---
title: Lync Server 2013：监视 Lync Server 性能
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Monitoring Lync Server 2013 performance
ms:assetid: 2acfd720-6120-4816-a2d4-30476bd5cd0e
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn720910(v=OCS.15)
ms:contentKeyID: 63969592
ms.date: 01/27/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: fb8f57d25f02102cd407a320ffc11f3e8ff9497c
ms.sourcegitcommit: 33db8c7febd4cf1591e8dcbbdfd6fc8e8925896e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/19/2020
ms.locfileid: "42149311"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="monitoring-lync-server-2013-performance"></a>监视 Lync Server 2013 性能

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**上次修改的主题：** 2014-05-15_

Lync Server 2013 的性能受到各种因素的影响，如用户配置文件、系统体系结构、软件、硬件组件、第三方集成点（例如网关和电话设备）、网络连接和性能、Windows除 Windows 操作系统功能之外的 Active Directory 服务配置和性能。

在 Lync Server 2013 部署的核心上，性能是实施它的服务器软件和硬件。 例如，前端服务器必须有足够的硬件资源来处理预期的（短期）用户负载。 如果需要使用相应的前端服务器来向10000用户提供服务，则经过充分配置的服务器必须满足预期的负载要求，才能最终帮助确保最佳的最终用户体验。

因此，监视服务器性能对于评估所实施的服务器基础结构是否有适合日常负载要求的硬件资源极其重要。 监视服务器性能有助于识别系统瓶颈，从而使管理员能够在最终用户体验受到影响之前应用纠正措施。 应使用性能数据进行长期容量规划。

[！注意] 有关要观测到的所有性能对象和计数器的详细信息均链接到[使用 System Center Operations Manager 监视 Lync Server 2013](lync-server-2013-monitoring-lync-server-with-system-center-operations-manager.md)，应遵循的一些性能计数器可以为管理员提供系统性能的快速视图：

  - 为了跟踪前端服务器的整体系统运行状况，良好的起始点是检查处理器\\的处理器时间。 该值应始终低于80%。

  - 若要跟踪前端池使用的后端 SQL Server 数据库软件实例的性能，请监视以下性能计数器：
    
    LC： USrv –00– DBStore\\USrv –002–队列延迟（毫秒）
    
    LC： USrv –00– DBStore\\USrv – 0 04 –过程延迟（毫秒）
    
    处于稳定状态的正常服务器应显示\<100 毫秒延迟值。 当延迟达到12秒时，将会进行限制机制，这意味着前端服务器开始将请求限制到后端。 这会导致客户端收到 "503 服务器太忙" 错误消息。

  - 若要跟踪前端服务器的处理时间，请监视以下计数器：
    
    LC： SIP-07-Load Management\\SIP-000-传入邮件的平均保留时间
    
    这是前端服务器上的另一种限制机制，这一次是在前端处理时间较高时开始。 如果平均处理时间超过6秒，则服务器将进入限制模式，并且每个客户端连接只允许一个未完成的事务。

  - 若要跟踪 SQL 后端服务器上的内存问题，请监视以下计数器：
    
    SQL Server 缓冲区管理\\器页生命预期
    
    低值低于3600秒（加上高延迟写入次数/秒和检查点页数/秒）表示内存压力。

<div>

## <a name="additional-counters-to-view"></a>要查看的其他计数器

有几个关键计数器是前端服务器的总体运行状况的良好指示器。 这并不是一个完整的列表，并不是为了确定根本原因。 这些计数器将允许你对服务器运行状况执行快速检查。 建议在池中的每台服务器上验证这些计数器。 在服务器运行正常时，了解这些计数器的值是非常重要的。 需要使用基准来了解在用户体验降级时所做的更改。

前端服务器可以指示可能由系统中其他地方的瓶颈导致的问题。 这意味着，它是查看整体系统运行状况时的最佳开始位置。

要首先查看的两个额外的计数器如下所示：

LC： USrv-00-DBStore\\USrv-002-队列延迟（毫秒）

LC： USrv-00-DBStore\\USrv-004-过程延迟（毫秒）

Queue counter 计数器表示队列中的请求在后端所用的时间，而处理程序延迟表示后端处理请求所用的时间。 如果出于任何原因导致后端的磁盘、内存、网络和处理器出现问题，则队列延迟计数器将较高。

如果前端和后端之间存在较高的网络延迟，则它也可能很高。 那么，可接受的队列延迟是什么？

在12秒时，前端服务器开始对后端服务器的限制请求。 这意味着服务器开始向客户端返回的服务器太忙–503错误。 正常运行的服务器应具有低于100毫秒的 DBStore 队列延迟，但在服务器刚刚联机且同时用户同时登录时，该计数器可能会非常高，甚至你可能会看到它在数秒内遇到了多次。

您可以使用负载平衡配置，其中包含多台前端服务器部署的池和配置为 "最少连接数" 的负载平衡器。 在这种情况下，如果一台前端服务器重新启动，则尝试重新连接的所有用户都将指向重新启动的服务器，因为与其他池成员相比，该服务器的连接数较少。 在这段时间内，可能会重载相应的前端服务器，而其他池成员则不会。

我们建议您在非工作时间执行维护以降低性能影响，因为用户不会同时与服务器同时连接到服务器。

如果前两个性能计数器较高，则最可能的瓶颈是 SQL 后端服务器。 下一个要确认的组件如下所示：

  - SQL Server CPU 是否过高？ 例如，它是否大于80%？

  - 磁盘延迟是否为高？

在理想的世界中，有足够的 RAM 将 RTC 和 RTCDYN 数据库同时存储在内存中。 然后，服务器将访问磁盘的唯一原因是写入日志文件并刷新数据库。 测试显示，12 GB RAM 足以满足100000用户部署的需要。 这假定 RTC 和 RTCDYN 数据库的大小总和小于 12 GB。 如果您的数据库大于该数据库，则可能需要额外的内存。

您可以通过查看 SQL Server 缓冲区管理器页生命预期性能计数器来确定您的 SQL Server 是否需要额外的 RAM。 小于3600的值表示内存压力。 如果有足够的内存，您还应该在数据库驱动器上看不到读取的内容，因为 SQL Server 只应写入数据库。

如果服务器处理时间较高，则会在启动 Lync Server 2013 前端服务器时启动其他限制机制。 仅当对 SQL Server 的延迟较高时，才会启用 DBStore 延迟限制。 启用此限制的一个示例是，如果前端服务器是 CPU 界限的。

如果服务器上的平均处理时间 **（LC：针对传入邮件的\\"LC： Sip-Load Management sip-000 –平均保留时间"）** 超过6秒，则服务器将进入限制模式，并只为用户提供每个客户端连接一个未完成的事务。 在处理时间降到3秒后，服务器将断开限制模式，并为用户提供每个客户端连接20个未完成的事务。 只要特定连接上的事务数超过上述阈值，该连接将被标记为 "以流方式控制"。 结果是服务器不会在其上发布任何接收，而**LC： SIP-01 对等\\流控制的连接**计数器将递增。 如果连接在受流控制的状态中保持一分钟以上，则服务器将关闭该连接。 它会以延迟的方法执行此操作。 如果有机会检查连接，它将确定它是否被限制为太长，如果超过一分钟，则关闭该连接。

这些是两种限制机制，并且有一个性能计数器，用于汇总服务器执行的操作（如果有）（如果有）限制。

**LC： SIP-04-响应\\SIP-053-本地503响应数/秒**

  - 上一个计数器中的 "Local" 一词指的是本地生成的响应。

  - 503代码对应于服务器不可用，您不应在正常服务器上看到任何503代码。 在服务器刚联机后的一段时间内，您可能会看到一些503代码。 当所有用户重新登录并返回到稳定状态时，不应再添加503个代码。

**LC： SIP-04-响应\\SIP-074-本地504响应数/秒**

此性能计数器指示其他服务器的连接问题，它可能指示连接失败或连接延迟。 如果您看到504错误，则应检查以下性能计数器。

**LC： SIP-01-对\\等 sip-017-发送未完成**

此计数器指示传出排队的请求和响应的数量。 如果此计数器较高，则问题很可能不在本地服务器上。 请注意，如果存在网络延迟问题，此计数器可能很高。 它还可能指示本地网络适配器存在问题，但更可能是由远程服务器上的问题导致的。 当要与之进行通信的池超载时，此计数器很可能在控制器服务器上是很高的。 此计数器的关键是查看实例，而不仅仅是总数。

</div>

</div>

<span> </span>

</div>

</div>

</div>

