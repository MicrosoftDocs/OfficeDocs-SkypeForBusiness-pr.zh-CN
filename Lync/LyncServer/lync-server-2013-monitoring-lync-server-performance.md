---
title: 'Lync Server 2013: 监视 Lync 服务器性能'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Monitoring Lync Server 2013 performance
ms:assetid: 2acfd720-6120-4816-a2d4-30476bd5cd0e
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn720910(v=OCS.15)
ms:contentKeyID: 63969592
ms.date: 01/27/2015
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: a9610dddfa9748b7d28dfe040a36214f3f969826
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/11/2019
ms.locfileid: "34826743"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="monitoring-lync-server-2013-performance"></a>监视 Lync Server 2013 性能

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**主题上次修改时间:** 2014-05-15_

Lync Server 2013 的性能受到各种因素的影响, 如用户配置文件、系统体系结构、软件、硬件组件、第三方集成点 (如网关和电话设备)、网络连接和性能、Windows除 Windows 操作系统功能之外的 Active Directory 服务配置和性能。

在 Lync Server 2013 部署的核心中, "性能" 是指实施它的服务器软件和硬件。 例如, 前端服务器必须有足够的硬件资源来处理预期的 (短期) 用户负载。 如果需要使用各自的前端服务器向10000用户提供服务, 则配置良好的服务器必须满足预期的负载要求, 才能最终帮助确保最佳的最终用户体验。

因此, 监视服务器性能非常重要, 可衡量已实现的服务器基础结构是否具有适用于日常峰值负载要求的硬件资源。 监视服务器性能有助于标识系统瓶颈, 从而允许管理员在最终用户体验受到影响之前应用纠正操作。 应使用性能数据进行长期容量规划。

尽管要观察的所有性能对象和计数器的详细信息均链接到[使用 System Center Operations Manager 监视 Lync Server 2013](lync-server-2013-monitoring-lync-server-with-system-center-operations-manager.md)中, 但你应该关注的一些性能计数器可以为管理员提供快速查看系统性能:

  - 为了跟踪前端服务器的整体系统运行状况, 良好的起始点是检查处理器\\的处理器时间。 该值应始终小于 80%。

  - 若要跟踪前端池使用的后端 SQL Server 数据库软件实例的性能, 请监视以下性能计数器:
    
    LC: USrv –00– DBStore\\USrv – 002-队列延迟 (毫秒)
    
    LC: USrv-DBStore\\USrv-0 04 –过程延迟 (毫秒)
    
    处于稳定状态的正常服务器应显示\<100 ms 滞后时间值。 当延迟达到12秒时, 节流机制将会起到这种情况, 这意味着前端服务器会将请求限制到后端。 这使客户端能够接收503服务器太忙的错误消息。

  - 若要跟踪前端服务器的处理时间, 请监视以下计数器:
    
    LC: SIP-2007-加载管理\\SIP-000-接收邮件的平均保留时间
    
    这是前端服务器上的另一限制机制, 这次在前端处理时间较高时开始。 如果平均处理时间超过6秒, 则服务器将进入阻止模式, 并仅允许每个客户端连接一个未完成的事务。

  - 若要在 SQL 后端服务器上跟踪内存问题, 请监视以下计数器:
    
    SQL Server 缓冲区管理\\器页生命预期
    
    小于3600秒的低值 (与高延迟写入/秒和检查点页/秒一起) 表示内存压力。

<div>

## <a name="additional-counters-to-view"></a>要查看的其他计数器

有多个关键计数器是前端服务器的整体运行状况的很好指示器。 这不是一个完整的列表, 也不是为了找出根本原因。 这些计数器将允许你对服务器运行状况执行快速检查。 我们建议在池中的每台服务器上验证这些计数器。 当服务器运行正常时, 了解这些计数器值的含义非常重要。 需要使用基准来了解在用户体验下降时所发生的更改。

前端服务器可以指示可能由系统中其他地方的瓶颈导致的问题。 这意味着它是查看整个系统运行状况的最佳起点。

要首先查看的两个其他计数器如下所示:

LC: USrv-DBStore\\USrv-002-队列延迟 (毫秒)

LC: USrv-DBStore\\USrv-004-过程延迟 (毫秒)

Queue 延迟计数器表示请求在队列中的后端的时间, 而 "处理程序延迟" 表示用于处理请求的后端所花费的时间。 如果由于任何原因而后端的磁盘、内存、网络和处理器出现问题, 则队列延迟计数器将很高。

如果前端和后端之间存在较高的网络延迟, 它也会很高。 那么, 哪些队列延迟是可接受的？

在12秒后, 前端服务器将对后端服务器启动限制请求。 这意味着服务器开始返回的服务器太忙-503 错误会出现在客户端。 正常状态的服务器在稳定状态下应具有小于100毫秒的 DBStore 队列等待时间, 但在服务器刚刚联机且用户同时登录的时间段内, 该计数器可能会非常高, 甚至你可能会看到它遇到了多长时间。

你可能具有负载平衡的配置, 其中包含使用多个前端服务器部署的池和配置为 "最少连接数" 的负载平衡器。 在这种情况下, 如果重新启动了一个前端服务器, 则尝试重新连接的所有用户都将指向重新启动的服务器, 因为该服务器与其他池成员相比的连接较少。 在这段时间内, 可能会重载相应的前端服务器, 而其他池成员则不会。

我们建议你在非工作时间内执行维护以减少性能影响, 因为用户不会同时与服务器同时连接。

如果前两个性能计数器较高, 则最可能的瓶颈是 SQL 后端服务器。 要确认的下一个组件如下所示:

  - SQL Server CPU 是否太高？ 例如, 它是否大于 80%？

  - 磁盘延迟是否高？

在理想的世界中, 你有足够的 RAM 在内存中同时具有 RTC 和 RTCDYN 数据库。 然后, 服务器访问该磁盘的唯一原因是写入日志文件并刷新数据库。 测试显示, 12 GB RAM 足以满足100000用户部署的需要。 这假设 RTC 和 RTCDYN 数据库的大小不超过 12 GB。 如果你的数据库大于该数据库, 则你可能需要额外的内存。

你可以通过查看 SQL Server 缓冲区管理器页面寿命性能计数器确定你的 SQL Server 是否需要其他 RAM。 小于3600的值表示内存压力。 如果您有足够的内存, 您还可以在数据库驱动器上看不到任何读取, 因为 SQL Server 只能写入数据库。

如果服务器处理时间较高, 则在 Lync Server 2013 前端服务器中有一种额外的限制机制。 仅当 SQL Server 的延迟较高时, DBStore 延迟限制才会启用。 启用此限制的一个示例是在前端服务器受 CPU 限制的情况中。

如果在服务器上的平均处理时间 **(LC:07-07\\-Load Management sip-000-每次保留邮件的平均保留时间)** 超过6秒, 则服务器将进入阻止模式, 并仅为用户提供一个未完成的事务。客户端连接。 当处理时间降到3秒后, 服务器将断开阻止模式, 并为用户提供每个客户端连接20个未完成的事务。 只要特定连接的事务数超过上述阈值, 连接将被标记为 "流控制"。 结果是服务器不会在其上发布任何接收, 并且**LC: SIP 对等\\流控制的连接**计数器将递增。 如果连接处于流控制状态的时间超过一分钟, 则服务器将其关闭。 这样做会发生延迟。 当它有机会检查连接时, 它会确定它是否被限制太长, 如果超过一分钟, 则将其关闭。

这些是两种限制机制, 并且有一个性能计数器, 用于汇总服务器执行的限制 (如果有)。

**LC: SIP-04-响应\\SIP-053-本地503响应/秒**

  - 以前计数器中的术语 "本地" 指本地生成的响应。

  - 503代码对应于服务器不可用, 您在正常服务器上不应看到任何503代码。 在服务器刚联机的期间, 您可能会看到一些503代码。 当所有用户重新登录, 并且服务器返回到稳定状态时, 不应该有其他503代码。

**LC: SIP-04-响应\\SIP-074-本地504响应/秒**

此性能计数器指示其他服务器的连接问题, 并且它可以指示连接失败或连接延迟。 如果看到504错误, 则应选中以下性能计数器。

**LC: SIP-01-对\\等 sip-017-发送未完成**

此计数器表示传出的排队请求和响应的数量。 如果此计数器较高, 则问题很可能不在本地服务器上。 请注意, 如果存在网络延迟问题, 此计数器可能会很高。 它还可以指示本地网络适配器的问题, 但更可能是由于远程服务器上的问题导致的。 当它尝试与其通信的池超载时, 此计数器最有可能在控制器服务器上很高。 此计数器的键是查看实例, 而不仅仅是总数。

</div>

</div>

<span> </span>

</div>

</div>

</div>

