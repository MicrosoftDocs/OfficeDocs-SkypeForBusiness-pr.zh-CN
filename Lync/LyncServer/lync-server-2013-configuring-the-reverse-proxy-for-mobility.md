---
title: Lync Server 2013：配置反向代理以实现移动功能
TOCTitle: 配置反向代理以实现移动功能
ms:assetid: 3f4a9e33-77e4-4c18-a73f-24d4bec8ea9c
ms:mtpsurl: https://technet.microsoft.com/zh-cn/library/Hh690011(v=OCS.15)
ms:contentKeyID: 49312605
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 在 Lync Server 2013 中配置反向代理以实现移动功能

 

_**上一次修改主题：** 2014-03-20_

如果要对移动设备客户端使用自动发现，您需要为反向代理修改现有 Web 发布规则或创建一条新的 Web 发布规则，无论是否更新反向代理证书上的使用者替代名称列表都是如此。

如果您决定对初始 Lync Server 2013 自动发现服务请求使用 HTTPS，并决定更新反向代理证书上的使用者替代名称列表，则需要向反向代理上的安全套接字层 (SSL) 侦听器分配已更新的公共证书。有关所需的使用者替代名称条目的详细信息，请参阅 [Lync Server 2013 中的移动性技术要求](lync-server-2013-technical-requirements-for-mobility.md)。随后，您需要为外部 Web 服务修改现有侦听器或为外部自动发现服务 URL 创建一条新的 Web 发布规则。如果您的 前端池的外部 Lync Server 2013 Web 服务 URL 尚不具有 Web 发布规则，则您还需为其发布一条规则。

> [!NOTE]  
> 只要分配给侦听器的证书同时包含针对外部 Web 服务和自动发现服务的必要的使用者名称和使用者替代名称，反向代理发布规则和侦听器就可以为这两种服务提供服务。有关 Web 侦听器和发布规则的默认配置的详细信息，请参阅 <a href="lync-server-2013-setting-up-reverse-proxy-servers.md">为 Lync Server 2013 设置反向代理服务器</a>。



如果您决定对初始自动发现服务请求使用 HTTP 以便无需更新反向代理的使用者替代名称，则需要为端口 80 创建或修改一条 Web 发布规则。

本节中的过程介绍如何使用 Microsoft Forefront Threat Management Gateway 2010 创建或修改一条 Web 发布规则以实现自动发现。

> [!NOTE]  
> 这些过程假定您已安装 Forefront Threat Management Gateway (TMG) 2010 Standard Edition。如果您使用另一个反向代理，则这些过程是类似的，只不过需要将其映射到第三方产品的文档。



## 为外部自动发现 URL 创建 Web 发布规则

1.  单击“开始”，指向“程序”，再指向“Microsoft Forefront TMG”，然后单击“Forefront TMG 管理”。

2.  在左侧窗格中，展开“服务器名称”，右键单击“防火墙策略”，选择“新建”，然后单击“网站发布规则”。

3.  在“欢迎使用新建 Web 发布规则向导”页上，为发布规则键入一个显示名称（例如 LyncDiscoveryURL）。

4.  在“选择规则操作”页上，选择“允许”。

5.  在“发布类型”页上，选择“发布单个网站或负载平衡器”。

6.  在“服务器连接安全性”页上，选择“使用 SSL 连接到发布的 Web 服务器或服务器场”。

7.  在“内部发布详细信息”页的“内部站点名称”框中，键入 控制器池 的完全限定域名 (FQDN)（例如，lyncdir01.contoso.local）。如果要为 前端池 上的外部 Web 服务 URL 创建规则，请在 前端池 之前键入硬件负载平衡器 (HLB) 的 VIP 地址。

8.  在“内部发布详细信息”页的“路径(可选)”框中键入 **/\*** 作为要发布的文件夹的路径，然后选择“转发原始主机头”。

9.  在“公共名称细节”页上，执行以下操作：
    
      - 在“接受请求”中，选择“此域名”。
    
      - 在“公共名称”中，键入 **lyncdiscover.***\<sipdomain\>*（外部自动发现服务 URL）。如果要为前端池上的外部 Web 服务 URL 创建规则，请键入前端池上的外部 Web 服务的 FQDN（例如，lyncwebextpool01.contoso.com）。
    
      - 在“路径”中，键入 **/\***。

10. 在“选择 Web 侦听器” 页上的“Web 侦听器”中，选择具有已更新的公共证书的现有 SSL 侦听器。

11. 在“身份验证委派”页上，选择“无委派，但是客户端可以直接进行身份验证”。

12. 在“用户集”页上，选择“所有用户”。

13. 在“正在完成新建 Web 发布规则向导”页上，确认 Web 发布规则设置正确，然后单击“完成”。

14. 在 Web 发布规则的 Forefront TMG 列表中，双击您刚添加的新规则以打开“属性”。

15. 在“收件人”选项卡上，执行以下操作：
    
      - 选中“转发原始主机头，而不是实际主机头”。
    
      - 选择“使请求显示为来自 Forefront TMG 计算机”。

16. 在“桥接”选项卡上，配置以下设置：
    
      - 选择“Web 服务器”。
    
      - 选择“将请求重定向到 HTTP 端口”，并键入 **8080** 作为端口号。
    
      - 选择“将请求重定向到 SSL 端口”，并键入 **4443** 作为端口号。

17. 单击“确定”。

18. 在详细信息窗格中，单击“应用”，以保存所做的更改并更新配置。

19. 单击“测试规则”以验证是否正确设置了新规则。

## 修改现有 Web 发布规则以添加外部自动发现 SAN 和 URL

1.  单击“开始”，指向“程序”，再指向“Microsoft Forefront TMG”，然后单击“Forefront TMG 管理”。
    
    > [!IMPORTANT]
    > 您将对您拥有的每个发布规则和侦听器重复进行此修改。通常，有一个针对 前端池的规则和侦听器，并且有一个针对可选的 控制器或 控制器池的规则和侦听器，前提是已部署二者。


2.  在左窗格中展开“服务器名称”，右键单击“防火墙策略”，再单击适用的规则。在“任务”选项卡上，单击“编辑所选规则”。

3.  在“公共名称”选项卡上的“此规则应用于”中，选择“以下网站的请求”。

4.  单击“添加”，键入新的自动发现网站的名称（例如，“lyncdiscover.contoso.com”），然后单击“确定”。

5.  在“侦听器”选项卡上，单击“选择证书”并指定具有添加的自动发现 SAN 条目的新证书。 关闭侦听器和 Web 发布属性。

6.  在详细信息窗格中，单击“应用”，以保存所做的更改并更新配置。

7.  单击“测试规则”以验证是否正确设置了新规则。

## 为端口 80 创建 Web 发布规则

1.  单击“开始”，指向“程序”，再指向“Microsoft Forefront TMG”，然后单击“Forefront TMG 管理”。

2.  在左侧窗格中，展开“服务器名称”，右键单击“防火墙策略”，选择“新建”，然后单击“网站发布规则”。

3.  在“欢迎使用新建 Web 发布规则向导”页上，为新的发布规则键入一个显示名称（例如，Lync Autodiscover (HTTP)）。

4.  在“选择规则操作”页上，选择“允许”。

5.  在“发布类型”页上，选择“发布单个网站或负载平衡器”。

6.  在“服务器连接安全性”页上，选择“使用不安全的连接连接发布的 Web 服务器或服务器场”。

7.  在“内部发布详细信息”页的“内部站点名称”中，在 前端池 之前键入硬件负载平衡器 (HLB) 的 VIP 地址。

8.  在“内部发布详细信息”页上的“路径(可选)”中，键入 **/\***作为要发布的文件夹的路径，然后选择“转发原始主机头而不是内部站点名称字段中指定的主机头”。

9.  在“公共名称细节”页上，执行以下操作：
    
      - 在“接受请求”中，选择“此域名”。
    
      - 在“公共名称”中，键入 **lyncdiscover.***\<sipdomain\>*（外部自动发现服务 URL）。
    
      - 在“路径”中，键入 **/\***。

10. 在“选择 Web 侦听器”页上的“侦听器”中，选择 Web 侦听器或使用新建 Web 侦听器定义向导新建一个 Web 侦听器。

11. 在“身份验证委派”页上，选择“无委派，并且客户端无法直接进行身份验证”。

12. 在“用户集”页上，选择“所有用户”。

13. 在“正在完成新建 Web 发布规则向导”页上，确认 Web 发布规则设置正确，然后单击“完成”。

14. 在 Web 发布规则的 Forefront TMG 列表中，双击您刚添加的新规则以打开“属性”。

15. 在“桥接”选项卡上，配置以下设置：
    
      - 选择“Web 服务器”。
    
      - 选择“将请求重定向到 HTTP 端口”，并键入 **8080** 作为端口号。
    
      - 确认未选中“将请求重定向到 SSL 端口”。

16. 单击“确定”。

17. 在详细信息窗格中，单击“应用”，以保存所做的更改并更新配置。

18. 单击“测试规则”以验证是否正确设置了新规则。

19. 确认未针对任何其他 Web 发布规则定义外部自动发现服务 URL。

## 另请参阅

#### 概念

[为 Lync Server 2013 设置反向代理服务器](lync-server-2013-setting-up-reverse-proxy-servers.md)  
[Lync Server 2013 中的移动性技术要求](lync-server-2013-technical-requirements-for-mobility.md)

