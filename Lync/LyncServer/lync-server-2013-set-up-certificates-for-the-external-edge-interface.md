---
title: Lync Server 2013：为外部边缘接口设置证书
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Set up certificates for the external edge interface
ms:assetid: 5d78182c-88d8-4483-95ad-74b17f2d5fac
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg398409(v=OCS.15)
ms:contentKeyID: 48184287
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: c1c836191c19eeadd915d0263c89b52289f60fe9
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/04/2020
ms.locfileid: "41764668"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="set-up-certificates-for-the-external-edge-interface-for-lync-server-2013"></a>为 Lync Server 2013 的外部边缘接口设置证书

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**主题上次修改时间：** 2012-09-08_

<div>


> [!IMPORTANT]  
> 当你运行证书向导时，请确保你使用的帐户是已为你将使用的证书模板类型分配了相应权限的组的成员。 默认情况下，Lync Server 证书请求将使用 Web 服务器证书模板。 如果您使用的帐户是 RTCUniversalServerAdmins 组的成员以使用此模板申请证书，请验证该组是否已分配使用该模板所需的注册权限。



</div>

每个边缘服务器在外围网络和 Internet 之间的接口上需要一个公共证书，并且证书的 "使用者备用名称" 必须包含 "访问边缘" 服务和 "网络会议边缘" 服务的外部名称。完全限定的域名（Fqdn）。

有关此和其他证书要求的详细信息，请参阅[Lync Server 2013 中的外部用户访问证书要求](lync-server-2013-certificate-requirements-for-external-user-access.md)。

对于公共证书颁发机构（Ca）的列表，该列表提供符合统一通信证书特定要求的证书，并与 Microsoft 合作以确保它们与 Lync Server 2013 证书向导配合使用，请参阅 Microsoft 知识库文章929395，"适用于 Exchange Server 的统一通信证书合作伙伴和通信服务器" [http://go.microsoft.com/fwlink/p/?linkId=202834](http://go.microsoft.com/fwlink/p/?linkid=202834)。

<div>

## <a name="configuring-certificates-on-the-external-interfaces"></a>在外部接口上配置证书

若要在网站上的外部边缘界面上设置证书，请使用本部分中的过程执行下列操作：

  - 为 Edge 服务器的外部接口创建证书请求。

  - 向您的公共 CA 提交请求。

  - 导入每个边缘服务器的外部接口的证书。

  - 为每个边缘服务器的外部接口分配证书。

  - 如果你的部署包含多台边缘服务器，请导出证书及其私钥，然后将其复制到其他边缘服务器。 然后，对于每个边缘服务器，将其导入并按上文所述进行分配。 对每个边缘服务器重复此过程。

你可以直接从公共证书颁发机构（CA）请求公共证书（如从公共 CA 的网站）。 本部分中的过程对大多数证书任务使用证书向导。 如果您选择直接从公共 CA 申请证书，则需要根据需要修改每个过程来请求、传输和导入证书，还需要导入证书链。

从外部 CA 申请证书时，所提供的凭据必须具有从该 CA 请求证书的权限。 每个 CA 都有一个安全策略，用于定义允许哪些凭据（即特定用户和组名称）请求、颁发、管理或读取证书。

如果你决定使用证书 Microsoft 管理控制台（MMC）导入证书链和证书，则必须将它们导入到计算机的证书存储。 如果将它们导入到用户或服务证书存储，则该证书在 Lync Server 2013 证书向导中将不可用于作业。

<div>

## <a name="to-create-the-certificate-request-for-the-external-interface-of-the-edge-server"></a>为边缘服务器的外部接口创建证书请求

1.  在边缘服务器上的 "部署向导" 中，在 "**步骤3：请求、安装或分配证书**" 旁边，再次单击 "**运行**"。
    
    <div>
    

    > [!NOTE]  
    > 如果您的组织希望支持使用 AOL 的公共即时消息（IM）连接，则不能使用 Lync Server 部署向导申请证书。 请改为在本主题后面的 "为边缘服务器的外部接口创建证书请求以支持公共 IM 连接" 过程中执行 "为边缘服务器的外部接口创建证书请求" 中的步骤。<BR>如果在池中的一个位置有多个边缘服务器，则可以在任何一个边缘服务器上运行 Lync Server 2013 证书向导。

    
    </div>

2.  在“**可用的证书任务**”页上，单击“**创建新的证书请求**”。

3.  在 "**证书请求**" 页面上，单击 "**外部边缘证书**"。

4.  在 "**延迟或立即请求**" 页面上，选中 "**立即准备请求，但稍后发送"** 复选框。

5.  在 "**证书请求文件**" 页面上，键入要保存请求的文件的完整路径和文件名（例如，c：\\cert\_外部\_edge）。

6.  在 "**指定备用证书模板**" 页面上，若要使用默认 web 台模板之外的模板，请选中 "**为所选证书颁发机构使用备用证书模板**" 复选框。

7.  在 "**名称和安全设置**" 页面上，执行下列操作：
    
      - 在 "**友好名称**" 中，键入证书的显示名称。
    
      - 在 "**位长度**" 中，指定位长度（通常为默认值**2048**）。
    
      - 验证 "将**证书私钥标记为可导出**" 复选框是否已选中。

8.  在 "**组织信息**" 页面上，键入组织和组织单位的名称（例如，"部门" 或 "部门"）。

9.  在 "**地理信息**" 页面上，指定位置信息。

10. 在 "**主题名称/主题备用名称**" 页面上，将显示要由向导自动填充的信息。 如果需要其他主题备用名称，请在接下来的两个步骤中进行指定。

11. 在 "**主题备用名称（san）** " 页面上的 "SIP 域设置" 中，选中 "域" 复选框以添加 SIP。\<sipdomain\>条目到 "主题备用名称" 列表。

12. 在 "**配置其他主题备用名称**" 页面上，指定所需的任何其他主题备用名称。

13. 在 "**请求摘要**" 页面上，查看要用于生成请求的证书信息。

14. 命令运行完毕后，请执行下列操作：
    
      - 若要查看证书请求的日志，请单击 "**查看日志**"。
    
      - 若要完成证书请求，请单击 "**下一步**"。

15. 在 "**证书请求文件**" 页面上，执行下列操作：
    
      - 若要查看生成的证书签名请求（CSR）文件，请单击 "**查看**"。
    
      - 若要关闭向导，请单击“**完成**”。

16. 将输出文件复制到可将其提交到公共 CA 的位置。

</div>

<div>

## <a name="to-create-a-certificate-request-for-the-external-interface-of-the-edge-server-to-support-public-im-connectivity-with-aol"></a>为边缘服务器的外部接口创建证书请求以支持与 AOL 的公共 IM 连接

1.  当需要的模板可供 CA 使用时，请从 Edge 服务器使用以下 Windows PowerShell cmdlet 来申请证书：
    
        Request-CsCertificate -New -Type AccessEdgeExternal  -Output C:\ <certfilename.txt or certfilename.csr>  -ClientEku $true -Template <template name>
    
    Lync Server 2013 中提供的模板的默认证书名称是 Web 服务器。 仅当需要\<使用不同\>于默认模板的模板时，才指定模板名称。
    
    <div>
    

    > [!NOTE]  
    > 如果你的组织希望支持与 AOL 的公共 IM 连接，你必须使用 Windows PowerShell 而不是证书向导请求将证书分配给访问边缘服务的外部边缘。 这是因为证书向导用于申请证书的 Lync Server 2013 Web 服务器模板不支持客户端 EKU 配置。 在使用 Windows PowerShell 创建证书之前，CA 管理员必须创建和部署支持客户端 EKU 的新模板。

    
    </div>

</div>

<div>

## <a name="to-submit-a-request-to-a-public-certification-authority"></a>将请求提交到公共证书颁发机构

1.  打开输出文件。

2.  复制并粘贴证书签名请求（CSR）的内容。

3.  如果出现提示，请指定以下内容：
    
      - **Microsoft**作为服务器平台。
    
      - 作为版本的**IIS** 。
    
      - **Web 服务器**用作使用类型。
    
      - **PKCS7**作为响应格式。

4.  当公共 CA 验证您的信息后，您将收到一封电子邮件，其中包含您的证书所需的文本。

5.  复制电子邮件中的文本，并将内容保存在本地计算机上的文本文件（.txt）中。

</div>

<div>

## <a name="to-import-the-certificate-for-the-external-interface-of-the-edge-server"></a>导入边缘服务器的外部接口的证书

1.  以管理员组的成员身份登录到创建证书请求的同一边缘服务器。

2.  在部署向导的 "**部署边缘服务器**" 页面上，在 "**步骤3：请求、安装或分配证书**" 旁边，**再次**单击 "运行"。

3.  在 "**可用证书任务**" 页面上，单击 "**从 p7b、.pfx 或 .Cer 文件导入证书"**。

4.  在 "**导入证书**" 页面上，单击 "**浏览**" 以查找并选择你为 Edge 服务器的外部接口请求的证书（或者，你可以键入完整路径和文件名）。 如果证书包含私钥，请选择 "**证书文件包含证书的私钥**"，然后键入私钥的密码。 单击" **下一步**"。

5.  在 "**导入证书摘要**" 页面上，查看摘要，然后单击 "**下一步**"。

6.  在**执行命令**时，查看导入的结果，单击 "**查看日志**以了解详细信息"，然后单击 "**完成**" 以完成证书导入。

7.  如果你要配置 Edge 服务器池，请按照本主题后面部分的 "导出证书中包含 Edge 服务器的私钥" 过程中所述，导出证书及其私钥。 将导出的证书文件复制到其他边缘服务器，然后将其导入到每台边缘服务器上的计算机存储中。

</div>

<div>

## <a name="to-export-the-certificate-with-the-private-key-for-edge-servers-in-a-pool"></a>导出具有池中的边缘服务器的私钥的证书

1.  以管理员组成员的身份登录到您在其中导入证书的同一边缘服务器。

2.  单击 "**开始**"，单击 "**运行**"，然后键入 " **MMC**"。

3.  在 Microsoft 管理控制台（MMC）控制台中，单击 "**文件**"，然后单击 "**添加/删除管理单元**"。

4.  在 "**添加或删除管理单元**" 中，单击 "**证书**"，然后单击 "**添加**"。

5.  在 "**证书**" 对话框中，选择 "**计算机帐户**"，单击 "**下一步**"，选择 "**本地计算机：" （运行此控制台的计算机）** ，单击 "**完成**" **，然后**单击 **"确定"** 以完成 MMC 控制台的配置。

6.  双击 "**证书（本地计算机）** " 以展开证书存储，双击 "**个人**"，然后双击 "**证书**"。
    
    <div>
    

    > [!IMPORTANT]  
    > 如果本地计算机的 "证书个人" 存储中没有证书，则没有与导入的证书相关联的私钥。 查看请求和导入步骤。 如果问题仍然存在，请联系您的证书颁发机构管理员或提供商。

    
    </div>

7.  在**本地计算机的 "证书个人" 存储**中，右键单击要导出的证书，单击 "**所有任务**"，然后单击 "**导出**"。

8.  在 "证书导出向导" 中，单击 "**下一步**"，选择 **"是，导出私钥**"，然后单击 "**下一步**"。
    
    <div>
    

    > [!NOTE]  
    > 如果选择<STRONG>"是"，则导出私钥</STRONG>不可用，与此证书关联的私钥未标记为 "导出"。 您需要再次申请证书，确保证书已标记为允许导出私钥，然后您才能继续导出操作。 联系您的证书颁发机构管理员或提供商。

    
    </div>

9.  在 "导出文件格式" 对话框中，选择 "**个人信息\#交换-PKCS 12 （。PFX）** ，然后选择以下操作：
    
      - 如果可能，包括证书路径中的所有证书
    
      - 导出所有扩展属性
        
        <div>
        

        > [!WARNING]  
        > 从边缘服务器导出证书时，如果导出成功，请勿选择 "<STRONG>删除私钥"</STRONG>。 选择此选项将要求你将证书和私钥导入此 Edge 服务器。

        
        </div>

10. 单击" **下一步**"。

11. 键入私钥的密码，再次键入密码进行确认，然后单击 "**下一步**"。

12. 为导出的证书键入路径和文件名，并使用文件扩展名 .pfx。 该路径必须可由池中的所有其他边缘服务器访问，或可通过可移动媒体（例如，USB 闪存驱动器）进行传输。 单击" **下一步**"。

13. 查看**完成证书导出向导**中的摘要，然后单击 "**完成**"。

14. 在 "成功导出" 对话框中，单击 **"确定"**。

15. 按照本主题前面的 "导入用于边缘服务器的外部接口的证书" 过程中所述的步骤将导出的证书文件导入其他边缘服务器。

</div>

<div>

## <a name="to-assign-the-certificate-for-the-external-interface-of-the-edge-server"></a>为边缘服务器的外部接口分配证书

1.  在每个边缘服务器上的 "部署向导" 中，在 "**步骤3：请求、安装或分配证书**" 旁边，再次单击 "**运行**"。

2.  在 "**可用的证书任务**" 页面上，单击 "**分配现有证书**"。

3.  在 "**证书分配**" 页面上，单击 "**外部边缘证书**"，然后选中 "**高级证书用法**" 复选框。

4.  在 "**高级证书用法**" 页面上，选中 "所有复选框" 为所有使用实例分配证书。

5.  在 "**证书存储**" 页面上，选择为 Edge 服务器的外部接口请求和导入的公共证书。
    
    <div>
    

    > [!NOTE]  
    > 如果您请求和导入的证书不在列表中，则其中一种故障排除方法是验证证书的使用者名称和主题备用名称是否满足证书的所有要求，以及是否手动导入证书和证书链，而不是使用上述过程，而是证书位于正确的证书存储（计算机证书存储，而不是用户或服务证书存储）中。

    
    </div>

6.  在 "**证书分配摘要**" 页面上，查看您的设置，然后单击 "**下一步**" 以分配证书。

7.  在向导完成页上，单击“**完成**”。

8.  使用此过程分配边缘证书后，在每台服务器上打开 "证书" 管理单元，展开 "**证书（本地计算机）**"，展开 "**个人**"，单击 "**证书**"，然后验证 "详细信息" 窗格中是否列出了证书。

9.  如果你的部署包含多个边缘服务器，请为每个边缘服务器重复此过程。

</div>

</div>

</div>

<span> </span>

</div>

</div>

</div>

