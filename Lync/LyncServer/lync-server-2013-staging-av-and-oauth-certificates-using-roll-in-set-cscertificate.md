---
title: 在 Set-cscertificate 中使用-中间暂存 AV 和 OAuth 证书
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Staging AV and OAuth certificates using -Roll in Set-CsCertificate
ms:assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ660292(v=OCS.15)
ms:contentKeyID: 49354387
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: ee572bbf115d1e83476194b0e5c92859886da42f
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/21/2020
ms.locfileid: "42208399"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="staging-av-and-oauth-certificates-in-lync-server-2013-using--roll-in-set-cscertificate"></a><span data-ttu-id="3167d-102">使用-Set-cscertificate 中的 Lync Server 2013 暂存 AV 和 OAuth 证书</span><span class="sxs-lookup"><span data-stu-id="3167d-102">Staging AV and OAuth certificates in Lync Server 2013 using -Roll in Set-CsCertificate</span></span>

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

<span data-ttu-id="3167d-103">_**上次修改的主题：** 2012-11-13_</span><span class="sxs-lookup"><span data-stu-id="3167d-103">_**Topic Last Modified:** 2012-11-13_</span></span>

<span data-ttu-id="3167d-104">音频/视频（A/V）通信是 Microsoft Lync Server 2013 的关键组件。</span><span class="sxs-lookup"><span data-stu-id="3167d-104">Audio/Video (A/V) communications is a key component of Microsoft Lync Server 2013.</span></span> <span data-ttu-id="3167d-105">应用程序共享和音频和视频会议等功能依赖于为 A/V 边缘服务分配的证书，特别是 A/V 身份验证服务。</span><span class="sxs-lookup"><span data-stu-id="3167d-105">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>

<div>


> [!IMPORTANT]
> <OL>
> <LI>
> <P><span data-ttu-id="3167d-106">此新功能旨在适用于 A/V 边缘服务和<EM>OAuthTokenIssuer</EM>证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-106">This new feature is designed to work for the A/V Edge service and the <EM>OAuthTokenIssuer</EM> certificate.</span></span> <span data-ttu-id="3167d-107">其他证书类型可以与 A/V 边缘服务和 OAuth 证书类型一起设置，但不会从 A/V 边缘服务证书将受益的共存行为中受益。</span><span class="sxs-lookup"><span data-stu-id="3167d-107">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span></P>
> <LI>
> <P><span data-ttu-id="3167d-108">用于管理 Microsoft Lync Server 2013 证书的 Lync Server 命令行管理程序 PowerShell cmdlet 是指 A/V 边缘服务证书作为<EM>AudioVideoAuthentication</EM>证书类型，将 OAuthServer 证书称为类型<EM>OAuthTokenIssuer</EM>。</span><span class="sxs-lookup"><span data-stu-id="3167d-108">The Lync Server Management Shell PowerShell cmdlets used to manage Microsoft Lync Server 2013 certificates refers to the A/V Edge service certificate as the <EM>AudioVideoAuthentication</EM> certificate type and the OAuthServer certificate as type <EM>OAuthTokenIssuer</EM>.</span></span> <span data-ttu-id="3167d-109">在本主题的其余部分中，若要唯一标识证书，它们将通过相同的标识符类型<EM>AudioVideoAuthentication</EM>和<EM>OAuthTokenIssuer</EM>引用。</span><span class="sxs-lookup"><span data-stu-id="3167d-109">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, <EM>AudioVideoAuthentication</EM> and <EM>OAuthTokenIssuer</EM>.</span></span></P></LI></OL>



</div>

<span data-ttu-id="3167d-110">A/V 身份验证服务负责颁发供客户端和其他 A/V 使用者使用的令牌。</span><span class="sxs-lookup"><span data-stu-id="3167d-110">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="3167d-111">这些令牌是根据证书上的属性生成的，当证书到期时，会断开连接并需要用新证书生成的新令牌重新连接。</span><span class="sxs-lookup"><span data-stu-id="3167d-111">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="3167d-112">Lync Server 2013 中的一项新功能将缓解此问题–在旧证书即将过期并允许证书在一段时间内继续运行的功能。</span><span class="sxs-lookup"><span data-stu-id="3167d-112">A new feature in Lync Server 2013 will alleviate this problem – the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="3167d-113">此功能使用 Set-cscertificate Lync Server 命令行管理程序 cmdlet 中的更新功能。</span><span class="sxs-lookup"><span data-stu-id="3167d-113">This feature uses updated functionality in the Set-CsCertificate Lync Server Management Shell cmdlet.</span></span> <span data-ttu-id="3167d-114">新参数 –Roll 以及现有参数 –EffectiveDate 会将新 AudioVideoAuthentication 证书置于证书存储中。</span><span class="sxs-lookup"><span data-stu-id="3167d-114">The new parameter –Roll, with the existing parameter –EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="3167d-115">旧 AudioVideoAuthentication 证书仍将保留，以便根据该证书验证颁发的令牌。</span><span class="sxs-lookup"><span data-stu-id="3167d-115">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="3167d-116">随着新 AudioVideoAuthentication 证书的就绪，将发生以下一系列事件：</span><span class="sxs-lookup"><span data-stu-id="3167d-116">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>

<div>


> [!TIP]
> <span data-ttu-id="3167d-117">使用 Lync Server 命令行管理程序 cmdlet 管理证书，可以为边缘服务器上的每个用途请求单独和不同的证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-117">Using the Lync Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="3167d-118">使用 Lync Server 部署向导中的 "证书向导" 可帮助您创建证书，但通常会将边缘服务器的所有证书使用的<STRONG>默认</STRONG>类型集中到一个证书上。</span><span class="sxs-lookup"><span data-stu-id="3167d-118">Using the Certificate Wizard in the Lync Server Deployment Wizard assists you in creating certificates, but is typically of the <STRONG>default</STRONG> type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="3167d-119">如果要使用滚动证书功能，建议的做法是将 AudioVideoAuthentication 证书与其他证书用途分离开。</span><span class="sxs-lookup"><span data-stu-id="3167d-119">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="3167d-120">您可以设置和暂存默认类型的证书，但只有已合并证书的 AudioVideoAuthentication 部分将从暂存中受益。</span><span class="sxs-lookup"><span data-stu-id="3167d-120">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="3167d-121">在证书过期时，参与（例如）即时消息对话的用户需要注销，然后重新登录以使用与访问边缘服务关联的新证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-121">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="3167d-122">对于使用 Web 会议边缘服务的 Web 会议中涉及的用户，将发生类似的行为。</span><span class="sxs-lookup"><span data-stu-id="3167d-122">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="3167d-123">OAuthTokenIssuer 证书是一种跨所有服务器共享的特定类型证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-123">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="3167d-124">您可以在一个位置创建和管理证书，并将证书存储在所有其他服务器的中央管理存储中。</span><span class="sxs-lookup"><span data-stu-id="3167d-124">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>



</div>

<span data-ttu-id="3167d-125">需要更多详细信息才能充分了解您在使用 Set-CsCertificate cmdlet 并在当前证书到期之前将其用于暂存证书时的选择和要求。</span><span class="sxs-lookup"><span data-stu-id="3167d-125">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="3167d-126">–Roll 参数很重要，但基本上只能满足一种用途。</span><span class="sxs-lookup"><span data-stu-id="3167d-126">The –Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="3167d-127">如果将其定义为参数，则表明您要向 Set-cscertificate 提供有关受– Type （例如 AudioVideoAuthentication 和 OAuthTokenIssuer）定义的证书的信息，当证书将变为时。有效的-EffectiveDate 定义。</span><span class="sxs-lookup"><span data-stu-id="3167d-127">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by –Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by –EffectiveDate.</span></span>

<span data-ttu-id="3167d-128">**-滚动：**–汇总参数是必需的，并且具有必须与它一起提供的依赖项。</span><span class="sxs-lookup"><span data-stu-id="3167d-128">**-Roll:** The –Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="3167d-129">以下必需参数用于充分定义哪些证书将受影响以及将如何应用这些证书：</span><span class="sxs-lookup"><span data-stu-id="3167d-129">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>

<span data-ttu-id="3167d-130">**-EffectiveDate：** 参数– EffectiveDate 定义新证书何时与当前证书共同生效。</span><span class="sxs-lookup"><span data-stu-id="3167d-130">**-EffectiveDate:** The parameter –EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="3167d-131">–EffectiveDate 可以接近当前证书的到期时间，也可以具有更长的时间段。</span><span class="sxs-lookup"><span data-stu-id="3167d-131">The –EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="3167d-132">建议的 AudioVideoAuthentication 证书的最短 –EffectiveDate 为 8 小时，这是使用 AudioVideoAuthentication 证书颁发的 AV 边缘服务令牌的默认令牌生命周期。</span><span class="sxs-lookup"><span data-stu-id="3167d-132">A recommended minimum –EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>

<span data-ttu-id="3167d-p109">暂存 OAuthTokenIssuer 证书时，对于证书生效之前的提前期有不同的要求。OAuthTokenIssuer 证书的最短提前时间是当前证书到期前的 24 小时。为实现共存而延长提前期是因为存在依赖于 OAuthTokenIssuer 证书的其他服务器角色（例如 Exchange Server），该证书创建的身份验证和加密密钥材料具有更长的保留时间。</span><span class="sxs-lookup"><span data-stu-id="3167d-p109">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective. The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate. The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>

<span data-ttu-id="3167d-136">**-指纹：** 指纹是证书上唯一的证书属性。</span><span class="sxs-lookup"><span data-stu-id="3167d-136">**-Thumbprint:** The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="3167d-137">–Thumbprint 参数用于标识将受 Set-CsCertificate cmdlet 操作影响的证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-137">The –Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>

<span data-ttu-id="3167d-138">**-类型：**– Type 参数可以接受单个证书使用类型或以逗号分隔的证书使用类型列表。</span><span class="sxs-lookup"><span data-stu-id="3167d-138">**-Type:** The –Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="3167d-139">证书类型用于向 cmdlet 和服务器确认证书的用途。</span><span class="sxs-lookup"><span data-stu-id="3167d-139">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="3167d-140">例如，键入 AudioVideoAuthentication 可供 A/V 边缘服务和 AV 身份验证服务使用。</span><span class="sxs-lookup"><span data-stu-id="3167d-140">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="3167d-141">如果您决定同时暂存和设置不同类型的证书，则必须针对这些证书的最短生效提前期，考虑其中所需的最长生效期。</span><span class="sxs-lookup"><span data-stu-id="3167d-141">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="3167d-142">例如，您需要暂存 AudioVideoAuthentication 和 OAuthTokenIssuer 类型的证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-142">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="3167d-143">则最短 –EffectiveDate 必须是两个证书中的较大者，本例中为 OAuthTokenIssuer，其最短提前期为 24 小时。</span><span class="sxs-lookup"><span data-stu-id="3167d-143">Your minimum –EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="3167d-144">如果您不想用 24 小时提前期暂存 AudioVideoAuthentication 证书，请使用更符合您的要求的 EffectiveDate 单独暂存它。</span><span class="sxs-lookup"><span data-stu-id="3167d-144">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>

<div>

## <a name="to-update-or-renew-an-av-edge-service-certificate-with-a-roll-and--effectivedate-parameters"></a><span data-ttu-id="3167d-145">使用-滚和-EffectiveDate 参数更新或续订 A/V 边缘服务证书</span><span class="sxs-lookup"><span data-stu-id="3167d-145">To update or renew an A/V Edge service certificate with a –Roll and -EffectiveDate parameters</span></span>

1.  <span data-ttu-id="3167d-146">以 Administrators 组成员的身份登录到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="3167d-146">Log on to the local computer as a member of the Administrators group.</span></span>

2.  <span data-ttu-id="3167d-147">使用 A/V 边缘服务上的现有证书的可导出私钥请求续订或新 AudioVideoAuthentication 证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-147">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>

3.  <span data-ttu-id="3167d-148">将新的 AudioVideoAuthentication 证书导入到边缘服务器和池中的所有其他边缘服务器（如果部署了池）。</span><span class="sxs-lookup"><span data-stu-id="3167d-148">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>

4.  <span data-ttu-id="3167d-149">使用 Set-CsCertificate cmdlet 配置导入的证书并结合使用 –Roll 参数和 –EffectiveDate 参数。</span><span class="sxs-lookup"><span data-stu-id="3167d-149">Configure the imported certificate with the Set-CsCertificate cmdlet and use the –Roll parameter with the –EffectiveDate parameter.</span></span> <span data-ttu-id="3167d-150">生效日期应定义为当前证书到期时间（14:00:00 或 2:00:00 PM）减去令牌生命周期（默认为八小时）。</span><span class="sxs-lookup"><span data-stu-id="3167d-150">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="3167d-151">这为我们提供了一段时间，即证书必须设置为 "活动"，并且\<是\>– EffectiveDate 字符串： "7/22/2012 6:00:00 AM"。</span><span class="sxs-lookup"><span data-stu-id="3167d-151">This gives us a time that the certificate must be set to active, and is the –EffectiveDate \<string\>: “7/22/2012 6:00:00 AM”.</span></span>
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="3167d-152">对于边缘池，必须使用部署的首个证书的– EffectiveDate 参数定义的日期和时间部署和预配所有 AudioVideoAuthentication 证书，以避免由于旧证书即将到期而使用新证书续订所有客户端和消费者令牌而导致的可能的 A/V 通信中断。</span><span class="sxs-lookup"><span data-stu-id="3167d-152">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the –EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span>

    
    </div>
    
    <span data-ttu-id="3167d-153">带 –Roll 和 –EffectiveTime 参数的 Set-CsCertificate 命令：</span><span class="sxs-lookup"><span data-stu-id="3167d-153">The Set-CsCertificate command with the –Roll and –EffectiveTime parameter:</span></span>
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    <span data-ttu-id="3167d-154">Set-CsCertificate 命令示例：</span><span class="sxs-lookup"><span data-stu-id="3167d-154">An example Set-CsCertificate command:</span></span>
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2012 6:00:00 AM"
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="3167d-p113">必须设置 EffectiveDate 的格式以匹配您的服务器的区域和语言设置。本例使用美国英语区域和语言设置</span><span class="sxs-lookup"><span data-stu-id="3167d-p113">The EffectiveDate must be formatted to match your server’s region and language settings. The example uses the US English Region and Language settings</span></span>

    
    </div>

<span data-ttu-id="3167d-157">为进一步了解如何使用 Set-CsCertificate、-Roll 和 –EffectiveDate 暂存新证书，以便在仍使用现有证书验证使用者使用的 AudioVideoAuthentication 时颁发新 AudioVideoAuthentication 令牌，可通过直观的日程表充分了解此过程。</span><span class="sxs-lookup"><span data-stu-id="3167d-157">To further understand the process that Set-CsCertificate, -Roll, and –EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span>

<span data-ttu-id="3167d-158">在下面的示例中，管理员确定 A/V 边缘服务证书是在07/22/2012 时的 2:00:00 PM 到期。</span><span class="sxs-lookup"><span data-stu-id="3167d-158">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2012.</span></span> <span data-ttu-id="3167d-159">他请求并接收新证书，并将其导入到池中的每台边缘服务器。</span><span class="sxs-lookup"><span data-stu-id="3167d-159">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="3167d-160">在 07/22/2012 2 AM，他开始运行带 –Roll 的 Get-CsCertificate，使 -Thumbprint 等于新证书的指纹字符串，并将 –EffectiveTime 设置为 07/22/2012 6:00:00 AM。</span><span class="sxs-lookup"><span data-stu-id="3167d-160">At 2 AM on 07/22/2012, he begins running Get-CsCertificate with –Roll, -Thumbprint equal to the thumbprint string of the new certificate, and –EffectiveTime set to 07/22/2012 6:00:00 AM.</span></span> <span data-ttu-id="3167d-161">他在每台边缘服务器上运行此命令。</span><span class="sxs-lookup"><span data-stu-id="3167d-161">He runs this command on each Edge Server.</span></span>

<span data-ttu-id="3167d-162">![使用滚动和 EffectiveDate 参数。](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "使用滚动和 EffectiveDate 参数。")</span><span class="sxs-lookup"><span data-stu-id="3167d-162">![Using the Roll and the EffectiveDate parameters.](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "Using the Roll and the EffectiveDate parameters.")</span></span>

<span data-ttu-id="3167d-p115">当到达生效时间 (7/22/2012 6:00:00 AM) 时，新证书将颁发所有新令牌。在验证令牌时，将首先根据新证书验证令牌。如果验证失败，将尝试旧证书。尝试新证书并回到旧证书的过程将一直继续下去，直到到达旧证书的到期时间。旧证书到期后 (7/22/2012 2:00:00 PM)，将只根据新证书验证令牌。可以使用带 –Previous 参数的 Remove-CsCertificate cmdlet 安全地删除旧证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-p115">When the effective time is reached (7/22/2012 6:00:00 AM), all new tokens are issued by the new certificate. When validating tokens, tokens will first be validated against the new certificate. If the validation fails, the old certificate is tried. The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate. Once the old certificate has expired (7/22/2012 2:00:00 PM), tokens will only be validated by the new certificate. The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the –Previous parameter.</span></span>

    Remove-CsCertificate -Type AudioVideoAuthentication -Previous

</div>

<div>

## <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a-roll-and--effectivedate-parameters"></a><span data-ttu-id="3167d-169">使用 –Roll 和 -EffectiveDate 参数更新或续订 OAuthTokenIssuer 证书</span><span class="sxs-lookup"><span data-stu-id="3167d-169">To update or renew an OAuthTokenIssuer certificate with a –Roll and -EffectiveDate parameters</span></span>

1.  <span data-ttu-id="3167d-170">以 Administrators 组成员的身份登录到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="3167d-170">Log on to the local computer as a member of the Administrators group.</span></span>

2.  <span data-ttu-id="3167d-171">使用 A/V 边缘服务上的现有证书的可导出私钥请求续订或新 OAuthTokenIssuer 证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-171">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>

3.  <span data-ttu-id="3167d-172">将新的 OAuthTokenIssuer 证书导入到池中的前端服务器（如果已部署池）。</span><span class="sxs-lookup"><span data-stu-id="3167d-172">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="3167d-173">将全局复制 OAuthTokenIssuer 证书且只需在部署中的任何服务器更新和续订这些证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-173">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="3167d-174">前端服务器可用作示例。</span><span class="sxs-lookup"><span data-stu-id="3167d-174">The Front End Server is used as an example.</span></span>

4.  <span data-ttu-id="3167d-p117">使用 Set-CsCertificate cmdlet 配置导入的证书并结合使用 –Roll 参数和 –EffectiveDate 参数。生效日期应定义为当前证书到期时间（14:00:00 或 2:00:00 PM）减去至少 24 个小时。</span><span class="sxs-lookup"><span data-stu-id="3167d-p117">Configure the imported certificate with the Set-CsCertificate cmdlet and use the –Roll parameter with the –EffectiveDate parameter. The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span>
    
    <span data-ttu-id="3167d-177">带 –Roll 和 –EffectiveTime 参数的 Set-CsCertificate 命令：</span><span class="sxs-lookup"><span data-stu-id="3167d-177">The Set-CsCertificate command with the –Roll and –EffectiveTime parameter:</span></span>
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    <span data-ttu-id="3167d-178">Set-CsCertificate 命令示例：</span><span class="sxs-lookup"><span data-stu-id="3167d-178">An example Set-CsCertificate command:</span></span>
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2012 1:00:00 PM"
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="3167d-p118">必须设置 EffectiveDate 的格式以匹配您的服务器的区域和语言设置。本例使用美国英语区域和语言设置</span><span class="sxs-lookup"><span data-stu-id="3167d-p118">The EffectiveDate must be formatted to match your server’s region and language settings. The example uses the US English Region and Language settings</span></span>

    
    </div>

<span data-ttu-id="3167d-p119">当到达生效时间 (7/21/2012 1:00:00 AM) 时，将由新证书颁发所有新令牌。在验证令牌时，将首先根据新证书验证令牌。如果验证失败，将尝试旧证书。尝试新证书并回到旧证书的过程将一直继续下去，直到到达旧证书的到期时间。旧证书到期后 (7/22/2012 2:00:00 PM)，将只根据新证书验证令牌。可以使用带 –Previous 参数的 Remove-CsCertificate cmdlet 安全地删除旧证书。</span><span class="sxs-lookup"><span data-stu-id="3167d-p119">When the effective time is reached (7/21/2012 1:00:00 AM), all new tokens are issued by the new certificate. When validating tokens, tokens will first be validated against the new certificate. If the validation fails, the old certificate is tried. The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate. Once the old certificate has expired (7/22/2012 2:00:00 PM), tokens will only be validated by the new certificate. The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the –Previous parameter.</span></span>

    Remove-CsCertificate -Type OAuthTokenIssuer -Previous

</div>

<div>

## <a name="see-also"></a><span data-ttu-id="3167d-187">另请参阅</span><span class="sxs-lookup"><span data-stu-id="3167d-187">See Also</span></span>


[<span data-ttu-id="3167d-188">在 Lync Server 2013 中规划边缘服务器证书</span><span class="sxs-lookup"><span data-stu-id="3167d-188">Plan for Edge Server certificates in Lync Server 2013</span></span>](lync-server-2013-plan-for-edge-server-certificates.md)  
[<span data-ttu-id="3167d-189">在 Lync Server 2013 中管理服务器到服务器的身份验证（OAuth）和合作伙伴应用程序</span><span class="sxs-lookup"><span data-stu-id="3167d-189">Managing server-to-server authentication (OAuth) and partner applications in Lync Server 2013</span></span>](lync-server-2013-managing-server-to-server-authentication-oauth-and-partner-applications.md)  


[<span data-ttu-id="3167d-190">为 Lync Server 2013 设置边缘证书</span><span class="sxs-lookup"><span data-stu-id="3167d-190">Set up Edge certificates for Lync Server 2013</span></span>](lync-server-2013-set-up-edge-certificates.md)  
<span data-ttu-id="3167d-191">[Set-cscertificate](https://technet.microsoft.com/library/Gg398518(v=OCS.15))</span><span class="sxs-lookup"><span data-stu-id="3167d-191">[Set-CsCertificate](https://technet.microsoft.com/library/Gg398518(v=OCS.15))</span></span>  
<span data-ttu-id="3167d-192">[Set-cscertificate](https://technet.microsoft.com/library/Gg412895(v=OCS.15))</span><span class="sxs-lookup"><span data-stu-id="3167d-192">[Remove-CsCertificate](https://technet.microsoft.com/library/Gg412895(v=OCS.15))</span></span>  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

