---
title: Lync Server 2013：为外部边缘接口设置证书
TOCTitle: 为外部边缘接口设置证书
ms:assetid: 5d78182c-88d8-4483-95ad-74b17f2d5fac
ms:mtpsurl: https://technet.microsoft.com/zh-cn/library/Gg398409(v=OCS.15)
ms:contentKeyID: 49312988
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 为 Lync Server 2013 的外部边缘接口设置证书

 

_**上一次修改主题：** 2016-12-08_

> [!IMPORTANT]
> 在运行证书向导时，请确保您使用作为组（已为其分配您将使用的证书模板类型的适当权限）的成员的帐户进行登录。默认情况下， Lync Server 证书请求将使用 Web 服务器证书模板。如果您使用作为 RTCUniversalServerAdmins 组的成员的帐户来通过此模板请求证书，请确保已为该组分配使用此模板所需的注册权限。


每台边缘服务器都要求外围网络和 Internet 之间的接口上有一个公共证书，且证书的使用者替代名称必须包含访问边缘服务的外部名称和 Web 会议边缘服务的完全限定的域名 (FQDN)。

有关证书的这一要求以及其他要求的详细信息，请参阅[Lync Server 2013 中外部用户访问的证书要求](lync-server-2013-certificate-requirements-for-external-user-access.md)。

有关提供符合统一通信证书的特定要求的证书，并与 Microsoft 具有伙伴关系以确保其可以使用 Lync Server 2013 证书向导的公共证书颁发机构 (CA) 列表，请参阅 Microsoft 知识库文章 929395“Exchange Server 和 Communications Server 的统一通信证书合作伙伴”，网址为 [http://go.microsoft.com/fwlink/p/?linkId=202834](http://go.microsoft.com/fwlink/p/?linkid=202834)。

## 在外部接口上配置证书

要在站点的外部边缘接口上设置证书，请使用本节中的过程执行下列操作：

  - 为边缘服务器的外部接口创建证书请求。

  - 将请求提交给公共 CA。

  - 为每台边缘服务器的外部接口导入证书。

  - 为每台边缘服务器的外部接口分配证书。

  - 如果部署中包含多台边缘服务器，请导出证书及其私钥，并将其复制到其他边缘服务器。然后，在每台边缘服务器上导入证书及其私钥，并按之前描述的方法进行分配。在每台边缘服务器上重复此过程。

可以直接向公共证书颁发机构 (CA) 请求公共证书（例如从公共 CA 的网站）。本节中的过程使用证书向导执行大部分证书任务。如果选择直接向公共 CA 请求证书，则需要适当修改每个步骤，以请求、传输和导入证书及导入证书链。

向外部 CA 请求证书时，提供的凭据必须具有向该 CA 请求证书的权限。每个 CA 都具有定义允许哪些凭据（即特定用户名和组名称）请求、颁发、管理或读取证书的安全策略。

如果决定使用证书 Microsoft 管理控制台 (MMC) 导入证书链和证书，则必须将其导入计算机的证书存储。如果将其导入用户证书存储或服务证书存储，将无法在 Lync Server 2013 证书向导中分配证书。

## 为边缘服务器的外部接口创建证书请求

1.  在边缘服务器上，单击部署向导中“步骤 3：请求、安装或分配证书”旁边的“再次运行”。
    
    > [!NOTE]  
	> 如果组织希望支持与 AOL 的公共即时消息 (IM) 连接，则不能使用 Lync Server 部署向导请求证书，而应执行本主题后面的“为边缘服务器的外部接口创建证书请求以支持与 AOL 的公共 IM 连接”过程中的步骤。<br />
    > 如果多台边缘服务器位于一个池中的同一个位置，则可以在任意一台边缘服务器上运行 Lync Server 2013 证书向导。
    


2.  在“可用的证书任务”页上，单击“创建新的证书请求”。

3.  在“证书请求”页上，单击“外部边缘证书”。

4.  在“延迟的请求或即时请求”页上，选中“现在准备请求，但稍后发送”复选框。

5.  在“证书请求文件”页上，键入要向其保存请求的文件的完整路径和文件名（例如，c:\\cert\_exernal\_edge.cer）。

6.  在“指定替代证书模板”页上，要使用除默认 WebServer 模板之外的模板，请选中“使用选定证书颁发机构的备用证书模板”复选框。

7.  在“名称和安全设置”页上，执行以下操作：
    
      - 在“友好名称”中，键入证书的显示名称。
    
      - 在“位长度”中，指定位长度（通常为默认值“2048”）。
    
      - 验证是否选中了“将证书私钥标记为可导出”复选框。

8.  在“组织信息”页上，键入组织和组织单位（例如分部或部门）的名称。

9.  在“地理信息”页上，指定位置信息。

10. 在“使用者名称/使用者替代名称”页上，将显示向导自动填充的信息。如果需要其他使用者替代名称，可以在接下来的两个步骤中指定。

11. 在“使用者替代名称(SAN)的 SIP 域设置”页上，选中域复选框以向使用者替代名称列表中添加 *\<sipdomain\>* 条目。

12. 在“配置其他使用者替代名称”页上，指定所需的任何其他使用者替代名称。

13. 在“请求摘要”页上，检查要用于生成请求的证书信息。

14. 命令运行完成后，执行以下操作：
    
      - 要查看证书请求的日志，请单击“查看日志”。
    
      - 要完成证书请求，请单击“下一步”。

15. 在“证书请求文件”页上，执行以下操作：
    
      - 要查看生成的证书签名请求 (CSR) 文件，请单击“查看”。
    
      - 要关闭向导，请单击“完成”。

16. 将输出文件复制到从中可将该文件提交给公共 CA 的位置。

## 为边缘服务器的外部接口创建证书请求以支持与 AOL 的公共 IM 连接

1.  如果所需模板可供 CA 使用，请使用以下 Windows PowerShell cmdlet 在边缘服务器上请求证书：
    
        Request-CsCertificate -New -Type AccessEdgeExternal  -Output C:\ <certfilename.txt or certfilename.csr>  -ClientEku $true -Template <template name>
    
    Lync Server 2013 中提供的模板的默认证书名称是 Web Server。仅当需要使用与默认模板不同的模板时指定 *\<template name\>*。
    
    > [!NOTE]  
	> 如果组织希望支持与 AOL 的公共 IM 连接，则必须使用 Windows PowerShell（而非证书向导）请求要分配给访问边缘服务的外部边缘的证书。这是因为证书向导用于请求证书的 Lync Server 2013 Web Server 模板不支持客户端 EKU 配置。使用 Windows PowerShell 创建证书之前，CA 管理员必须创建和部署支持客户端 EKU 的新模板。
    


## 向公共证书颁发机构提交请求

1.  打开输出文件。

2.  复制并粘贴证书签名请求 (CSR) 的内容。

3.  如果出现提示，请指定以下各项：
    
      - **Microsoft** 作为服务器平台。
    
      - **IIS** 作为版本。
    
      - **Web Server** 作为使用类型。
    
      - **PKCS7** 作为响应格式。

4.  公共 CA 验证了您的信息之后，您会收到一封电子邮件，其中包含证书所需的文本。

5.  将电子邮件中的文本复制并保存到本地计算机上的一个文本文件 (.txt) 中。

## 为边缘服务器的外部接口导入证书

1.  以 Administrators 组成员的身份登录在其中创建了证书请求的边缘服务器。

2.  在部署向导中的“部署边缘服务器”页上，单击“步骤 3: 请求、安装或分配证书”旁边的“再次运行”。

3.  在“可用的证书任务”页上，单击“从 .p7b、pfx 或 .cer 文件导入证书”。

4.  在“导入证书”页上，单击“浏览”以查找和选择为边缘服务器的外部接口请求的证书（或者，您也可以键入完整路径和文件名）。如果该证书包含私钥，请选择“证书文件包含证书的私钥”并键入该私钥的密码。单击“下一步”。

5.  在“导入证书摘要”页上，查看摘要，然后单击“下一步”。

6.  在“正在执行命令”上，查看导入的结果，单击“查看日志”以按需了解更多信息，然后单击“完成”以完成证书导入。

7.  如果配置的是边缘服务器池，可以按照本主题后面的“为池中的边缘服务器导出包含私钥的证书”部分所述的操作导出包含私钥的证书。将导出的证书复制到其他边缘服务器，然后导入到每台边缘服务器上的计算机存储。

## 为池中的边缘服务器导出包含私钥的证书

1.  以 Administrators 组成员的身份登录到导入了证书的同一台边缘服务器。

2.  依次单击“开始”和“运行”，再键入 **MMC**。

3.  在 Microsoft 管理控制台 (MMC) 中，单击“文件”，然后单击“添加/删除管理单元”。

4.  在“添加或删除管理单元”中，单击“证书”，然后单击“添加”。

5.  在“证书”对话框中，选择“计算机帐户”，单击“下一步”，在“选择计算机”中选择“本地计算机: (运行此控制台的计算机)”，单击“完成”，然后单击“确定”以完成 MMC 控制台的配置。

6.  双击“证书(本地计算机)”以展开证书存储，双击“个人”，然后双击“证书”。
    
    > [!IMPORTANT]
    > 如果本地计算机的证书个人存储中没有证书，则表示未导入与证书关联的私钥。请检查请求和导入步骤。如果问题仍然存在，请联系您的证书颁发机构管理员或提供商。


7.  在“本地计算机的证书个人存储”中，右键单击要导出的证书，单击“所有任务”，然后单击“导出”。

8.  在证书导出向导中，单击“下一步”，选择“是，导出私钥”，然后单击“下一步”。
    
    > [!NOTE]  
	> 如果“是，导出私钥”选择不可用，则没有将与该证书关联的私钥标记为导出。您将需要再次请求该证书，并确保该证书已标记为允许导出私钥，然后您才能继续导出操作。请与您的证书颁发机构管理员或提供商联系。
    


9.  在“导出文件格式”对话框中，选择“个人信息交换 - PKCS \#12 (.PFX)”，然后选择以下选项：
    
      - 如果可能，则数据包括证书路径中的所有证书
    
      - 导出所有扩展属性
        
        > [!WARNING]  
		> 从边缘服务器导出证书时，请勿选择“如果导出成功，删除私钥”。如果选择此选项，您将需要将证书和私钥导入到此边缘服务器。


10. 单击“下一步”。

11. 键入私钥的密码，再次键入该密码以进行确认，然后单击“下一步”。

12. 为导出的证书键入路径和文件名，并使用文件扩展名 .pfx。该路径必须可由池中的所有其他边缘服务器访问，或者可通过可移动媒体（例如，USB 闪存驱动器）传输。单击“下一步”。

13. 在“完成证书导出向导”中查看摘要，然后单击“完成”。

14. 在“成功导出”对话框中，单击“确定”。

15. 按照本主题后面的“为边缘服务器的外部接口导入证书”过程中所述的步骤将导出的证书文件导入其他边缘服务器。

## 为边缘服务器的外部接口分配证书

1.  对于每台边缘服务器，在部署向导中，单击“步骤 3: 请求、安装或分配证书”旁边的“再次运行”。

2.  在“可用的证书任务”页上，单击“分配现有证书”。

3.  在“证书分配”页上，单击“外部边缘证书”，并选中“高级证书用法”复选框。

4.  在“高级证书用法”页上，选中所有复选框以为所有用法分配证书。

5.  在“证书存储”页上，选择为边缘服务器的外部接口请求和导入的公共证书。
    
    > [!NOTE]  
	> 如果请求和导入的证书不在列表中，解决方法之一是验证证书的使用者名称和使用者替代名称是否满足证书的所有要求，如果是以手动方式导入证书和证书链，而不是使用上述过程导入，则还应验证证书是否位于正确的证书存储（应为计算机证书存储，而非用户证书存储或服务证书存储）中。
    


6.  在“证书分配摘要”页上，检查设置，然后单击“下一步”以分配证书。

7.  在向导完成页上，单击“完成”。

8.  使用此过程分配边缘证书后，请在每台服务器上打开“证书”管理单元，依次展开“证书（本地计算机）”、“个人”，单击“证书”，然后确认详细信息窗格中是否列出了该证书。

9.  如果部署中包含多台边缘服务器，请对每台边缘服务器重复此过程。

