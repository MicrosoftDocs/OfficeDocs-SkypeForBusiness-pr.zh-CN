---
title: 在 Lync Server 2013 上配置 XMPP 网关
TOCTitle: 在 Lync Server 2013 上配置 XMPP 网关
ms:assetid: 00777a34-cc36-4992-9459-08c14543ef6b
ms:mtpsurl: https://technet.microsoft.com/zh-cn/library/JJ687953(v=OCS.15)
ms:contentKeyID: 49888279
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 在 Lync Server 2013 上配置 XMPP 网关

 

_**上一次修改主题：** 2012-10-19_

当您配置支持可扩展消息传递和状态协议 (XMPP) 联盟伙伴的策略时，这些策略适用于 XMPP 联盟域用户，但不适用于会话初始协议 (SIP) 即时消息 (IM) 服务提供程序（例如，Windows Live）用户或 SIP 联盟域用户。应为每个您希望允许您的用户在其中添加联系人并与其通信的 XMPP 联盟域配置一个 XMPP 联盟伙伴。这些策略就绪后，还需执行的其他任务包括配置 XMPP 网关证书、部署 Lync Server 2013 XMPP 网关以及最后更新 XMPP 网关的 DNS 记录。

## 在 Lync Server 2013 边缘服务器上配置 XMPP 网关证书

1.  在边缘服务器上，单击部署向导中“步骤 3：请求、安装或分配证书”旁边的“再次运行”。
    
    > [!TIP]
    > 如果您第一次部署边缘服务器，您将看到“运行”而不是“再次运行”。


2.  在“可用的证书任务”页上，单击“创建新的证书请求”。

3.  在“证书请求”页上，单击“外部边缘证书”。

4.  在“延迟的请求或即时请求”页上，选中“现在准备请求，但稍后发送”复选框。

5.  在“证书请求文件”页上，键入要向其保存请求的文件的完整路径和文件名（例如，c:\\cert\_exernal\_edge.cer）。

6.  在“指定替代证书模板”页上，要使用除默认 WebServer 模板之外的模板，请选中“使用选定证书颁发机构的备用证书模板”复选框。

7.  在“名称和安全设置”页上，执行以下操作：
    
    1.  在“友好名称”中，键入证书的显示名称。
    
    2.  在“位长度”中，指定位长度（通常默认值为 2048）。
    
    3.  验证是否选中了“将证书私钥标记为可导出”复选框。

8.  在“组织信息”页上，键入组织和组织单位（例如分部或部门）的名称。

9.  在“地理信息”页上，指定位置信息。

10. 在“使用者名称/使用者替代名称”页上，将显示向导自动填充的信息。如果需要其他使用者替代名称，可以在接下来的两个步骤中指定。

11. 在“使用者替代名称(SAN)的 SIP 域设置”页上，选中域复选框以向使用者替代名称列表中添加 sip.\<sipdomain\> 条目。

12. 在“配置其他使用者替代名称”页上，指定所需的任何其他使用者替代名称。
    
    > [!TIP]
    > 如果安装了 XMPP 代理，则默认情况下域名（如 contoso.com）填充在 SAN 条目中。如果您需要更多条目，请在此步骤中添加它们。


13. 在“请求摘要”页上，检查要用于生成请求的证书信息。

14. 在命令运行完毕后，您可以“查看日志”，或单击“下一步”继续操作。

15. 在“证书请求文件”页上，您可以通过单击“查看”来查看生成的证书签名请求 (CSR) 文件，或通过单击“完成”来退出证书向导。

16. 复制请求文件并提交至公共证书颁发机构。

17. 在接收、导入和分配公共证书后，您必须停止边缘服务器服务，然后重新启动它。为此，请在 Lync Server 管理控制台中键入：
    
        Stop-CsWindowsService

       &nbsp;
    
        Start-CsWindowsService

## 配置新的 Lync Server 2013 XMPP 网关

1.  打开 Lync Server 控制面板。

2.  在左侧导航栏中，单击“联盟和外部访问”，然后单击“XMPP 联盟伙伴”。

3.  要创建新配置，请单击“新建”。

4.  定义以下设置：

5.  **主域**     （必需）。主域是 XMPP 伙伴的基域。例如，您输入 **fabrikam.com** 作为 XMPP 伙伴的域名。这是必需条目。

6.  **描述**    描述是此特定配置的说明或其他标识信息。此条目为可选。

7.  **其他域**    其他域是 XMPP 伙伴的域的一部分，应作为允许的 XMPP 通信的一部分包括在内。例如，如果主域为 **fabrikam.com**，则将列出 fabrikam.com 下可通过 XMPP 进行通信的所有其他域。

8.  **合作伙伴类型**   “合作伙伴类型”是必需的设置。必须选择下列选项之一来描述和限定可以添加的联系人。选项有：
    
      - **联盟**   “联盟”合作伙伴类型表示 Lync Server 部署和 XMPP 合作伙伴之间存在高度信任。建议在以下情况下使用此合作伙伴类型：与同一企业内的 XMPP 服务器联盟，或存在既有业务关系。联盟合作伙伴中的 XMPP 联系人可以：
        
        1.  添加 Lync 联系人并查看其状态，而无需明确的 Lync 用户授权。
        
        2.  向 Lync 联系人发送即时消息，无论 Lync 用户是否已将他们添加到其联系人列表。
        
        3.  查看 Lync 用户的状态注释。
    
      - **已公开验证** “已公开验证”合作伙伴是一个公共 XMPP 提供程序，系统信任它来验证用户的身份。已公开验证网络中包含的 XMPP 联系人可以在无需 Lync 用户明确授权的情况下，添加 Lync 联系人和查看其状态，并向其发送即时消息。已公开验证网络中的 XMPP 联系人永远看不到 Lync 用户的状态说明。不建议使用此设置。
    
      - **未公开验证** “未公开验证”合作伙伴是一个公共 XMPP 提供程序，系统不信任它来验证用户的身份。未公开验证网络中的 XMPP 用户不能与 Lync 用户通信，除非 Lync 用户通过将其添加到联系人列表来明确授权他们。未公开验证网络中的 XMPP 联系人永远看不到 Lync 用户的状态说明。建议与公共 XMPP 提供程序（如 Google Talk）联盟时使用此设置。

9.  **连接类型：**定义各种规则和回拨设置。
    
      - **TLS 协商**    定义 TLS 协商规则。XMPP 服务可以要求 TLS，也可以让 TLS 可选，或者您也可以定义不支持 TLS。选择“可选”表示由 XMPP 服务来决定是否必须进行协商。要查看 SASL、TLS 和回拨协商的所有可能的设置和详细信息（包括无效和已知错误配置），请参阅 [Lync Server 2013 中 XMPP 联盟伙伴的协商设置](lync-server-2013-negotiation-settings-for-xmpp-federated-partners.md)
        
          - **必需**    XMPP 服务需要 TLS 协商。
        
          - **可选**    XMPP 服务指示 TLS 是否必须协商。
        
          - **不支持**    XMPP 服务不支持 TLS。
    
      - **SASL 协商**   定义 SASL 协商规则。XMPP 服务可能需要 SASL，可以将 SASL 设置为可选，或者将 SASL 定义为不受支持。选择“可选”表明可以根据需要为合作伙伴 XMPP 服务选择强制协商选项。
        
          - **必需**    XMPP 服务需要 SASL 协商。
        
          - **可选**    XMPP 服务指示 SASL 是否必须协商。
        
          - **不支持**    XMPP 服务不支持 SASL。
    
      - **支持服务器回拨协商** 支持服务器回拨协商过程使用域名系统 (DNS) 和权威服务器来验证来自有效 XMPP 伙伴的请求。为此，发起服务器将创建一条含有生成的回拨密钥的特定类型的消息并在 DNS 中查找接收服务器。发起服务器通过 XML 流将密钥发送给 DNS 查找结果，即可能的接收服务器。通过 XML 流接收密钥时，接收服务器不会响应发起服务器，但会将密钥发送到已知的权威服务器。权威服务器验证该密钥是否有效。如果无效，接收服务器不会响应发起服务器。如果密钥有效，接收服务器会通知发起服务器标识和密钥有效，并可以开始对话。
        
        **回拨协商**有两种有效状态：
        
          - **True**    如果应该从发起服务器接收请求，则 XMPP 服务器配置为使用回拨协商。
        
          - **False**    不将 XMPP 服务器配置为使用回拨协商，如果从发起服务器收到请求，会将其忽略。

10. 单击“提交”保存对站点或用户策略的更改。

## 更新 Lync Server 2013 XMPP 网关的 DNS 记录

1.  要配置 XMPP 联盟的 DNS，请将以下 SRV 记录添加到外部 DNS：\_xmpp-server.\_tcp.\<域名\> SRV 记录将解析到边缘服务器的访问边缘 FQDN，端口号为 5269。

