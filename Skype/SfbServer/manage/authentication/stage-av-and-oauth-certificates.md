---
title: 为业务服务器阶段中 Skype AV 和 OAuth 证书使用在 Set-cscertificate 中的滚动分期
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: 摘要： 业务服务器 Skype 的阶段 AV 和 OAuth 证书。
ms.openlocfilehash: 793791ad882171e381eff751a6f57425de0c8ca7
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/11/2019
ms.locfileid: "33919393"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a><span data-ttu-id="b8d2a-103">为业务服务器阶段中 Skype AV 和 OAuth 证书使用在 Set-cscertificate 中的滚动分期</span><span class="sxs-lookup"><span data-stu-id="b8d2a-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span></span>
 
<span data-ttu-id="b8d2a-104">**摘要：** Skype 业务服务器的阶段 AV 和 OAuth 证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-104">**Summary:** Stage AV and OAuth certificates for Skype for Business Server.</span></span>
  
<span data-ttu-id="b8d2a-105">音频/视频 (A / V) 通信是业务服务器 Skype 的关键组成部分。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-105">Audio/Video (A/V) communications is a key component of Skype for Business Server.</span></span> <span data-ttu-id="b8d2a-106">等应用程序共享和音频和视频会议功能依赖于证书分配给 A / V 边缘服务，特别是 A / V 身份验证服务。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-106">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="b8d2a-107">这一新功能旨在配合使用的 a / V 边缘服务和 OAuthTokenIssuer 证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-107">This new feature is designed to work for the A/V Edge service and the OAuthTokenIssuer certificate.</span></span> <span data-ttu-id="b8d2a-108">其他证书类型可设置以及 A / V 边缘服务和 OAuth 证书类型，但不是将受益的共存行为的 A / V 边缘服务证书将。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-108">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span>
  
<span data-ttu-id="b8d2a-109">业务服务器管理命令行管理程序 PowerShell cmdlet 用于管理业务服务器证书的 Skype Skype 指的是 A / V 边缘服务作为 AudioVideoAuthentication 证书类型的证书和为 OAuthServer 证书typeOAuthTokenIssuer。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-109">The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer.</span></span> <span data-ttu-id="b8d2a-110">对于其余的本主题和来唯一地标识证书，它们将按相同的标识符类型 AudioVideoAuthentication andOAuthTokenIssuer 身份引用。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-110">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, AudioVideoAuthentication andOAuthTokenIssuer.</span></span>
  
<span data-ttu-id="b8d2a-111">A/V 身份验证服务负责颁发供客户端和其他 A/V 使用者使用的令牌。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-111">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="b8d2a-112">这些令牌是根据证书上的属性生成的，当证书到期时，会断开连接并需要用新证书生成的新令牌重新连接。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-112">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="b8d2a-113">Skype 业务服务器中的新功能将缓解这一问题-阶段日过期，并允许两个证书，即可继续运行的一段时间，旧的一个新的证书的能力。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-113">A new feature in Skype for Business Server will alleviate this problem - the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="b8d2a-114">此功能使用已更新的功能在 Set-cscertificate Skype 业务 Server Management Shell cmdlet。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-114">This feature uses updated functionality in the Set-CsCertificate Skype for Business Server Management Shell cmdlet.</span></span> <span data-ttu-id="b8d2a-115">新参数-滚动，与现有的参数的-EffectiveDate，将新的 AudioVideoAuthentication 证书的证书存储中。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-115">The new parameter -Roll, with the existing parameter -EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="b8d2a-116">旧 AudioVideoAuthentication 证书仍将保留，以便根据该证书验证颁发的令牌。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-116">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="b8d2a-117">随着新 AudioVideoAuthentication 证书的就绪，将发生以下一系列事件：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-117">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>
  
> [!TIP]
> <span data-ttu-id="b8d2a-118">使用 Skype 业务 Server Management Shell cmdlet 用于管理证书，您可以为每个边缘服务器上请求单独和不同的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-118">Using the Skype for Business Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="b8d2a-119">使用 for Business Server 部署向导的 Skype 中的证书向导帮助您创建的证书，但通常为**默认**类型的将到单个证书的边缘服务器使用的所有证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-119">Using the Certificate Wizard in the Skype for Business Server Deployment Wizard assists you in creating certificates, but is typically of the **default** type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="b8d2a-120">如果要使用滚动证书功能，建议的做法是将 AudioVideoAuthentication 证书与其他证书用途分离开。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-120">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="b8d2a-121">您可以设置和暂存默认类型的证书，但只有已合并证书的 AudioVideoAuthentication 部分将从暂存中受益。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-121">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="b8d2a-122">用户 （例如） 参与即时消息对话，证书过期时将需要注销然后重新登录以使与访问边缘服务关联的新证书的使用。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-122">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="b8d2a-123">使用 Web 会议边缘服务为 Web 会议中所涉及的用户，则会发生类似的行为。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-123">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="b8d2a-124">OAuthTokenIssuer 证书是一种跨所有服务器共享的特定类型证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-124">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="b8d2a-125">创建和管理一个位置中的证书和证书存储中中央管理存储的所有其他服务器。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-125">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>
  
<span data-ttu-id="b8d2a-126">需要更多详细信息才能充分了解您在使用 Set-CsCertificate cmdlet 并在当前证书到期之前将其用于暂存证书时的选择和要求。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-126">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="b8d2a-127">在-回滚参数很重要，但实际上单一用途。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-127">The -Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="b8d2a-128">如果您定义它作为参数，您在告诉您将提供有关由-定义将受影响的证书的信息的 Set-cscertificate 类型 （例如 AudioVideoAuthentication 和 OAuthTokenIssuer） 时将成为证书定义-EffectiveDate 有效。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-128">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by -Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by -EffectiveDate.</span></span>
  
 <span data-ttu-id="b8d2a-129">**-滚动**： 参数是必需的具有依赖项必须提供以及其在-回滚。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-129">**-Roll**: The -Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="b8d2a-130">以下必需参数用于充分定义哪些证书将受影响以及将如何应用这些证书：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-130">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>
  
 <span data-ttu-id="b8d2a-131">**-EffectiveDate**: 参数-EffectiveDate 定义时，新证书将成为 co-active 与当前证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-131">**-EffectiveDate**: The parameter -EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="b8d2a-132">-EffectiveDate 可以是接近当前证书的到期时间也很长的时间段。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-132">The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="b8d2a-133">建议最小-EffectiveDate AudioVideoAuthentication 证书将为 8 小时，这是默认令牌生存期 AV 边缘服务令牌颁发使用 AudioVideoAuthentication 证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-133">A recommended minimum -EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>
  
<span data-ttu-id="b8d2a-p109">暂存 OAuthTokenIssuer 证书时，对于证书生效之前的提前期有不同的要求。OAuthTokenIssuer 证书的最短提前时间是当前证书到期前的 24 小时。为实现共存而延长提前期是因为存在依赖于 OAuthTokenIssuer 证书的其他服务器角色（例如 Exchange Server），该证书创建的身份验证和加密密钥材料具有更长的保留时间。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-p109">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective. The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate. The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>
  
 <span data-ttu-id="b8d2a-137">**-Thumbprint**：指纹是证书特有的属性。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-137">**-Thumbprint**: The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="b8d2a-138">-指纹参数用于标识将受影响的证书的 Set-cscertificate cmdlet 的操作。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-138">The -Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>
  
 <span data-ttu-id="b8d2a-139">**-类型**:-类型参数可以接受单个证书使用类型或证书使用类型以逗号分隔列表。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-139">**-Type**: The -Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="b8d2a-140">证书类型用于向 cmdlet 和服务器确认证书的用途。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-140">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="b8d2a-141">例如，类型 AudioVideoAuthentication 是用于通过 A / V 边缘服务和 AV 身份验证服务。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-141">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="b8d2a-142">如果你决定同时暂存和设置不同类型的证书，则必须针对这些证书的最短生效提前期，考虑其中所需的最长生效期。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-142">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="b8d2a-143">例如，你需要暂存 AudioVideoAuthentication 和 OAuthTokenIssuer 类型的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-143">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="b8d2a-144">您最小 EffectiveDate 必须更大容量的两个证书，在此情况下 OAuthTokenIssuer，上面有最小负责人时间为 24 小时。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-144">Your minimum -EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="b8d2a-145">如果你不想用 24 小时提前期暂存 AudioVideoAuthentication 证书，请使用更符合你的要求的 EffectiveDate 单独暂存它。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-145">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="b8d2a-146">更新或续订 A / V 边缘服务证书使用-Roll 和-EffectiveDate 参数</span><span class="sxs-lookup"><span data-stu-id="b8d2a-146">To update or renew an A/V Edge service certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="b8d2a-147">以 Administrators 组成员的身份登录本地计算机。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-147">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="b8d2a-148">A 上的现有证书的可导出私钥请求续订或新的 AudioVideoAuthentication 证书 / V 边缘服务。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-148">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>
    
3. <span data-ttu-id="b8d2a-149">（如果您部署了一个池），新的 AudioVideoAuthentication 证书导入边缘服务器和池中的所有其他边缘服务器。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-149">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>
    
4. <span data-ttu-id="b8d2a-150">使用 Set-cscertificate cmdlet 配置导入的证书和使用-Roll 参数和-EffectiveDate 参数。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-150">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="b8d2a-151">生效日期应定义为当前证书到期时间（14:00:00 或下午 2:00:00）减去令牌生命周期（默认为八小时）。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-151">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="b8d2a-152">这让我们证书必须设置为活动，一次，-EffectiveDate\<字符串\>:"7/22/2015年 6:00:00"。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-152">This gives us a time that the certificate must be set to active, and is the -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".</span></span> 
    
    > [!IMPORTANT]
    > <span data-ttu-id="b8d2a-153">对于边缘池，您必须具有所有 AudioVideoAuthentication 证书部署并设置过的日期和时间的第一个证书部署以避免可能 A-EffectiveDate 参数定义 / 由于较旧的 V communications 中断证书过期之前已使用新的证书续订客户端和使用者的所有令牌。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-153">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the -EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span> 
  
    <span data-ttu-id="b8d2a-154">Set-cscertificate 命令与-Roll 和-EffectiveTime 参数：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-154">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    <span data-ttu-id="b8d2a-155">Set-CsCertificate 命令示例：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-155">An example Set-CsCertificate command:</span></span>
    
   ```
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > <span data-ttu-id="b8d2a-156">EffectiveDate 必须要设置格式，以匹配您的服务器的区域和语言设置。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-156">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="b8d2a-157">本例使用美国英语区域和语言设置</span><span class="sxs-lookup"><span data-stu-id="b8d2a-157">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="b8d2a-158">若要进一步了解过程，该 Set-cscertificate，-Roll 和-EffectiveDate 用于阶段颁发同时仍使用现有证书来验证 AudioVideoAuthentication 正在使用的新 AudioVideoAuthentication 令牌的新证书通过使用者，可视日程表是了解过程有效方法。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-158">To further understand the process that Set-CsCertificate, -Roll, and -EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span> <span data-ttu-id="b8d2a-159">在以下示例中，管理员确定的 A / V 边缘服务证书将在 2:00:00 07/22/2015年过期。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-159">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2015.</span></span> <span data-ttu-id="b8d2a-160">他请求和接收新证书并在其池将其导入每台边缘服务器。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-160">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="b8d2a-161">上午 2 上 07/22/2015年，他开始运行 Get-cscertificate-滚动，-指纹等于的新证书的指纹字符串和-EffectiveTime 设置为 07/22/2015年 6:00:00。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-161">At 2 AM on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM.</span></span> <span data-ttu-id="b8d2a-162">他在每台边缘服务器上运行此命令。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-162">He runs this command on each Edge Server.</span></span>
  
![使用 Roll 和 EffectiveDate 参数。](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|<span data-ttu-id="b8d2a-164">**标注**</span><span class="sxs-lookup"><span data-stu-id="b8d2a-164">**Callout**</span></span>|<span data-ttu-id="b8d2a-165">**阶段**</span><span class="sxs-lookup"><span data-stu-id="b8d2a-165">**Stage**</span></span>|
|:-----|:-----|
|<span data-ttu-id="b8d2a-166">1</span><span class="sxs-lookup"><span data-stu-id="b8d2a-166">1</span></span>  <br/> |<span data-ttu-id="b8d2a-167">开始时间：2015 年 7 月 22 日上午 12:00:00</span><span class="sxs-lookup"><span data-stu-id="b8d2a-167">Start: 7/22/2015 12:00:00 AM</span></span>  <br/> <span data-ttu-id="b8d2a-p115">当前 AudioVideoAuthentication 证书在 2015 年 7 月 22 日下午 2:00:00 到期。这由证书上的过期时间戳决定。规划证书替换和滚动，计入现有证书达到过期时间前的 8 小时重叠期（默认令牌生命周期）。上午 2:00:00 提前时间在本例中用来给管理员留出足够的时间，在上午 6:00:00 生效时间前放置和设置新证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-p115">The current AudioVideoAuthentication certificate is due to expire at 2:00:00 PM on 7/22/2015. This is determined by the expires time stamp on the certificate. Plan your certificate replacement and rollover to account for an 8 hour overlap (default token lifetime) before the existing certificate reaches the expire time. The 2:00:00 AM lead time is used in this example to allow the administrator adequate time to place and provision the new certificates in advance of the 6:00:00 AM effective time.</span></span>  <br/> |
|<span data-ttu-id="b8d2a-172">2</span><span class="sxs-lookup"><span data-stu-id="b8d2a-172">2</span></span>  <br/> |<span data-ttu-id="b8d2a-173">2015 年 7 月 22 日上午 2:00:00 - 2015 年 7 月 22 日上午 5:59:59</span><span class="sxs-lookup"><span data-stu-id="b8d2a-173">7/22/2015 2:00:00 AM - 7/22/2015 5:59:59 AM</span></span>  <br/> <span data-ttu-id="b8d2a-174">有效时间 6:00:00 （4 小时提前期对于此示例，但可更长时间） 边缘服务器上设置证书使用 Set-cscertificate-类型\<证书使用类型\>-指纹\<新证书的指纹\>-滚动-EffectiveDate\<的新证书的有效时间的 datetime 字符串\></span><span class="sxs-lookup"><span data-stu-id="b8d2a-174">Set Certificates on Edge Servers with effective time of 6:00:00 AM (4 hour lead time is for this example, but can be longer) using Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span></span>  <br/> |
|<span data-ttu-id="b8d2a-175">3</span><span class="sxs-lookup"><span data-stu-id="b8d2a-175">3</span></span>  <br/> |<span data-ttu-id="b8d2a-176">2015 年 7 月 22 日上午 6:00 - 2015 年 7 月 22 日下午 2:00</span><span class="sxs-lookup"><span data-stu-id="b8d2a-176">7/22/2015 6:00 AM - 7/22/2015 2:00 PM</span></span>  <br/> <span data-ttu-id="b8d2a-177">若要验证令牌，新证书将首先尝试，并如果新证书无法验证令牌，尝试旧的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-177">To validate tokens, the new certificate is tried first, and if the new certificate fails to validate the token, the old certificate is tried.</span></span> <span data-ttu-id="b8d2a-178">8 小时 （默认令牌生存期） 重叠期间使用的所有标记该过程。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-178">This process is used for all tokens during the 8 hour (default token lifetime) overlap period.</span></span>  <br/> |
|<span data-ttu-id="b8d2a-179">4</span><span class="sxs-lookup"><span data-stu-id="b8d2a-179">4</span></span>  <br/> |<span data-ttu-id="b8d2a-180">结束日期： 7/22/2015年 2:00:01 PM</span><span class="sxs-lookup"><span data-stu-id="b8d2a-180">End: 7/22/2015 2:00:01 PM</span></span>  <br/> <span data-ttu-id="b8d2a-181">旧证书已过期，对所具有新的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-181">Old certificate has expired and the new certificate has taken over.</span></span> <span data-ttu-id="b8d2a-182">可以使用删除 CsCertificate 安全删除旧证书-类型\<证书使用类型\>-以前</span><span class="sxs-lookup"><span data-stu-id="b8d2a-182">Old certificate can be safely removed with Remove-CsCertificate -Type \<certificate usage type\> -Previous</span></span>  <br/> |
   
<span data-ttu-id="b8d2a-183">当达到有效时间 (7/22/2015年 6:00:00)，所有新令牌颁发由新的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-183">When the effective time is reached (7/22/2015 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="b8d2a-184">验证令牌时, 令牌将首先验证新的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-184">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="b8d2a-185">如果验证失败，则将尝试旧的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-185">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="b8d2a-186">尝试新和下降回原来的证书的过程将继续之前旧证书的到期时间。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-186">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="b8d2a-187">一旦旧的证书已过期 (7/22/2015年 2:00:00)，新证书将仅验证令牌。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-187">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="b8d2a-188">旧证书可安全删除使用删除 cmdlet 与-以前的参数。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-188">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>

```
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="b8d2a-189">更新或续订 OAuthTokenIssuer 证书使用-Roll 和-EffectiveDate 参数</span><span class="sxs-lookup"><span data-stu-id="b8d2a-189">To update or renew an OAuthTokenIssuer certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="b8d2a-190">以 Administrators 组成员的身份登录本地计算机。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-190">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="b8d2a-191">前端服务器上的现有证书的可导出私钥请求续订或新 OAuthTokenIssuer 证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-191">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the Front End Server.</span></span>
    
3. <span data-ttu-id="b8d2a-192">（如果您部署了一个池），新 OAuthTokenIssuer 证书导入前端池中服务器。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-192">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="b8d2a-193">OAuthTokenIssuer 证书全局复制，并且仅需要更新并在您的部署中的任何服务器续订。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-193">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="b8d2a-194">前端服务器用作示例。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-194">The Front End Server is used as an example.</span></span>
    
4. <span data-ttu-id="b8d2a-195">使用 Set-cscertificate cmdlet 配置导入的证书和使用-Roll 参数和-EffectiveDate 参数。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-195">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="b8d2a-196">应定义的有效日期，为当前证书过期时间 (14: 00:00 或 2:00:00) 减去至少 24 小时。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-196">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span> 
    
    <span data-ttu-id="b8d2a-197">Set-cscertificate 命令与-Roll 和-EffectiveTime 参数：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-197">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

<span data-ttu-id="b8d2a-198">Set-CsCertificate 命令示例：</span><span class="sxs-lookup"><span data-stu-id="b8d2a-198">An example Set-CsCertificate command:</span></span>
    
  ```
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> <span data-ttu-id="b8d2a-199">EffectiveDate 必须要设置格式，以匹配您的服务器的区域和语言设置。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-199">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="b8d2a-200">本例使用美国英语区域和语言设置</span><span class="sxs-lookup"><span data-stu-id="b8d2a-200">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="b8d2a-201">当达到有效时间 (7/21/2015年 1:00:00)，所有新令牌颁发由新的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-201">When the effective time is reached (7/21/2015 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="b8d2a-202">验证令牌时, 令牌将首先验证新的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-202">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="b8d2a-203">如果验证失败，则将尝试旧的证书。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-203">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="b8d2a-204">尝试新和下降回原来的证书的过程将继续之前旧证书的到期时间。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-204">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="b8d2a-205">一旦旧的证书已过期 (7/22/2015年 2:00:00)，新证书将仅验证令牌。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-205">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="b8d2a-206">旧证书可安全删除使用删除 cmdlet 与-以前的参数。</span><span class="sxs-lookup"><span data-stu-id="b8d2a-206">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>
```
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a><span data-ttu-id="b8d2a-207">另请参阅</span><span class="sxs-lookup"><span data-stu-id="b8d2a-207">See also</span></span>

[<span data-ttu-id="b8d2a-208">管理服务器到服务器身份验证 (OAuth) 和 Skype 中的业务服务器的合作伙伴应用程序</span><span class="sxs-lookup"><span data-stu-id="b8d2a-208">Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server</span></span>](server-to-server-and-partner-applications.md)

[<span data-ttu-id="b8d2a-209">Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="b8d2a-209">Set-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[<span data-ttu-id="b8d2a-210">Remove-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="b8d2a-210">Remove-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
