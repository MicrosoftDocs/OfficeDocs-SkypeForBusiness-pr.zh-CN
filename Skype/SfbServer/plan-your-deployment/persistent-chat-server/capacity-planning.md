---
title: Skype for Business Server 2015 中持久聊天服务器的容量规划
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/23/2018
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: 7a850cd5-c789-4795-a8ff-083be21ae784
description: '摘要: 阅读本主题, 了解 Skype for business Server 2015 中持久聊天服务器的容量规划。'
ms.openlocfilehash: b303a0d6cd0e518ed1619d53f8fc7bc1b5101903
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/20/2019
ms.locfileid: "34297118"
---
# <a name="capacity-planning-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Skype for Business Server 2015 中持久聊天服务器的容量规划
 
**摘要:** 阅读本主题, 了解 Skype for business Server 2015 中持久聊天服务器的容量规划。
  
持久聊天服务器可以执行可持续进行的多用户实时聊天, 以便将来检索和搜索。 与保存在用户邮箱中的组即时消息 (IM) 不同, 如果已配置对话历史记录, 持久聊天服务器会话将保持打开状态, 并将内容保存在服务器上, 以及邮件、文件、Url 和其他属于正在进行的对话。
  
容量规划是准备部署持久聊天服务器的重要部分。 本主题提供了可用于为部署确定最佳配置的容量规划表。 它还介绍了如何最好地管理在高峰时段需要更大容量的持久聊天服务器部署。
  
在阅读本节之前，应熟悉持久聊天拓扑。 如需了解详细信息，请参阅[Plan Persistent Chat Server topology](topology.md)。

> [!NOTE] 
> Skype for business Server 2015 中提供了持久聊天, 但 Skype for business Server 2019 不再支持此功能。 团队中提供了相同的功能。 有关详细信息, 请参阅[从 Skype For Business 迁移到 Microsoft 团队](/microsoftteams/journey-skypeforbusiness-teams)。 如果需要使用持久聊天, 您可以选择将需要此功能的用户迁移到团队, 或继续使用 Skype for Business Server 2015。 
  
## <a name="persistent-chat-server-capacity-planning"></a>持久聊天服务器容量规划

下表通过建模各种持久聊天服务器设置对容量的影响, 可帮助你进行持久聊天服务器的容量规划。
  
- 用户数量容量规划
    
- 聊天室访问容量规划
    
- 通过邀请计划访问聊天室的能力
    
- 性能容量规划
    
### <a name="plan-capacity-for-number-of-users-for-persistent-chat-server"></a>为持久聊天服务器的用户数计划容量

使用下面的示例表确定可以支持的用户数。
  
**持久聊天服务器池最大容量示例**

|||
|:-----|:-----|
|活动的持久聊天服务实例  <br/> |4  <br/> |
|持久聊天服务实例  <br/> |8（最大仅有 4 个可为活动，另外 4 个必须处于不活动状态）  <br/> |
|连接的活动用户数量  <br/> |80,000  <br/> |
|设置的用户总数  <br/> |150,000  <br/> |
|终结点数量  <br/> |120,000  <br/> |
   
在前面的示例中, 计划支持持久聊天服务器允许的最大用户数: 四个服务器/持久聊天服务实例 (可以有四个更多的被动服务器, 运行持久聊天服务器以获得高可用性和灾难恢复) 和每台服务器20000用户, 共80000个活动用户。
  
### <a name="plan-capacity-for-chat-room-access"></a>聊天室访问容量规划

下面的示例表可帮助你计划在持久聊天服务器池中管理聊天室访问。
  
**管理聊天室访问示例**

||**小聊天室**|**中聊天室**|**大聊天室**|**总计**|
|:-----|:-----|:-----|:-----|:-----|
|聊天室大小（连接的用户数）  <br/> |每个聊天室 30 个用户  <br/> |每个聊天室 150 个用户  <br/> |每个聊天室 16,000 个用户  <br/> ||
|聊天室  <br/> |32,000  <br/> |1,067  <br/> |10  <br/> |33,077  <br/> |
|属于大会堂的聊天室百分比  <br/> |1%  <br/> |1%  <br/> |50%  <br/> ||
|开放式聊天室的百分比  <br/> |3%  <br/> |3%  <br/> |50%  <br/> ||
|开放式聊天室数量（没有明确的成员身份）  <br/> |960  <br/> |32  <br/> |5  <br/> |997  <br/> |
|非开放式聊天室数量（具有明确的成员身份的普通聊天室）  <br/> |31,040  <br/> |1.035  <br/> |5  <br/> |32,080  <br/> |
|大会堂聊天室数量（有更多的演示者进入）  <br/> |0  <br/> |32  <br/> |5  <br/> ||
|按直接成员身份管理的聊天室比例  <br/> |50%  <br/> |10%  <br/> |0%  <br/> ||
|用户组管理的聊天室比率  <br/> |50%  <br/> |90%  <br/> |100%  <br/> ||
|开放式聊天室的每个聊天室成员列表中的用户组数量（未明确指定）  <br/> |0  <br/> |0  <br/> |0  <br/> ||
|非开放式聊天室的每个聊天室成员列表中的用户数量  <br/> |大约  <br/> |150  <br/> |16,000  <br/> ||
|非开放式聊天室的每个聊天室成员列表中的用户组数量  <br/> |3  <br/> |5  <br/> |10  <br/> ||
|每个聊天室的管理者列表中的用户和用户组数量（开放式和非开放式聊天室）  <br/> |6  <br/> |6  <br/> |6  <br/> ||
|每个大会堂聊天室的演示者列表中的用户和用户组数量（开放式和非开放式聊天室）  <br/> |6  <br/> |6  <br/> |6  <br/> ||
|所有非开放式聊天室中基于用户的成员实体数量  <br/> |465,600  <br/> |15,520  <br/> |-  <br/> ||
|所有非开放式聊天室中基于用户组的成员实体数量  <br/> |46,560  <br/> |4656  <br/> |50  <br/> ||
|所有大会堂聊天室中基于用户和用户组的实体数量  <br/> |0  <br/> |192  <br/> |50  <br/> ||
|所有聊天室管理者列表中基于用户和用户组的管理者实体数量  <br/> |192,000  <br/> |6,400  <br/> |60  <br/> ||
|每个聊天室的活动用户数量  <br/> |大约  <br/> |150  <br/> |16,000  <br/> ||
|每个用户的聊天室数量  <br/> |至  <br/> |2  <br/> |2  <br/> |utf-16  <br/> |
|每个聊天室的成员身份列表中的用户组  <br/> |10  <br/> |10  <br/> |岁  <br/> ||
|用户组管理的聊天室比率  <br/> |50%  <br/> |50%  <br/> |50%  <br/> ||
|所有聊天室中基于用户组的成员实体数量  <br/> |155,200  <br/> |5173  <br/> |68  <br/> ||
|所有聊天室中基于用户的成员实体数量  <br/> |465,600  <br/> |77,600  <br/> |72,000  <br/> ||
|每个聊天室的管理者、演示者和范围列表中的用户和用户组数量  <br/> |6  <br/> |6  <br/> |6  <br/> ||
|所有聊天室的管理者、演示者和范围列表中的用户和用户组数量  <br/> |192,000  <br/> |6400  <br/> |60  <br/> ||
|访问控制项数量  <br/> |704,160  <br/> |26,768  <br/> |160  <br/> |731,088  <br/> |
|最大访问控制项数量  <br/> ||||2,000,000  <br/> |
   
在前面的示例中, 当你根据推荐的指南部署持久聊天服务器时, 他们最多可以在启用了合规性的四个服务器池中处理最多80000个活动用户。
  
该示例显示按小（在任何给定时间具有 30 个活动用户）、中（150 个活动用户）和大（16,000 个活动用户）进行分类的聊天室。根据以下总数计算所支持的上表指定大小的聊天室数量：
  
- 系统中的活动用户数量
    
- 给定大小的聊天室中的活动用户数量
    
- 单个用户加入的给定大小的聊天室数量
    
对于每个聊天室，前面的容量规划表将指定与聊天室关联的访问控制项的数量，包括直接分配到聊天室的项。可以使用访问控制列表 (ACL) 控制对单个聊天室的访问，也可以在类别级别控制访问。在 ACL 中，单个访问控制项可以是用户组（例如，安全组、通讯组列表），也可以是单个用户。您可以为聊天室管理者、演示者和成员定义访问控制项。
  
> [!IMPORTANT]
> 规划管理聊天室的策略时，请牢记允许的访问控制项总数是 200 万。如果计算出的访问控制项超过 200 万，服务器性能可能会显著降低。为避免这一问题，请尽可能确保您的访问控制项是用户组而非单个用户。 
  
### <a name="plan-capacity-for-managing-chat-room-access-by-invitation"></a>管理邀请的聊天室访问的容量规划

当配置为发送邀请时, 可以使用以下容量规划表了解持久聊天服务器在持久聊天数据库中创建和存储的邀请数。 通过使用 Skype for Business Server 控制面板中的 "**聊天室类别设置**" 页面或使用 Windows PowerShell cmdlet **csPersistentChatCategory**, 可在类别上管理邀请。 通过使用从 Skype for Business 客户端启动的 "**会议室管理**" 页面, 或者使用 Windows PowerShell cmdlet **csPersistentChatRoom**, 您可以在聊天室 (使用类别允许的方式) 管理邀请。
  
下表中的示例数据假定在 50% 聊天室的“**聊天室设置**”页面上，“**邀请**”选项设置为“**是**”。
  
> [!IMPORTANT]
> 如果计算出的服务器生成的邀请数量超过 100 万，服务器性能可能会显著降低。 若要避免此问题, 请确保将配置为发送邀请的聊天室的数量减到最少, 或者限制可加入聊天室的用户数, 这些聊天室已配置为发送邀请。 
  
**邀请的聊天室访问示例**

||**小聊天室**|**中聊天室**|**大聊天室**|**总计**|
|:-----|:-----|:-----|:-----|:-----|
|可以访问聊天室的用户数量  <br/> |每个聊天室 30 个用户  <br/> |每个聊天室 150 个用户  <br/> |每个聊天室 16,000 个用户  <br/> ||
|具有邀请的聊天室百分比  <br/> |50%  <br/> |50%  <br/> |50%  <br/> ||
|配置为发送邀请的聊天室数量  <br/> |16,000  <br/> |533  <br/> |5  <br/> ||
|可以访问聊天室的用户数量  <br/> |60  <br/> |225  <br/> |16,000  <br/> ||
|持久聊天服务器生成的邀请  <br/> |960,000  <br/> |120,000  <br/> |80,000  <br/> |1,160,000  <br/> |
|允许的最大邀请数量  <br/> ||||2,000,000  <br/> |
|模型 1 - 以每天每个聊天室的预期消息数开始  <br/> |||||
|每个聊天室的聊天速率（每天）  <br/> |50  <br/> |500  <br/> |100  <br/> |650  <br/> |
|所有聊天室的聊天速率（每秒）  <br/> |55.56  <br/> |18.52  <br/> |0.03  <br/> |74  <br/> |
|模型 2 - 以每天每个用户发布的消息数开始  <br/> |||||
|每个用户每天的聊天速率  <br/> |岁  <br/> |5  <br/> |0.1  <br/> |名  <br/> |
|每个聊天室的聊天速率（每天）  <br/> |38  <br/> |375  <br/> |800  <br/> |1,213  <br/> |
|所有聊天室的聊天速率（每秒）  <br/> |41.67  <br/> |13.89  <br/> |0.28  <br/> |56  <br/> |
   
### <a name="plan-capacity-for-persistent-chat-server-performance"></a>为持久聊天服务器性能计划容量

下表介绍持久聊天服务器的用户模型。 它提供了容量规划要求的基础，并代表一个在四台服务器上拥有 80,000 个并发用户的典型组织。
  
**持久聊天服务器性能用户模型**

|||
|:-----|:-----|
|连接的活动用户的数量  <br/> |80,000  <br/> |
|持久聊天服务器服务实例数  <br/> |4  <br/> |
|小聊天室的大小  <br/> |30 个用户  <br/> |
|中聊天室的大小  <br/> |150 个用户  <br/> |
|大聊天室的大小  <br/> |16,000 个用户  <br/> |
|聊天室的总数  <br/> |33,077  <br/> |
|小聊天室的数量  <br/> |32,000  <br/> |
|中聊天室的数量  <br/> |1,067  <br/> |
|大聊天室的数量  <br/> |10  <br/> |
|每个用户的聊天室总数  <br/> |utf-16  <br/> |
|每个用户的小聊天室数量  <br/> |至  <br/> |
|每个用户的中聊天室数量  <br/> |2  <br/> |
|每个用户的大聊天室数量  <br/> |2  <br/> |
|每个用户加入的聊天室数  <br/> |全  <br/> |
|峰值加入速率  <br/> |10 个/秒  <br/> |
|总聊天速率  <br/> |24 个/秒  <br/> |
|小聊天室的聊天速率  <br/> |22.22/second  <br/> |
|中聊天室的聊天速率  <br/> |1.67/second  <br/> |
|大聊天室的聊天速率  <br/> |~0.15/second  <br/> |
|为邀请配置的聊天室的百分比  <br/> |50%  <br/> |
|直接成员身份的百分比  <br/> |50%  <br/> |
|组成员身份的百分比  <br/> |50%  <br/> |
|Active Directory 域服务中上级隶属关系的平均数量  <br/> |100 - 200  <br/> |
|每个用户的订阅联系人数  <br/> |80  <br/> |
|每个用户的平均终结点数  <br/> |1.5  <br/> |
|每个终结点的平均可见聊天室数  <br/> |1.5  <br/> |
|每个用户可见的平均聊天室数量  <br/> |2.25（一个聊天室为 50%，两个聊天室也为 50%）；最多 6 个聊天室开放，每个监视器一个  <br/> |
|每个时间间隔轮询的参与者数量  <br/> |每个可见聊天室 25 个  <br/> |
|轮询间隔时长  <br/> |5 分钟  <br/> |
|每秒钟轮询的参与者数量  <br/> |15,000  <br/> |
|每个用户每小时的状态更改数量  <br/> |6  <br/> |
|每秒钟的状态更改数量  <br/> |133.33  <br/> |
   

