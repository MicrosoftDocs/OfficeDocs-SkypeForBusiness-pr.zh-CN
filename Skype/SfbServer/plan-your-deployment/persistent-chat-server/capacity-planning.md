---
title: Skype for Business Server 2015 中的持久聊天服务器容量规划
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/23/2018
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.assetid: 7a850cd5-c789-4795-a8ff-083be21ae784
description: 摘要：阅读本主题，了解 2015 年 10 月持久聊天服务器Skype for Business Server规划。
ms.openlocfilehash: 430bceb547be9208348d61dc919ddb463f2d5ca2
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/26/2021
ms.locfileid: "58615568"
---
# <a name="capacity-planning-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Skype for Business Server 2015 中的持久聊天服务器容量规划
 
**摘要：** 阅读本主题，了解 2015 年 3 月持久聊天服务器Skype for Business Server规划。
  
持久聊天服务器可以执行多用户实时聊天，这些聊天可以保留供将来检索和搜索。 与组即时消息 (IM) （如果配置了对话历史记录）不同，持久聊天服务器会话保持打开状态的时间更长，并且内容会与消息、文件、URL 以及作为持续对话一部分的其他数据一起保存到服务器上。
  
容量规划是准备部署持久聊天服务器的重要部分。 本主题提供了可用于确定部署的最佳配置的容量规划表。 本文还介绍如何最好地管理高峰时间需要更大容量的持久聊天服务器部署。
  
在阅读本节之前，您应熟悉持久聊天拓扑。 有关详细信息，请参阅规划 [持久聊天服务器拓扑](topology.md)。

> [!NOTE] 
> 持久聊天在 Skype for Business Server 2015 中可用，但在 2019 年 2 Skype for Business Server不再受支持。 相同的功能在 Teams。 有关详细信息，请参阅[开始升级Microsoft Teams升级](/microsoftteams/upgrade-start-here)。 如果您需要使用持久聊天，则选择将需要此功能的用户迁移到 Teams，或者继续使用 Skype for Business Server 2015。 
  
## <a name="persistent-chat-server-capacity-planning"></a>持久聊天服务器容量规划

下表通过建模各种持久聊天服务器设置对容量的影响，帮助您规划持久聊天服务器的容量。
  
- 规划用户数量容量
    
- 规划聊天室访问容量
    
- 规划邀请访问聊天室的容量
    
- 规划性能容量
    
### <a name="plan-capacity-for-number-of-users-for-persistent-chat-server"></a>规划持久聊天服务器用户数的容量

使用下面的示例表决定可以支持的用户数。
  
**持久聊天服务器池最大容量示例**

|||
|:-----|:-----|
|Active Persistent Chat Service 实例  <br/> |4   <br/> |
|持久聊天服务实例  <br/> |8 (最多只能有 4 个处于活动状态;4 必须处于非活动)   <br/> |
|连接的活动用户  <br/> |80,000  <br/> |
|已设置用户总数  <br/> |150,000  <br/> |
|终结点数  <br/> |120,000  <br/> |
   
在上一示例中，计划支持持久聊天服务器允许的最大用户数：持久聊天服务的四台服务器/实例 (可以另外四个被动服务器运行持久聊天服务器，以便实现高可用性和灾难恢复) 并且每台服务器拥有 20，000 个用户，总共 80，000 个活动用户。
  
### <a name="plan-capacity-for-chat-room-access"></a>规划聊天室访问容量

以下示例表可帮助您规划管理持久聊天服务器池中的聊天室访问。
  
**管理聊天室访问示例**

||**小聊天室**|**中聊天室**|**大聊天室**|**Total**|
|:-----|:-----|:-----|:-----|:-----|
|聊天室大小 (连接的用户数)   <br/> |每个聊天室 30 个  <br/> |每个聊天室 150 个  <br/> |每个聊天室 16，000 个  <br/> ||
|聊天室  <br/> |32,000  <br/> |1,067  <br/> |10   <br/> |33,077  <br/> |
|大会堂中的会议室百分比  <br/> |1%  <br/> |1%  <br/> |50%  <br/> ||
|打开的聊天室的百分比  <br/> |3%  <br/> |3%  <br/> |50%  <br/> ||
|开放式聊天室 (没有显式成员身份)   <br/> |960  <br/> |32  <br/> |5   <br/> |997  <br/> |
|非开放式聊天室 (具有显式成员身份的普通)   <br/> |31,040  <br/> |1.035  <br/> |5   <br/> |32,080  <br/> |
|大会堂聊天室 (其他演示者条目)   <br/> |0  <br/> |32  <br/> |5   <br/> ||
|由直接成员身份管理的聊天室  <br/> |50%  <br/> |10%  <br/> |0%  <br/> ||
|用户组管理的聊天室比率  <br/> |50%  <br/> |90%  <br/> |100%  <br/> ||
|未明确指定开放式聊天室的每个聊天室 (列表中的用户组)   <br/> |0  <br/> |0  <br/> |0  <br/> ||
|非开放式聊天室的每个聊天室的成员资格列表中的用户  <br/> |30  <br/> |150  <br/> |16,000  <br/> ||
|非开放式聊天室的每个聊天室成员身份列表中的用户组  <br/> |3   <br/> |5   <br/> |10   <br/> ||
|每个聊天室的管理者列表中的用户和用户组 (开放式和非开放式聊天室)   <br/> |6   <br/> |6   <br/> |6   <br/> ||
|每个大会堂聊天室的演示者列表中的用户和用户组 (开放式和非开放式聊天室)   <br/> |6   <br/> |6   <br/> |6   <br/> ||
|所有非开放式聊天室中基于用户的成员身份实体  <br/> |465,600  <br/> |15,520  <br/> |-  <br/> ||
|所有非开放式聊天室中基于用户组的成员身份实体  <br/> |46,560  <br/> |4656  <br/> |50  <br/> ||
|所有大会堂聊天室中基于用户和用户组的实体  <br/> |0  <br/> |192  <br/> |50  <br/> ||
|所有聊天室管理员列表中基于用户和用户组的经理实体  <br/> |192,000  <br/> |6,400  <br/> |60  <br/> ||
|每个聊天室的活动用户数  <br/> |30  <br/> |150  <br/> |16,000  <br/> ||
|每个用户的聊天室数量  <br/> |12   <br/> |2   <br/> |2   <br/> |16   <br/> |
|每个聊天室的成员列表中的用户组  <br/> |10   <br/> |10   <br/> |15   <br/> ||
|用户组管理的聊天室比率  <br/> |50%  <br/> |50%  <br/> |50%  <br/> ||
|所有聊天室中基于用户组的成员实体数量  <br/> |155,200  <br/> |5173  <br/> |68  <br/> ||
|所有聊天室中基于用户的成员实体数量  <br/> |465,600  <br/> |77,600  <br/> |72,000  <br/> ||
|每个聊天室的管理者、演示者和范围列表中的用户和用户组数量  <br/> |6   <br/> |6   <br/> |6   <br/> ||
|所有聊天室的管理者、演示者和范围列表的用户和用户组  <br/> |192,000  <br/> |6400  <br/> |60  <br/> ||
|访问控制项数量  <br/> |704,160  <br/> |26,768  <br/> |160  <br/> |731,088  <br/> |
|最大访问控制项数量  <br/> ||||2,000,000  <br/> |
   
在上一示例中，根据建议的准则部署持久聊天服务器时，这些服务器可以在启用了合规性的四台服务器池中处理多达 80，000 个活动用户。
  
此示例显示在任何给定时间) 中 (30 个活动用户、中 (150 个活动用户) 和 (16，000 个活动用户) 的聊天室。 上表中特定大小的支持的聊天室数量基于以下总数计算：
  
- 系统中的活动用户数量
    
- 给定大小的聊天室中的活动用户数量
    
- 单个用户加入的给定大小的聊天室数量
    
对于每个聊天室，前面的容量规划表指定与聊天室关联的访问控制条目的数量，包括直接分配给聊天室的条目。 您可以使用访问控制列表和 ACL 或 ACL 来控制对 (聊天室) 。 您还可以在类别级别控制访问。 在 ACL 中，单个访问控制项可以是用户组，例如，安全组、通讯组列表或单个用户。 您可以为聊天室管理员、演示者和成员定义访问控制条目。
  
> [!IMPORTANT]
> 在规划管理聊天室的策略时，请记住允许的访问控制项总数为 200 万。 如果计算出的访问控制项超过 200 万个，则服务器性能可能会显著降低。 为避免此问题，只要有可能，请确保您的访问控制项是用户组而不是单个用户。 
  
### <a name="plan-capacity-for-managing-chat-room-access-by-invitation"></a>规划通过邀请管理聊天室访问的容量

您可以使用以下容量规划表了解持久聊天服务器在配置为发送邀请时在持久聊天数据库中创建和存储的邀请数。 您可以使用 Skype for Business Server 控制面板中的"聊天室类别"设置页，或通过使用 Windows PowerShell cmdlet **set-csPersistentChatCategory** 管理类别上的邀请。 您可以使用从 Skype for Business 客户端启动的"聊天室管理"页，或通过使用 Windows PowerShell cmdlet **set-csPersistentChatRoom** 管理聊天室) 上的邀请，符合类别允许的类别。 (
  
下表中的示例数据假定在 50% 聊天室的"聊天室设置"页上，"邀请"选项设置为 **"是"。** 
  
> [!IMPORTANT]
> 如果服务器生成的邀请数的计算值超过 100 万，则服务器性能可能会显著降低。 若要避免此问题，请确保最大程度地减少配置为发送邀请的聊天室数量，或限制可加入已配置为发送邀请的聊天室的用户数。 
  
**邀请访问聊天室示例**

||**小聊天室**|**中聊天室**|**大聊天室**|**Total**|
|:-----|:-----|:-----|:-----|:-----|
|可以访问聊天室的用户  <br/> |每个聊天室 30 个  <br/> |每个聊天室 150 个  <br/> |每个聊天室 16，000 个  <br/> ||
|具有邀请的聊天室的百分比  <br/> |50%  <br/> |50%  <br/> |50%  <br/> ||
|配置为发送邀请的聊天室数量  <br/> |16,000  <br/> |533  <br/> |5   <br/> ||
|可以访问聊天室的用户数  <br/> |60  <br/> |225  <br/> |16,000  <br/> ||
|持久聊天服务器生成的邀请  <br/> |960,000  <br/> |120,000  <br/> |80,000  <br/> |1,160,000  <br/> |
|允许的最大邀请数量  <br/> ||||2,000,000  <br/> |
|模型 1 - 从每个聊天室每天的预期邮件数开始  <br/> |||||
|每个聊天室的 (聊天速率)   <br/> |50  <br/> |500  <br/> |100  <br/> |650  <br/> |
|所有聊天室 (每秒) 的聊天速率  <br/> |55.56  <br/> |18.52  <br/> |0.03  <br/> |74  <br/> |
|模型 2 - 从每个用户每天发布的消息数开始  <br/> |||||
|每个用户每天的聊天速率  <br/> |15   <br/> |5   <br/> |0.1  <br/> |20  <br/> |
|每个聊天室每天的 (聊天速率)   <br/> |38  <br/> |375  <br/> |800  <br/> |1,213  <br/> |
|所有聊天室 (每秒) 的聊天速率  <br/> |41.67  <br/> |13.89  <br/> |0.28  <br/> |56  <br/> |
   
### <a name="plan-capacity-for-persistent-chat-server-performance"></a>规划持久聊天服务器性能的容量

下表介绍了持久聊天服务器的用户模型。 它提供了容量规划要求的基础，并代表在四台服务器上拥有 80，000 个并发用户的典型组织。
  
**持久聊天服务器性能用户模型**

|||
|:-----|:-----|
|已连接的活动用户数  <br/> |80,000  <br/> |
|持久聊天服务器服务实例数  <br/> |4   <br/> |
|小聊天室的大小  <br/> |30 个用户  <br/> |
|中聊天室的大小  <br/> |150 个用户  <br/> |
|大聊天室的大小  <br/> |16，000 个用户  <br/> |
|聊天室的总数  <br/> |33,077  <br/> |
|小聊天室的数量  <br/> |32,000  <br/> |
|中聊天室的数量  <br/> |1,067  <br/> |
|大聊天室的数量  <br/> |10   <br/> |
|每个用户的聊天室总数  <br/> |16   <br/> |
|每个用户的小聊天室数量  <br/> |12   <br/> |
|每个用户的中聊天室数量  <br/> |2   <br/> |
|每个用户的大聊天室数量  <br/> |2   <br/> |
|每个用户加入的聊天室数  <br/> |24  <br/> |
|峰值加入速率  <br/> |10/秒  <br/> |
|总聊天速率  <br/> |24/秒  <br/> |
|小聊天室的聊天速率  <br/> |22.22/秒  <br/> |
|中聊天室的聊天速率  <br/> |1.67/秒  <br/> |
|大聊天室的聊天速率  <br/> |~0.15/秒  <br/> |
|为邀请配置的聊天室的百分比  <br/> |50%  <br/> |
|直接成员身份的百分比  <br/> |50%  <br/> |
|组成员身份的百分比  <br/> |50%  <br/> |
|Active Directory 域服务中上级附属关系的平均数量  <br/> |100 - 200  <br/> |
|每个用户的订阅联系人数  <br/> |80  <br/> |
|每个用户的平均终结点数  <br/> |1.5  <br/> |
|每个终结点的可见聊天室平均数量  <br/> |1.5  <br/> |
|每个用户的可见聊天室平均数量  <br/> |2.25 (50%用于 1 室，50% 用于 2 室) ;最多 6 个聊天室打开，每个监视器一个  <br/> |
|每个时间间隔轮询的参与者数量  <br/> |每个可见聊天室 25 个  <br/> |
|轮询间隔时长  <br/> |5 分钟  <br/> |
|每秒钟轮询的参与者数量  <br/> |15,000  <br/> |
|每个用户每小时的状态更改数量  <br/> |6   <br/> |
|每秒钟的状态更改数量  <br/> |133.33  <br/> |
   

