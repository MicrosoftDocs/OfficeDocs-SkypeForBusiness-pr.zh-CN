---
title: Skype for Business 服务器中的 MN 主干
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: dc4c5d66-297c-48a5-91b9-b9b8ce44a6e0
description: Skype for Business 服务器企业语音支持中介服务器和组件 (如 PSTN 网关、会话边界控制器和 IP PBX) 之间的 M:N 中继。
ms.openlocfilehash: 24be86c3b174eff70632ddd85a71b5ee7016b990
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/20/2019
ms.locfileid: "34276731"
---
# <a name="mn-trunk-in-skype-for-business-server"></a><span data-ttu-id="ce06a-103">Skype for Business 服务器中的 M:N 主干</span><span class="sxs-lookup"><span data-stu-id="ce06a-103">M:N trunk in Skype for Business Server</span></span>
 
<span data-ttu-id="ce06a-104">Skype for Business 服务器企业语音支持中介服务器和组件 (如 PSTN 网关、会话边界控制器和 IP PBX) 之间的 M:N 中继。</span><span class="sxs-lookup"><span data-stu-id="ce06a-104">Skype for Business Server Enterprise Voice supports M:N trunking between Mediation Server and components such as PSTN gateways, session border controllers, and IP-PBX.</span></span>
  
<span data-ttu-id="ce06a-105">Skype for Business 服务器支持从以前的版本进行呼叫路由的主干定义中更大的灵活性。</span><span class="sxs-lookup"><span data-stu-id="ce06a-105">Skype for Business Server supports greater flexibility in the definition of a trunk for call routing purposes from previous releases.</span></span> <span data-ttu-id="ce06a-106">主干是中介服务器和侦听端口号与网关和侦听端口号之间的逻辑关联。</span><span class="sxs-lookup"><span data-stu-id="ce06a-106">A trunk is a logical association between a Mediation Server and listening port number with a gateway and a listening port number.</span></span> <span data-ttu-id="ce06a-107">这意味着: 中介服务器可以有多个中继到同一网关;中介服务器可以有多个中继到不同的网关;与网关相反, 网关可以有多个中继到不同的中介服务器。</span><span class="sxs-lookup"><span data-stu-id="ce06a-107">This implies several things: A Mediation Server can have multiple trunks to the same gateway; a Mediation Server can have multiple trunks to different gateways; conversely a gateway can have multiple trunks to different Mediation Servers.</span></span>
  
<span data-ttu-id="ce06a-108">只要使用拓扑生成器为拓扑网关, 仍然必须创建根主干。</span><span class="sxs-lookup"><span data-stu-id="ce06a-108">You must still create a root trunk whenever you use Topology Builder to adde a gateway to the topology.</span></span> <span data-ttu-id="ce06a-109">给定中介服务器可以处理的网关数取决于高峰时段内服务器的处理能力。</span><span class="sxs-lookup"><span data-stu-id="ce06a-109">The number of gateways that a given Mediation Server can handle depends on the processing capacity of the server during peak busy hours.</span></span> <span data-ttu-id="ce06a-110">如果你在超过 Skype for business 服务器的最低硬件要求的硬件上部署中介服务器, 如[skype for Business server 2015 的服务器要求](../../plan-your-deployment/requirements-for-your-environment/server-requirements.md)中所述, 然后估计有多少个活动的非绕过通话独立中介服务器可以处理大约1000通话。</span><span class="sxs-lookup"><span data-stu-id="ce06a-110">If you deploy a Mediation Server on hardware that exceeds the minimum hardware requirements for Skype for Business Server, as described in [Server requirements for Skype for Business Server 2015](../../plan-your-deployment/requirements-for-your-environment/server-requirements.md), then the estimate of how many active non-bypass calls a stand-alone Mediation Server can handle is approximately 1000 calls.</span></span> <span data-ttu-id="ce06a-111">在满足这些规范的硬件上部署时, 中介服务器应执行转换, 但仍可以为多个网关路由呼叫, 即使网关不支持媒体旁路也是如此。</span><span class="sxs-lookup"><span data-stu-id="ce06a-111">When deployed on hardware meeting these specifications, the Mediation Server is expected to perform transcoding, but still route calls for multiple gateways even if the gateways do not support media bypass.</span></span>
  
<span data-ttu-id="ce06a-112">定义呼叫路线时, 指定与该路线关联的中继, 但不指定与该路由关联的中介服务器。</span><span class="sxs-lookup"><span data-stu-id="ce06a-112">When defining a call route, you specify the trunks associated with that route, but you do not specify which Mediation Servers are associated with that route.</span></span> <span data-ttu-id="ce06a-113">而是使用拓扑生成器将中继与中介服务器相关联。</span><span class="sxs-lookup"><span data-stu-id="ce06a-113">Instead, you use Topology Builder to associate trunks with Mediation Servers.</span></span> <span data-ttu-id="ce06a-114">换句话说, 路由确定用于呼叫的主干, 随后, 与该主干相关联的中介服务器将发送该呼叫的信号。</span><span class="sxs-lookup"><span data-stu-id="ce06a-114">In other words, routing determines which trunk to use for a call, and, subsequently, the Mediation Server associated with that trunk is sent the signaling for that call.</span></span>
  
<span data-ttu-id="ce06a-115">中介服务器可以作为池进行部署;此池可以与前端池 collocated, 也可以作为独立的池进行部署。</span><span class="sxs-lookup"><span data-stu-id="ce06a-115">The Mediation Server can be deployed as a pool; this pool can be collocated with a Front End pool, or it can be deployed as a stand-alone pool.</span></span> <span data-ttu-id="ce06a-116">当使用前端池的中介服务器 collocated 时, 池大小最多为 12 (注册池大小的限制)。</span><span class="sxs-lookup"><span data-stu-id="ce06a-116">When a Mediation Server is collocated with a Front End pool, the pool size can be at most 12 (the limit of the Registrar pool size).</span></span> <span data-ttu-id="ce06a-117">总之, 这些新功能提高了中介服务器的可靠性和部署灵活性, 但它们需要在以下对等实体中具有关联的功能:</span><span class="sxs-lookup"><span data-stu-id="ce06a-117">Taken together, these new capabilities increase the reliability and deployment flexibility for Mediation Servers, but they require associated capabilities in the following peer entities:</span></span>
  
- <span data-ttu-id="ce06a-118">**PSTN 网关。**</span><span class="sxs-lookup"><span data-stu-id="ce06a-118">**PSTN gateway.**</span></span> <span data-ttu-id="ce06a-119">Skype for Business 服务器合格的网关必须实现 DNS 负载平衡, 这使限定的公共交换电话网络 (PSTN) 网关能够充当一个中介服务器池的负载平衡器, 从而在池中对呼叫进行负载平衡.</span><span class="sxs-lookup"><span data-stu-id="ce06a-119">A Skype for Business Server qualified gateway must implement DNS load balancing, which enables a qualified public switched telephone network (PSTN) gateway to act as a load balancer for one pool of Mediation Servers, and thereby to load-balance calls across the pool.</span></span>
    
- <span data-ttu-id="ce06a-120">**会话边界控制器。**</span><span class="sxs-lookup"><span data-stu-id="ce06a-120">**Session Border Controller.**</span></span> <span data-ttu-id="ce06a-121">对于 SIP 中继，对等实体是 Internet 电话服务提供商的会话边界控制器 (SBC)。</span><span class="sxs-lookup"><span data-stu-id="ce06a-121">For a SIP trunk, the peer entity is a Session Border Controller (SBC) at an Internet telephony service provider.</span></span> <span data-ttu-id="ce06a-122">从中介服务器池到 SBC 的方向, SBC 可以从池中的任何中介服务器接收连接。</span><span class="sxs-lookup"><span data-stu-id="ce06a-122">In the direction from the Mediation Server pool to the SBC, the SBC can receive connections from any Mediation Server in the pool.</span></span> <span data-ttu-id="ce06a-123">在从 SBC 到池中的方向上, 流量可以发送到池中的任何中介服务器。</span><span class="sxs-lookup"><span data-stu-id="ce06a-123">In the direction from the SBC to the pool, traffic can be sent to any Mediation Server in the pool.</span></span> <span data-ttu-id="ce06a-124">实现此功能的一个方法是通过 DNS 负载平衡（如果服务提供商和 SBC 支持）。</span><span class="sxs-lookup"><span data-stu-id="ce06a-124">One method of achieving this is through DNS load balancing, if supported by the service provider and SBC.</span></span> <span data-ttu-id="ce06a-125">另一种方法是为服务提供商提供池中所有中介服务器的 IP 地址, 并且服务提供商将其 SBC 中的这些地址设置为每个中介服务器的单独 SIP 干线。</span><span class="sxs-lookup"><span data-stu-id="ce06a-125">An alternative is to give the service provider the IP addresses of all Mediation Servers in the pool, and the service provider will provision these in their SBC as a separate SIP trunk for each Mediation Server.</span></span> <span data-ttu-id="ce06a-126">然后，服务提供商将处理自己的服务器的负载平衡。</span><span class="sxs-lookup"><span data-stu-id="ce06a-126">The service provider will then handle the load balancing for its own servers.</span></span> <span data-ttu-id="ce06a-127">并非所有服务提供商或 SBC 都可以支持这些功能。</span><span class="sxs-lookup"><span data-stu-id="ce06a-127">Not all service providers or SBCs may support these capabilities.</span></span> <span data-ttu-id="ce06a-128">此外，服务提供商可能会对此功能收取额外费用。</span><span class="sxs-lookup"><span data-stu-id="ce06a-128">Furthermore, the service provider may charge extra for this capability.</span></span> <span data-ttu-id="ce06a-129">通常，每个到 SBC 的 SIP 中继按月收费。</span><span class="sxs-lookup"><span data-stu-id="ce06a-129">Typically, each SIP trunk to the SBC incurs a monthly fee.</span></span>
    
- <span data-ttu-id="ce06a-130">**IP-PBX。**</span><span class="sxs-lookup"><span data-stu-id="ce06a-130">**IP-PBX.**</span></span> <span data-ttu-id="ce06a-131">从中介服务器池到 IP PBX SIP 终止方向, IP PBX 可以从池中的任何中介服务器接收连接。</span><span class="sxs-lookup"><span data-stu-id="ce06a-131">In the direction from the Mediation Server pool to the IP-PBX SIP termination, the IP-PBX can receive connections from any Mediation Server in the pool.</span></span> <span data-ttu-id="ce06a-132">在从 IP PBX 到池中的方向上, 流量可以发送到池中的任何中介服务器。</span><span class="sxs-lookup"><span data-stu-id="ce06a-132">In the direction from the IP-PBX to the pool, traffic can be sent to any Mediation Server in the pool.</span></span> <span data-ttu-id="ce06a-133">由于大多数 IP Pbx 不支持 DNS 负载平衡, 因此我们建议将单个直接 SIP 连接从 IP PBX 定义到池中的每个中介服务器。</span><span class="sxs-lookup"><span data-stu-id="ce06a-133">Because most IP-PBXs do not support DNS load balancing, we recommend that individual direct SIP connections be defined from the IP-PBX to each Mediation Server in the pool.</span></span> <span data-ttu-id="ce06a-134">然后，IP-PBX 将通过向中继组分发流量处理自己的负载平衡。</span><span class="sxs-lookup"><span data-stu-id="ce06a-134">The IP-PBX will then handle its own load balancing by distributing traffic over the trunk group.</span></span> <span data-ttu-id="ce06a-135">假定中继组在 IP-PBX 中具有一组一致的路由规则。</span><span class="sxs-lookup"><span data-stu-id="ce06a-135">The assumption is that the trunk group has a consistent set of routing rules at the IP-PBX.</span></span> <span data-ttu-id="ce06a-136">无论特定的 IP PBX 是否支持此中继组概念, 以及它与 IP PBX 自身的冗余和群集体系结构的交集, 都需要先确定它们, 然后才能确定中介服务器群集是否可以正确地与 IP PBX 交互。</span><span class="sxs-lookup"><span data-stu-id="ce06a-136">Whether a particular IP-PBX supports this trunk group concept and how it intersects with the IP-PBX's own redundancy and clustering architecture needs to be determined before you can decide whether a Mediation Server cluster can interact correctly with an IP-PBX.</span></span>
    
<span data-ttu-id="ce06a-137">中介服务器池必须具有与其交互的对等网关的统一视图。</span><span class="sxs-lookup"><span data-stu-id="ce06a-137">A Mediation Server pool must have a uniform view of the peer gateway with which it interacts.</span></span> <span data-ttu-id="ce06a-138">这意味着池中的所有成员都能从配置存储访问对等网关的同一定义，并且都可能针对传出呼叫与其进行交互。</span><span class="sxs-lookup"><span data-stu-id="ce06a-138">This means that all members of the pool access the same definition of the peer gateway from the configuration store and are equally likely to interact with it for outgoing calls.</span></span> <span data-ttu-id="ce06a-139">因此, 无法划分池, 因此某些中介服务器仅与特定网关对等的传出呼叫进行通信。</span><span class="sxs-lookup"><span data-stu-id="ce06a-139">Therefore, there is no way to segment the pool so that some Mediation Servers communicate with only certain gateway peers for outgoing calls.</span></span> <span data-ttu-id="ce06a-140">如果需要此类分段, 则必须使用单独的中介服务器池。</span><span class="sxs-lookup"><span data-stu-id="ce06a-140">If such segmentation is necessary, a separate pool of Mediation Servers must be used.</span></span> <span data-ttu-id="ce06a-141">例如，如果与池进行交互的 PSTN 网关、SIP 中继或 IP-PBX 中的相关功能（如本主题中前面所述）不存在，则此情况适用。</span><span class="sxs-lookup"><span data-stu-id="ce06a-141">This would be the case, for example, if the associated capabilities in PSTN gateways, SIP trunks, or IP-PBXs to interact with a pool as detailed earlier in this topic are not present.</span></span>
  
<span data-ttu-id="ce06a-142">特定 PSTN 网关、IP PBX 或 SIP 中继对等可以路由到多个中介服务器或中继。</span><span class="sxs-lookup"><span data-stu-id="ce06a-142">A particular PSTN gateway, IP-PBX, or SIP trunk peer can route to multiple Mediation Servers or trunks.</span></span> <span data-ttu-id="ce06a-143">特定中介服务器池可以控制的网关数取决于使用媒体绕过的调用数量。</span><span class="sxs-lookup"><span data-stu-id="ce06a-143">The number of gateways that a particular pool of Mediation Servers can control depends on the number of calls that use media bypass.</span></span> <span data-ttu-id="ce06a-144">如果大量呼叫使用媒体绕过, 则池中的中介服务器可以处理更多调用, 因为只有信号层处理是必需的。</span><span class="sxs-lookup"><span data-stu-id="ce06a-144">If a large number of calls use media bypass, a Mediation Server in the pool can handle many more calls, because only signaling layer processing is necessary.</span></span> 
  

