---
title: Skype 业务服务器 2015 使用统一的联系人存储库的配置
ms.author: jambirk
author: jambirk
manager: serdars
ms.date: 2/7/2018
ms.audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: 摘要： 配置业务服务器 2015年的统一的联系人存储的 Exchange Server 2016年或 Exchange Server 2013年和 Skype。
ms.openlocfilehash: 479032425c8a3d2d66bd341f54908a071dd5480d
ms.sourcegitcommit: 7d819bc9eb63bfd85f5dada09f1b8e5354c56f6b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="configure-skype-for-business-server-2015-to-use-the-unified-contact-store"></a><span data-ttu-id="c9f9e-103">Skype 业务服务器 2015 使用统一的联系人存储库的配置</span><span class="sxs-lookup"><span data-stu-id="c9f9e-103">Configure Skype for Business Server 2015 to use the unified contact store</span></span>
 
<span data-ttu-id="c9f9e-104">**摘要：**配置业务服务器 2015年的统一的联系人存储的 Exchange Server 2016年或 Exchange Server 2013年和 Skype。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-104">**Summary:** Configure the unified contacts store for Exchange Server 2016 or Exchange Server 2013 and Skype for Business Server 2015.</span></span>
  
<span data-ttu-id="c9f9e-105">使用统一的联系人存储库，用户维护单个联系人列表，然后在多个应用程序，包括商业、 Microsoft Outlook 2013，和 Microsoft Outlook Web App 2013 Skype 可用的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-105">Using the unified contact store, users maintain a single contacts list and then have those contacts available in multiple applications, including Skype for Business, Microsoft Outlook 2013, and Microsoft Outlook Web App 2013.</span></span> <span data-ttu-id="c9f9e-106">当您启用统一联系人存储库用户，用户的联系人未存储在 Skype 业务服务器 2015年和根据需要进行检索。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-106">When you enable the unified contact store for a user, that user's contacts are not stored in Skype for Business Server 2015 and retrieved as needed.</span></span> <span data-ttu-id="c9f9e-107">相反，他 / 她的联系人存储在 Exchange Server 2016年或 Exchange Server 2013年，并通过使用 Exchange Web 服务来检索。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-107">Instead, his or her contacts are stored in Exchange Server 2016 or Exchange Server 2013 and are retrieved by using Exchange Web Services.</span></span>
  
> [!NOTE]
> <span data-ttu-id="c9f9e-108">从技术上讲，两个用户的 Exchange 邮箱中的文件夹中存储联系人信息。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-108">Technically, contact information is stored in a pair of folders found in the user's Exchange mailbox.</span></span> <span data-ttu-id="c9f9e-109">自己的联系人存储在一个名为 Skype，这是显示给最终用户; 商务联系人的文件夹对最终用户是不可见的子文件夹中存储联系人有关的元数据。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-109">The contacts themselves are stored in a folder named Skype for Business Contacts which is visible to end users; metadata about the contacts are stored in a subfolder that is not visible to end users.</span></span> 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a><span data-ttu-id="c9f9e-110">为用户启用统一的联系人存储库</span><span class="sxs-lookup"><span data-stu-id="c9f9e-110">Enabling the Unified Contact Store for a User</span></span>

<span data-ttu-id="c9f9e-111">如果已经配置了业务服务器 2015年和 Exchange Server 2016年或 Exchange Server 2013 Skype 之间的服务器到服务器进行身份验证，然后您也启用了统一的联系人存储库;不不需要任何额外的服务器配置。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-111">If server-to-server authentication between Skype for Business Server 2015 and Exchange Server 2016 or Exchange Server 2013 is already configured, then you have also enabled the unified contact store; no additional server configuration is required.</span></span> <span data-ttu-id="c9f9e-112">但是，若要将用户的联系人移至统一的联系人存储库，则需要执行额外的用户帐户配置。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-112">However, additional user account configuration is required in order to move a user's contacts into the unified contact store.</span></span> <span data-ttu-id="c9f9e-113">默认情况下，用户联系人保留在 Skype 业务服务器而不是在统一的联系人存储库。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-113">By default, user contacts are kept in Skype for Business Server and not in the unified contact store.</span></span>
  
<span data-ttu-id="c9f9e-114">通过 Skype 业务服务器用户服务策略管理对统一联系人存储库的访问。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-114">Access to the unified contact store is managed by using Skype for Business Server user services policies.</span></span> <span data-ttu-id="c9f9e-115">用户服务器策略只具有一个属性 (UcsAllowed)；此属性用于确定存储用户联系人的位置。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-115">User server policies have only a single property (UcsAllowed); this property is used to determine the location where a user's contacts are stored.</span></span> <span data-ttu-id="c9f9e-116">如果某个用户是由 UcsAllowed 设置为 True ($True) 的用户服务策略管理的，则该用户的联系人将存储在统一的联系人存储库中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-116">If a user is managed by a user services policy where UcsAllowed has been set to True ($True) then the user's contacts will be stored in in the unified contact store.</span></span> <span data-ttu-id="c9f9e-117">如果用户由用户服务已将 UcsAllowed 设置为 False ($False)，然后他或她的联系人将存储在 Skype 业务服务器的策略。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-117">If the user is managed by a user services policy where UcsAllowed has been set to False ($False) then his or her contacts will be stored in Skype for Business Server.</span></span>
  
<span data-ttu-id="c9f9e-118">当安装 Skype 业务服务器上时，也同时安装 （在全球范围内配置） 的单用户服务策略。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-118">When you install Skype for Business Server, a single user services policy (configured at the global scope) is installed as well.</span></span> <span data-ttu-id="c9f9e-119">此策略中的 UcsAllowed 值将设置为 True，这意味着在默认情况下，用户联系人将存储在统一联系人存储中（假设已部署和配置它）。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-119">The UcsAllowed value in this policy is set to True, meaning that, by default, user contacts will be stored in the unified contact store (assuming this has been deployed and configured).</span></span> <span data-ttu-id="c9f9e-120">若要将所有用户联系人迁移到统一联系人存储，根本不必执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-120">If you want to migrate all of your user contacts to the unified contact store you do not have to do anything at all.</span></span> 
  
<span data-ttu-id="c9f9e-121">如果您不想将所有联系人都迁移到统一联系人存储，您可以通过在全局策略中将 UcsAllowed 属性设置为 False 来对所有用户禁用统一联系人存储：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-121">If you would prefer not to migrate all your contacts to the unified contact store you can disable the unified contact store for all users by setting the UcsAllowed property in the global policy to False:</span></span>
  
```
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

<span data-ttu-id="c9f9e-122">在禁用统一联系人存储库中的全局策略后可以创建允许使用的统一的联系人存储库; 一个每用户策略这使您可以统一联系人存储库中保持其联系人，同时其他用户继续需要其联系人的 Skype 业务服务器的某些用户。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-122">After you have disabled the unified contact store in the global policy you can then create a per-user policy that enables the use of the unified contact store; this allows you to have some users keep their contacts in the unified contact store while other users continue to keep their contacts in Skype for Business Server.</span></span> <span data-ttu-id="c9f9e-123">可通过使用与以下命令类似的命令来创建每用户的用户服务策略：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-123">You can create a per-user user services policy by using a command similar to this:</span></span>
  
```
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

<span data-ttu-id="c9f9e-p107">在创建新的策略后，您必须将此策略分配给应有权访问统一的联系人存储库的任何用户。可通过使用与以下内容类似的命令来将每用户策略分配给用户：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-p107">After you have created the new policy you must then assign that policy to any user who should have access to the unified contact store. Per-user policies can be assigned to users by using commands similar to this:</span></span>
  
```
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

<span data-ttu-id="c9f9e-126">已分配该策略后，将开始 Skype 业务服务器迁移到统一的联系人存储库的用户的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-126">After the policy has been assigned, Skype for Business Server will begin to migrate the user's contacts to the unified contact store.</span></span> <span data-ttu-id="c9f9e-127">迁移完成后，用户将具有他或她为业务服务器而不是 Skype 在 Exchange 存储的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-127">After migration is complete, the user will then have his or her contacts stored in Exchange rather than Skype for Business Server.</span></span> <span data-ttu-id="c9f9e-128">如果用户登录到恰好 Lync 2013 时间迁移完成，将出现一个消息框，将要求他或她 Skype 为企业注销并重新登录才能完成该过程。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-128">If the user happens to be logged on to Lync 2013 at the time migration completes, a message box will appear and he or she will be asked to log off of Skype for Business and then log back on in order to finalize the process.</span></span> <span data-ttu-id="c9f9e-129">如果未向用户分配此每用户策略，则用户的联系人不会存储到统一联系人存储中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-129">Users who have not been assigned this per-user policy will not have their contacts migrated to the unified contact store.</span></span> <span data-ttu-id="c9f9e-130">这是因为这些用户由全球政策，并使用统一的联系人存储库的全局策略中已禁用。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-130">That's because those users are being managed by the global policy, and use of the unified contact store has been disabled in the global policy.</span></span>
  
<span data-ttu-id="c9f9e-131">您可以验证该用户的联系人成功已迁移到统一联系人存储库通过为业务服务器管理外壳程序运行[测试 CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) cmdlet 从 Skype 内：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-131">You can verify that a user's contacts have successfully been migrated to the unified contact store by running the [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

<span data-ttu-id="c9f9e-132">如果 Test-CsUnifiedContactStore 成功，则表示已将用户 sip:kenmyer@litwareinc.com 的联系人迁移到统一的联系人存储库中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-132">If Test-CsUnifiedContactStore succeeds that means that the contacts for the user sip:kenmyer@litwareinc.com have been migrated to the unified contact store.</span></span>
  
## <a name="rolling-back-the-unified-contact-store"></a><span data-ttu-id="c9f9e-133">回滚统一的联系人存储库</span><span class="sxs-lookup"><span data-stu-id="c9f9e-133">Rolling Back the Unified Contact Store</span></span>

<span data-ttu-id="c9f9e-134">如果您需要删除用户的联系人联系的统一存储 （例如，如果用户需要在 Microsoft Lync Server 2010 上重新连接，并因此不能使用统一的联系人存储库） 必须做两件事。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-134">If you need to remove a user's contacts from the unified contact store (for example, if the user needs to be rehomed on Microsoft Lync Server 2010 and thus can no longer use the unified contact store) you must do two things.</span></span> <span data-ttu-id="c9f9e-135">首先，您必须为用户分配一个新的用户服务策略，此策略禁止将联系人存储在统一的联系人存储库中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-135">First, you must assign the user a new user services policy, one that prohibits storing contacts in the unified contact store.</span></span> <span data-ttu-id="c9f9e-136">（也就是说，策略其中 UcsAllowed 属性已设置为 $False。）如果没有这样的策略，您可以创建使用与以下类似的命令：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-136">(That is, a policy where the UcsAllowed property has been set to $False.) If you do not have such a policy you can create one using a command similar to this:</span></span>
  
```
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

<span data-ttu-id="c9f9e-137">然后，可通过使用与以下内容类似的命令分配此新的每用户策略 (NoUnifiedContactStore)：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-137">You can then assign this new per-user policy (NoUnifiedContactStore) by using a command like this:</span></span>
  
```
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

<span data-ttu-id="c9f9e-138">上面的命令将新策略分配给用户 Ken Myer，并且还阻止将 Ken 的联系人迁移到统一的联系人存储库中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-138">The preceding command assigns the new policy to the user Ken Myer, and also prevents Ken's contacts from being migrated to the unified contact store.</span></span>
  
> [!NOTE]
> <span data-ttu-id="c9f9e-139">在某些情况下，只需取消分配用户的当前用户服务策略即可达到相同的效果。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-139">In some cases you can achieve the same net effect by simply un-assigning the user's current user services policy.</span></span> <span data-ttu-id="c9f9e-140">例如，假定 Ken Myer 具有启用统一的联系人存储库的每用户用户服务策略，但您的全局策略禁止使用统一的联系人存储库。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-140">For example, suppose Ken Myer has a per-user user services policy the enables the unified contact store, but your global policy prohibits the use of the unified contact store.</span></span> <span data-ttu-id="c9f9e-141">在此情况下，您可以取消分配 Ken 的每用户服务策略。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-141">In that case, you could un-assign Ken's per-user services policy.</span></span> <span data-ttu-id="c9f9e-142">在执行此操作后，Ken 将自动由全局策略管理，因此他将不再能够访问统一的联系人存储库。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-142">When you do that, Ken will automatically be managed by the global policy, and thus will no longer have access to the unified contact store.</span></span> <span data-ttu-id="c9f9e-143">不指派先前指定每个用户的策略，对使用同一命令，如下所示在前，但这一次将 PolicyName 参数设置为空值： 授予 CsUserServicesPolicy-标识"鸿波"-PolicyName $Null</span><span class="sxs-lookup"><span data-stu-id="c9f9e-143">To un-assign a previously-assigned per-user policy, use the same command as shown before, but this time set the PolicyName parameter to a null value: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span></span> 
  
<span data-ttu-id="c9f9e-144">在使用统一的联系人存储库时，请务必记住术语“阻止将 Ken 的联系人迁移到统一的联系人存储库中”。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-144">The terminology "prevents Ken's contacts from being migrated to the unified contact store" is important to keep in mind when working with the unified contact store.</span></span> <span data-ttu-id="c9f9e-145">仅为 Ken 分配一个新的用户服务策略并不会将其联系人从统一的联系人存储库中移出。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-145">Simply assigning Ken a new user services policy will not move his contacts out of the unified contact store.</span></span> <span data-ttu-id="c9f9e-146">当用户登录 Skype 业务服务器时，系统将检查该用户的用户服务策略，以查看是否应该统一联系人存储库中保留他 / 她的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-146">When a user logs on to Skype for Business Server, the system checks the user's user services policy to see whether his or her contacts should be kept in the unified contact store.</span></span> <span data-ttu-id="c9f9e-147">如果回答为“是”（即，在 UcsAllowed 属性设置为 $True 的情况下），则这些联系人将被迁移到统一的联系人存储库中（假定这些联系人尚未包含在统一的联系人存储库中）。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-147">If the answer is yes (that is, if the UcsAllowed property is set to $True) then those contacts will be migrated to the unified contact store (assuming that those contacts are not already in the unified contact store).</span></span> <span data-ttu-id="c9f9e-148">如果答案为否，Skype 业务服务器只是忽略用户的联系人，然后移到其下一步的任务。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-148">If the answer is no, then Skype for Business Server simply ignores the user's contacts and moves on to its next task.</span></span> <span data-ttu-id="c9f9e-149">这意味着，Skype 业务服务器不会自动移动用户的联系人外统一联系人存储库，而不考虑 UcsAllowed 属性的值。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-149">That means that Skype for Business Server will not automatically move a user's contacts from out of the unified contact store, regardless of the value of the UcsAllowed property.</span></span>
  
<span data-ttu-id="c9f9e-150">这也就意味着之后将该用户分配新用户服务策略，, 您必须运行[调用 CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) cmdlet 以便移动业务服务器的 Exchange Server 取出并放回 Skype 用户的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-150">That also means that, after assigning the user a new user services policy, you must then run the [Invoke-CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) cmdlet in order to move the user's contacts out of Exchange Server and back to Skype for Business Server.</span></span> <span data-ttu-id="c9f9e-151">例如，在为 Ken Myer 分配一个新的用户服务策略后，可使用以下命令将用户的联系人从统一的联系人存储库中移出：</span><span class="sxs-lookup"><span data-stu-id="c9f9e-151">For example, after assigning Ken Myer a new user services policy you can then move his contacts out of the unified contact store by using the following command:</span></span>
  
```
Invoke-CsUcsRollback -Identity "Ken Myer"
```

<span data-ttu-id="c9f9e-152">如果更改用户服务策略但不运行 Invoke-CsUcsRollback cmdlet，则不会从统一的联系人存储库中删除 Ken 的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-152">If you change the user services policy but do not run the Invoke-CsUcsRollback cmdlet Ken's contacts will not be removed from the unified contact store.</span></span> <span data-ttu-id="c9f9e-153">如果运行 Invoke-CsUcsRollback 但不更改 Ken Myer 的用户服务策略，会出现什么情况？</span><span class="sxs-lookup"><span data-stu-id="c9f9e-153">What if you run Invoke-CsUcsRollback but do not change Ken Myer's user services policy?</span></span> <span data-ttu-id="c9f9e-154">在此情况下，会暂时从统一的联系人存储库中删除 Ken 的联系人。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-154">In that case, Ken's contacts will be temporarily removed from the unified contact store.</span></span> <span data-ttu-id="c9f9e-155">请务必记住此删除是暂时性的这一事实。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-155">The fact that this removal is temporary is important to keep in mind.</span></span> <span data-ttu-id="c9f9e-156">Ken 的联系人已经从统一的联系人存储库中删除后，Skype 业务服务器将等待 7 天，然后检查以查看哪个用户服务策略已指派给 Ken。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-156">After Ken's contacts have been removed from the unified contact store, Skype for Business Server will wait 7 days and then check to see which user services policy has been assigned to Ken.</span></span> <span data-ttu-id="c9f9e-157">如果仍为 Ken 分配了允许使用统一的联系人存储库的策略，则其联系人将被自动移回联系人存储库中。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-157">If Ken is still assigned a policy that enables the user of the unified contact store, then his contacts will automatically be moved back to into the contact store.</span></span> <span data-ttu-id="c9f9e-158">若要从统一的联系人存储库中永久性删除联系人，您必须更改用户服务策略并运行 Invoke-CsUcsRollback cmdlet。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-158">To permanently remove contacts from the unified contact store you must change the user services policy in addition to running the Invoke-CsUcsRollback cmdlet.</span></span>
  
<span data-ttu-id="c9f9e-p114">由于存在可影响迁移的大量变量，因而很难估计将帐户完全迁移到统一存储库会用多长时间。但一般说来，迁移不会立即生效：即使迁移的联系人数量不多，完成迁移也可能要用 10 分钟或更长时间。</span><span class="sxs-lookup"><span data-stu-id="c9f9e-p114">Due to the large number of variables that can affect migration, it is difficult to estimate how long it will take before accounts are fully migrated to the unified contact store. As a general rule, however, migration does not take effect immediately: even when migrating a small number of contacts it might take 10 minutes or more before the move is complete.</span></span>
  

