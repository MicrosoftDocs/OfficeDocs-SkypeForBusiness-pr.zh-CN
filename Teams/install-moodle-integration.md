---
title: 安装与 Microsoft 团队的 Moodle 集成
author: MicrosoftHeidi
ms.author: heidip
manager: serdars
ms.topic: article
ms.service: msteams
audience: admin
ms.reviewer: ''
search.appverid: MET150
description: 了解如何为 Microsoft 团队安装和配置 Moodle 开放源代码学习管理系统 (LMS) 应用。
keywords: Moodle 应用集成插件的团队
localization_priority: Normal
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
ms.custom:
- seo-marvel-apr2020
- seo-marvel-mar2020
appliesto:
- Microsoft Teams
ms.openlocfilehash: 36b966748fe88b8fec803adc7f9f898e247cdec9
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/16/2020
ms.locfileid: "48508329"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a><span data-ttu-id="a0ded-104">安装与 Microsoft 团队的 Moodle 集成</span><span class="sxs-lookup"><span data-stu-id="a0ded-104">Installing the Moodle integration with Microsoft Teams</span></span>

> [!VIDEO https://www.youtube.com/embed/OHlPt22nKoE]

<span data-ttu-id="a0ded-105">[Moodle](https://moodle.org/)，世界上最流行和开放源代码的学习管理系统 (的 LMS) 现已与 Microsoft 团队集成！</span><span class="sxs-lookup"><span data-stu-id="a0ded-105">[Moodle](https://moodle.org/), the most popular and open-source Learning Management System (LMS) in the world, is now integrated with Microsoft Teams!</span></span> <span data-ttu-id="a0ded-106">此集成可帮助教师和教师在 Moodle 课程中进行协作，询问有关其成绩和作业的问题，并在团队内部及时更新通知！</span><span class="sxs-lookup"><span data-stu-id="a0ded-106">This integration helps educators and teachers collaborate around Moodle courses, ask questions about their grades and assignments and stay updated with notifications -- right within Teams!</span></span>

<span data-ttu-id="a0ded-107">为了帮助 IT 管理员轻松设置此集成，我们已使用以下功能更新了我们的开源 Moodle 插件：</span><span class="sxs-lookup"><span data-stu-id="a0ded-107">To help IT admins easily set this integration up, we have updated our open-source Moodle Plugin with the following capabilities:</span></span>

* <span data-ttu-id="a0ded-108">通过 Azure AD 自动注册 Moodle 服务器。</span><span class="sxs-lookup"><span data-stu-id="a0ded-108">Auto-registration of your Moodle server with Azure AD.</span></span>
* <span data-ttu-id="a0ded-109">将 Moodle 助手机器人的一次单击部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="a0ded-109">One-click deployment of your Moodle Assistant bot to Azure.</span></span>
* <span data-ttu-id="a0ded-110">自动预配团队并自动同步团队注册的所有或选择 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="a0ded-110">Auto-provisioning of teams and auto-synchronization of team enrollments for all or select Moodle courses.</span></span>
* <span data-ttu-id="a0ded-111">将 Moodle 选项卡和 Moodle 助手机器人自动安装到每个同步团队。</span><span class="sxs-lookup"><span data-stu-id="a0ded-111">Auto-installation of the Moodle tab and the Moodle Assistant bot into each synchronized team.</span></span> <span data-ttu-id="a0ded-112"> (即将推出) </span><span class="sxs-lookup"><span data-stu-id="a0ded-112">(Coming soon)</span></span>
* <span data-ttu-id="a0ded-113">单击 "将 Moodle 应用发布到专用团队应用商店"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-113">One-click publishing of the Moodle app into your private Teams App Store.</span></span> <span data-ttu-id="a0ded-114"> (即将推出) </span><span class="sxs-lookup"><span data-stu-id="a0ded-114">(Coming soon)</span></span>

<span data-ttu-id="a0ded-115">若要了解有关此集成提供的功能的详细信息，请访问 [此处](https://education.microsoft.com/courses-and-resources/resources/microsoft-teams-moodle)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-115">To learn more about the functionality this integration provides, go [here](https://education.microsoft.com/courses-and-resources/resources/microsoft-teams-moodle).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a0ded-116">先决条件</span><span class="sxs-lookup"><span data-stu-id="a0ded-116">Prerequisites</span></span>

<span data-ttu-id="a0ded-117">为了安装和配置此应用程序，你需要：</span><span class="sxs-lookup"><span data-stu-id="a0ded-117">In order to install and configure this application you'll need:</span></span>

1. <span data-ttu-id="a0ded-118">Moodle 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="a0ded-118">Moodle administrator credentials</span></span>
2. <span data-ttu-id="a0ded-119">Azure AD 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="a0ded-119">Azure AD administrator credentials</span></span>
3. <span data-ttu-id="a0ded-120">Azure 订阅可在中创建新资源</span><span class="sxs-lookup"><span data-stu-id="a0ded-120">An Azure subscription you can create new resources in</span></span>

## <a name="step-1-install-the-moodle-plugin"></a><span data-ttu-id="a0ded-121">步骤1：安装 Moodle 插件</span><span class="sxs-lookup"><span data-stu-id="a0ded-121">Step 1: Install the Moodle Plugin</span></span>

> [!VIDEO https://www.youtube.com/embed/SETEC5nzMgk]

<span data-ttu-id="a0ded-122">Microsoft 团队中的 Moodle 集成由 open source [Moodle 插件集](https://github.com/Microsoft/o365-moodle)提供支持。</span><span class="sxs-lookup"><span data-stu-id="a0ded-122">The Moodle integration in Microsoft Teams is powered by the open source [Moodle plugin set](https://github.com/Microsoft/o365-moodle).</span></span> <span data-ttu-id="a0ded-123">要在 Moodle server 中安装插件，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="a0ded-123">To install the plugin in your Moodle server:</span></span>

1. <span data-ttu-id="a0ded-124">首先，下载 [Moodle 插件集](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) 并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="a0ded-124">First, download the [Moodle plugin set](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) and save it to your local computer.</span></span> <span data-ttu-id="a0ded-125">您需要使用版本3.5 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="a0ded-125">You'll need to use version 3.5 or newer.</span></span>
    * <span data-ttu-id="a0ded-126">安装 local_o365 插件还将安装 [auth_oidc](https://moodle.org/plugins/auth_oidc) 和 [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams) 插件。</span><span class="sxs-lookup"><span data-stu-id="a0ded-126">Installing the local_o365 plugin will also install the [auth_oidc](https://moodle.org/plugins/auth_oidc) and [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams) plugins.</span></span>
1. <span data-ttu-id="a0ded-127">以管理员身份登录到 Moodle 服务器，然后从左侧导航面板中选择 " **网站管理** "。</span><span class="sxs-lookup"><span data-stu-id="a0ded-127">Login to your Moodle server as an administrator, and select **Site administration** from the left navigation panel.</span></span>
1. <span data-ttu-id="a0ded-128">选择 " **插件** " 选项卡，然后单击 " **安装插件**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-128">Select the **Plugins** tab, and then click **Install plugins**.</span></span>
1. <span data-ttu-id="a0ded-129">在 " **ZIP 文件安装插件** " 部分下，单击 " **选择文件** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-129">Under the **Install plugin from ZIP file** section click the **Choose a file** button.</span></span>
1. <span data-ttu-id="a0ded-130">从左侧导航中选择 " **上传文件** " 选项，通过浏览找到上面下载的文件，然后单击 " **上载此文件**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-130">Select the **Upload a file** options from the left navigation, browse for the file you downloaded above and click **Upload this file**.</span></span>
1. <span data-ttu-id="a0ded-131">再次从左侧导航面板中选择 " **网站管理** " 选项，返回到您的 "管理员" 仪表板。</span><span class="sxs-lookup"><span data-stu-id="a0ded-131">Select the **Site administration** option from the left navigation panel again to return to your admin dashboard.</span></span> <span data-ttu-id="a0ded-132">向下滚动到 **本地插件** ，然后单击 " **Microsoft Office 365 集成** " 链接。</span><span class="sxs-lookup"><span data-stu-id="a0ded-132">Scroll down to the **Local plugins** and click the **Microsoft Office 365 Integration** link.</span></span> <span data-ttu-id="a0ded-133">将此配置页在单独的浏览器选项卡中打开，因为您将在整个过程的其余部分中使用它。</span><span class="sxs-lookup"><span data-stu-id="a0ded-133">Keep this configuration page open in a separate browser tab as you'll be using it throughout the rest of this process.</span></span>

<span data-ttu-id="a0ded-134">你可以在 [Moodle 文档](https://docs.moodle.org/34/en/Installing_plugins)中找到有关如何安装 Moodle 插件的详细信息。</span><span class="sxs-lookup"><span data-stu-id="a0ded-134">You can find more information on how to install Moodle plugins in the [Moodle documentation](https://docs.moodle.org/34/en/Installing_plugins).</span></span>

<span data-ttu-id="a0ded-135">**重要说明：** 让 Microsoft 365 或 Office 365 Moodle 插件配置页在单独的浏览器选项卡中打开，因为你将在此过程中返回到此页面集。</span><span class="sxs-lookup"><span data-stu-id="a0ded-135">**Important Note:** Keep your Microsoft 365 or Office 365 Moodle Plugin configuration page open in a separate browser tab as you will be returning to this set of pages throughout this process.</span></span>

<span data-ttu-id="a0ded-136">*尚未有 Moodle 网站？*</span><span class="sxs-lookup"><span data-stu-id="a0ded-136">*Don't have a Moodle site already?*</span></span> <span data-ttu-id="a0ded-137">你可能希望查看 Azure 存储库上的 Moodle [，你](https://github.com/azure/moodle) 可以在其中快速部署 azure 上的 Moodle 实例并根据你的需要对其进行自定义。</span><span class="sxs-lookup"><span data-stu-id="a0ded-137">You might want to check out our Moodle on Azure [repo](https://github.com/azure/moodle) where you can quickly deploy a Moodle instance on Azure and customize it to your needs.</span></span>

## <a name="step-2-configure-the-connection-between-the-microsoft-365-or-office-365-plugin-and-azure-active-directory"></a><span data-ttu-id="a0ded-138">步骤2：配置 Microsoft 365 或 Office 365 插件与 Azure Active Directory 之间的连接</span><span class="sxs-lookup"><span data-stu-id="a0ded-138">Step 2: Configure the connection between the Microsoft 365 or Office 365 plugin and Azure Active Directory</span></span>

> [!VIDEO https://www.youtube.com/embed/FpGEezaJ3SA]

<span data-ttu-id="a0ded-139">接下来，你需要在 Azure Active Directory 中将 Moodle 注册为应用程序。</span><span class="sxs-lookup"><span data-stu-id="a0ded-139">Next you'll need to register Moodle as an application in your Azure Active Directory.</span></span> <span data-ttu-id="a0ded-140">我们提供了一个 PowerShell 脚本来帮助你完成此过程。</span><span class="sxs-lookup"><span data-stu-id="a0ded-140">We've provided a PowerShell script to help you complete this process.</span></span> <span data-ttu-id="a0ded-141">PowerShell 脚本为 Microsoft 365 或 Office 365 组织设置新的 Azure AD 应用程序，这些应用将由 Moodle 插件使用。</span><span class="sxs-lookup"><span data-stu-id="a0ded-141">The PowerShell Script provisions a new Azure AD application for your Microsoft 365 or Office 365 organization, which will be used by the Moodle Plugin.</span></span> <span data-ttu-id="a0ded-142">该脚本将为你的 Microsoft 365 或 Office 365 租户设置应用，为预配的应用设置所有所需的答复 Url 和权限，并返回 AppID 和 Key。</span><span class="sxs-lookup"><span data-stu-id="a0ded-142">The script will provision the app for your Microsoft 365 or Office 365 tenant, set up all the required Reply URLs and Permissions for the provisioned app and return the AppID and Key.</span></span> <span data-ttu-id="a0ded-143">你可以在 Moodle 插件设置页面中使用生成的 AppID 和 Key，使用 Azure AD 配置 Moodle 服务器。</span><span class="sxs-lookup"><span data-stu-id="a0ded-143">You can use the generated AppID and Key in your Moodle Plugin Setup Page to configure your Moodle server with Azure AD.</span></span> <span data-ttu-id="a0ded-144">如果你想要查看 PowerShell 脚本自动化的详细手动步骤，你可以在插件的完整 [文档](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application)中找到它们。</span><span class="sxs-lookup"><span data-stu-id="a0ded-144">If you want to see the detailed manual steps that the PowerShell script is automating, you can find them in the full [documentation for the plugin](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application).</span></span>

### <a name="moodle-tab-for-microsoft-teams-information-flow"></a><span data-ttu-id="a0ded-145">Microsoft 团队信息流的 Moodle 选项卡</span><span class="sxs-lookup"><span data-stu-id="a0ded-145">Moodle tab for Microsoft Teams information flow</span></span>

<img width="530px" src="media/MoodleTabInformationFlow.png" alt="Illustration of Moodle tab for Microsoft Teams information flow" title="Microsoft 团队信息流的 Moodle 选项卡的插图" />

1. <span data-ttu-id="a0ded-147">从 "Microsoft 365 或 Office 365 集成插件" 页面中，选择 " **设置** " 选项卡。</span><span class="sxs-lookup"><span data-stu-id="a0ded-147">From the Microsoft 365 or Office 365 Integration plugin page, select the **Setup** tab.</span></span>
1. <span data-ttu-id="a0ded-148">单击 " **下载 PowerShell 脚本** " 按钮并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="a0ded-148">Click the **Download PowerShell Script** button and save it to your local computer.</span></span>
1. <span data-ttu-id="a0ded-149">你需要从 ZIP 文件准备 PowerShell 脚本。</span><span class="sxs-lookup"><span data-stu-id="a0ded-149">You'll need to prepare the PowerShell script from the ZIP file.</span></span> <span data-ttu-id="a0ded-150">为此：</span><span class="sxs-lookup"><span data-stu-id="a0ded-150">To do so:</span></span>
    * <span data-ttu-id="a0ded-151">下载并解压缩该 `Moodle-AzureAD-Powershell.zip` 文件。</span><span class="sxs-lookup"><span data-stu-id="a0ded-151">Download and extract the `Moodle-AzureAD-Powershell.zip` file.</span></span>
    * <span data-ttu-id="a0ded-152">打开提取的文件夹。</span><span class="sxs-lookup"><span data-stu-id="a0ded-152">Open the extracted folder.</span></span>
    * <span data-ttu-id="a0ded-153">右键单击该 `Moodle-AzureAD-Script.ps1` 文件，然后选择 " **属性**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-153">Right-click on the `Moodle-AzureAD-Script.ps1` file and select **Properties**.</span></span>
    * <span data-ttu-id="a0ded-154">在 "属性" 窗口的 " **常规** " 选项卡下，选中 `Unblock` 底部的 " **安全** " 属性旁边的框。</span><span class="sxs-lookup"><span data-stu-id="a0ded-154">Under the **General** tab of the Properties window, check the `Unblock` box next to the **Security** attribute at the bottom.</span></span>
    * <span data-ttu-id="a0ded-155">单击“**确定**”。</span><span class="sxs-lookup"><span data-stu-id="a0ded-155">Click **OK**.</span></span>
    * <span data-ttu-id="a0ded-156">复制提取的文件夹的目录路径。</span><span class="sxs-lookup"><span data-stu-id="a0ded-156">Copy the directory path of the extracted folder.</span></span>
1. <span data-ttu-id="a0ded-157">接下来，你将以管理员身份运行 PowerShell：</span><span class="sxs-lookup"><span data-stu-id="a0ded-157">Next you'll run PowerShell as an administrator:</span></span>
    * <span data-ttu-id="a0ded-158">单击“开始”。</span><span class="sxs-lookup"><span data-stu-id="a0ded-158">Click Start.</span></span>
    * <span data-ttu-id="a0ded-159">键入 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="a0ded-159">Type PowerShell.</span></span>
    * <span data-ttu-id="a0ded-160">右键单击 "Windows PowerShell"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-160">Right-click Windows PowerShell.</span></span>
    * <span data-ttu-id="a0ded-161">单击 "以管理员身份运行"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-161">Click "Run as Administrator".</span></span>
1. <span data-ttu-id="a0ded-162">通过键入 `cd ...\...\Moodle-AzureAD-Powershell` 目录路径的位置，导航到解压缩目录 `...\...` 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-162">Navigate to the unzipped directory by typing `cd ...\...\Moodle-AzureAD-Powershell` where `...\...` is the path to the directory.</span></span>
1. <span data-ttu-id="a0ded-163">通过以下方式执行 PowerShell 脚本：</span><span class="sxs-lookup"><span data-stu-id="a0ded-163">Execute the PowerShell script by:</span></span>
    * <span data-ttu-id="a0ded-164">Enter `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser` 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-164">Enter `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`.</span></span>
    * <span data-ttu-id="a0ded-165">Enter `.\Moodle-AzureAD-Script.ps1` 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-165">Enter `.\Moodle-AzureAD-Script.ps1`.</span></span>
    * <span data-ttu-id="a0ded-166">在弹出窗口中登录到 Microsoft 365 或 Office 365 管理员帐户。</span><span class="sxs-lookup"><span data-stu-id="a0ded-166">Log in to your Microsoft 365 or Office 365 Administrator account in the pop-up window.</span></span>
    * <span data-ttu-id="a0ded-167">输入 Azure AD 应用程序的名称 (Ex。</span><span class="sxs-lookup"><span data-stu-id="a0ded-167">Enter the name of the Azure AD Application (Ex.</span></span> <span data-ttu-id="a0ded-168">Moodle/Moodle 插件) 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-168">Moodle/Moodle plugin).</span></span>
    * <span data-ttu-id="a0ded-169">输入 Moodle 服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="a0ded-169">Enter the URL of your Moodle server.</span></span>
    * <span data-ttu-id="a0ded-170">复制脚本生成的 **应用程序 ID** 和 **应用程序密钥** 并保存。</span><span class="sxs-lookup"><span data-stu-id="a0ded-170">Copy the **Application ID** and **Application Key** generated by the script and save them.</span></span>
1. <span data-ttu-id="a0ded-171">接下来，你需要将 Id 和密钥添加到 Moodle 插件。</span><span class="sxs-lookup"><span data-stu-id="a0ded-171">Next you'll need to add the Id and Key to the Moodle Plugin.</span></span> <span data-ttu-id="a0ded-172">> Microsoft 365 集成) 中，返回到插件管理页面 (网站管理 > 插件。</span><span class="sxs-lookup"><span data-stu-id="a0ded-172">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration).</span></span>
1. <span data-ttu-id="a0ded-173">在 " **设置** " 选项卡上，添加您之前复制的 **应用程序 Id** 和 **应用程序键** ，然后单击 " **保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-173">On the **Setup** tab add the **Application Id** and **Application Key** you copied previously, then click **Save changes**.</span></span>
1. <span data-ttu-id="a0ded-174">页面刷新后，您现在应该可以看到一个新分区 **选择连接方法**。</span><span class="sxs-lookup"><span data-stu-id="a0ded-174">Once the page refreshes you should now see a new section **Choose connection method**.</span></span> <span data-ttu-id="a0ded-175">单击标记为 " **默认** " 的复选框，然后再次单击 " **保存更改** "。</span><span class="sxs-lookup"><span data-stu-id="a0ded-175">Click the checkbox labeled **Default** and then click **Save changes** again.</span></span>
1. <span data-ttu-id="a0ded-176">页面刷新后，您将看到另一个新部分 **管理员同意 & 其他信息**。</span><span class="sxs-lookup"><span data-stu-id="a0ded-176">Once the page refreshes you will see another new section **Admin consent & additional information**.</span></span>
    * <span data-ttu-id="a0ded-177">单击 " **提供管理员同意** " 链接，输入 Microsoft 365 或 Office 365 全局管理员凭据，然后按 " **接受** " 授予权限。</span><span class="sxs-lookup"><span data-stu-id="a0ded-177">Click the **Provide Admin Consent** link, enter your Microsoft 365 or Office 365 Global Administrator credentials, then **Accept** to grant the permissions.</span></span>
    * <span data-ttu-id="a0ded-178">在 " **AZURE AD 租户** " 字段旁边，单击 " **检测** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-178">Next to the **Azure AD Tenant** field click the **Detect** button.</span></span>
    * <span data-ttu-id="a0ded-179">在 **OneDrive for BUSINESS URL** 旁边，单击 " **检测** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-179">Next to the **OneDrive for Business URL** click the **Detect** button.</span></span>
    * <span data-ttu-id="a0ded-180">填写域后，再次单击 " **保存更改** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-180">Once the fields populate, click the **Save changes** button again.</span></span>
1. <span data-ttu-id="a0ded-181">单击 " **更新** " 按钮以验证安装，然后单击 " **保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-181">Click the **Update** button to verify the installation, then **Save changes**.</span></span>
1. <span data-ttu-id="a0ded-182">接下来，你需要在 Moodle server 和 Azure Active Directory 之间同步用户。</span><span class="sxs-lookup"><span data-stu-id="a0ded-182">Next you'll need to synchronize users between your Moodle server and Azure Active Directory.</span></span> <span data-ttu-id="a0ded-183">根据你的环境，你可以在此阶段中选择不同的选项。</span><span class="sxs-lookup"><span data-stu-id="a0ded-183">Depending on your environment, you may select different options during this stage.</span></span> <span data-ttu-id="a0ded-184">请注意，你在此处设置的配置将与每个 Moodle cron 运行 (通常是每天一次) 保持同步的所有内容。要开始使用，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="a0ded-184">Note that the configuration you set here will run with each Moodle cron run (typically once a day) to keep everything in sync. To get started:</span></span>
    * <span data-ttu-id="a0ded-185">切换到 " **同步设置" 选项卡**</span><span class="sxs-lookup"><span data-stu-id="a0ded-185">Switch to the **Sync Settings tab**</span></span>
    * <span data-ttu-id="a0ded-186">在 "将 **用户与 AZURE AD 同步** " 部分中，选择适用于你的环境的复选框。</span><span class="sxs-lookup"><span data-stu-id="a0ded-186">In the **Sync users with Azure AD** section, select the checkboxes that apply to your environment.</span></span> <span data-ttu-id="a0ded-187">通常情况下，您至少要选择：</span><span class="sxs-lookup"><span data-stu-id="a0ded-187">Typically you would select at least:</span></span>
        * <span data-ttu-id="a0ded-188">在 Moodle 中为 Azure AD 中的用户创建帐户</span><span class="sxs-lookup"><span data-stu-id="a0ded-188">Create accounts in Moodle for users in Azure AD</span></span>
        * <span data-ttu-id="a0ded-189">在 Moodle for Azure AD 中的用户更新所有帐户</span><span class="sxs-lookup"><span data-stu-id="a0ded-189">Update all accounts in Moodle for users in Azure AD</span></span>
    * <span data-ttu-id="a0ded-190">在 " **用户创建限制** " 部分中，你可以设置筛选器以限制将同步到 Moodle 的 Azure AD 用户。</span><span class="sxs-lookup"><span data-stu-id="a0ded-190">In the **User Creation Restriction** section you can setup a filter to limit the Azure AD users that will by synced to Moodle.</span></span>
    * <span data-ttu-id="a0ded-191">**用户字段映射**部分将允许你将 Azure AD 自定义为 Moodle 用户配置文件字段映射。</span><span class="sxs-lookup"><span data-stu-id="a0ded-191">The **User Field Mapping** section will allow you to customize the Azure AD to Moodle User Profile field mapping.</span></span>
    * <span data-ttu-id="a0ded-192">在 " **团队同步** " 部分中，你可以选择自动创建组 (也就是说，团队) 适用于现有 Moodle 课程的部分或全部。</span><span class="sxs-lookup"><span data-stu-id="a0ded-192">In the **Teams Sync** section you can choose to automatically create Groups (i.e. Teams) for some, or all, of your existing Moodle courses.</span></span>
1. <span data-ttu-id="a0ded-193">若要验证 cron 作业 (并手动运行它们（如果你希望首次运行）) 单击 "**同步用户和 AZURE AD** " 部分中的 "**计划任务管理页面**" 链接。</span><span class="sxs-lookup"><span data-stu-id="a0ded-193">To validate the cron jobs (and run them manually if you wish to for the first run) click the **Scheduled tasks management page** link in the **Sync users with Azure AD** section.</span></span> <span data-ttu-id="a0ded-194">这将转到 " **计划任务** " 页面。</span><span class="sxs-lookup"><span data-stu-id="a0ded-194">This will take you to the **Scheduled Tasks** page.</span></span>
    * <span data-ttu-id="a0ded-195">向下滚动并找到 " **与 AZURE AD 作业同步用户** "，然后单击 " **立即运行**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-195">Scroll down and find the job **Sync users with Azure AD** job and click **Run now**.</span></span>
    * <span data-ttu-id="a0ded-196">如果您选择基于现有课程创建组，也可以 **在 Office 365 作业中运行 "创建用户组** "。</span><span class="sxs-lookup"><span data-stu-id="a0ded-196">If you chose to create Groups based on existing courses, you can also run the **Create user groups in Office 365** job.</span></span>
1. <span data-ttu-id="a0ded-197">返回到插件管理页面 (网站管理 > 插件 > Microsoft 365 集成) 并选择 " **团队设置** " 页面。</span><span class="sxs-lookup"><span data-stu-id="a0ded-197">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration) and select the **Teams Settings** page.</span></span> <span data-ttu-id="a0ded-198">你需要配置一些安全设置以启用团队应用集成。</span><span class="sxs-lookup"><span data-stu-id="a0ded-198">You'll need to configure some security settings to enable the Teams app integration.</span></span>
    * <span data-ttu-id="a0ded-199">若要启用 OpenID Connect，请单击 " **管理身份验证** " 链接，然后在 **OpenID 连接线** 上单击 "眼睛" 图标（如果它呈灰色）。</span><span class="sxs-lookup"><span data-stu-id="a0ded-199">To enable OpenID Connect, click the **Manage Authentication** link, and click the eye icon on the **OpenId Connect** line if it is greyed out.</span></span>
    * <span data-ttu-id="a0ded-200">接下来，你需要启用框架嵌入。</span><span class="sxs-lookup"><span data-stu-id="a0ded-200">Next you'll need to enable frame embedding.</span></span> <span data-ttu-id="a0ded-201">单击 " **HTTP 安全** " 链接，然后单击 " **允许框架嵌入**" 旁边的复选框。</span><span class="sxs-lookup"><span data-stu-id="a0ded-201">Click the **HTTP Security** link, then click the checkbox next to **Allow frame embedding**.</span></span>
    * <span data-ttu-id="a0ded-202">下一步是启用将启用 Moodle API 功能的 web 服务。</span><span class="sxs-lookup"><span data-stu-id="a0ded-202">The next step is to enable web services which will enable the Moodle API features.</span></span> <span data-ttu-id="a0ded-203">单击 " **高级功能** " 链接，然后确保选中 " **启用 web 服务** " 旁边的复选框。</span><span class="sxs-lookup"><span data-stu-id="a0ded-203">Click the **Advanced Features** link, then make sure the checkbox next to **Enable web services** is checked.</span></span>
    * <span data-ttu-id="a0ded-204">最后，你将需要为 Microsoft 365 或 Office 365 启用外部服务。</span><span class="sxs-lookup"><span data-stu-id="a0ded-204">Finally you'll need to enabled the external services for Microsoft 365 or Office 365.</span></span> <span data-ttu-id="a0ded-205">单击 " **外部服务** " 链接，然后执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="a0ded-205">Click the **External services** link then:</span></span>
        * <span data-ttu-id="a0ded-206">单击 " **Moodle Office 365 Webservices** " 行上的 "**编辑**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-206">Click **Edit** on the **Moodle Office 365 Webservices** row.</span></span>
        * <span data-ttu-id="a0ded-207">标记 "**启用**" 旁边的复选框，然后单击 "**保存更改**"</span><span class="sxs-lookup"><span data-stu-id="a0ded-207">Mark the checkbox next to **Enabled**, then click **Save Changes**</span></span>
    * <span data-ttu-id="a0ded-208">接下来，你需要编辑已验证身份的用户权限，以允许他们创建 web 服务令牌。</span><span class="sxs-lookup"><span data-stu-id="a0ded-208">Next you'll need to edit your authenticated user permissions to allow them to create web service tokens.</span></span> <span data-ttu-id="a0ded-209">单击 **编辑角色的 "经过身份验证的用户"** 链接。</span><span class="sxs-lookup"><span data-stu-id="a0ded-209">Click the **Editing role 'Authenticated user'** link.</span></span> <span data-ttu-id="a0ded-210">向下滚动并找到 " **创建 web 服务标记** " 功能，并标记 " **允许** " 复选框。</span><span class="sxs-lookup"><span data-stu-id="a0ded-210">Scroll down and find the **Create a web service token** capability and mark the **Allow** checkbox.</span></span>

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a><span data-ttu-id="a0ded-211">步骤3：将 Moodle 助理机器人部署到 Azure</span><span class="sxs-lookup"><span data-stu-id="a0ded-211">Step 3: Deploy the Moodle Assistant Bot to Azure</span></span>

> [!VIDEO https://www.youtube.com/embed/gbkJxf8FlfY]

<span data-ttu-id="a0ded-212">Microsoft 团队的免费 Moodle 助理机器人可帮助教师和学生在 Moodle 中解答有关其课程、作业、成绩和其他信息的问题。</span><span class="sxs-lookup"><span data-stu-id="a0ded-212">The free Moodle Assistant Bot for Microsoft Teams helps teachers and students answer questions about their courses, assignments, grades and other information in Moodle.</span></span> <span data-ttu-id="a0ded-213">机器人还会向团队中的学生和教师发送 Moodle 通知。</span><span class="sxs-lookup"><span data-stu-id="a0ded-213">The bot also sends Moodle notifications to students and teachers right within Teams.</span></span> <span data-ttu-id="a0ded-214">此 bot 是由 Microsoft 维护的开源项目， [在 GitHub 上提供](https://github.com/microsoft/Moodle-Teams-Bot)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-214">This bot is an open source project maintained by Microsoft, and is [available on GitHub](https://github.com/microsoft/Moodle-Teams-Bot).</span></span>

> [!NOTE]
> <span data-ttu-id="a0ded-215">在此部分中，你会将资源部署到你的 Azure 订阅，并且将使用 **免费** 的层配置所有资源。</span><span class="sxs-lookup"><span data-stu-id="a0ded-215">In this section you will deploy resources to your Azure subscription, and all resources will be configured using the **free** tier.</span></span> <span data-ttu-id="a0ded-216">根据你的 bot 使用情况，你可能需要缩放这些资源。</span><span class="sxs-lookup"><span data-stu-id="a0ded-216">Depending on the usage of your bot, you may need to scale these resources.</span></span>
> <span data-ttu-id="a0ded-217">如果只想在没有机器人的情况下使用 Moodle 选项卡，请跳到 [步骤 4](#step-4-deploy-your-microsoft-teams-app)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-217">If you want to just use the Moodle tab without the bot, skip to [step 4](#step-4-deploy-your-microsoft-teams-app).</span></span>

### <a name="moodle-bot-information-flow"></a><span data-ttu-id="a0ded-218">Moodle 机器人信息流</span><span class="sxs-lookup"><span data-stu-id="a0ded-218">Moodle bot information flow</span></span>

<img width="530px" src="media/MoodleBotInformationFlow.png" alt="llustration of Moodle bot for Microsoft Teams information flow" title="Microsoft 团队信息流的 Moodle bot 的插图" />


<span data-ttu-id="a0ded-220">若要安装机器人，首先需要在 [Microsoft Identity 平台](https://identity.microsoft.com/Landing)上注册它。</span><span class="sxs-lookup"><span data-stu-id="a0ded-220">To install the bot, you'll first need to register it on the [Microsoft Identity Platform](https://identity.microsoft.com/Landing).</span></span> <span data-ttu-id="a0ded-221">这使你的 Bot 能够针对你的 Microsoft 终结点进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="a0ded-221">This allows your Bot to authenticate against your Microsoft endpoints.</span></span> <span data-ttu-id="a0ded-222">要注册你的 bot，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="a0ded-222">To register your bot:</span></span>

1. <span data-ttu-id="a0ded-223">返回到插件管理页面 (网站管理 > 插件 > Microsoft 365 集成) 并选择 " **团队设置** " 选项卡。</span><span class="sxs-lookup"><span data-stu-id="a0ded-223">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration) and select the **Teams Settings** tab.</span></span>
1. <span data-ttu-id="a0ded-224">单击 " **Microsoft 应用程序注册门户** " 链接，并通过您的 microsoft Id 登录。</span><span class="sxs-lookup"><span data-stu-id="a0ded-224">Click the **Microsoft Application Registration Portal** link and login with your Microsoft Id.</span></span>
1. <span data-ttu-id="a0ded-225">为你的应用输入名称 (例如。</span><span class="sxs-lookup"><span data-stu-id="a0ded-225">Enter a name for you app (Eg.</span></span> <span data-ttu-id="a0ded-226">MoodleBot) ，然后单击 " **创建** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-226">MoodleBot) and click the **Create** button.</span></span>
1. <span data-ttu-id="a0ded-227">复制**应用程序 Id**并将其粘贴到 "**团队设置**" 页面上的 " **Bot 应用程序 id** " 字段中。</span><span class="sxs-lookup"><span data-stu-id="a0ded-227">Copy the **Application Id** and paste it into the **Bot Application ID** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="a0ded-228">单击 " **生成新密码** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="a0ded-228">Click the **Generate New Password** button.</span></span> <span data-ttu-id="a0ded-229">复制生成的密码，并将其粘贴到 "**团队设置**" 页面上的 " **Bot 应用程序密码**" 字段中。</span><span class="sxs-lookup"><span data-stu-id="a0ded-229">Copy the generated password and and paste it into the **Bot Application Password** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="a0ded-230">滚动到窗体底部，然后单击 " **保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-230">Scroll to the bottom of the form and click **Save Changes**.</span></span>

<span data-ttu-id="a0ded-231">既然你已生成你的应用程序 Id 和密码，现在是将机器人部署到 Azure 的时候了。</span><span class="sxs-lookup"><span data-stu-id="a0ded-231">Now that you've generated your Application Id and Password, it's time to deploy your bot to Azure.</span></span> <span data-ttu-id="a0ded-232">单击 " **部署到 Azure** " 按钮并填写包含必要信息的窗体， (Bot 应用程序 Id、Bot 应用程序密码和 Moodle 机密位于 " **团队设置** " 页面上，并且 Azure 信息位于 " **设置** " 页面上) 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-232">Click on the **Deploy to Azure** button and fill out the form with the necessary information (the Bot Application Id, Bot Application Password and the Moodle Secret are on the **Team Settings** page, and the Azure information is on the **Setup** page).</span></span> <span data-ttu-id="a0ded-233">填写完表单后，单击复选框以接受条款和条件，然后单击 " **购买** " 按钮 (所有 Azure 资源都部署到 "自由" 层) 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-233">Once you've got the form filled out, click the check box to agree to the terms and conditions then click the **Purchase** button (all Azure resources are deployed to the free tier).</span></span>

<span data-ttu-id="a0ded-234">将资源部署到 Azure 后，你需要将 Moodle 插件配置为其消息传递终结点。</span><span class="sxs-lookup"><span data-stu-id="a0ded-234">Once the resources are finished deploying to Azure, you'll need to configure the Moodle plugin with it's messaging endpoint.</span></span> <span data-ttu-id="a0ded-235">首先，你需要从 Azure 中的 Bot 获取终结点。</span><span class="sxs-lookup"><span data-stu-id="a0ded-235">First, you'll need to get the endpoint from your Bot in Azure.</span></span> <span data-ttu-id="a0ded-236">为此，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="a0ded-236">To do that:</span></span>

1. <span data-ttu-id="a0ded-237">如果尚未登录，请登录到 [Azure 门户](https://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-237">If you aren't already, log into the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="a0ded-238">在左窗格中，选择 " **资源组**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-238">In the left pane select **Resource groups**.</span></span>
3. <span data-ttu-id="a0ded-239">从列表中选择您刚刚使用的资源组 (或在部署机器人时创建) 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-239">From the list select the resource group you just used (or created) while deploying your Bot.</span></span>
4. <span data-ttu-id="a0ded-240">从组资源列表中选择 " **WebApp Bot** 资源"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-240">Select the **WebApp Bot** resource from the list of resources in the group.</span></span>
5. <span data-ttu-id="a0ded-241">从 "**概述**" 部分复制**消息终结点**。</span><span class="sxs-lookup"><span data-stu-id="a0ded-241">Copy the **Messaging Endpoint** from the **Overview** section.</span></span>
6. <span data-ttu-id="a0ded-242">在 Moodle 中，打开 Moodle 插件的 **团队设置** 页面。</span><span class="sxs-lookup"><span data-stu-id="a0ded-242">In Moodle, open the **Team Settings** page of your Moodle Plugin.</span></span>
7. <span data-ttu-id="a0ded-243">在 " **机器人终结点** " 字段中，粘贴您刚刚复制的 URL，并将 word *消息* 更改为 *webhook*。</span><span class="sxs-lookup"><span data-stu-id="a0ded-243">In the **Bot Endpoint** field paste the URL you just copied and change the word *messages* to *webhook*.</span></span> <span data-ttu-id="a0ded-244">该 URL 现在应如下所示 `https://botname.azurewebsites.net/api/webhook`</span><span class="sxs-lookup"><span data-stu-id="a0ded-244">The URL should now look like `https://botname.azurewebsites.net/api/webhook`</span></span>
8. <span data-ttu-id="a0ded-245">单击 "**保存更改**"</span><span class="sxs-lookup"><span data-stu-id="a0ded-245">Click **Save Changes**</span></span>
9. <span data-ttu-id="a0ded-246">保存更改后，返回到 " **团队设置** " 选项卡，单击 " **下载清单文件** " 按钮并将清单包保存到您的计算机 (您将在下一节) 中使用。</span><span class="sxs-lookup"><span data-stu-id="a0ded-246">Once your changes have saved, go back to the **Team Settings** tab, click the **Download manifest file** button and save the manifest package to your computer (you'll use it in the next section).</span></span>

## <a name="step-4-deploy-your-microsoft-teams-app"></a><span data-ttu-id="a0ded-247">步骤4：部署 Microsoft 团队应用</span><span class="sxs-lookup"><span data-stu-id="a0ded-247">Step 4: Deploy your Microsoft Teams app</span></span>

> [!VIDEO https://www.youtube.com/embed/2rMb7gtM_ZM]

<span data-ttu-id="a0ded-248">现在，你已将机器人部署到 Azure 并配置为与 Moodle 服务器通话，现在是部署 Microsoft 团队应用的时候了。</span><span class="sxs-lookup"><span data-stu-id="a0ded-248">Now that you have your Bot deployed to Azure and configured to talk to your Moodle server, it's time to deploy your Microsoft Teams app.</span></span> <span data-ttu-id="a0ded-249">若要执行此操作，你将从上一步中的 Moodle 插件团队设置页面加载下载的清单文件。</span><span class="sxs-lookup"><span data-stu-id="a0ded-249">To do this you'll load the manifest file you downloaded from the Moodle Plugin Team Settings page in the previous step.</span></span>

<span data-ttu-id="a0ded-250">在你可以安装应用之前，你需要确保已启用应用的外部应用和旁加载。</span><span class="sxs-lookup"><span data-stu-id="a0ded-250">Before you can install the app you'll need to make sure external apps and sideloading of apps is enabled.</span></span> <span data-ttu-id="a0ded-251">若要执行此操作，您可以执行 [以下步骤](https://docs.microsoft.com/MicrosoftTeams/admin-settings)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-251">To do so you can follow [these steps](https://docs.microsoft.com/MicrosoftTeams/admin-settings).</span></span> <span data-ttu-id="a0ded-252">确保已启用外部应用后，你可以按照以下步骤部署你的应用。</span><span class="sxs-lookup"><span data-stu-id="a0ded-252">Once you've ensured that external apps are enabled, you can follow the steps below to deploy your app.</span></span>

1. <span data-ttu-id="a0ded-253">打开 Microsoft 团队。</span><span class="sxs-lookup"><span data-stu-id="a0ded-253">Open Microsoft Teams.</span></span>
2. <span data-ttu-id="a0ded-254">单击导航栏左下角的 " **应用商店** " 图标。</span><span class="sxs-lookup"><span data-stu-id="a0ded-254">Click the **Store** icon on the lower-left of the navigation bar.</span></span>
3. <span data-ttu-id="a0ded-255">从选项列表中单击 " **上载自定义应用程序** " 链接。</span><span class="sxs-lookup"><span data-stu-id="a0ded-255">Click the **Upload a custom app** link from the list of options.</span></span> <span data-ttu-id="a0ded-256">*注意：* 如果你作为全局管理员登录，你可以选择将应用上载到你的组织的应用商店，否则你将只能为你所属的团队加载应用 ( "旁加载" ) 。</span><span class="sxs-lookup"><span data-stu-id="a0ded-256">*Note:* If you're logged in as a global administer you'll have the option of uploading the app to your organization's app store, otherwise you'll only be able to load the app for Teams you're a part of ("sideloading").</span></span>
4. <span data-ttu-id="a0ded-257">选择 `manifest.zip` 之前下载的程序包，然后单击 " **保存**"。</span><span class="sxs-lookup"><span data-stu-id="a0ded-257">Select the `manifest.zip` package you downloaded previously and click **Save**.</span></span> <span data-ttu-id="a0ded-258">如果您尚未下载清单程序包，则可以从 Moodle 中的 "插件配置" 页面的 " **团队设置** " 选项卡执行此操作。</span><span class="sxs-lookup"><span data-stu-id="a0ded-258">If you haven't yet downloaded the manifest package, you can do so from the **Team Settings** tab of the plugin configuration page in Moodle.</span></span>

<span data-ttu-id="a0ded-259">现在已安装应用，你可以将该选项卡添加到你有权访问的任何频道。</span><span class="sxs-lookup"><span data-stu-id="a0ded-259">Now that you have the app installed you can add the tab to any channel that you have access to.</span></span> <span data-ttu-id="a0ded-260">若要执行此操作，请导航到该通道，单击该 **+** 符号，然后从列表中选择你的应用。</span><span class="sxs-lookup"><span data-stu-id="a0ded-260">To do so navigate to the channel, click the **+** symbol and select your app from the list.</span></span> <span data-ttu-id="a0ded-261">按照提示完成将 Moodle 课程选项卡添加到频道。</span><span class="sxs-lookup"><span data-stu-id="a0ded-261">Follow the prompts to finish adding your Moodle course tab to a channel.</span></span>

<span data-ttu-id="a0ded-262">就是这样！</span><span class="sxs-lookup"><span data-stu-id="a0ded-262">That's it!</span></span> <span data-ttu-id="a0ded-263">您和您的团队现在可以直接从 Microsoft 团队开始处理 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="a0ded-263">You and your team, can now start working with your Moodle courses directly from Microsoft Teams.</span></span>

<span data-ttu-id="a0ded-264">若要与我们共享任何功能请求或反馈，请访问我们的 [用户语音页面](https://microsoftteams.uservoice.com/forums/916759-moodle)。</span><span class="sxs-lookup"><span data-stu-id="a0ded-264">To share any feature requests or feedback with us, please visit our [User Voice page](https://microsoftteams.uservoice.com/forums/916759-moodle).</span></span>
