---
title: 安装 Moodle 与 Microsoft Teams 的集成
author: MicrosoftHeidi
ms.author: heidip
manager: serdars
ms.topic: article
ms.service: msteams
audience: admin
ms.reviewer: ''
search.appverid: MET150
description: 了解如何安装和配置适用于 Microsoft Teams 的 Moodle 开源学习管理系统 (LMS) 应用。
keywords: Teams Moodle 应用集成插件
localization_priority: Normal
f1.keywords:
- NOCSH
ms.collection:
- M365-collaboration
ms.custom:
- seo-marvel-apr2020
- seo-marvel-mar2020
appliesto:
- Microsoft Teams
ms.openlocfilehash: 60fabc107ba684afdf32c4eeeb0351f12dec883e
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/23/2021
ms.locfileid: "51120633"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a><span data-ttu-id="9ae6e-104">安装 Moodle 与 Microsoft Teams 的集成</span><span class="sxs-lookup"><span data-stu-id="9ae6e-104">Installing the Moodle integration with Microsoft Teams</span></span>

> [!VIDEO https://www.youtube.com/embed/OHlPt22nKoE]

<span data-ttu-id="9ae6e-105">[Moodle（](https://moodle.org/)世界上最常用的开源学习管理系统 (LMS) ）现在与 Microsoft Teams 集成！</span><span class="sxs-lookup"><span data-stu-id="9ae6e-105">[Moodle](https://moodle.org/), the most popular and open-source Learning Management System (LMS) in the world, is now integrated with Microsoft Teams!</span></span> <span data-ttu-id="9ae6e-106">此集成可帮助教师和教师围绕 Moodle 课程展开协作，提出有关其成绩和作业的问题，并及时了解通知 - 就在 Teams 中！</span><span class="sxs-lookup"><span data-stu-id="9ae6e-106">This integration helps educators and teachers collaborate around Moodle courses, ask questions about their grades and assignments and stay updated with notifications -- right within Teams!</span></span>

<span data-ttu-id="9ae6e-107">为了帮助 IT 管理员轻松设置此集成，我们已使用以下功能更新了开源 Moodle 插件：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-107">To help IT admins easily set this integration up, we have updated our open-source Moodle Plugin with the following capabilities:</span></span>

* <span data-ttu-id="9ae6e-108">将 Moodle 服务器自动注册到 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-108">Auto-registration of your Moodle server with Azure AD.</span></span>
* <span data-ttu-id="9ae6e-109">一键式将 Moodle Assistant 机器人部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-109">One-click deployment of your Moodle Assistant bot to Azure.</span></span>
* <span data-ttu-id="9ae6e-110">自动预配团队以及自动同步所有或选择 Moodle 课程的团队注册。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-110">Auto-provisioning of teams and auto-synchronization of team enrollments for all or select Moodle courses.</span></span>
* <span data-ttu-id="9ae6e-111">自动将 Moodle 选项卡和 Moodle Assistant 机器人安装在每个同步的团队中。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-111">Auto-installation of the Moodle tab and the Moodle Assistant bot into each synchronized team.</span></span> <span data-ttu-id="9ae6e-112"> (即将推出) </span><span class="sxs-lookup"><span data-stu-id="9ae6e-112">(Coming soon)</span></span>
* <span data-ttu-id="9ae6e-113">一键式将 Moodle 应用发布到专用 Teams App Store。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-113">One-click publishing of the Moodle app into your private Teams App Store.</span></span> <span data-ttu-id="9ae6e-114"> (即将推出) </span><span class="sxs-lookup"><span data-stu-id="9ae6e-114">(Coming soon)</span></span>

<span data-ttu-id="9ae6e-115">若要详细了解此集成提供的功能，请参阅 [安装 Moodle 与 Microsoft Teams 的集成](/microsoftteams/platform/resources/moodleinstructions)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-115">To learn more about the functionality this integration provides, see [Installing the Moodle integration with Microsoft Teams](/microsoftteams/platform/resources/moodleinstructions).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="9ae6e-116">先决条件</span><span class="sxs-lookup"><span data-stu-id="9ae6e-116">Prerequisites</span></span>

<span data-ttu-id="9ae6e-117">若要安装和配置此应用程序，需要：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-117">In order to install and configure this application you'll need:</span></span>

1. <span data-ttu-id="9ae6e-118">Moodle 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="9ae6e-118">Moodle administrator credentials</span></span>
2. <span data-ttu-id="9ae6e-119">Azure AD 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="9ae6e-119">Azure AD administrator credentials</span></span>
3. <span data-ttu-id="9ae6e-120">可以在 中创建新资源的 Azure 订阅</span><span class="sxs-lookup"><span data-stu-id="9ae6e-120">An Azure subscription you can create new resources in</span></span>

## <a name="step-1-install-the-moodle-plugin"></a><span data-ttu-id="9ae6e-121">步骤 1：安装 Moodle 插件</span><span class="sxs-lookup"><span data-stu-id="9ae6e-121">Step 1: Install the Moodle Plugin</span></span>

> [!VIDEO https://www.youtube.com/embed/SETEC5nzMgk]

<span data-ttu-id="9ae6e-122">Microsoft Teams 中的 Moodle 集成由开源[Moodle 插件集 提供。](https://github.com/Microsoft/o365-moodle)</span><span class="sxs-lookup"><span data-stu-id="9ae6e-122">The Moodle integration in Microsoft Teams is powered by the open source [Moodle plugin set](https://github.com/Microsoft/o365-moodle).</span></span> <span data-ttu-id="9ae6e-123">若要在 Moodle 服务器中安装插件，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-123">To install the plugin in your Moodle server:</span></span>

1. <span data-ttu-id="9ae6e-124">首先，下载 [Moodle 插件集](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) 并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-124">First, download the [Moodle plugin set](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) and save it to your local computer.</span></span> <span data-ttu-id="9ae6e-125">需使用 3.5 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-125">You'll need to use version 3.5 or newer.</span></span>
    * <span data-ttu-id="9ae6e-126">安装 local_o365 插件还将安装 auth_oidc [boost_o365Teams](https://moodle.org/plugins/auth_oidc)插件。 [](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams)</span><span class="sxs-lookup"><span data-stu-id="9ae6e-126">Installing the local_o365 plugin will also install the [auth_oidc](https://moodle.org/plugins/auth_oidc) and [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams) plugins.</span></span>
1. <span data-ttu-id="9ae6e-127">以管理员角色登录到 Moodle 服务器，然后从左侧导航 **面板** 中选择"网站管理"。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-127">Sign in to your Moodle server as an administrator, and select **Site administration** from the left navigation panel.</span></span>
1. <span data-ttu-id="9ae6e-128">选择"**插件"** 选项卡，并单击"**安装插件"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-128">Select the **Plugins** tab, and then click **Install plugins**.</span></span>
1. <span data-ttu-id="9ae6e-129">在" **从 ZIP 文件安装插件** "部分下，单击 **"选择文件"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-129">Under the **Install plugin from ZIP file** section click the **Choose a file** button.</span></span>
1. <span data-ttu-id="9ae6e-130">从 **左侧导航栏中选择**"上传文件"选项，浏览上面下载的文件，然后单击"**上传此文件"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-130">Select the **Upload a file** option from the left navigation, browse for the file you downloaded above and click **Upload this file**.</span></span>
1. <span data-ttu-id="9ae6e-131">再次从 **左侧导航** 面板中选择"网站管理"选项，返回到管理员仪表板。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-131">Select the **Site administration** option from the left navigation panel again to return to your admin dashboard.</span></span> <span data-ttu-id="9ae6e-132">向下滚动到"本地 **插件"，** 并单击 **"Microsoft Office 365 集成"** 链接。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-132">Scroll down to the **Local plugins** and click the **Microsoft Office 365 Integration** link.</span></span> <span data-ttu-id="9ae6e-133">让此配置页在单独的浏览器选项卡中保持打开状态，因为此过程的余下部分会一直使用。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-133">Keep this configuration page open in a separate browser tab as you'll be using it throughout the rest of this process.</span></span>

<span data-ttu-id="9ae6e-134">可以在 Moodle 文档中找到有关如何安装 [Moodle](https://docs.moodle.org/34/en/Installing_plugins)插件的信息。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-134">You can find more information on how to install Moodle plugins in the [Moodle documentation](https://docs.moodle.org/34/en/Installing_plugins).</span></span>

<span data-ttu-id="9ae6e-135">**重要说明：** 在单独的浏览器选项卡中打开 Microsoft 365 或 Office 365 Moodle 插件配置页，因为在整个过程中将返回到这组页面。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-135">**Important Note:** Keep your Microsoft 365 or Office 365 Moodle Plugin configuration page open in a separate browser tab as you will be returning to this set of pages throughout this process.</span></span>

<span data-ttu-id="9ae6e-136">*还没有 Moodle 网站？*</span><span class="sxs-lookup"><span data-stu-id="9ae6e-136">*Don't have a Moodle site already?*</span></span> <span data-ttu-id="9ae6e-137">可能需要查看 Azure 上的 Moodle 存储库[](https://github.com/azure/moodle)，可在其中快速在 Azure 上部署 Moodle 实例，并根据需要对其进行自定义。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-137">You might want to check out our Moodle on Azure [repo](https://github.com/azure/moodle) where you can quickly deploy a Moodle instance on Azure and customize it to your needs.</span></span>

## <a name="step-2-configure-the-connection-between-the-microsoft-365-or-office-365-plugin-and-azure-active-directory"></a><span data-ttu-id="9ae6e-138">步骤 2：配置 Microsoft 365 或 Office 365 插件与 Azure Active Directory 之间的连接</span><span class="sxs-lookup"><span data-stu-id="9ae6e-138">Step 2: Configure the connection between the Microsoft 365 or Office 365 plugin and Azure Active Directory</span></span>

> [!VIDEO https://www.youtube.com/embed/FpGEezaJ3SA]

<span data-ttu-id="9ae6e-139">接下来，需要将 Moodle 注册为 Azure Active Directory 中的应用程序。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-139">Next you'll need to register Moodle as an application in your Azure Active Directory.</span></span> <span data-ttu-id="9ae6e-140">我们提供了 PowerShell 脚本来帮助你完成此过程。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-140">We've provided a PowerShell script to help you complete this process.</span></span> <span data-ttu-id="9ae6e-141">PowerShell 脚本为 Microsoft 365 或 Office 365 组织设置新的 Azure AD 应用程序，Moodle 插件将使用该应用程序。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-141">The PowerShell Script provisions a new Azure AD application for your Microsoft 365 or Office 365 organization, which will be used by the Moodle Plugin.</span></span> <span data-ttu-id="9ae6e-142">该脚本将为 Microsoft 365 或 Office 365 租户预配应用，为预配的应用设置所有必需的回复 URL 和权限，并返回 AppID 和密钥。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-142">The script will provision the app for your Microsoft 365 or Office 365 tenant, set up all the required Reply URLs and Permissions for the provisioned app and return the AppID and Key.</span></span> <span data-ttu-id="9ae6e-143">可以使用 Moodle 插件设置页中生成的 AppID 和密钥通过 Azure AD 配置 Moodle 服务器。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-143">You can use the generated AppID and Key in your Moodle Plugin Setup Page to configure your Moodle server with Azure AD.</span></span> <span data-ttu-id="9ae6e-144">若要查看 PowerShell 脚本自动执行的详细手动步骤，可在插件 的完整 [文档中找到这些步骤](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-144">If you want to see the detailed manual steps that the PowerShell script is automating, you can find them in the full [documentation for the plugin](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application).</span></span>

### <a name="moodle-tab-for-microsoft-teams-information-flow"></a><span data-ttu-id="9ae6e-145">Microsoft Teams 信息流的 Moodle 选项卡</span><span class="sxs-lookup"><span data-stu-id="9ae6e-145">Moodle tab for Microsoft Teams information flow</span></span>

<img width="530px" src="media/MoodleTabInformationFlow.png" alt="Illustration of Moodle tab for Microsoft Teams information flow" title="Microsoft Teams 信息流的 Moodle 选项卡插图" />

1. <span data-ttu-id="9ae6e-147">从 Microsoft 365 或 Office 365 集成插件页面中，选择"设置 **"** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-147">From the Microsoft 365 or Office 365 Integration plugin page, select the **Setup** tab.</span></span>
1. <span data-ttu-id="9ae6e-148">单击" **下载 PowerShell 脚本"** 按钮，并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-148">Click the **Download PowerShell Script** button and save it to your local computer.</span></span>
1. <span data-ttu-id="9ae6e-149">需要从 ZIP 文件准备 PowerShell 脚本。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-149">You'll need to prepare the PowerShell script from the ZIP file.</span></span> <span data-ttu-id="9ae6e-150">为此：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-150">To do so:</span></span>
    * <span data-ttu-id="9ae6e-151">下载并解压缩 `Moodle-AzureAD-Powershell.zip` 文件。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-151">Download and extract the `Moodle-AzureAD-Powershell.zip` file.</span></span>
    * <span data-ttu-id="9ae6e-152">打开提取的文件夹。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-152">Open the extracted folder.</span></span>
    * <span data-ttu-id="9ae6e-153">右键单击文件 `Moodle-AzureAD-Script.ps1` 并选择"属性 **"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-153">Right-click on the `Moodle-AzureAD-Script.ps1` file and select **Properties**.</span></span>
    * <span data-ttu-id="9ae6e-154">在" **属性** "窗口的"常规"选项卡下，选中底部 `Unblock` **"安全性"** 属性旁边的框。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-154">Under the **General** tab of the Properties window, check the `Unblock` box next to the **Security** attribute at the bottom.</span></span>
    * <span data-ttu-id="9ae6e-155">单击“**确定**”。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-155">Click **OK**.</span></span>
    * <span data-ttu-id="9ae6e-156">复制提取的文件夹的目录路径。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-156">Copy the directory path of the extracted folder.</span></span>
1. <span data-ttu-id="9ae6e-157">接下来，以管理员角色运行 PowerShell：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-157">Next you'll run PowerShell as an administrator:</span></span>
    * <span data-ttu-id="9ae6e-158">单击“开始”。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-158">Click Start.</span></span>
    * <span data-ttu-id="9ae6e-159">键入 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-159">Type PowerShell.</span></span>
    * <span data-ttu-id="9ae6e-160">右键单击Windows PowerShell。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-160">Right-click Windows PowerShell.</span></span>
    * <span data-ttu-id="9ae6e-161">单击"以管理员角色运行"。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-161">Click "Run as Administrator".</span></span>
1. <span data-ttu-id="9ae6e-162">通过键入 ，导航到解压缩的目录 `cd ...\...\Moodle-AzureAD-Powershell` ，其中 是 `...\...` 目录的路径。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-162">Navigate to the unzipped directory by typing `cd ...\...\Moodle-AzureAD-Powershell` where `...\...` is the path to the directory.</span></span>
1. <span data-ttu-id="9ae6e-163">通过以下方法执行 PowerShell 脚本：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-163">Execute the PowerShell script by:</span></span>
    * <span data-ttu-id="9ae6e-164">输入 `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser` 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-164">Enter `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`.</span></span>
    * <span data-ttu-id="9ae6e-165">输入 `.\Moodle-AzureAD-Script.ps1` 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-165">Enter `.\Moodle-AzureAD-Script.ps1`.</span></span>
    * <span data-ttu-id="9ae6e-166">在弹出窗口中登录到 Microsoft 365 或 Office 365 管理员帐户。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-166">Log in to your Microsoft 365 or Office 365 Administrator account in the pop-up window.</span></span>
    * <span data-ttu-id="9ae6e-167">输入 Azure AD 应用程序的名称 (例如</span><span class="sxs-lookup"><span data-stu-id="9ae6e-167">Enter the name of the Azure AD Application (Ex.</span></span> <span data-ttu-id="9ae6e-168">Moodle/Moodle 插件) 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-168">Moodle/Moodle plugin).</span></span>
    * <span data-ttu-id="9ae6e-169">输入 Moodle 服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-169">Enter the URL of your Moodle server.</span></span>
    * <span data-ttu-id="9ae6e-170">复制 **脚本生成的\*\*\*\*应用程序** ID 和应用程序密钥，并保存它们。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-170">Copy the **Application ID** and **Application Key** generated by the script and save them.</span></span>
1. <span data-ttu-id="9ae6e-171">接下来，需要将 ID 和密钥添加到 Moodle 插件。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-171">Next you'll need to add the Id and Key to the Moodle Plugin.</span></span> <span data-ttu-id="9ae6e-172">返回到 Microsoft 365 集成 (插件的>管理>管理) 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-172">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration).</span></span>
1. <span data-ttu-id="9ae6e-173">在"**设置"** 选项卡上，**添加之前** 复制的应用程序 ID 和应用程序密钥，然后单击"**保存更改"。** </span><span class="sxs-lookup"><span data-stu-id="9ae6e-173">On the **Setup** tab add the **Application Id** and **Application Key** you copied previously, then click **Save changes**.</span></span>
1. <span data-ttu-id="9ae6e-174">页面刷新后，现在应会看到一个新部分"**选择连接方法"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-174">Once the page refreshes you should now see a new section **Choose connection method**.</span></span> <span data-ttu-id="9ae6e-175">单击标记为"默认" **的复选框** ，然后再次单击" **保存更改** "。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-175">Click the checkbox labeled **Default** and then click **Save changes** again.</span></span>
1. <span data-ttu-id="9ae6e-176">刷新页面后，你将看到另一个新分区管理员 **同意&信息**。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-176">Once the page refreshes you will see another new section **Admin consent & additional information**.</span></span>
    * <span data-ttu-id="9ae6e-177">单击"**提供管理员许可**"链接，输入 Microsoft 365 或 Office 365全局管理员凭据，并单击"接受"以授予权限。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-177">Click the **Provide Admin Consent** link, enter your Microsoft 365 or Office 365 Global Administrator credentials, then **Accept** to grant the permissions.</span></span>
    * <span data-ttu-id="9ae6e-178">在 **"Azure AD 租户"字段** 旁边，单击" **检测"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-178">Next to the **Azure AD Tenant** field click the **Detect** button.</span></span>
    * <span data-ttu-id="9ae6e-179">在 **OneDrive for Business URL 旁边，单击** " **检测"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-179">Next to the **OneDrive for Business URL** click the **Detect** button.</span></span>
    * <span data-ttu-id="9ae6e-180">填充字段后，再次单击 **"保存更改"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-180">Once the fields populate, click the **Save changes** button again.</span></span>
1. <span data-ttu-id="9ae6e-181">单击"**更新"** 按钮验证安装，并单击"**保存更改"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-181">Click the **Update** button to verify the installation, then **Save changes**.</span></span>
1. <span data-ttu-id="9ae6e-182">接下来，需要在 Moodle 服务器和 Azure Active Directory 之间同步用户。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-182">Next you'll need to synchronize users between your Moodle server and Azure Active Directory.</span></span> <span data-ttu-id="9ae6e-183">根据环境，可以在此阶段选择不同的选项。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-183">Depending on your environment, you may select different options during this stage.</span></span> <span data-ttu-id="9ae6e-184">请注意，在此处设置的配置将运行每个 Moodle cron (每天运行一次) 以保持所有内容同步。若要开始，请：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-184">Note that the configuration you set here will run with each Moodle cron run (typically once a day) to keep everything in sync. To get started:</span></span>
    * <span data-ttu-id="9ae6e-185">切换到"同步 **设置"选项卡**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-185">Switch to the **Sync Settings tab**</span></span>
    * <span data-ttu-id="9ae6e-186">在" **将用户与 Azure AD** 同步"部分中，选中适用于环境的复选框。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-186">In the **Sync users with Azure AD** section, select the checkboxes that apply to your environment.</span></span> <span data-ttu-id="9ae6e-187">通常至少选择：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-187">Typically you would select at least:</span></span>
        * <span data-ttu-id="9ae6e-188">在 Moodle 中为 Azure AD 中的用户创建帐户</span><span class="sxs-lookup"><span data-stu-id="9ae6e-188">Create accounts in Moodle for users in Azure AD</span></span>
        * <span data-ttu-id="9ae6e-189">为 Azure AD 中的用户更新 Moodle 中的所有帐户</span><span class="sxs-lookup"><span data-stu-id="9ae6e-189">Update all accounts in Moodle for users in Azure AD</span></span>
    * <span data-ttu-id="9ae6e-190">在 **"用户创建限制** "部分中，可以设置筛选器来限制要同步到 Moodle 的 Azure AD 用户。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-190">In the **User Creation Restriction** section you can set up a filter to limit the Azure AD users that will be synced to Moodle.</span></span>
    * <span data-ttu-id="9ae6e-191">使用 **"用户字段** 映射"部分可以自定义 Azure AD 到 Moodle 用户配置文件字段映射。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-191">The **User Field Mapping** section will allow you to customize the Azure AD to Moodle User Profile field mapping.</span></span>
    * <span data-ttu-id="9ae6e-192">在 **"Teams 同步** "部分中，可以选择自动 (组，例如 Teams) 部分或所有现有 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-192">In the **Teams Sync** section you can choose to automatically create Groups (i.e. Teams) for some, or all, of your existing Moodle courses.</span></span>
1. <span data-ttu-id="9ae6e-193">若要验证 cron 作业 (并手动运行它们（如果希望首次运行) 请单击"将用户与 **Azure AD** 同步"部分中的"计划任务管理"页链接。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-193">To validate the cron jobs (and run them manually if you wish to for the first run) click the **Scheduled tasks management page** link in the **Sync users with Azure AD** section.</span></span> <span data-ttu-id="9ae6e-194">这会将你带至 **"计划任务"** 页。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-194">This will take you to the **Scheduled Tasks** page.</span></span>
    * <span data-ttu-id="9ae6e-195">向下滚动并找到作业"将 **用户与 Azure AD 作业** 同步"，并单击"**立即运行"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-195">Scroll down and find the job **Sync users with Azure AD** job and click **Run now**.</span></span>
    * <span data-ttu-id="9ae6e-196">如果选择基于现有课程创建组，还可以运行在 **Office 365** 中创建用户组作业。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-196">If you chose to create Groups based on existing courses, you can also run the **Create user groups in Office 365** job.</span></span>
1. <span data-ttu-id="9ae6e-197">返回到 Microsoft 365 集成 (网站>管理>管理) 并选择 **"Teams 设置** "页面。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-197">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration) and select the **Teams Settings** page.</span></span> <span data-ttu-id="9ae6e-198">需要配置一些安全设置才能启用 Teams 应用集成。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-198">You'll need to configure some security settings to enable the Teams app integration.</span></span>
    * <span data-ttu-id="9ae6e-199">若要启用 OpenID Connect，请单击" **管理** 身份验证"链接，并单击 **OpenId Connect** 行上的眼睛图标（如果灰度）。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-199">To enable OpenID Connect, click the **Manage Authentication** link, and click the eye icon on the **OpenId Connect** line if it is greyed out.</span></span>
    * <span data-ttu-id="9ae6e-200">接下来，你需要启用帧嵌入。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-200">Next you'll need to enable frame embedding.</span></span> <span data-ttu-id="9ae6e-201">单击 **"HTTP 安全性** "链接，并单击"允许嵌入帧 **"旁边的复选框**。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-201">Click the **HTTP Security** link, then click the checkbox next to **Allow frame embedding**.</span></span>
    * <span data-ttu-id="9ae6e-202">下一步是启用将启用 Moodle API 功能的 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-202">The next step is to enable web services which will enable the Moodle API features.</span></span> <span data-ttu-id="9ae6e-203">单击" **高级功能** "链接，确保选中"启用 Web 服务 **"旁边的** 复选框。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-203">Click the **Advanced Features** link, then make sure the checkbox next to **Enable web services** is checked.</span></span>
    * <span data-ttu-id="9ae6e-204">最后，需要为 Microsoft 365 或 Office 365 启用外部服务。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-204">Finally you'll need to enable the external services for Microsoft 365 or Office 365.</span></span> <span data-ttu-id="9ae6e-205">单击" **外部服务"** 链接，然后：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-205">Click the **External services** link then:</span></span>
        * <span data-ttu-id="9ae6e-206">在 **"Moodle Office 365 Webservices"行上单击"编辑**"。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-206">Click **Edit** on the **Moodle Office 365 Webservices** row.</span></span>
        * <span data-ttu-id="9ae6e-207">标记"已启用"旁边的 **复选框**，然后单击" **保存更改"**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-207">Mark the checkbox next to **Enabled**, then click **Save Changes**</span></span>
    * <span data-ttu-id="9ae6e-208">接下来，需要编辑经过身份验证的用户权限，以允许他们创建 Web 服务令牌。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-208">Next you'll need to edit your authenticated user permissions to allow them to create web service tokens.</span></span> <span data-ttu-id="9ae6e-209">单击 **"编辑角色""已经过身份验证的用户"** 链接。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-209">Click the **Editing role 'Authenticated user'** link.</span></span> <span data-ttu-id="9ae6e-210">向下滚动并找到" **创建 Web 服务** 令牌"功能，并标记" **允许"** 复选框。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-210">Scroll down and find the **Create a web service token** capability and mark the **Allow** checkbox.</span></span>

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a><span data-ttu-id="9ae6e-211">步骤 3：将 Moodle Assistant 机器人部署到 Azure</span><span class="sxs-lookup"><span data-stu-id="9ae6e-211">Step 3: Deploy the Moodle Assistant Bot to Azure</span></span>

> [!VIDEO https://www.youtube.com/embed/gbkJxf8FlfY]

<span data-ttu-id="9ae6e-212">Microsoft Teams 的免费 Moodle Assistant 机器人可帮助教师和学生回答有关其课程、作业、成绩和 Moodle 的其他信息的问题。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-212">The free Moodle Assistant Bot for Microsoft Teams helps teachers and students answer questions about their courses, assignments, grades and other information in Moodle.</span></span> <span data-ttu-id="9ae6e-213">机器人还会在 Teams 中向学生和教师发送 Moodle 通知。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-213">The bot also sends Moodle notifications to students and teachers right within Teams.</span></span> <span data-ttu-id="9ae6e-214">此机器人是 Microsoft 维护的开源项目， [可在 GitHub 上获取](https://github.com/microsoft/Moodle-Teams-Bot)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-214">This bot is an open source project maintained by Microsoft, and is [available on GitHub](https://github.com/microsoft/Moodle-Teams-Bot).</span></span>

> [!NOTE]
> <span data-ttu-id="9ae6e-215">在本部分，我们将资源部署到 Azure 订阅，所有资源都将使用免费 **层进行** 配置。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-215">In this section you will deploy resources to your Azure subscription, and all resources will be configured using the **free** tier.</span></span> <span data-ttu-id="9ae6e-216">根据机器人的使用情况，可能需要缩放这些资源。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-216">Depending on the usage of your bot, you may need to scale these resources.</span></span>
> <span data-ttu-id="9ae6e-217">如果只想使用"Moodle"选项卡而不使用机器人，请跳到步骤[4。](#step-4-deploy-your-microsoft-teams-app)</span><span class="sxs-lookup"><span data-stu-id="9ae6e-217">If you want to just use the Moodle tab without the bot, skip to [step 4](#step-4-deploy-your-microsoft-teams-app).</span></span>

### <a name="moodle-bot-information-flow"></a><span data-ttu-id="9ae6e-218">Moodle 机器人信息流</span><span class="sxs-lookup"><span data-stu-id="9ae6e-218">Moodle bot information flow</span></span>

<img width="530px" src="media/MoodleBotInformationFlow.png" alt="llustration of Moodle bot for Microsoft Teams information flow" title="Microsoft Teams 信息流的 Moodle 机器人插图" />


<span data-ttu-id="9ae6e-220">若要安装机器人，首先需要在 Microsoft 标识平台上 [注册它](https://identity.microsoft.com/Landing)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-220">To install the bot, you'll first need to register it on the [Microsoft Identity Platform](https://identity.microsoft.com/Landing).</span></span> <span data-ttu-id="9ae6e-221">这样机器人可以针对 Microsoft 终结点进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-221">This allows your Bot to authenticate against your Microsoft endpoints.</span></span> <span data-ttu-id="9ae6e-222">注册机器人：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-222">To register your bot:</span></span>

1. <span data-ttu-id="9ae6e-223">返回到 Microsoft 365 集成 (网站管理>插件>管理) 并选择 **"Teams** 设置"选项卡。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-223">Return to the plugin administration page (Site administration > Plugins > Microsoft 365 Integration) and select the **Teams Settings** tab.</span></span>
1. <span data-ttu-id="9ae6e-224">单击 **"Microsoft 应用程序注册门户"** 链接，使用 Microsoft ID 登录。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-224">Click the **Microsoft Application Registration Portal** link and login with your Microsoft Id.</span></span>
1. <span data-ttu-id="9ae6e-225">输入应用的名称，例如 (名称。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-225">Enter a name for your app (Eg.</span></span> <span data-ttu-id="9ae6e-226">MoodleBot) 单击"创建 **"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-226">MoodleBot) and click the **Create** button.</span></span>
1. <span data-ttu-id="9ae6e-227">复制应用程序 **ID 并将其** 粘贴到"团队设置"页上的"机器人应用程序 **ID"** 字段中。 </span><span class="sxs-lookup"><span data-stu-id="9ae6e-227">Copy the **Application Id** and paste it into the **Bot Application ID** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="9ae6e-228">单击" **生成新密码"** 按钮。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-228">Click the **Generate New Password** button.</span></span> <span data-ttu-id="9ae6e-229">复制生成的密码，并将其粘贴到"团队设置" **页上** 的"机器人应用程序 **密码"** 字段中。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-229">Copy the generated password and paste it into the **Bot Application Password** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="9ae6e-230">滚动到表单底部，然后单击"保存 **更改"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-230">Scroll to the bottom of the form and click **Save Changes**.</span></span>

<span data-ttu-id="9ae6e-231">生成应用程序 ID 和密码后，现在可以将机器人部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-231">Now that you've generated your Application Id and Password, it's time to deploy your bot to Azure.</span></span> <span data-ttu-id="9ae6e-232">单击"**部署到 Azure"** 按钮，在窗体中填写必要的信息 ("机器人应用程序 ID"、机器人应用程序密码和 Moodle 机密位于"团队设置"页上，Azure 信息位于"设置"页) 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-232">Click on the **Deploy to Azure** button and fill out the form with the necessary information (the Bot Application Id, Bot Application Password and the Moodle Secret are on the **Team Settings** page, and the Azure information is on the **Setup** page).</span></span> <span data-ttu-id="9ae6e-233">填写表单后，单击该复选框以同意条款和条件，然后单击"购买"按钮 (所有 Azure 资源都部署到免费层) 。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-233">Once you've got the form filled out, click the check box to agree to the terms and conditions then click the **Purchase** button (all Azure resources are deployed to the free tier).</span></span>

<span data-ttu-id="9ae6e-234">资源部署到 Azure 后，需要配置 Moodle 插件及其消息传送终结点。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-234">Once the resources are finished deploying to Azure, you'll need to configure the Moodle plugin with its messaging endpoint.</span></span> <span data-ttu-id="9ae6e-235">首先，需要从 Azure 中的机器人获取终结点。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-235">First, you'll need to get the endpoint from your Bot in Azure.</span></span> <span data-ttu-id="9ae6e-236">为此，需要：</span><span class="sxs-lookup"><span data-stu-id="9ae6e-236">To do that:</span></span>

1. <span data-ttu-id="9ae6e-237">如果还没有，请登录到 [Azure 门户](https://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-237">If you aren't already, log into the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="9ae6e-238">在左窗格中，选择"**资源组"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-238">In the left pane select **Resource groups**.</span></span>
3. <span data-ttu-id="9ae6e-239">从列表中选择在部署机器人时刚 (或) 的资源组。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-239">From the list select the resource group you just used (or created) while deploying your Bot.</span></span>
4. <span data-ttu-id="9ae6e-240">从 **组中资源列表中选择 WebApp** 机器人资源。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-240">Select the **WebApp Bot** resource from the list of resources in the group.</span></span>
5. <span data-ttu-id="9ae6e-241">从 **"概述"部分** 复制"消息 **传送终结点** "。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-241">Copy the **Messaging Endpoint** from the **Overview** section.</span></span>
6. <span data-ttu-id="9ae6e-242">在 Moodle 中，打开 **Moodle 插件** 的"团队设置"页。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-242">In Moodle, open the **Team Settings** page of your Moodle Plugin.</span></span>
7. <span data-ttu-id="9ae6e-243">在"**机器人终结点"** 字段中，粘贴刚刚复制的 URL，然后将"*消息"一* 词更改为 *"webhook"。*</span><span class="sxs-lookup"><span data-stu-id="9ae6e-243">In the **Bot Endpoint** field paste the URL you just copied and change the word *messages* to *webhook*.</span></span> <span data-ttu-id="9ae6e-244">URL 现在应如下所示 `https://botname.azurewebsites.net/api/webhook`</span><span class="sxs-lookup"><span data-stu-id="9ae6e-244">The URL should now look like `https://botname.azurewebsites.net/api/webhook`</span></span>
8. <span data-ttu-id="9ae6e-245">单击" **保存更改"**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-245">Click **Save Changes**</span></span>
9. <span data-ttu-id="9ae6e-246">保存更改后，返回到"团队设置"选项卡，单击"下载清单文件"按钮，将清单包保存到计算机 (你将在) 的下一部分中使用它。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-246">Once your changes have saved, go back to the **Team Settings** tab, click the **Download manifest file** button and save the manifest package to your computer (you'll use it in the next section).</span></span>

## <a name="step-4-deploy-your-microsoft-teams-app"></a><span data-ttu-id="9ae6e-247">步骤 4：部署 Microsoft Teams 应用</span><span class="sxs-lookup"><span data-stu-id="9ae6e-247">Step 4: Deploy your Microsoft Teams app</span></span>

> [!VIDEO https://www.youtube.com/embed/2rMb7gtM_ZM]

<span data-ttu-id="9ae6e-248">将机器人部署到 Azure 并配置为与 Moodle 服务器通信后，可以部署 Microsoft Teams 应用了。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-248">Now that you have your Bot deployed to Azure and configured to talk to your Moodle server, it's time to deploy your Microsoft Teams app.</span></span> <span data-ttu-id="9ae6e-249">为此，需要加载在上一步中从 Moodle 插件团队设置页面下载的清单文件。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-249">To do this you'll load the manifest file you downloaded from the Moodle Plugin Team Settings page in the previous step.</span></span>

<span data-ttu-id="9ae6e-250">在安装应用之前，你需要确保启用外部应用和应用旁加载。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-250">Before you can install the app you'll need to make sure external apps and sideloading of apps is enabled.</span></span> <span data-ttu-id="9ae6e-251">为此，可以按照 [以下步骤操作](./admin-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-251">To do so you can follow [these steps](./admin-settings.md).</span></span> <span data-ttu-id="9ae6e-252">确保启用外部应用后，可以按照以下步骤部署应用。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-252">Once you've ensured that external apps are enabled, you can follow the steps below to deploy your app.</span></span>

1. <span data-ttu-id="9ae6e-253">打开 Microsoft Teams。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-253">Open Microsoft Teams.</span></span>
2. <span data-ttu-id="9ae6e-254">单击 **导航栏** 左下角的"应用商店"图标。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-254">Click the **Store** icon on the lower left of the navigation bar.</span></span>
3. <span data-ttu-id="9ae6e-255">单击 **选项列表中的"** 上传自定义应用"链接。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-255">Click the **Upload a custom app** link from the list of options.</span></span> <span data-ttu-id="9ae6e-256">*注意：* 如果你以全局管理员身份登录，你将可以选择将应用上载到组织的应用商店，否则你只能为你作为"旁加载" ( ) 一部分的 Teams 加载应用。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-256">*Note:* If you're logged in as a global administer you'll have the option of uploading the app to your organization's app store, otherwise you'll only be able to load the app for Teams you're a part of ("sideloading").</span></span>
4. <span data-ttu-id="9ae6e-257">选择之前 `manifest.zip` 下载的包，然后单击"保存 **"。**</span><span class="sxs-lookup"><span data-stu-id="9ae6e-257">Select the `manifest.zip` package you downloaded previously and click **Save**.</span></span> <span data-ttu-id="9ae6e-258">如果尚未下载清单包，可以从 Moodle 中插件配置页的"团队设置"选项卡进行下载。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-258">If you haven't yet downloaded the manifest package, you can do so from the **Team Settings** tab of the plugin configuration page in Moodle.</span></span>

<span data-ttu-id="9ae6e-259">安装应用后，你可以将选项卡添加到你有权访问的任何频道。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-259">Now that you have the app installed you can add the tab to any channel that you have access to.</span></span> <span data-ttu-id="9ae6e-260">为此，请导航到通道，单击 **+** 符号，然后从列表中选择你的应用。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-260">To do so navigate to the channel, click the **+** symbol and select your app from the list.</span></span> <span data-ttu-id="9ae6e-261">按照提示完成将 Moodle 课程选项卡添加到频道。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-261">Follow the prompts to finish adding your Moodle course tab to a channel.</span></span>

<span data-ttu-id="9ae6e-262">就是这样！</span><span class="sxs-lookup"><span data-stu-id="9ae6e-262">That's it!</span></span> <span data-ttu-id="9ae6e-263">现在，你和团队可以直接从 Microsoft Teams 开始使用 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-263">You and your team, can now start working with your Moodle courses directly from Microsoft Teams.</span></span>

<span data-ttu-id="9ae6e-264">若要与我们共享任何功能请求或反馈，请访问 User [Voice 页面](https://microsoftteams.uservoice.com/forums/916759-moodle)。</span><span class="sxs-lookup"><span data-stu-id="9ae6e-264">To share any feature requests or feedback with us, please visit our [User Voice page](https://microsoftteams.uservoice.com/forums/916759-moodle).</span></span>