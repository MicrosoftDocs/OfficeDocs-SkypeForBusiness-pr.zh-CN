---
title: 在 Microsoft 团队的 Microsoft 团队中的服务质量
author: rmw2890
ms.author: MyAdvisor
manager: Serdars
ms.date: 04/23/2018
ms.topic: article
ms.service: msteams
ms.reviewer: rowille
description: 针对 Microsoft Teams 的服务质量 (QoS) 准备贵组织的网络。
localization_priority: Normal
search.appverid: MET150
MS.collection: Strat_MT_TeamsAdmin
appliesto:
- Microsoft Teams
ms.openlocfilehash: 640f567033b75a6d068721c0c59ef4d2a1b5f11a
ms.sourcegitcommit: 940cb253923e3537cb7fb4d7ce875ed9bfbb72db
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/07/2018
ms.locfileid: "23882271"
---
# <a name="quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="e7fd0-103">Microsoft Teams 中的服务质量 (QoS)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-103">Quality of Service (QoS) in Microsoft Teams</span></span>

<span data-ttu-id="e7fd0-104">本文将帮助您的服务质量 (QoS) 中的 Microsoft 团队准备贵组织的网络。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-104">This article will help you prepare your organization's network for Quality of Service (QoS) in Microsoft Teams.</span></span>
<span data-ttu-id="e7fd0-105">QoS 是一种机制用于设置优先级某些类型的网络流量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-105">QoS is a mechanism you use to prioritize certain types of network traffic.</span></span> <span data-ttu-id="e7fd0-106">确定优先级如团队的实时通信服务的通信很重要以提供业务级用户体验。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-106">Prioritizing the traffic for real-time communications services such as Teams is important to deliver a business-grade user experience.</span></span> <span data-ttu-id="e7fd0-107">对于要真正有效的 QoS，您必须配置从最终的 QoS 能够连接到最终 （PC、 网络交换机和路由器到云），因为无法支持 QoS 路径的任何部分会降低整个呼叫的质量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-107">For QoS to be truly effective, you must configure a QoS-capable connection from end to end (PC, network switches, and routers to the cloud), because any part of the path that fails to support QoS can degrade the quality of the entire call.</span></span>

<span data-ttu-id="e7fd0-108">![组织的网络和 Office 365 服务之间的关系： 本地网络和设备将与反过来连接和 Office 365 云语音和音频会议服务互连网络连接。](media/Qos-in-Teams-Image1.png "组织的网络和 Office 365 服务之间的关系： 本地网络和设备将与反过来连接和 Office 365 云语音和音频会议服务互连网络连接。")</span><span class="sxs-lookup"><span data-stu-id="e7fd0-108">![The relationship between an organization's networks and Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Office 365 Cloud Voice and Audio Conferencing services.](media/Qos-in-Teams-Image1.png "The relationship between an organization's networks and Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Office 365 Cloud Voice and Audio Conferencing services.")</span></span>

<span data-ttu-id="e7fd0-109">_图 1。组织的网络和 Office 365 服务之间的关系_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-109">_Figure 1. The relationship between an organization’s networks and Office 365 services_</span></span>
 

<span data-ttu-id="e7fd0-110">在大多数情况下，该互连网络将非托管的网络 internet 连接。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-110">In most cases, the interconnect network will be an unmanaged network internet connection.</span></span> <span data-ttu-id="e7fd0-111">一个选项可用于解决端到端 QoS 是[Azure ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/)。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-111">One option available to address end-to-end QoS is [Azure ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/).</span></span> <span data-ttu-id="e7fd0-112">我们仍建议您实现 QoS 上网络的部分中，您可以控制，即您的本地网络。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-112">We still recommend that you implement QoS on the portions of the network you have control over, namely your on-premises network.</span></span> <span data-ttu-id="e7fd0-113">这将提高整个部署的实时通信工作负载的质量，并解决阻塞现有部署中的点。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-113">This will increase the quality of real-time communication workloads throughout your deployment and alleviate chokepoints in your existing deployment.</span></span> 


## <a name="prioritize-teams-network-traffic-for-qos"></a><span data-ttu-id="e7fd0-114">设置团队网络流量优先级的 QoS</span><span class="sxs-lookup"><span data-stu-id="e7fd0-114">Prioritize Teams network traffic for QoS</span></span> 

<span data-ttu-id="e7fd0-115">本文重点介绍如何设置优先级团队实时通信流量 — 即，语音和视频。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-115">This article focuses on how to prioritize Teams real-time communications traffic—namely, voice and video.</span></span> <span data-ttu-id="e7fd0-116">您还可以设置优先级其他类型的通信，根据您的需求。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-116">You can also prioritize other types of traffic, based on your needs.</span></span>

<span data-ttu-id="e7fd0-117">有多种方式对流量进行优先排序，最常用的是使用区分服务代码点 (DSCP) 标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-117">There are multiple ways to prioritize traffic, but the most common is by using differentiated services code point (DSCP) markings.</span></span> <span data-ttu-id="e7fd0-118">它们可以应用 （"已标记"） 基于端口范围和还通过组策略对象。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-118">They can be applied (“tagged”) based on port ranges and also via Group Policy objects.</span></span> <span data-ttu-id="e7fd0-119">我们将介绍均位于这篇文章。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-119">We’ll cover both in this article.</span></span> <span data-ttu-id="e7fd0-120">我们建议您使用标记基于端口范围，因为它适用于所有设备，而不仅仅是加入到域。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-120">We recommend that you use tagging based on port ranges because it will work for all devices, not just those joined to the domain.</span></span>

<span data-ttu-id="e7fd0-121">控制通过组策略对象 DSCP 标记确保加入域的计算机接收设置正确，并且只有管理员可以管理其。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-121">Controlling the DSCP marking via Group Policy objects ensures that domain-joined computers receive the correct settings and that only an administrator can manage them.</span></span>
 
<span data-ttu-id="e7fd0-122">务必了解 QoS 在连接呼叫者到被叫方的所有链接上实现时才有效。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-122">It’s important to understand that QoS only works when implemented on all links that connect caller to callee.</span></span> <span data-ttu-id="e7fd0-123">如果您使用内部网络上的 QoS，一个用户登录从远程位置，您可以仅设置优先级内部、 托管网络中。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-123">If you use QoS on the internal network and a user signs in from a remote location, you can only prioritize within your internal, managed network.</span></span> <span data-ttu-id="e7fd0-124">尽管远程位置可以通过实现虚拟专用网络 (VPN) 接收托管的连接，我们建议您避免运行实时通信流量通过 VPN。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-124">Although remote locations can receive a managed connection by implementing a virtual private network (VPN), we  recommend that you avoid running real-time communications traffic over the VPN.</span></span>

> [!NOTE]
> <span data-ttu-id="e7fd0-125">我们建议您实现拆分隧道 VPN 连接远程用户最大化的用户体验质量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-125">We recommend that you implement split tunneling for VPN-connected remote users to maximize the quality of the user experience.</span></span> <span data-ttu-id="e7fd0-126">将文档[部署指南 VPN 拆分隧道](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 )从 MyAdvisor 下载的详细信息。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-126">Download the document [Deploy-Guidance-VPN Split Tunnel](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 ) from MyAdvisor for more information.</span></span>

<span data-ttu-id="e7fd0-127">在全局组织中使用托管跨洲的链接，因为这些链接的带宽有限相比 LAN 强烈建议 QoS。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-127">In a global organization with managed links that span continents, QoS is highly recommended because bandwidth for those links is limited in comparison to the LAN.</span></span>

## <a name="qos-queues"></a><span data-ttu-id="e7fd0-128">QoS 队列</span><span class="sxs-lookup"><span data-stu-id="e7fd0-128">QoS queues</span></span>

<span data-ttu-id="e7fd0-129">若要在网络上提供保证的服务应用程序级别，基础的网络设备必须具有分类不同类型的通信的方式。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-129">To provide a guaranteed level of service for an application on the network, the underlying network devices must have a way to classify different types of traffic.</span></span> <span data-ttu-id="e7fd0-130">如果您的组织希望为语音通信优先级提供比其他通信，路由器 （示例） 必须能够区分语音通信和普通 web 浏览通信。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-130">If your organization wants to give voice traffic priority over other traffic, a router (for example) must be able to distinguish between voice traffic and normal web-browsing traffic.</span></span> 

<span data-ttu-id="e7fd0-131">区分的服务 (DiffServ) 提供在其中通信通过基于 IPv4/IPv6 数据包的标题中的服务 （直观操作方法） 字段的类型的网络设备给定不同的优先级框架。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-131">Differentiated services (DiffServ) provides a framework in which traffic is given different priority by network devices based on the type of services (ToS) field in the header of an IPv4/IPv6 packet.</span></span> <span data-ttu-id="e7fd0-132">DiffServ 字段的六个最重要位是区分的服务代码点或 DSCP。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-132">The six most significant bits of the DiffServ field are the differentiated services code point, or DSCP.</span></span> <span data-ttu-id="e7fd0-133">使用此框架，流量可以是归类为特定类型的通信 （例如，语音），然后将标记 （101110 或 46 的语音流量的十进制），以便流量时网络设备处理这些标记，可以是 （的相应地确定其优先级加速转发，在本例中）。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-133">Using this framework, traffic can be classified as a particular type of traffic (for example, voice), and then marked (101110, or 46 in decimal for voice traffic), so that when network devices process these markings, the traffic can be prioritized accordingly (Expedited Forwarding, in this example).</span></span>

<span data-ttu-id="e7fd0-134">当网络流量进入路由器时，流量放入队列 — 如果就地没有任何 QoS，实质上没有为只有一个队列，并且数据处理为第一项，先出。这意味着语音通信 （这是非常对延迟敏感） 可能停滞后面流量从联机流服务。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-134">When network traffic enters a router, the traffic is placed into a queue—if there is no QoS in place, essentially there is only one queue, and data is treated as first-in, first-out. That means voice traffic (which is very sensitive to delays) might get stuck behind traffic from online streaming services.</span></span> <span data-ttu-id="e7fd0-135">在实现 QoS，您可以使用不同的拥塞管理功能 （如 Cisco 的优先级队列和基于类的加权公平队列 [CBWFQ]） 和拥塞避免功能 （如加权随机早期检测 [定义多个队列WRED])。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-135">When implementing QoS, you can define multiple queues by using different congestion management features (such as Cisco’s priority queuing and class-based weighted fair queue [CBWFQ]) and congestion avoidance features (such as weighted random early detection [WRED]).</span></span>

<span data-ttu-id="e7fd0-136">![全部可用带宽分为多个队列 — 音频、 视频和其他通信 — 的已分配不同的优先级。](media/Qos-in-Teams-Image2.png "全部可用带宽分为多个队列 — 音频、 视频和其他通信 — 的已分配不同的优先级。")</span><span class="sxs-lookup"><span data-stu-id="e7fd0-136">![Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.](media/Qos-in-Teams-Image2.png "Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.")</span></span>

<span data-ttu-id="e7fd0-137">_图 2。可视化 QoS 队列_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-137">_Figure 2. QoS queues visualized_</span></span>

<span data-ttu-id="e7fd0-138">这些条目准备就绪后，就可以传递可预测的 QoS，因为基础的托管的网络现在了解如何进行分类，将标记，并设置其优先级流量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-138">After these pieces are in place, it’s possible to deliver predictable QoS because the underlying managed network now understands how to classify, mark, and prioritize traffic.</span></span> <span data-ttu-id="e7fd0-139">从工作组角度来看，最重要的配置步骤的分类和标记的数据包，但在进行端到端 QoS 成功您还需要仔细对齐的基础的网络配置的应用程序的配置。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-139">From the Teams perspective, the most important configuration step is the classification and marking of packets, but for end-to-end QoS to be successful you also need to carefully align the application’s configuration with the underlying network configuration.</span></span>

## <a name="teams-qos-scenarios"></a><span data-ttu-id="e7fd0-140">团队 QoS 方案</span><span class="sxs-lookup"><span data-stu-id="e7fd0-140">Teams QoS scenarios</span></span>

<span data-ttu-id="e7fd0-141">有关 QoS 团队的实施的指南基于四种方案：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-141">The guidance for implementing QoS for Teams is based on four scenarios:</span></span>

*  <span data-ttu-id="e7fd0-142">**方案 1:** 您已部署，或要部署团队和规划实现 QoS 通过基于端口的标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-142">**Scenario 1:** You’ve deployed, or are deploying, Teams and are planning on implementing QoS via port-based tagging.</span></span> <span data-ttu-id="e7fd0-143">基于端口的标签是最可靠的方法，因为它适用于整个所有平台的全局和是最容易实现。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-143">Port-based tagging is the most reliable method, because it works universally throughout all platforms and is the easiest to implement.</span></span>  

*  <span data-ttu-id="e7fd0-144">**方案 2:** 您已部署，或要部署团队和打算通过组策略对象标记实现 QoS。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-144">**Scenario 2:** You’ve deployed, or are deploying, Teams and are planning to implement QoS via Group Policy Object tagging.</span></span> <span data-ttu-id="e7fd0-145">此方案有时会与方案 1 结合使用。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-145">This is sometimes used in combination with scenario 1.</span></span> <span data-ttu-id="e7fd0-146">尽管这种情况下完全无效，但务必了解它仅适用于加入域的 Windows 客户端。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-146">Although this scenario is entirely valid, it’s important to understand it will only work for domain-joined Windows clients.</span></span> <span data-ttu-id="e7fd0-147">未加入域的 Windows 客户端的任何设备不启用 DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-147">Any device that isn’t a domain-joined Windows client won’t be enabled for DSCP tagging.</span></span>

*  <span data-ttu-id="e7fd0-148">**方案 3:** 您已部署 Skype 业务 Online，包括 QoS 标记，并立即部署团队。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-148">**Scenario 3:** You’ve deployed Skype for Business Online, including QoS tagging, and are now deploying Teams.</span></span> <span data-ttu-id="e7fd0-149">如果是你，Teams 将遵循现有配置，并且将使用与 Skype for Business 客户端相同的端口范围和标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-149">If this is you, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="e7fd0-150">在大多数情况下，将不需要任何其他配置。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-150">In most cases, no additional configuration will be needed.</span></span> 
 
    > [!NOTE]
    > <span data-ttu-id="e7fd0-151">如果您使用的应用程序名称 QoS 标记通过组策略，您必须添加 Teams.exe 作为应用程序的名称。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-151">If you're using Application Name QoS tagging via Group Policy, you must add Teams.exe as the application name.</span></span>

*  <span data-ttu-id="e7fd0-152">**方案 4:** 已部署，或要部署团队，希望通过基于端口的标记使用的自定义端口范围中实现 QoS。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-152">**Scenario 4:** You’ve deployed, or are deploying, Teams and want to implement QoS via port-based tagging by using a custom port range.</span></span>

## <a name="recommended-dscp-markings"></a><span data-ttu-id="e7fd0-153">建议的 DSCP 标记</span><span class="sxs-lookup"><span data-stu-id="e7fd0-153">Recommended DSCP markings</span></span>

<span data-ttu-id="e7fd0-154">第一步是通过将 DSCP 值分配给的唯一的非重叠端口范围 （如音频和视频） 通信流进行分类。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-154">The first step is to classify the traffic flows (such as audio and video) by assigning DSCP values to the unique, non-overlapping port ranges.</span></span> <span data-ttu-id="e7fd0-155">此处分配的 DSCP 值将决定需要通过网络，根据网络配置的流量的优先级。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-155">The DSCP value assigned here will determine the priority of the traffic going through the network, based on network configuration.</span></span> <span data-ttu-id="e7fd0-156">每个工作负荷获取其自己的 DSCP 值，但不一定的唯一值 — 某些客户可能设置相同的语音和视频的工作负荷，值为他们提供网络中的相同的优先级。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-156">Each workload gets its own DSCP value, though not necessarily a unique value—some customers might set the same value for voice and video workloads, giving them the same priority in the network.</span></span>  

<span data-ttu-id="e7fd0-157">要使用的 DSCP 值取决于您希望如何设置优先级工作负荷。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-157">The DSCP value to use depends on how you want to prioritize the workload.</span></span> <span data-ttu-id="e7fd0-158">例如，业务要求可能要求您提供应用程序共享按视频的优先级 （并因此使用视频相同的 DSCP 值标记它）。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-158">For example, business requirements might dictate that you give application sharing the same priority as video (and therefore mark it with the same DSCP value as video).</span></span> <span data-ttu-id="e7fd0-159">其他环境可能具有现有的 QoS 策略就地，这将帮助您确定网络工作负荷的优先级。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-159">Other environments might have an existing QoS strategy in place, which will help you determine the priority of network workloads.</span></span> 

<span data-ttu-id="e7fd0-160">表 1 显示了使用 ExpressRoute 团队时是必需的 DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-160">Table 1 shows the DSCP markings required when using Teams with ExpressRoute.</span></span> <span data-ttu-id="e7fd0-161">这些标记可能用作不能确定要在其自己的环境中使用的客户的良好的起始点。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-161">These markings might serve as a good starting point for customers who are unsure what to use in their own environments.</span></span> <span data-ttu-id="e7fd0-162">要了解详细信息，请阅读 [ExpressRoute QoS 要求](https://docs.microsoft.com/azure/expressroute/expressroute-qos)。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-162">To learn more, read [ExpressRoute QoS requirements](https://docs.microsoft.com/azure/expressroute/expressroute-qos).</span></span>


<span data-ttu-id="e7fd0-163">_表 1。DSCP 标记_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-163">_Table 1. DSCP markings_</span></span>
    
| <span data-ttu-id="e7fd0-164">客户端源端口范围</span><span class="sxs-lookup"><span data-stu-id="e7fd0-164">Client source port range</span></span> |<span data-ttu-id="e7fd0-165">协议</span><span class="sxs-lookup"><span data-stu-id="e7fd0-165">Protocol</span></span>|<span data-ttu-id="e7fd0-166">媒体类别</span><span class="sxs-lookup"><span data-stu-id="e7fd0-166">Media category</span></span>|<span data-ttu-id="e7fd0-167">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-167">DSCP value</span></span>|<span data-ttu-id="e7fd0-168">DSCP 类</span><span class="sxs-lookup"><span data-stu-id="e7fd0-168">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="e7fd0-169">50000 – 50,019</span><span class="sxs-lookup"><span data-stu-id="e7fd0-169">50,000–50,019</span></span>|<span data-ttu-id="e7fd0-170">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-170">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-171">音频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-171">Audio</span></span>|<span data-ttu-id="e7fd0-172">46</span><span class="sxs-lookup"><span data-stu-id="e7fd0-172">46</span></span>|<span data-ttu-id="e7fd0-173">加速转发 (EF)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-173">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="e7fd0-174">50,020 – 50,039</span><span class="sxs-lookup"><span data-stu-id="e7fd0-174">50,020–50,039</span></span>|<span data-ttu-id="e7fd0-175">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-175">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-176">视频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-176">Video</span></span>|<span data-ttu-id="e7fd0-177">34</span><span class="sxs-lookup"><span data-stu-id="e7fd0-177">34</span></span>|<span data-ttu-id="e7fd0-178">保证转发 (AF41)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-178">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="e7fd0-179">50,040 – 50,059</span><span class="sxs-lookup"><span data-stu-id="e7fd0-179">50,040–50,059</span></span>|<span data-ttu-id="e7fd0-180">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-180">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-181">应用程序/桌面共享</span><span class="sxs-lookup"><span data-stu-id="e7fd0-181">Application/Desktop Sharing</span></span>|<span data-ttu-id="e7fd0-182">18</span><span class="sxs-lookup"><span data-stu-id="e7fd0-182">18</span></span>|<span data-ttu-id="e7fd0-183">保证转发 (AF21)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-183">Assured Forwarding (AF21)</span></span>|

<span data-ttu-id="e7fd0-184">下面是使用表 1 中的信息时的一些注意事项：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-184">Here are some caveats to understand when you use the information in Table 1:</span></span>
    
-  <span data-ttu-id="e7fd0-185">如果您计划将来实现 ExpressRoute 并没有尚未实施 QoS，我们建议您遵循表 1 中的指南，以便是来自到接收方的发件人相同的 DSCP 值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-185">If you plan to implement ExpressRoute in the future and haven’t yet implemented QoS, we recommend that you follow the guidance in Table 1 so that DSCP values are the same from sender to receiver.</span></span> 

-  <span data-ttu-id="e7fd0-186">所有客户端，其中包括移动客户端和团队设备，将使用这些端口范围，并将受您实现任何 DSCP 策略使用这些源端口范围。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-186">All clients, including mobile clients and Teams devices, will use these port ranges and will be affected by any DSCP policy you implement that uses these source port ranges.</span></span> <span data-ttu-id="e7fd0-187">将继续使用动态端口的唯一客户端是基于浏览器的客户端 （即，这些客户端，允许使用其浏览器加入会议的参与者）。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-187">The only clients that will continue to use dynamic ports are the browser-based clients (that is, those clients that let participants join meetings by using their browsers).</span></span>

-  <span data-ttu-id="e7fd0-188">尽管 Mac 客户端将使用相同的端口范围，但 Mac 客户端 （ef） 级别音频和视频 (AF41) 还使用硬编码值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-188">Although the Mac client does use the same port ranges, the Mac client also uses hard-coded values for audio (EF) and video (AF41).</span></span> <span data-ttu-id="e7fd0-189">这些值是不可配置。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-189">These values are not configurable.</span></span>
 
    
## <a name="source-ports-used-by-teams"></a><span data-ttu-id="e7fd0-190">Teams 使用的源端口</span><span class="sxs-lookup"><span data-stu-id="e7fd0-190">Source ports used by Teams</span></span>

<span data-ttu-id="e7fd0-191">在 Teams 中，应根据不同工作负荷使用的源端口配置 QoS。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-191">In Teams, QoS should be configured based on the source ports used by the different workloads.</span></span> <span data-ttu-id="e7fd0-192">当前配置的任何服务器端和客户端端口范围。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-192">Neither server-side nor client-side port ranges are currently configurable.</span></span> 

<span data-ttu-id="e7fd0-193">请注意表 2 中列出的客户端源端口范围，并使用其关联的 QoS DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-193">Note the client source port ranges listed in Table 2, and use their associated QoS DSCP markings.</span></span>

<span data-ttu-id="e7fd0-194">_表 2。客户端源端口范围_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-194">_Table 2. Client source port ranges_</span></span>

| <span data-ttu-id="e7fd0-195">客户端源端口范围</span><span class="sxs-lookup"><span data-stu-id="e7fd0-195">Client source port range</span></span> |<span data-ttu-id="e7fd0-196">协议</span><span class="sxs-lookup"><span data-stu-id="e7fd0-196">Protocol</span></span>|<span data-ttu-id="e7fd0-197">媒体类别</span><span class="sxs-lookup"><span data-stu-id="e7fd0-197">Media category</span></span>|<span data-ttu-id="e7fd0-198">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-198">DSCP value</span></span>|<span data-ttu-id="e7fd0-199">DSCP 类</span><span class="sxs-lookup"><span data-stu-id="e7fd0-199">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="e7fd0-200">50000 – 50,019</span><span class="sxs-lookup"><span data-stu-id="e7fd0-200">50,000–50,019</span></span>|<span data-ttu-id="e7fd0-201">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-201">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-202">音频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-202">Audio</span></span>|<span data-ttu-id="e7fd0-203">46</span><span class="sxs-lookup"><span data-stu-id="e7fd0-203">46</span></span>|<span data-ttu-id="e7fd0-204">加速转发 (EF)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-204">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="e7fd0-205">50,020 – 50,039</span><span class="sxs-lookup"><span data-stu-id="e7fd0-205">50,020–50,039</span></span>|<span data-ttu-id="e7fd0-206">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-206">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-207">视频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-207">Video</span></span>|<span data-ttu-id="e7fd0-208">34</span><span class="sxs-lookup"><span data-stu-id="e7fd0-208">34</span></span>|<span data-ttu-id="e7fd0-209">保证转发 (AF41)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-209">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="e7fd0-210">50,040 – 50,059</span><span class="sxs-lookup"><span data-stu-id="e7fd0-210">50,040–50,059</span></span>|<span data-ttu-id="e7fd0-211">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-211">TCP/UDP</span></span>|<span data-ttu-id="e7fd0-212">应用程序/桌面共享</span><span class="sxs-lookup"><span data-stu-id="e7fd0-212">Application/Desktop Sharing</span></span>|<span data-ttu-id="e7fd0-213">18</span><span class="sxs-lookup"><span data-stu-id="e7fd0-213">18</span></span>|<span data-ttu-id="e7fd0-214">保证转发 (AF21)</span><span class="sxs-lookup"><span data-stu-id="e7fd0-214">Assured Forwarding (AF21)</span></span>|

<span data-ttu-id="e7fd0-215">实现这些 QoS 策略的推荐的方法是使用客户端源端口源和目标 IP 地址为"任何。"</span><span class="sxs-lookup"><span data-stu-id="e7fd0-215">The recommended method of implementing these QoS policies is to use the client source ports with a source and destination IP address of “any.”</span></span> <span data-ttu-id="e7fd0-216">这将在内部网络中捕获这两个传入和传出的媒体流量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-216">This will catch both incoming and outgoing media traffic on the internal network.</span></span> 

> [!NOTE]
> <span data-ttu-id="e7fd0-217">如果您已经配置 QoS 基于源的端口范围的 Skype 业务联机，相同的配置将应用于工作组和需要进一步的更改。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-217">If you've already configured QoS based on source port ranges for Skype for Business Online, the same configuration will apply to Teams and no further changes will be required.</span></span> <span data-ttu-id="e7fd0-218">如果您已为 Business Server 本地部署 Skype，您需要重新设计 QoS 策略。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-218">If you’ve deployed Skype for Business Server on-premises, you’ll need to redesign your QoS policies.</span></span>

## <a name="setting-dscp-markings"></a><span data-ttu-id="e7fd0-219">设置 DSCP 标记</span><span class="sxs-lookup"><span data-stu-id="e7fd0-219">Setting DSCP markings</span></span>

<span data-ttu-id="e7fd0-220">有多个方法设置通信量分类适当的 DSCP 标记：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-220">There are multiple approaches to setting the proper DSCP markings for traffic classification:</span></span>

-  <span data-ttu-id="e7fd0-221">**端点处的 DSCP 标记：** 这通常是首选的选项，因为本身的终结点提供适当的标记。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-221">**DSCP marking at the endpoint:** This is generally the preferred option, because the endpoint itself provides the proper markings.</span></span> <span data-ttu-id="e7fd0-222">当前这可以通过使用组策略对象，但它仅可加入域的 Windows 客户端上。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-222">Currently this can be done by using a Group Policy object, but it can only be used on domain-joined Windows clients.</span></span> <span data-ttu-id="e7fd0-223">移动客户端不提供通过使用 DSCP 值标记流量的机制。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-223">Mobile clients don’t provide a mechanism to mark traffic by using DSCP values.</span></span> <span data-ttu-id="e7fd0-224">尽管您无法配置非&ndash;标记流量，客户端 Mac OS 如加入域的 Windows 客户端具有硬编码标记，并将始终标记流量，如上文所述。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-224">Although you can’t configure non&ndash;domain-joined Windows clients to tag traffic, clients such as Mac OS have hard-coded tags and will always tag traffic as described above.</span></span>

-  <span data-ttu-id="e7fd0-225">**基于端口的 DSCP 标记使用路由器上的访问控制列表 (Acl):** 这是在异类 Windows 和 Mac 环境中遇到非常常见选项。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-225">**Port-based DSCP tagging by using access control lists (ACLs) on routers:** This is a very common option encountered in heterogeneous Windows and Mac environments.</span></span> <span data-ttu-id="e7fd0-226">在此方案中，网络团队标记基于定义每种形式的源端口范围的入站/出站路由器 （通常位于 WAN） 通信。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-226">In this scenario, the network team marks the traffic at the ingress/egress routers (typically located on the WAN) based on the source port ranges defined for each modality.</span></span> <span data-ttu-id="e7fd0-227">虽然这可以工作跨平台，仅标记在 WAN 边缘流量 — 不一直到客户端计算机 — 和因此产生管理开销。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-227">Although this works across platforms, it only marks traffic at the WAN edge—not all the way to the client machine—and therefore incurs management overhead.</span></span>
    
-  <span data-ttu-id="e7fd0-228">**组合的终结点和基于端口的路由器上的 Acl 的 DSCP 标记：** 我们建议此组合方案，如有可能在您的环境中。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-228">**A combination of DSCP markings at the endpoint and port-based ACLs on routers:** We recommend this combination, if possible in your environment.</span></span> <span data-ttu-id="e7fd0-229">使用组策略对象捕获大多数客户端，并且使用基于端口的 DSCP 标记，以确保该 mobile、 Mac 和其他客户端将仍获取 QoS 诊 （至少部分）。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-229">Use a Group Policy object to catch the majority of clients, and also use port-based DSCP tagging to ensure that mobile, Mac, and other clients will still get QoS treatment (at least partially).</span></span>
    
<span data-ttu-id="e7fd0-230">您可以使用基于策略的 QoS 组策略中设置团队客户端中的预定义的源端口范围的 DSCP 值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-230">You can use policy-based QoS within Group Policy to set the DSCP value for the predefined source port range in the Teams client.</span></span> <span data-ttu-id="e7fd0-231">使用表 3 中指定的端口范围创建的每个工作负荷策略。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-231">Use the port ranges specified in Table 3 to create a policy for each workload.</span></span>

<span data-ttu-id="e7fd0-232">_表 3。按通信类型的端口范围_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-232">_Table 3. Port ranges by traffic type_</span></span>
| <span data-ttu-id="e7fd0-233">客户端流量类型</span><span class="sxs-lookup"><span data-stu-id="e7fd0-233">Client traffic type</span></span>|<span data-ttu-id="e7fd0-234">端口范围起始值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-234">Port range start</span></span>|<span data-ttu-id="e7fd0-235">端口范围结束值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-235">Port range end</span></span>|<span data-ttu-id="e7fd0-236">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-236">DSCP value</span></span>|
|---------|---------|---------|--------|
| <span data-ttu-id="e7fd0-237">音频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-237">Audio</span></span>|<span data-ttu-id="e7fd0-238">50000</span><span class="sxs-lookup"><span data-stu-id="e7fd0-238">50000</span></span>|<span data-ttu-id="e7fd0-239">50019</span><span class="sxs-lookup"><span data-stu-id="e7fd0-239">50019</span></span>|<span data-ttu-id="e7fd0-240">46</span><span class="sxs-lookup"><span data-stu-id="e7fd0-240">46</span></span>|
| <span data-ttu-id="e7fd0-241">视频</span><span class="sxs-lookup"><span data-stu-id="e7fd0-241">Video</span></span>|<span data-ttu-id="e7fd0-242">50020</span><span class="sxs-lookup"><span data-stu-id="e7fd0-242">50020</span></span>|<span data-ttu-id="e7fd0-243">50039</span><span class="sxs-lookup"><span data-stu-id="e7fd0-243">50039</span></span>|<span data-ttu-id="e7fd0-244">34</span><span class="sxs-lookup"><span data-stu-id="e7fd0-244">34</span></span>|
| <span data-ttu-id="e7fd0-245">应用程序共享</span><span class="sxs-lookup"><span data-stu-id="e7fd0-245">Application sharing</span></span>|<span data-ttu-id="e7fd0-246">50040</span><span class="sxs-lookup"><span data-stu-id="e7fd0-246">50040</span></span>|<span data-ttu-id="e7fd0-247">50059</span><span class="sxs-lookup"><span data-stu-id="e7fd0-247">50059</span></span>|<span data-ttu-id="e7fd0-248">18</span><span class="sxs-lookup"><span data-stu-id="e7fd0-248">18</span></span>|

> [!NOTE]
> <span data-ttu-id="e7fd0-249">设置团队的端口范围不能更改。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-249">The port ranges set by Teams can't be changed.</span></span> <span data-ttu-id="e7fd0-250">请查看[本文支持](https://support.microsoft.com/kb/2409256)的最新信息。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-250">Review [this support article](https://support.microsoft.com/kb/2409256) for the latest information.</span></span> 

<span data-ttu-id="e7fd0-251">您已确定的端口范围后下, 一步是配置组策略对象中的基于策略的 QoS 设置。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-251">After you’ve identified the port ranges, the next step is to configure the policy-based QoS settings within a Group Policy object.</span></span> <span data-ttu-id="e7fd0-252">[TechNet 本文](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx)中，可以找到有关这些步骤的详细信息。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-252">More information about these steps can be found in [this TechNet article](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx).</span></span> 

<span data-ttu-id="e7fd0-253">已在客户端计算机上刷新组策略之前，您已创建的新策略不会生效。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-253">The new policies you’ve created won’t take effect until Group Policy has been refreshed on your client computers.</span></span> <span data-ttu-id="e7fd0-254">尽管自己定期刷新组策略，您可以强制立即刷新。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-254">Although Group Policy periodically refreshes on its own, you can force an immediate refresh.</span></span>

### <a name="force-group-policy-refresh"></a><span data-ttu-id="e7fd0-255">强制组策略刷新</span><span class="sxs-lookup"><span data-stu-id="e7fd0-255">Force Group Policy refresh</span></span>

1. <span data-ttu-id="e7fd0-256">在您要刷新组策略的每台计算机上打开命令控制台。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-256">On each computer for which you want to refresh Group Policy, open a command console.</span></span> <span data-ttu-id="e7fd0-257">确保命令控制台设置以管理员身份运行。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-257">Ensure that the command console is set to run as administrator.</span></span>

2. <span data-ttu-id="e7fd0-258">在命令提示符处，输入</span><span class="sxs-lookup"><span data-stu-id="e7fd0-258">At the command prompt, enter</span></span>
```
    gpudate.exe /force
```

## <a name="verify-dscp-markings-in-the-group-policy-object"></a><span data-ttu-id="e7fd0-259">验证 DSCP 标记中的组策略对象</span><span class="sxs-lookup"><span data-stu-id="e7fd0-259">Verify DSCP markings in the Group Policy object</span></span>

<span data-ttu-id="e7fd0-260">若要验证已设置的组策略对象的值，请执行以下步骤。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-260">To verify that the values from the Group Policy object have been set, perform the following steps.</span></span>

1.  <span data-ttu-id="e7fd0-261">打开一个命令控制台。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-261">Open a command console.</span></span> <span data-ttu-id="e7fd0-262">确保命令控制台设置以管理员身份运行。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-262">Ensure that the command console is set to run as administrator.</span></span>

2.  <span data-ttu-id="e7fd0-263">在命令提示符处，输入</span><span class="sxs-lookup"><span data-stu-id="e7fd0-263">At the command prompt, enter</span></span> 
    ```
    gpresult /R >gp.txt
    ```

    <span data-ttu-id="e7fd0-264">这将生成一个报告，并将其发送到一个名为 gp.txt 文本文件。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-264">This will generate a report and send it to a text file named gp.txt.</span></span> <span data-ttu-id="e7fd0-265">或者，您可以输入以下命令以生成更容易阅读 HTML 报表名为 gp.html 中相同的数据：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-265">Alternatively, you can enter the following command to produce the same data in a more readable HTML report named gp.html:</span></span>
    ```
    gpresult /H >gp.html
    ```
 
   <span data-ttu-id="e7fd0-266">![运行 gpresult 命令控制台窗口的屏幕截图。](media/Qos-in-Teams-Image3.png "运行 gpresult 命令控制台窗口的屏幕截图。")</span><span class="sxs-lookup"><span data-stu-id="e7fd0-266">![Screenshot of the console window running the gpresult command.](media/Qos-in-Teams-Image3.png "Screenshot of the console window running the gpresult command.")</span></span>

3.  <span data-ttu-id="e7fd0-267">在生成的文件中，查找的标题**应用组策略对象**和验证前面创建的组策略对象的名称位于应用策略的列表。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-267">In the generated file, look for the heading **Applied Group Policy Objects** and verify that the names of the Group Policy objects created earlier are in the list of applied policies.</span></span> 

4.  <span data-ttu-id="e7fd0-268">打开注册表编辑器中，并转到：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-268">Open the Registry Editor, and go to:</span></span>

    <span data-ttu-id="e7fd0-269">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span><span class="sxs-lookup"><span data-stu-id="e7fd0-269">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span></span>

    <span data-ttu-id="e7fd0-270">验证表 3 中列出的注册表项的值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-270">Verify the values for the registry entries listed in Table 3.</span></span>

    <span data-ttu-id="e7fd0-271">_表 3。QoS 程序的 Windows 注册表项的值_</span><span class="sxs-lookup"><span data-stu-id="e7fd0-271">_Table 3. Values for Windows registry entries for QoS_</span></span>
    
    | <span data-ttu-id="e7fd0-272">名称</span><span class="sxs-lookup"><span data-stu-id="e7fd0-272">Name</span></span> | <span data-ttu-id="e7fd0-273">类型</span><span class="sxs-lookup"><span data-stu-id="e7fd0-273">Type</span></span> | <span data-ttu-id="e7fd0-274">数据</span><span class="sxs-lookup"><span data-stu-id="e7fd0-274">Data</span></span>|
    |---------|---------|---------
    | <span data-ttu-id="e7fd0-275">应用程序名称</span><span class="sxs-lookup"><span data-stu-id="e7fd0-275">Application Name</span></span>|<span data-ttu-id="e7fd0-276">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-276">REG_SZ</span></span>|<span data-ttu-id="e7fd0-277">Teams.exe</span><span class="sxs-lookup"><span data-stu-id="e7fd0-277">Teams.exe</span></span>|
    | <span data-ttu-id="e7fd0-278">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-278">DSCP Value</span></span>|<span data-ttu-id="e7fd0-279">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-279">REG_SZ</span></span>|<span data-ttu-id="e7fd0-280">46</span><span class="sxs-lookup"><span data-stu-id="e7fd0-280">46</span></span>|
    | <span data-ttu-id="e7fd0-281">本地 IP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-281">Local IP</span></span>|<span data-ttu-id="e7fd0-282">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-282">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-283">本地 IP 前缀长度</span><span class="sxs-lookup"><span data-stu-id="e7fd0-283">Local IP Prefix Length</span></span>|<span data-ttu-id="e7fd0-284">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-284">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-285">本地端口</span><span class="sxs-lookup"><span data-stu-id="e7fd0-285">Local Port</span></span>|<span data-ttu-id="e7fd0-286">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-286">REG_SZ</span></span>|<span data-ttu-id="e7fd0-287">50000-50019</span><span class="sxs-lookup"><span data-stu-id="e7fd0-287">50000-50019</span></span>|
    | <span data-ttu-id="e7fd0-288">协议</span><span class="sxs-lookup"><span data-stu-id="e7fd0-288">Protocol</span></span>|<span data-ttu-id="e7fd0-289">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-289">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-290">远程 IP</span><span class="sxs-lookup"><span data-stu-id="e7fd0-290">Remote IP</span></span>|<span data-ttu-id="e7fd0-291">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-291">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-292">远程 IP 前缀</span><span class="sxs-lookup"><span data-stu-id="e7fd0-292">Remote IP Prefix</span></span>|<span data-ttu-id="e7fd0-293">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-293">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-294">远程端口</span><span class="sxs-lookup"><span data-stu-id="e7fd0-294">Remote Port</span></span>|<span data-ttu-id="e7fd0-295">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-295">REG_SZ</span></span>|*|
    | <span data-ttu-id="e7fd0-296">限制率</span><span class="sxs-lookup"><span data-stu-id="e7fd0-296">Throttle Rate</span></span>|<span data-ttu-id="e7fd0-297">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="e7fd0-297">REG_SZ</span></span>|<span data-ttu-id="e7fd0-298">-1</span><span class="sxs-lookup"><span data-stu-id="e7fd0-298">-1</span></span>|
    
5.  <span data-ttu-id="e7fd0-299">验证应用程序名称条目的值正确客户端使用，并确认的 DSCP 值和本地端口条目反映中的组策略对象的设置。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-299">Verify that the value for the Application Name entry is correct for the client you’re using, and verify that both the DSCP Value and Local Port entries reflect the settings in the Group Policy object.</span></span>

## <a name="validate-qos-by-analyzing-teams-traffic-on-the-network"></a><span data-ttu-id="e7fd0-300">验证通过分析团队流量网络上的 QoS</span><span class="sxs-lookup"><span data-stu-id="e7fd0-300">Validate QoS by analyzing Teams traffic on the network</span></span>

<span data-ttu-id="e7fd0-301">设置通过存在从呼叫者到被叫方为了可以取得高效率的 QoS 组策略对象需求的 DSCP 值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-301">The DSCP value set by the Group Policy object needs to be present from caller to callee in order for QoS to be effective.</span></span> <span data-ttu-id="e7fd0-302">通过查看生成的团队客户端的通信，您可以验证的 DSCP 值不更改或删除工作组工作负荷通信量遍历网络。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-302">By looking at the traffic generated by the Teams client, you can verify that the DSCP value isn’t changed or stripped out when the Teams workload traffic traverses the network.</span></span> 

<span data-ttu-id="e7fd0-303">最好，您可以捕获网络出口点处的流量。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-303">Preferably, you capture traffic at the network egress point.</span></span> <span data-ttu-id="e7fd0-304">您可以使用端口镜像开关或路由器上与此帮助。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-304">You can use port mirroring on a switch or router to help with this.</span></span>

### <a name="use-network-monitor-to-verify-dscp-values"></a><span data-ttu-id="e7fd0-305">使用网络监视器验证 DSCP 值</span><span class="sxs-lookup"><span data-stu-id="e7fd0-305">Use Network Monitor to verify DSCP values</span></span>

<span data-ttu-id="e7fd0-306">网络监视器是您可以[从 Microsoft 下载](https://www.microsoft.com/download/4865)分析网络流量的工具。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-306">Network Monitor is a tool you can [download from Microsoft](https://www.microsoft.com/download/4865) to analyze network traffic.</span></span>

1.  <span data-ttu-id="e7fd0-307">在 PC 上运行网络监视器，连接到端口镜像和开始捕获数据包已配置的端口。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-307">On the PC running Network Monitor, connect to the port that has been configured for port mirroring and start capturing packets.</span></span> 

2.  <span data-ttu-id="e7fd0-308">使用 Skype 业务客户端发起呼叫。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-308">Make a call by using the Skype for Business client.</span></span> <span data-ttu-id="e7fd0-309">请确保媒体建立挂断呼叫之前。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-309">Make sure media has been established before hanging up the call.</span></span> 

3.  <span data-ttu-id="e7fd0-310">停止捕获。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-310">Stop the capture.</span></span>

4. <span data-ttu-id="e7fd0-311">在**显示筛选器**字段中，使用源 IP 地址的 pc 的发出呼叫，并通过定义作为搜索条件的 DSCP 值 46 (hex 0xb8) 优化筛选器，如下面的示例中所示：</span><span class="sxs-lookup"><span data-stu-id="e7fd0-311">In the **Display Filter** field, use the source IP address of the PC that made the call, and refine the filter by defining DSCP value 46 (hex 0xb8) as search criteria, as shown in the following example:</span></span>

    <span data-ttu-id="e7fd0-312">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span><span class="sxs-lookup"><span data-stu-id="e7fd0-312">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span></span> 

    <span data-ttu-id="e7fd0-313">![网络监视器，显示应用的筛选器中的显示筛选器对话框的屏幕快照。](media/Qos-in-Teams-Image4.png "网络监视器，显示应用的筛选器中的显示筛选器对话框的屏幕快照。")</span><span class="sxs-lookup"><span data-stu-id="e7fd0-313">![Screenshot of the Display Filter dialog box in Network Monitor, showing the filters to apply.](media/Qos-in-Teams-Image4.png "Screenshot of the Display Filter dialog box in Network Monitor, showing the filters to apply.")</span></span>

5.  <span data-ttu-id="e7fd0-314">选择**应用**以激活筛选器。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-314">Select **Apply** to activate the filter.</span></span>

6.  <span data-ttu-id="e7fd0-315">在**帧摘要**窗口中，选择第一个 UDP 数据包。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-315">In the **Frame Summary** window, select the first UDP packet.</span></span>

7.  <span data-ttu-id="e7fd0-316">在**帧详细信息**窗口中，展开 IPv4 列表项，并注意末尾的行的开头**DSCP**值。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-316">In the **Frame Details** window, expand the IPv4 list item and note the value at the end of the line that begins with **DSCP**.</span></span> 

    <span data-ttu-id="e7fd0-317">![网络监视器，突出显示 DSCP 设置中的帧详细信息对话框的屏幕快照。](media/Qos-in-Teams-Image5.png "网络监视器，突出显示 DSCP 设置中的帧详细信息对话框的屏幕快照。")</span><span class="sxs-lookup"><span data-stu-id="e7fd0-317">![Screenshot of the Frame Details dialog box in Network Monitor, highlighting DSCP settings.](media/Qos-in-Teams-Image5.png "Screenshot of the Frame Details dialog box in Network Monitor, highlighting DSCP settings.")</span></span>

<span data-ttu-id="e7fd0-318">在此示例中的 DSCP 值设置为 46。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-318">In this example, the DSCP value is set to 46.</span></span> <span data-ttu-id="e7fd0-319">这是正确的因为使用的源端口是 50019，表示这是语音工作负荷。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-319">This is correct, because the source port used is 50019, which indicates that this is a voice workload.</span></span> 

<span data-ttu-id="e7fd0-320">为 GPO 标记的每个工作负荷重复执行验证。</span><span class="sxs-lookup"><span data-stu-id="e7fd0-320">Repeat the verification for each workload that has been marked by the GPO.</span></span> 
