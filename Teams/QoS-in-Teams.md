---
title: 在 Microsoft 小组-Microsoft 小组的 QoS
author: rmw2890
ms.author: MyAdvisor
manager: Serdars
ms.date: 04/23/2018
ms.topic: article
ms.service: msteams
ms.reviewer: rowille
description: 针对 Microsoft Teams 的服务质量 (QoS) 准备贵组织的网络。
MS.collection: Strat_MT_TeamsAdmin
appliesto:
- Microsoft Teams
ms.openlocfilehash: 884055dce490b9db8fd31f6e52042a4315633e00
ms.sourcegitcommit: f942232d43fc4ad56b34dd400fdb4bca39013f5f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/26/2018
---
# <a name="quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="591e3-103">Microsoft Teams 中的服务质量 (QoS)</span><span class="sxs-lookup"><span data-stu-id="591e3-103">Quality of Service (QoS) in Microsoft Teams</span></span>

<span data-ttu-id="591e3-104">这篇文章将帮助您准备您组织的网络的服务质量 (QoS) 在 Microsoft 小组。</span><span class="sxs-lookup"><span data-stu-id="591e3-104">This article will help you prepare your organization's network for Quality of Service (QoS) in Microsoft Teams.</span></span>
<span data-ttu-id="591e3-105">QoS 是一种机制，用于确定某些类型的网络通信流的优先级。</span><span class="sxs-lookup"><span data-stu-id="591e3-105">QoS is a mechanism you use to prioritize certain types of network traffic.</span></span> <span data-ttu-id="591e3-106">确定优先级的实时通信服务，如团队的通信很重要提供企业级的用户体验。</span><span class="sxs-lookup"><span data-stu-id="591e3-106">Prioritizing the traffic for real-time communications services such as Teams is important to deliver a business-grade user experience.</span></span> <span data-ttu-id="591e3-107">若要真正有效的 QoS，您必须配置从结束到结束 （PC、 网络交换机和路由器到云） 支持 QoS 的连接由于未能支持 QoS 的路径的任何部分可以降低整个呼叫质量。</span><span class="sxs-lookup"><span data-stu-id="591e3-107">For QoS to be truly effective, you must configure a QoS-capable connection from end to end (PC, network switches, and routers to the cloud), because any part of the path that fails to support QoS can degrade the quality of the entire call.</span></span>

<span data-ttu-id="591e3-108">![公司的网络和 Office 365 提供服务之间的关系： 内部网络和设备连接连接与 Office 365 云语音和音频会议服务的互连网络。](media/Qos-in-Teams-Image1.png "公司的网络和 Office 365 提供服务之间的关系： 内部网络和设备连接连接与 Office 365 云语音和音频会议服务的互连网络。")</span><span class="sxs-lookup"><span data-stu-id="591e3-108">![The relationship between an organization's networks and Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Office 365 Cloud Voice and Audio Conferencing services.](media/Qos-in-Teams-Image1.png "The relationship between an organization's networks and Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Office 365 Cloud Voice and Audio Conferencing services.")</span></span>

<span data-ttu-id="591e3-109">_图 1。公司的网络和 Office 365 提供服务之间的关系_</span><span class="sxs-lookup"><span data-stu-id="591e3-109">_Figure 1. The relationship between an organization’s networks and Office 365 services_</span></span>
 

<span data-ttu-id="591e3-110">在大多数情况下，将非托管的网络互联网连接互联网络。</span><span class="sxs-lookup"><span data-stu-id="591e3-110">In most cases, the interconnect network will be an unmanaged network internet connection.</span></span> <span data-ttu-id="591e3-111">一个选项可用来满足端到端 QoS 是[Azure ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/)。</span><span class="sxs-lookup"><span data-stu-id="591e3-111">One option available to address end-to-end QoS is [Azure ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/).</span></span> <span data-ttu-id="591e3-112">我们仍然建议您实现 QoS 可以控制，即您的内部网络上的网络部分。</span><span class="sxs-lookup"><span data-stu-id="591e3-112">We still recommend that you implement QoS on the portions of the network you have control over, namely your on-premises network.</span></span> <span data-ttu-id="591e3-113">这将提高整个部署的实时通信负载的质量，缓解现有部署中的阻塞点。</span><span class="sxs-lookup"><span data-stu-id="591e3-113">This will increase the quality of real-time communication workloads throughout your deployment and alleviate chokepoints in your existing deployment.</span></span> 


## <a name="prioritize-teams-network-traffic-for-qos"></a><span data-ttu-id="591e3-114">QoS 为排定小组网络通信</span><span class="sxs-lookup"><span data-stu-id="591e3-114">Prioritize Teams network traffic for QoS</span></span> 

<span data-ttu-id="591e3-115">本文重点介绍如何确定团队实时通信流的优先级 — — 即，语音和视频。</span><span class="sxs-lookup"><span data-stu-id="591e3-115">This article focuses on how to prioritize Teams real-time communications traffic—namely, voice and video.</span></span> <span data-ttu-id="591e3-116">此外可以设置其他类型的通信，根据您的需要的优先级。</span><span class="sxs-lookup"><span data-stu-id="591e3-116">You can also prioritize other types of traffic, based on your needs.</span></span>

<span data-ttu-id="591e3-117">有多种方式对流量进行优先排序，最常用的是使用区分服务代码点 (DSCP) 标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-117">There are multiple ways to prioritize traffic, but the most common is by using differentiated services code point (DSCP) markings.</span></span> <span data-ttu-id="591e3-118">它们可以应用 （"标记"） 基于端口范围以及通过组策略对象。</span><span class="sxs-lookup"><span data-stu-id="591e3-118">They can be applied (“tagged”) based on port ranges and also via Group Policy objects.</span></span> <span data-ttu-id="591e3-119">我们将介绍在这篇文章。</span><span class="sxs-lookup"><span data-stu-id="591e3-119">We’ll cover both in this article.</span></span> <span data-ttu-id="591e3-120">我们建议您使用标记基于端口范围，因为它适用于所有的设备，而不仅仅是那些加入到域中。</span><span class="sxs-lookup"><span data-stu-id="591e3-120">We recommend that you use tagging based on port ranges because it will work for all devices, not just those joined to the domain.</span></span>

<span data-ttu-id="591e3-121">控制通过组策略对象的 DSCP 标记可确保加入域的计算机收到正确的设置，只有管理员可以管理它们。</span><span class="sxs-lookup"><span data-stu-id="591e3-121">Controlling the DSCP marking via Group Policy objects ensures that domain-joined computers receive the correct settings and that only an administrator can manage them.</span></span>
 
<span data-ttu-id="591e3-122">请务必理解 QoS 实现连接调用方对被调用方的所有链接上时才有效。</span><span class="sxs-lookup"><span data-stu-id="591e3-122">It’s important to understand that QoS only works when implemented on all links that connect caller to callee.</span></span> <span data-ttu-id="591e3-123">如果用户从远程位置登录到内部网络上使用 QoS，可以只优先考虑内部、 托管网络中。</span><span class="sxs-lookup"><span data-stu-id="591e3-123">If you use QoS on the internal network and a user signs in from a remote location, you can only prioritize within your internal, managed network.</span></span> <span data-ttu-id="591e3-124">尽管远程位置可以通过实现虚拟专用网络 (VPN) 接收托管的连接，我们建议您避免通过 VPN 运行实时通信流。</span><span class="sxs-lookup"><span data-stu-id="591e3-124">Although remote locations can receive a managed connection by implementing a virtual private network (VPN), we  recommend that you avoid running real-time communications traffic over the VPN.</span></span>

> [!NOTE]
> <span data-ttu-id="591e3-125">我们建议您实现拆分隧道的 VPN 连接远程用户能够获得最高质量的用户体验。</span><span class="sxs-lookup"><span data-stu-id="591e3-125">We recommend that you implement split tunneling for VPN-connected remote users to maximize the quality of the user experience.</span></span> <span data-ttu-id="591e3-126">将文档[部署指南 VPN 拆分隧道](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 )从 MyAdvisor 下载的详细信息。</span><span class="sxs-lookup"><span data-stu-id="591e3-126">Download the document [Deploy-Guidance-VPN Split Tunnel](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 ) from MyAdvisor for more information.</span></span>

<span data-ttu-id="591e3-127">在全球组织中具有跨洲的管理链接，因为这些链接带宽受到限制局域网进行对比强烈建议 QoS。</span><span class="sxs-lookup"><span data-stu-id="591e3-127">In a global organization with managed links that span continents, QoS is highly recommended because bandwidth for those links is limited in comparison to the LAN.</span></span>

## <a name="qos-queues"></a><span data-ttu-id="591e3-128">QoS 队列</span><span class="sxs-lookup"><span data-stu-id="591e3-128">QoS queues</span></span>

<span data-ttu-id="591e3-129">若要在网络上提供的保证应用程序的服务级别，基础网络设备必须划分不同类型流量的一种方法。</span><span class="sxs-lookup"><span data-stu-id="591e3-129">To provide a guaranteed level of service for an application on the network, the underlying network devices must have a way to classify different types of traffic.</span></span> <span data-ttu-id="591e3-130">如果您的组织想要比其他通信提供语音通信优先级，路由器 （例如） 必须能够区分语音和普通 web 浏览的通讯量。</span><span class="sxs-lookup"><span data-stu-id="591e3-130">If your organization wants to give voice traffic priority over other traffic, a router (for example) must be able to distinguish between voice traffic and normal web-browsing traffic.</span></span> 

<span data-ttu-id="591e3-131">区分的服务 (DiffServ) 提供了一个框架，在其中通信由不同的优先级基于 IPv4/IPv6 数据包标头中的服务 (ToS) 字段的类型的网络设备。</span><span class="sxs-lookup"><span data-stu-id="591e3-131">Differentiated services (DiffServ) provides a framework in which traffic is given different priority by network devices based on the type of services (ToS) field in the header of an IPv4/IPv6 packet.</span></span> <span data-ttu-id="591e3-132">六个最高有效位的 DiffServ 字段是区分的服务代码点或 DSCP。</span><span class="sxs-lookup"><span data-stu-id="591e3-132">The six most significant bits of the DiffServ field are the differentiated services code point, or DSCP.</span></span> <span data-ttu-id="591e3-133">使用此框架，流量可以归类为特定类型的通信 （例如，声音），然后标记 （101110 或进行语音通信的十进制数的 46），以便在网络设备处理这些标记，流量可以相应地优先 （加速转发，在本例中）。</span><span class="sxs-lookup"><span data-stu-id="591e3-133">Using this framework, traffic can be classified as a particular type of traffic (for example, voice), and then marked (101110, or 46 in decimal for voice traffic), so that when network devices process these markings, the traffic can be prioritized accordingly (Expedited Forwarding, in this example).</span></span>

<span data-ttu-id="591e3-134">当网络流量进入路由器时，通信量将被放入队列 — — 如果有没有 QoS 到位、 实质上是没有一个队列中，并且数据处理为先入先出。这意味着，（这是对延迟非常敏感） 的语音通信可能停滞背后流量从联机流式服务。</span><span class="sxs-lookup"><span data-stu-id="591e3-134">When network traffic enters a router, the traffic is placed into a queue—if there is no QoS in place, essentially there is only one queue, and data is treated as first-in, first-out. That means voice traffic (which is very sensitive to delays) might get stuck behind traffic from online streaming services.</span></span> <span data-ttu-id="591e3-135">在 QoS 的实施，您可以通过使用不同的拥塞管理功能 （例如 Cisco 的优先级队列和基于类的加权公平队列 [CBWFQ]） 和拥塞避免功能 （如加权随机早期检测 [定义多个队列WRED])。</span><span class="sxs-lookup"><span data-stu-id="591e3-135">When implementing QoS, you can define multiple queues by using different congestion management features (such as Cisco’s priority queuing and class-based weighted fair queue [CBWFQ]) and congestion avoidance features (such as weighted random early detection [WRED]).</span></span>

<span data-ttu-id="591e3-136">![全部可用带宽划分多个队列 — — 音频、 视频和其他通信 — — 已指派不同的优先级别。](media/Qos-in-Teams-Image2.png "全部可用带宽划分多个队列 — — 音频、 视频和其他通信 — — 已指派不同的优先级别。")</span><span class="sxs-lookup"><span data-stu-id="591e3-136">![Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.](media/Qos-in-Teams-Image2.png "Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.")</span></span>

<span data-ttu-id="591e3-137">_图 2。可视化的 QoS 队列_</span><span class="sxs-lookup"><span data-stu-id="591e3-137">_Figure 2. QoS queues visualized_</span></span>

<span data-ttu-id="591e3-138">这些条目准备就绪后，就可能因为基础托管的网络现在能够理解如何分类、 标记和设置优先级的通信提供可预知的 QoS。</span><span class="sxs-lookup"><span data-stu-id="591e3-138">After these pieces are in place, it’s possible to deliver predictable QoS because the underlying managed network now understands how to classify, mark, and prioritize traffic.</span></span> <span data-ttu-id="591e3-139">从团队的角度来看，最重要的一个配置步骤是分类和标记的数据包，但对于端到端 QoS 若要取得成功还需要仔细调整的基础网络配置的应用程序的配置。</span><span class="sxs-lookup"><span data-stu-id="591e3-139">From the Teams perspective, the most important configuration step is the classification and marking of packets, but for end-to-end QoS to be successful you also need to carefully align the application’s configuration with the underlying network configuration.</span></span>

## <a name="teams-qos-scenarios"></a><span data-ttu-id="591e3-140">团队的 QoS 方案</span><span class="sxs-lookup"><span data-stu-id="591e3-140">Teams QoS scenarios</span></span>

<span data-ttu-id="591e3-141">为团队的 QoS 的实施指南基于四种情况：</span><span class="sxs-lookup"><span data-stu-id="591e3-141">The guidance for implementing QoS for Teams is based on four scenarios:</span></span>

*  <span data-ttu-id="591e3-142">**方案 1:** 已经部署或正在部署团队并对基于端口的标记通过 QoS 的实施计划。</span><span class="sxs-lookup"><span data-stu-id="591e3-142">**Scenario 1:** You’ve deployed, or are deploying, Teams and are planning on implementing QoS via port-based tagging.</span></span> <span data-ttu-id="591e3-143">基于端口的标记是最可靠的方法，因为它在所有的平台会发挥普遍作用，并且是最容易实现。</span><span class="sxs-lookup"><span data-stu-id="591e3-143">Port-based tagging is the most reliable method, because it works universally throughout all platforms and is the easiest to implement.</span></span>  

*  <span data-ttu-id="591e3-144">**方案 2:** 已经部署或正在部署团队并计划实施 QoS 通过组策略对象添加标签。</span><span class="sxs-lookup"><span data-stu-id="591e3-144">**Scenario 2:** You’ve deployed, or are deploying, Teams and are planning to implement QoS via Group Policy Object tagging.</span></span> <span data-ttu-id="591e3-145">此方案有时会与方案 1 结合使用。</span><span class="sxs-lookup"><span data-stu-id="591e3-145">This is sometimes used in combination with scenario 1.</span></span> <span data-ttu-id="591e3-146">虽然这种情况下是完全有效的就一定要了解它仅适用于加入域的 Windows 客户端。</span><span class="sxs-lookup"><span data-stu-id="591e3-146">Although this scenario is entirely valid, it’s important to understand it will only work for domain-joined Windows clients.</span></span> <span data-ttu-id="591e3-147">未加入域的 Windows 客户端的任何设备将不会启用的 DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-147">Any device that isn’t a domain-joined Windows client won’t be enabled for DSCP tagging.</span></span>

*  <span data-ttu-id="591e3-148">**方案 3:** 已经部署了 Skype 的业务联机，包括 QoS 标记，并立即部署团队。</span><span class="sxs-lookup"><span data-stu-id="591e3-148">**Scenario 3:** You’ve deployed Skype for Business Online, including QoS tagging, and are now deploying Teams.</span></span> <span data-ttu-id="591e3-149">如果是你，Teams 将遵循现有配置，并且将使用与 Skype for Business 客户端相同的端口范围和标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-149">If this is you, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="591e3-150">在大多数情况下，将所不需任何额外的配置。</span><span class="sxs-lookup"><span data-stu-id="591e3-150">In most cases, no additional configuration will be needed.</span></span> 
 
    > [!NOTE]
    > <span data-ttu-id="591e3-151">如果您使用的应用程序名称 QoS 标记通过组策略，您必须添加 Teams.exe 作为应用程序的名称。</span><span class="sxs-lookup"><span data-stu-id="591e3-151">If you're using Application Name QoS tagging via Group Policy, you must add Teams.exe as the application name.</span></span>

*  <span data-ttu-id="591e3-152">**方案 4:** 已经部署或正在部署团队并想要通过使用自定义端口范围基于端口的标记实现 QoS。</span><span class="sxs-lookup"><span data-stu-id="591e3-152">**Scenario 4:** You’ve deployed, or are deploying, Teams and want to implement QoS via port-based tagging by using a custom port range.</span></span>

## <a name="recommended-dscp-markings"></a><span data-ttu-id="591e3-153">建议使用的 DSCP 标记</span><span class="sxs-lookup"><span data-stu-id="591e3-153">Recommended DSCP markings</span></span>

<span data-ttu-id="591e3-154">第一步是通过将 DSCP 值分配给的唯一的、 非重叠的端口范围进行分类 （例如音频和视频） 的通信量。</span><span class="sxs-lookup"><span data-stu-id="591e3-154">The first step is to classify the traffic flows (such as audio and video) by assigning DSCP values to the unique, non-overlapping port ranges.</span></span> <span data-ttu-id="591e3-155">此处指定的 DSCP 值将确定需要通过网络，根据网络配置的通信量的优先级。</span><span class="sxs-lookup"><span data-stu-id="591e3-155">The DSCP value assigned here will determine the priority of the traffic going through the network, based on network configuration.</span></span> <span data-ttu-id="591e3-156">每个工作负载获取自己的 DSCP 值，但不一定是一个唯一值，有些客户可能会设置相同的值对于语音和视频的工作负荷，在网络中为他们提供相同的优先级。</span><span class="sxs-lookup"><span data-stu-id="591e3-156">Each workload gets its own DSCP value, though not necessarily a unique value—some customers might set the same value for voice and video workloads, giving them the same priority in the network.</span></span>  

<span data-ttu-id="591e3-157">要使用 DSCP 值取决于所需优先工作负荷。</span><span class="sxs-lookup"><span data-stu-id="591e3-157">The DSCP value to use depends on how you want to prioritize the workload.</span></span> <span data-ttu-id="591e3-158">例如，业务需求可能要求您为应用程序提供共享视频相同的优先级 （和因此标记它与视频的 DSCP 值相同）。</span><span class="sxs-lookup"><span data-stu-id="591e3-158">For example, business requirements might dictate that you give application sharing the same priority as video (and therefore mark it with the same DSCP value as video).</span></span> <span data-ttu-id="591e3-159">其他环境可能有一个现有的 QoS 策略将帮助您确定网络工作负载优先级的位置中。</span><span class="sxs-lookup"><span data-stu-id="591e3-159">Other environments might have an existing QoS strategy in place, which will help you determine the priority of network workloads.</span></span> 

<span data-ttu-id="591e3-160">表 1 显示了在团队中使用 ExpressRoute 时所需的 DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-160">Table 1 shows the DSCP markings required when using Teams with ExpressRoute.</span></span> <span data-ttu-id="591e3-161">这些标记可以作为不确定怎么用他们自己的环境的客户很好的起点。</span><span class="sxs-lookup"><span data-stu-id="591e3-161">These markings might serve as a good starting point for customers who are unsure what to use in their own environments.</span></span> <span data-ttu-id="591e3-162">要了解详细信息，请阅读 [ExpressRoute QoS 要求](https://docs.microsoft.com/azure/expressroute/expressroute-qos)。</span><span class="sxs-lookup"><span data-stu-id="591e3-162">To learn more, read [ExpressRoute QoS requirements](https://docs.microsoft.com/azure/expressroute/expressroute-qos).</span></span>


<span data-ttu-id="591e3-163">_表 1。DSCP 标记_</span><span class="sxs-lookup"><span data-stu-id="591e3-163">_Table 1. DSCP markings_</span></span>
    
| <span data-ttu-id="591e3-164">客户端的源端口范围</span><span class="sxs-lookup"><span data-stu-id="591e3-164">Client source port range</span></span> |<span data-ttu-id="591e3-165">协议</span><span class="sxs-lookup"><span data-stu-id="591e3-165">Protocol</span></span>|<span data-ttu-id="591e3-166">媒体类别</span><span class="sxs-lookup"><span data-stu-id="591e3-166">Media category</span></span>|<span data-ttu-id="591e3-167">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="591e3-167">DSCP value</span></span>|<span data-ttu-id="591e3-168">DSCP 类</span><span class="sxs-lookup"><span data-stu-id="591e3-168">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="591e3-169">50000-50,019</span><span class="sxs-lookup"><span data-stu-id="591e3-169">50,000–50,019</span></span>|<span data-ttu-id="591e3-170">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-170">TCP/UDP</span></span>|<span data-ttu-id="591e3-171">音频</span><span class="sxs-lookup"><span data-stu-id="591e3-171">Audio</span></span>|<span data-ttu-id="591e3-172">46</span><span class="sxs-lookup"><span data-stu-id="591e3-172">46</span></span>|<span data-ttu-id="591e3-173">加速转发 (EF)</span><span class="sxs-lookup"><span data-stu-id="591e3-173">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="591e3-174">50,020-50,039</span><span class="sxs-lookup"><span data-stu-id="591e3-174">50,020–50,039</span></span>|<span data-ttu-id="591e3-175">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-175">TCP/UDP</span></span>|<span data-ttu-id="591e3-176">视频</span><span class="sxs-lookup"><span data-stu-id="591e3-176">Video</span></span>|<span data-ttu-id="591e3-177">34</span><span class="sxs-lookup"><span data-stu-id="591e3-177">34</span></span>|<span data-ttu-id="591e3-178">保证转发 (AF41)</span><span class="sxs-lookup"><span data-stu-id="591e3-178">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="591e3-179">50,040-50,059</span><span class="sxs-lookup"><span data-stu-id="591e3-179">50,040–50,059</span></span>|<span data-ttu-id="591e3-180">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-180">TCP/UDP</span></span>|<span data-ttu-id="591e3-181">应用程序/桌面共享</span><span class="sxs-lookup"><span data-stu-id="591e3-181">Application/Desktop Sharing</span></span>|<span data-ttu-id="591e3-182">18</span><span class="sxs-lookup"><span data-stu-id="591e3-182">18</span></span>|<span data-ttu-id="591e3-183">保证转发 (AF21)</span><span class="sxs-lookup"><span data-stu-id="591e3-183">Assured Forwarding (AF21)</span></span>|

<span data-ttu-id="591e3-184">下面是使用表 1 中的信息时的一些注意事项：</span><span class="sxs-lookup"><span data-stu-id="591e3-184">Here are some caveats to understand when you use the information in Table 1:</span></span>
    
-  <span data-ttu-id="591e3-185">如果您打算在今后实施 ExpressRoute 并没有尚未实现 QoS，我们建议您按照表 1 中的指导，以便 DSCP 值都相同，则从发送方到接收方。</span><span class="sxs-lookup"><span data-stu-id="591e3-185">If you plan to implement ExpressRoute in the future and haven’t yet implemented QoS, we recommend that you follow the guidance in Table 1 so that DSCP values are the same from sender to receiver.</span></span> 

-  <span data-ttu-id="591e3-186">所有客户端，包括移动客户端和团队设备将使用这些端口范围，将受到任何使用这些源端口范围的 DSCP 策略实现。</span><span class="sxs-lookup"><span data-stu-id="591e3-186">All clients, including mobile clients and Teams devices, will use these port ranges and will be affected by any DSCP policy you implement that uses these source port ranges.</span></span> <span data-ttu-id="591e3-187">将继续使用动态端口的唯一客户端是基于浏览器的客户端 （让参与者加入会议通过其浏览器的客户）。</span><span class="sxs-lookup"><span data-stu-id="591e3-187">The only clients that will continue to use dynamic ports are the browser-based clients (that is, those clients that let participants join meetings by using their browsers).</span></span>

-  <span data-ttu-id="591e3-188">虽然 Mac 客户端使用相同的端口范围，Mac 客户端音频 (EF) 和视频 (AF41) 也使用硬编码的值。</span><span class="sxs-lookup"><span data-stu-id="591e3-188">Although the Mac client does use the same port ranges, the Mac client also uses hard-coded values for audio (EF) and video (AF41).</span></span> <span data-ttu-id="591e3-189">这些值是不可配置的。</span><span class="sxs-lookup"><span data-stu-id="591e3-189">These values are not configurable.</span></span>
 
    
## <a name="source-ports-used-by-teams"></a><span data-ttu-id="591e3-190">Teams 使用的源端口</span><span class="sxs-lookup"><span data-stu-id="591e3-190">Source ports used by Teams</span></span>

<span data-ttu-id="591e3-191">在 Teams 中，应根据不同工作负荷使用的源端口配置 QoS。</span><span class="sxs-lookup"><span data-stu-id="591e3-191">In Teams, QoS should be configured based on the source ports used by the different workloads.</span></span> <span data-ttu-id="591e3-192">当前配置的任何服务器端和客户端的端口范围。</span><span class="sxs-lookup"><span data-stu-id="591e3-192">Neither server-side nor client-side port ranges are currently configurable.</span></span> 

<span data-ttu-id="591e3-193">请注意客户端源端口范围在表 2 中列出并使用其相关的 QoS DSCP 标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-193">Note the client source port ranges listed in Table 2, and use their associated QoS DSCP markings.</span></span>

<span data-ttu-id="591e3-194">_表 2。客户端的源端口范围_</span><span class="sxs-lookup"><span data-stu-id="591e3-194">_Table 2. Client source port ranges_</span></span>

| <span data-ttu-id="591e3-195">客户端的源端口范围</span><span class="sxs-lookup"><span data-stu-id="591e3-195">Client source port range</span></span> |<span data-ttu-id="591e3-196">协议</span><span class="sxs-lookup"><span data-stu-id="591e3-196">Protocol</span></span>|<span data-ttu-id="591e3-197">媒体类别</span><span class="sxs-lookup"><span data-stu-id="591e3-197">Media category</span></span>|<span data-ttu-id="591e3-198">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="591e3-198">DSCP value</span></span>|<span data-ttu-id="591e3-199">DSCP 类</span><span class="sxs-lookup"><span data-stu-id="591e3-199">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="591e3-200">50000-50,019</span><span class="sxs-lookup"><span data-stu-id="591e3-200">50,000–50,019</span></span>|<span data-ttu-id="591e3-201">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-201">TCP/UDP</span></span>|<span data-ttu-id="591e3-202">音频</span><span class="sxs-lookup"><span data-stu-id="591e3-202">Audio</span></span>|<span data-ttu-id="591e3-203">46</span><span class="sxs-lookup"><span data-stu-id="591e3-203">46</span></span>|<span data-ttu-id="591e3-204">加速转发 (EF)</span><span class="sxs-lookup"><span data-stu-id="591e3-204">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="591e3-205">50,020-50,039</span><span class="sxs-lookup"><span data-stu-id="591e3-205">50,020–50,039</span></span>|<span data-ttu-id="591e3-206">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-206">TCP/UDP</span></span>|<span data-ttu-id="591e3-207">视频</span><span class="sxs-lookup"><span data-stu-id="591e3-207">Video</span></span>|<span data-ttu-id="591e3-208">34</span><span class="sxs-lookup"><span data-stu-id="591e3-208">34</span></span>|<span data-ttu-id="591e3-209">保证转发 (AF41)</span><span class="sxs-lookup"><span data-stu-id="591e3-209">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="591e3-210">50,040-50,059</span><span class="sxs-lookup"><span data-stu-id="591e3-210">50,040–50,059</span></span>|<span data-ttu-id="591e3-211">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="591e3-211">TCP/UDP</span></span>|<span data-ttu-id="591e3-212">应用程序/桌面共享</span><span class="sxs-lookup"><span data-stu-id="591e3-212">Application/Desktop Sharing</span></span>|<span data-ttu-id="591e3-213">18</span><span class="sxs-lookup"><span data-stu-id="591e3-213">18</span></span>|<span data-ttu-id="591e3-214">保证转发 (AF21)</span><span class="sxs-lookup"><span data-stu-id="591e3-214">Assured Forwarding (AF21)</span></span>|

<span data-ttu-id="591e3-215">实施这些 QoS 策略的推荐的方法是使用客户端的源端口源和目标 IP 地址为"任意"。</span><span class="sxs-lookup"><span data-stu-id="591e3-215">The recommended method of implementing these QoS policies is to use the client source ports with a source and destination IP address of “any.”</span></span> <span data-ttu-id="591e3-216">这将内部网络上捕获这两种介质传入和传出通信。</span><span class="sxs-lookup"><span data-stu-id="591e3-216">This will catch both incoming and outgoing media traffic on the internal network.</span></span> 

> [!NOTE]
> <span data-ttu-id="591e3-217">如果您已配置 QoS 根据源端口范围对 Skype 的在线业务，相同的配置将应用到团队，则需要任何进一步的更改。</span><span class="sxs-lookup"><span data-stu-id="591e3-217">If you've already configured QoS based on source port ranges for Skype for Business Online, the same configuration will apply to Teams and no further changes will be required.</span></span> <span data-ttu-id="591e3-218">如果您已经部署了 Skype 对于业务服务器部署，您将需要重新设计您的 QoS 策略。</span><span class="sxs-lookup"><span data-stu-id="591e3-218">If you’ve deployed Skype for Business Server on-premises, you’ll need to redesign your QoS policies.</span></span>

## <a name="setting-dscp-markings"></a><span data-ttu-id="591e3-219">设置 DSCP 标记</span><span class="sxs-lookup"><span data-stu-id="591e3-219">Setting DSCP markings</span></span>

<span data-ttu-id="591e3-220">有多种方法设置通信量分类正确的 DSCP 标记：</span><span class="sxs-lookup"><span data-stu-id="591e3-220">There are multiple approaches to setting the proper DSCP markings for traffic classification:</span></span>

-  <span data-ttu-id="591e3-221">**在端点的 DSCP 标记：**这通常是首选的选项，因为自身的终结点提供适当的标记。</span><span class="sxs-lookup"><span data-stu-id="591e3-221">**DSCP marking at the endpoint:** This is generally the preferred option, because the endpoint itself provides the proper markings.</span></span> <span data-ttu-id="591e3-222">目前这可以通过使用组策略对象中，但它只能使用加入域的 Windows 客户端上。</span><span class="sxs-lookup"><span data-stu-id="591e3-222">Currently this can be done by using a Group Policy object, but it can only be used on domain-joined Windows clients.</span></span> <span data-ttu-id="591e3-223">移动客户端没有提供一种机制来使用 DSCP 值标记的通讯。</span><span class="sxs-lookup"><span data-stu-id="591e3-223">Mobile clients don’t provide a mechanism to mark traffic by using DSCP values.</span></span> <span data-ttu-id="591e3-224">虽然您不能配置非&ndash;于标记的通讯，如 Mac OS 客户端加入域的 Windows 客户端具有硬编码的标记，并将始终标记通信，如上面所述。</span><span class="sxs-lookup"><span data-stu-id="591e3-224">Although you can’t configure non&ndash;domain-joined Windows clients to tag traffic, clients such as Mac OS have hard-coded tags and will always tag traffic as described above.</span></span>

-  <span data-ttu-id="591e3-225">**基于端口的 DSCP 标记在路由器上使用访问控制列表 (Acl):** 这是在 Windows 和 Mac 的异构环境中遇到的常见选项。</span><span class="sxs-lookup"><span data-stu-id="591e3-225">**Port-based DSCP tagging by using access control lists (ACLs) on routers:** This is a very common option encountered in heterogeneous Windows and Mac environments.</span></span> <span data-ttu-id="591e3-226">在这种情况下，网络团队标记基于为每个模式定义的源端口范围 （通常位于 WAN） 入口/出口路由器上的通信。</span><span class="sxs-lookup"><span data-stu-id="591e3-226">In this scenario, the network team marks the traffic at the ingress/egress routers (typically located on the WAN) based on the source port ranges defined for each modality.</span></span> <span data-ttu-id="591e3-227">跨平台工作，虽然它仅标记边沿 WAN 流量 — — 不一直向客户机 — — 和因此产生的管理开销。</span><span class="sxs-lookup"><span data-stu-id="591e3-227">Although this works across platforms, it only marks traffic at the WAN edge—not all the way to the client machine—and therefore incurs management overhead.</span></span>
    
-  <span data-ttu-id="591e3-228">**的终结点和路由器上的端口基于 Acl 的 DSCP 标记组合：**我们建议这种组合，如有可能在您的环境中。</span><span class="sxs-lookup"><span data-stu-id="591e3-228">**A combination of DSCP markings at the endpoint and port-based ACLs on routers:** We recommend this combination, if possible in your environment.</span></span> <span data-ttu-id="591e3-229">使用组策略对象来捕捉大多数客户端，并且使用基于端口的 DSCP 标记以确保该移动、 Mac 和其他客户端仍可以得到 QoS 治疗 （至少部分）。</span><span class="sxs-lookup"><span data-stu-id="591e3-229">Use a Group Policy object to catch the majority of clients, and also use port-based DSCP tagging to ensure that mobile, Mac, and other clients will still get QoS treatment (at least partially).</span></span>
    
<span data-ttu-id="591e3-230">可以使用组策略中基于策略的 QoS 团队客户端中设置为预定义的源端口范围的 DSCP 值。</span><span class="sxs-lookup"><span data-stu-id="591e3-230">You can use policy-based QoS within Group Policy to set the DSCP value for the predefined source port range in the Teams client.</span></span> <span data-ttu-id="591e3-231">在表 3 中指定的端口范围用于创建每个工作负荷的策略。</span><span class="sxs-lookup"><span data-stu-id="591e3-231">Use the port ranges specified in Table 3 to create a policy for each workload.</span></span>

<span data-ttu-id="591e3-232">_表 3。按通信量类型的端口范围_</span><span class="sxs-lookup"><span data-stu-id="591e3-232">_Table 3. Port ranges by traffic type_</span></span>
| <span data-ttu-id="591e3-233">客户端流量类型</span><span class="sxs-lookup"><span data-stu-id="591e3-233">Client traffic type</span></span>|<span data-ttu-id="591e3-234">端口范围起始值</span><span class="sxs-lookup"><span data-stu-id="591e3-234">Port range start</span></span>|<span data-ttu-id="591e3-235">端口范围结束值</span><span class="sxs-lookup"><span data-stu-id="591e3-235">Port range end</span></span>|<span data-ttu-id="591e3-236">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="591e3-236">DSCP value</span></span>|
|---------|---------|---------|--------|
| <span data-ttu-id="591e3-237">音频</span><span class="sxs-lookup"><span data-stu-id="591e3-237">Audio</span></span>|<span data-ttu-id="591e3-238">50000</span><span class="sxs-lookup"><span data-stu-id="591e3-238">50000</span></span>|<span data-ttu-id="591e3-239">50019</span><span class="sxs-lookup"><span data-stu-id="591e3-239">50019</span></span>|<span data-ttu-id="591e3-240">46</span><span class="sxs-lookup"><span data-stu-id="591e3-240">46</span></span>|
| <span data-ttu-id="591e3-241">视频</span><span class="sxs-lookup"><span data-stu-id="591e3-241">Video</span></span>|<span data-ttu-id="591e3-242">50020</span><span class="sxs-lookup"><span data-stu-id="591e3-242">50020</span></span>|<span data-ttu-id="591e3-243">50039</span><span class="sxs-lookup"><span data-stu-id="591e3-243">50039</span></span>|<span data-ttu-id="591e3-244">34</span><span class="sxs-lookup"><span data-stu-id="591e3-244">34</span></span>|
| <span data-ttu-id="591e3-245">应用程序共享</span><span class="sxs-lookup"><span data-stu-id="591e3-245">Application sharing</span></span>|<span data-ttu-id="591e3-246">50040</span><span class="sxs-lookup"><span data-stu-id="591e3-246">50040</span></span>|<span data-ttu-id="591e3-247">50059</span><span class="sxs-lookup"><span data-stu-id="591e3-247">50059</span></span>|<span data-ttu-id="591e3-248">18</span><span class="sxs-lookup"><span data-stu-id="591e3-248">18</span></span>|

> [!NOTE]
> <span data-ttu-id="591e3-249">不能更改通过团队设置的端口范围。</span><span class="sxs-lookup"><span data-stu-id="591e3-249">The port ranges set by Teams can't be changed.</span></span> <span data-ttu-id="591e3-250">请查看[本文支持](https://support.microsoft.com/kb/2409256)的最新信息。</span><span class="sxs-lookup"><span data-stu-id="591e3-250">Review [this support article](https://support.microsoft.com/kb/2409256) for the latest information.</span></span> 

<span data-ttu-id="591e3-251">已确定端口范围后下, 一步是配置组策略对象内的基于策略的 QoS 设置。</span><span class="sxs-lookup"><span data-stu-id="591e3-251">After you’ve identified the port ranges, the next step is to configure the policy-based QoS settings within a Group Policy object.</span></span> <span data-ttu-id="591e3-252">[此 TechNet 文章](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx)中可以找到有关这些步骤的详细信息。</span><span class="sxs-lookup"><span data-stu-id="591e3-252">More information about these steps can be found in [this TechNet article](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx).</span></span> 

<span data-ttu-id="591e3-253">已在客户端计算机上刷新组策略，您已经创建了新的策略才能生效。</span><span class="sxs-lookup"><span data-stu-id="591e3-253">The new policies you’ve created won’t take effect until Group Policy has been refreshed on your client computers.</span></span> <span data-ttu-id="591e3-254">虽然自己会定期刷新组策略，您可以强制立即刷新。</span><span class="sxs-lookup"><span data-stu-id="591e3-254">Although Group Policy periodically refreshes on its own, you can force an immediate refresh.</span></span>

### <a name="force-group-policy-refresh"></a><span data-ttu-id="591e3-255">强制组策略刷新</span><span class="sxs-lookup"><span data-stu-id="591e3-255">Force Group Policy refresh</span></span>

1. <span data-ttu-id="591e3-256">在您要为其刷新组策略的每台计算机上打开一个命令控制台。</span><span class="sxs-lookup"><span data-stu-id="591e3-256">On each computer for which you want to refresh Group Policy, open a command console.</span></span> <span data-ttu-id="591e3-257">请确保命令控制台被设置为以管理员身份运行。</span><span class="sxs-lookup"><span data-stu-id="591e3-257">Ensure that the command console is set to run as administrator.</span></span>

2. <span data-ttu-id="591e3-258">在命令提示符下，输入</span><span class="sxs-lookup"><span data-stu-id="591e3-258">At the command prompt, enter</span></span>
```
    gpudate.exe /force
```

## <a name="verify-dscp-markings-in-the-group-policy-object"></a><span data-ttu-id="591e3-259">验证组策略对象中的 DSCP 标记</span><span class="sxs-lookup"><span data-stu-id="591e3-259">Verify DSCP markings in the Group Policy object</span></span>

<span data-ttu-id="591e3-260">若要验证已设置的组策略对象中的值，请执行以下步骤。</span><span class="sxs-lookup"><span data-stu-id="591e3-260">To verify that the values from the Group Policy object have been set, perform the following steps.</span></span>

1.  <span data-ttu-id="591e3-261">打开一个命令控制台。</span><span class="sxs-lookup"><span data-stu-id="591e3-261">Open a command console.</span></span> <span data-ttu-id="591e3-262">请确保命令控制台被设置为以管理员身份运行。</span><span class="sxs-lookup"><span data-stu-id="591e3-262">Ensure that the command console is set to run as administrator.</span></span>

2.  <span data-ttu-id="591e3-263">在命令提示符下，输入</span><span class="sxs-lookup"><span data-stu-id="591e3-263">At the command prompt, enter</span></span> 
    ```
    gpresult /R >gp.txt
    ```

    <span data-ttu-id="591e3-264">这将生成一个报告，并将其发送到一个名为 gp.txt 的文本文件。</span><span class="sxs-lookup"><span data-stu-id="591e3-264">This will generate a report and send it to a text file named gp.txt.</span></span> <span data-ttu-id="591e3-265">或者，您可以输入以下命令以生成中名为 gp.html 的更具可读性 HTML 报表相同的数据：</span><span class="sxs-lookup"><span data-stu-id="591e3-265">Alternatively, you can enter the following command to produce the same data in a more readable HTML report named gp.html:</span></span>
    ```
    gpresult /H >gp.html
    ```
 
   <span data-ttu-id="591e3-266">![运行 gpresult 命令控制台窗口的屏幕抓图。](media/Qos-in-Teams-Image3.png "运行 gpresult 命令控制台窗口的屏幕抓图。")</span><span class="sxs-lookup"><span data-stu-id="591e3-266">![Screenshot of the console window running the gpresult command.](media/Qos-in-Teams-Image3.png "Screenshot of the console window running the gpresult command.")</span></span>

3.  <span data-ttu-id="591e3-267">在生成文件中，查找标题**应用组策略对象**并验证以前创建的组策略对象的名称在已应用策略的列表。</span><span class="sxs-lookup"><span data-stu-id="591e3-267">In the generated file, look for the heading **Applied Group Policy Objects** and verify that the names of the Group Policy objects created earlier are in the list of applied policies.</span></span> 

4.  <span data-ttu-id="591e3-268">打开注册表编辑器，然后转至：</span><span class="sxs-lookup"><span data-stu-id="591e3-268">Open the Registry Editor, and go to:</span></span>

    <span data-ttu-id="591e3-269">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span><span class="sxs-lookup"><span data-stu-id="591e3-269">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span></span>

    <span data-ttu-id="591e3-270">验证在表 3 中列出的注册表项的值。</span><span class="sxs-lookup"><span data-stu-id="591e3-270">Verify the values for the registry entries listed in Table 3.</span></span>

    <span data-ttu-id="591e3-271">_表 3。QoS 的 Windows 注册表项的值_</span><span class="sxs-lookup"><span data-stu-id="591e3-271">_Table 3. Values for Windows registry entries for QoS_</span></span>
    
    | <span data-ttu-id="591e3-272">名称</span><span class="sxs-lookup"><span data-stu-id="591e3-272">Name</span></span> | <span data-ttu-id="591e3-273">类型</span><span class="sxs-lookup"><span data-stu-id="591e3-273">Type</span></span> | <span data-ttu-id="591e3-274">数据</span><span class="sxs-lookup"><span data-stu-id="591e3-274">Data</span></span>|
    |---------|---------|---------
    | <span data-ttu-id="591e3-275">应用程序名称</span><span class="sxs-lookup"><span data-stu-id="591e3-275">Application Name</span></span>|<span data-ttu-id="591e3-276">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-276">REG_SZ</span></span>|<span data-ttu-id="591e3-277">Teams.exe</span><span class="sxs-lookup"><span data-stu-id="591e3-277">Teams.exe</span></span>|
    | <span data-ttu-id="591e3-278">DSCP 值</span><span class="sxs-lookup"><span data-stu-id="591e3-278">DSCP Value</span></span>|<span data-ttu-id="591e3-279">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-279">REG_SZ</span></span>|<span data-ttu-id="591e3-280">46</span><span class="sxs-lookup"><span data-stu-id="591e3-280">46</span></span>|
    | <span data-ttu-id="591e3-281">本地 IP</span><span class="sxs-lookup"><span data-stu-id="591e3-281">Local IP</span></span>|<span data-ttu-id="591e3-282">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-282">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-283">本地 IP 前缀长度</span><span class="sxs-lookup"><span data-stu-id="591e3-283">Local IP Prefix Length</span></span>|<span data-ttu-id="591e3-284">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-284">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-285">本地端口</span><span class="sxs-lookup"><span data-stu-id="591e3-285">Local Port</span></span>|<span data-ttu-id="591e3-286">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-286">REG_SZ</span></span>|<span data-ttu-id="591e3-287">50000-50019</span><span class="sxs-lookup"><span data-stu-id="591e3-287">50000-50019</span></span>|
    | <span data-ttu-id="591e3-288">协议</span><span class="sxs-lookup"><span data-stu-id="591e3-288">Protocol</span></span>|<span data-ttu-id="591e3-289">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-289">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-290">远程 IP</span><span class="sxs-lookup"><span data-stu-id="591e3-290">Remote IP</span></span>|<span data-ttu-id="591e3-291">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-291">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-292">远程 IP 前缀</span><span class="sxs-lookup"><span data-stu-id="591e3-292">Remote IP Prefix</span></span>|<span data-ttu-id="591e3-293">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-293">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-294">远程端口</span><span class="sxs-lookup"><span data-stu-id="591e3-294">Remote Port</span></span>|<span data-ttu-id="591e3-295">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-295">REG_SZ</span></span>|*|
    | <span data-ttu-id="591e3-296">限制率</span><span class="sxs-lookup"><span data-stu-id="591e3-296">Throttle Rate</span></span>|<span data-ttu-id="591e3-297">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="591e3-297">REG_SZ</span></span>|<span data-ttu-id="591e3-298">-1</span><span class="sxs-lookup"><span data-stu-id="591e3-298">-1</span></span>|
    
5.  <span data-ttu-id="591e3-299">验证应用程序的名称输入的值是正确的客户端使用，以及的 DSCP 值和本地端口条目反映中的组策略对象的设置。</span><span class="sxs-lookup"><span data-stu-id="591e3-299">Verify that the value for the Application Name entry is correct for the client you’re using, and verify that both the DSCP Value and Local Port entries reflect the settings in the Group Policy object.</span></span>

## <a name="validate-qos-by-analyzing-teams-traffic-on-the-network"></a><span data-ttu-id="591e3-300">通过分析团队在网络上的通信验证 QoS</span><span class="sxs-lookup"><span data-stu-id="591e3-300">Validate QoS by analyzing Teams traffic on the network</span></span>

<span data-ttu-id="591e3-301">所设置的组策略对象需要进行有效的 QoS 的顺序被调用方调用方有 DSCP 值。</span><span class="sxs-lookup"><span data-stu-id="591e3-301">The DSCP value set by the Group Policy object needs to be present from caller to callee in order for QoS to be effective.</span></span> <span data-ttu-id="591e3-302">通过查看由工作组客户端生成的通信量，您可以验证 DSCP 值不会更改或剥团队的工作负荷通信量在网络中传输。</span><span class="sxs-lookup"><span data-stu-id="591e3-302">By looking at the traffic generated by the Teams client, you can verify that the DSCP value isn’t changed or stripped out when the Teams workload traffic traverses the network.</span></span> 

<span data-ttu-id="591e3-303">最好是，您可以捕获通信量在网络出口点。</span><span class="sxs-lookup"><span data-stu-id="591e3-303">Preferably, you capture traffic at the network egress point.</span></span> <span data-ttu-id="591e3-304">可以使用交换机或路由器上的端口镜像来做到这一点。</span><span class="sxs-lookup"><span data-stu-id="591e3-304">You can use port mirroring on a switch or router to help with this.</span></span>

### <a name="use-network-monitor-to-verify-dscp-values"></a><span data-ttu-id="591e3-305">使用网络监视器来验证 DSCP 值</span><span class="sxs-lookup"><span data-stu-id="591e3-305">Use Network Monitor to verify DSCP values</span></span>

<span data-ttu-id="591e3-306">网络监视器是一种工具，您可以[从 Microsoft 下载](https://www.microsoft.com/download/4865)来分析网络通信。</span><span class="sxs-lookup"><span data-stu-id="591e3-306">Network Monitor is a tool you can [download from Microsoft](https://www.microsoft.com/download/4865) to analyze network traffic.</span></span>

1.  <span data-ttu-id="591e3-307">在 PC 上运行网络监视器，连接到已配置的端口镜像并开始捕获的数据包的端口。</span><span class="sxs-lookup"><span data-stu-id="591e3-307">On the PC running Network Monitor, connect to the port that has been configured for port mirroring and start capturing packets.</span></span> 

2.  <span data-ttu-id="591e3-308">通过 Skype 业务客户端进行调用。</span><span class="sxs-lookup"><span data-stu-id="591e3-308">Make a call by using the Skype for Business client.</span></span> <span data-ttu-id="591e3-309">请确保已在挂断电话之前建立媒体。</span><span class="sxs-lookup"><span data-stu-id="591e3-309">Make sure media has been established before hanging up the call.</span></span> 

3.  <span data-ttu-id="591e3-310">停止捕获。</span><span class="sxs-lookup"><span data-stu-id="591e3-310">Stop the capture.</span></span>

4. <span data-ttu-id="591e3-311">在**显示筛选器**字段中，使用的 pc 的执行调用的源 IP 地址，通过定义 DSCP 值 46 （十六进制 0xb8） 作为搜索条件，进一步调整筛选，如下面的示例所示：</span><span class="sxs-lookup"><span data-stu-id="591e3-311">In the **Display Filter** field, use the source IP address of the PC that made the call, and refine the filter by defining DSCP value 46 (hex 0xb8) as search criteria, as shown in the following example:</span></span>

    <span data-ttu-id="591e3-312">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span><span class="sxs-lookup"><span data-stu-id="591e3-312">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span></span> 

    <span data-ttu-id="591e3-313">![在网络监视器中，显示要应用筛选器显示筛选程序对话框的屏幕截图。](media/Qos-in-Teams-Image4.png "在网络监视器中，显示要应用筛选器显示筛选程序对话框的屏幕截图。")</span><span class="sxs-lookup"><span data-stu-id="591e3-313">![Screenshot of the Display Filter dialog box in Network Monitor, showing the filters to apply.](media/Qos-in-Teams-Image4.png "Screenshot of the Display Filter dialog box in Network Monitor, showing the filters to apply.")</span></span>

5.  <span data-ttu-id="591e3-314">选择要激活筛选器的**应用**。</span><span class="sxs-lookup"><span data-stu-id="591e3-314">Select **Apply** to activate the filter.</span></span>

6.  <span data-ttu-id="591e3-315">在**框架摘要**窗口中，选择第一个 UDP 数据包。</span><span class="sxs-lookup"><span data-stu-id="591e3-315">In the **Frame Summary** window, select the first UDP packet.</span></span>

7.  <span data-ttu-id="591e3-316">在**帧详细信息**窗口中，展开 IPv4 列表项，请注意末尾的**DSCP**开头的行的值。</span><span class="sxs-lookup"><span data-stu-id="591e3-316">In the **Frame Details** window, expand the IPv4 list item and note the value at the end of the line that begins with **DSCP**.</span></span> 

    <span data-ttu-id="591e3-317">![在网络监视器中，突出显示 DSCP 设置帧详细信息对话框的屏幕截图。](media/Qos-in-Teams-Image5.png "在网络监视器中，突出显示 DSCP 设置帧详细信息对话框的屏幕截图。")</span><span class="sxs-lookup"><span data-stu-id="591e3-317">![Screenshot of the Frame Details dialog box in Network Monitor, highlighting DSCP settings.](media/Qos-in-Teams-Image5.png "Screenshot of the Frame Details dialog box in Network Monitor, highlighting DSCP settings.")</span></span>

<span data-ttu-id="591e3-318">在此示例中的 DSCP 值设置为 46。</span><span class="sxs-lookup"><span data-stu-id="591e3-318">In this example, the DSCP value is set to 46.</span></span> <span data-ttu-id="591e3-319">这是正确的因为所用的源端口 50019，表示这是一个声音的工作负荷。</span><span class="sxs-lookup"><span data-stu-id="591e3-319">This is correct, because the source port used is 50019, which indicates that this is a voice workload.</span></span> 

<span data-ttu-id="591e3-320">为 GPO 标记的每个工作负荷重复执行验证。</span><span class="sxs-lookup"><span data-stu-id="591e3-320">Repeat the verification for each workload that has been marked by the GPO.</span></span> 
