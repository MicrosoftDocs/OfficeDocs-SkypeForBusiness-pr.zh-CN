---
title: Microsoft Teams 体验质量概述指南
author: lanachin
ms.author: v-lanac
manager: serdars
ms.topic: article
ms.service: msteams
ms.reviewer: rowille
audience: admin
description: 有关使用呼叫质量仪表板（CQD）分析 Microsoft 团队的实时媒体性能的指南。
localization_priority: Normal
search.appverid: MET150
ms.collection:
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: 8a25b7db3a254c4bc1c1266b6b9be48ed798f331
ms.sourcegitcommit: 013190ad10cdc02ce02e583961f433d024d5d370
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2020
ms.locfileid: "41634885"
---
# <a name="quality-of-experience-review-guide"></a>体验质量检查指南

<!-- Note that this link to the Word doc is intentionally NOT the aka.ms/qerquide link -->
本指南介绍 Microsoft 团队和 Skype for business Online 的 "驱动器价值" 阶段。 您可以下载本指南的[Word 版本](https://github.com/MicrosoftDocs/OfficeDocs-SkypeForBusiness/blob/live/Teams/downloads/quality-of-experience-review-guide.docx?raw=true)。

## <a name="introduction"></a>简介

为了对改善用户体验的最大影响，组织需要 operationalize 下图中所示的关键区域。 其他方面包括确定操作任务、确定质量标准的目标、ascertaining 用于衡量组织成功的衡量标准，以及根据需要缩小调查的范围。


![用户体验质量的关键领域](media/qerguide-image-keyareas.png "用户体验质量的关键领域包括音频、可靠性、用户调查、设备和客户端。")

_图 1-本指南中涵盖的关键操作区域_

通过不断评估和修正本指南中所述的区域，你可以降低对用户体验质量产生负面影响的可能性。 在部署中遇到的大多数用户体验问题可以分为以下类别：

-   防火墙或代理配置不完整
-   Wi-Fi 覆盖范围较小
-   带宽不足
-   VPN
-   不一致或过时的客户端版本和驱动程序
-   未优化或内置音频设备
-   子网或网络设备存在问题

通过在部署团队或 Skype for business Online 之前制定正确的规划和设计，你可以减少保持高质量体验所需的工作量。

本指南重点介绍使用 "呼叫质量" 仪表板（CQD）作为主要工具来报告和调查每个区域，并对音频进行特殊强调以最大程度地提高采纳和影响。 对网络进行的改进音频体验的任何改进也将直接转换为视频和桌面共享中的改进。

为加速评估，提供了[两个特选 CQD 模板](https://aka.ms/qertemplates)：一个用于管理所有网络，另一个仅针对托管（内部）网络进行筛选。 虽然 "所有网络" 模板报表配置为显示建筑物和网络信息，但在您处理收集和上载建筑物信息时仍可使用这些报告。 将生成信息上载到 CQD 使服务可以通过添加自定义建筑物、网络和位置信息来增强报告，同时区分外部子网的内部子网。 有关详细信息，请参阅本指南后面的[构建地图](#building-mapping)。

### <a name="intended-audience"></a>目标受众

本指南旨在供合作伙伴和客户利益干系人使用，其角色包括协作领导/架构师、顾问、变更管理/采纳专家、支持/技术支持人员、网络主管、桌面组长和 IT 管理员。

本指南还旨在供指定的质量专家使用。 有关详细信息，请参阅[质量拥护者角色](4-envision-plan-my-service-management.md#the-quality-champion-role)。

## <a name="assign-roles-for-accessing-cqd"></a>为访问 CQD 分配角色

使用本指南之前，请确保你已分配正确的租户[角色](https://docs.microsoft.com/office365/admin/add-users/about-admin-roles)，以便你可以访问 CQD。

下表显示了每个角色在 CQD 中可以执行的操作：


|  |查看报表  |查看 EUII 字段  |创建报表  |上载构建数据  |
|---------|:-------:|:-------:|:-------:|:-------:|
|Office 365 全局管理员     |必需         |是          |是          |是          |
|Teams 服务管理员     |必需         |是          |是          |是          |
|Teams 通信管理员     |必需         |是          |是          |是          |
|Teams 通信支持工程师     |必需         |是          |是         |否         |
|团队沟通支持专家     |是         |否         |是         |否         |
|Skype for Business 管理员     |必需         |是          |是          |是          |
|Azure AD 全局阅读器 |必需         |是          |是         |否         |
|Office 365 报告阅读器<sup>1</sup>     |是         |否         |是         |否         |

<sup>1</sup>除了阅读 CQD 报表，Office 365 报表读者还可以查看管理中心中的所有[活动报表](https://support.office.com/article/activity-reports-0d6dfb17-8582-4172-a9a9-aed798150263)和[Microsoft 365 采纳内容包](https://support.office.com/article/Office-365-Adoption-content-pack-77ff780d-ab19-4553-adea-09cb65ad0f1f)中的所有报表。

> [!NOTE]
> 如果您没有看到 EUII （最终用户的可识别信息），并且您拥有允许查看此信息的角色之一，请记住 CQD 仅保留30天的 EUII。 将删除30天之前的任何内容。

## <a name="what-is-quality"></a>什么是质量？

在团队和 Skype for business 中讨论质量时，定义术语以实现共同的理解非常重要。 在此处定义的质量是服务指标和用户体验的组合。

<!-- Note: need to update graphic-->
![服务指标和用户体验的插图](media/qerguide-image-whatisquality.png "服务指标由较差的流比率、可靠性、终结点/设备和客户端版本组成。用户体验由用户对服务质量的理解构成。")

_图 2-什么是质量？_

### <a name="service-metrics"></a>服务指标

服务指标由基于客户端的特定指标组成。 在每次通话期间，客户将收集有关呼叫的遥测信息，并在每次调用结束时提交报告，以后可通过 CQD 或[调用分析](https://techcommunity.microsoft.com/t5/Skype-for-Business-Blog/Introducing-Call-Analytics/ba-p/57309)进行访问。 这些指标包括：

-   较差的流速率
-   设置失败率
-   丢单故障率


#### <a name="poor-stream-rate"></a>较差的流速率

较差的流速率（PSR.EXE）表示组织的质量较差的流的总体百分比。 此指标旨在突出显示你的组织集中关注的区域，以达到降低此值和改善用户体验的最大影响，这是在查看 PSR.EXE 时[托管网络](#managed-vs-unmanaged-networks)的主要焦点。 外部用户也很重要，但调查在组织的基础上有所不同。 考虑为外部用户提供最佳做法，并独立于整个组织调查外部呼叫。

CQD 中的实际度量值因工作负荷而异，但为了使质量体验进行评审，我们主要关注_音频的差百分比_度量。 PSR.EXE 是由下表中所述的五个网络度量值组成。 对于要归类为较差的流，只有一个指标需要超过所定义的阈值。 有关流分类过程的详细信息，请参阅[本文](stream-classification-in-call-quality-dashboard.md)。

> [!Note]
> CQD 提供 "不太好的原因 ..." 测量，以便更好地了解导致流归为差的条件。


_表 1-音频质量不佳的指标_

| 平均指标     | 说明     | 用户体验 |
|-------------|-----------------|-----------------|
| 抖动\>30 毫秒        | 这是连续数据包之间的延迟的平均变化。 团队和 Skype for business 可以通过缓冲来适应某些级别的抖动。 仅当抖动超过的是参与者注意到抖动效果的缓冲时才会如此。      | 以不同的速度收到的数据包将使扬声器的语音与声音机器人。   |
| 数据包丢失率\>10% 或0。1        | 这通常定义为丢失的数据包的百分比。 数据包丢失直接影响音频质量-从少量的单个丢失的数据包，几乎不影响对导致音频完全减少的后端到后突发损失的影响。     | 数据包被丢弃且未到达其预期目标会导致媒体出现间隙，导致丢失音节和单词，并且视频和共享断断续续。 |
| 往返时间\>500 ms        | 这是将 IP 数据包从点 A 转到点 B 并返回到点 A 所需的时间。此网络传播延迟与两个点之间的物理距离和光之间的距离密切相关，并且包括网络路径中的各种设备所占用的额外开销。      | 数据包到达目的地的时间太长，导致 walkie talkie 效果。   |
| NMOS 下降平均\>1。0         | 流的平均[网络平均观点（NMOS）](https://docs.microsoft.com/previous-versions/office/communications-server/bb894481(v=office.12)#network-mos)性能下降。 表示网络损失和抖动对导致 NMOS 通过多个点丢弃的已接收音频的质量有多大的影响。 | 这是抖动、数据包丢失和较低级别的组合——延长往返时间。 用户可能遇到这些症状的组合。   |
| 隐藏样本\>7% 或0.07 的平均比率 | 带有隐藏样本（由数据包丢失修复生成）到音频帧总数的音频帧数的平均比率。 隐藏的音频示例是一种技术，用于平滑通常由丢弃网络数据包导致的突然过渡。      | 高值表示应用了严重级别的损失 concealment，并导致音频失真。     |

#### <a name="setup-failure-rate"></a>设置失败率

设置失败率（在 CQD 中称为 "_总呼叫设置失败百分比_测量"）表示在呼叫开始时终结点之间无法建立媒体路径的流的数量。

这表示无法建立的任何媒体流。 根据此处测量的用户体验影响的严重程度，目标是将此值尽可能缩小到零。 在具有不完整的防火墙规则的新部署中，此指标的高值在防火墙规则上比成熟部署更常见，但仍需要定期观看非常重要。

此指标的计算方法是使用已提交成功呼叫详细记录（CDR）的流总数设置的失败流总数：

-   **设置失败率**= 总通话设置失败流计数/总 CDR 可用流计数

#### <a name="drop-failure-rate"></a>丢单故障率

在 CQD 中，"丢弃故障率" （也称为 "_总通话中断失败百分比_度量值"）是已成功建立媒体路径但未正常终止的流的百分比。

这表示意外终止的任何媒体流。 尽管这种影响不会像设置失败的流那样严重，但会对用户体验产生负面影响。 突然和频繁的媒体丢弃不仅会对用户体验产生严重影响，还会导致用户需要重新连接，从而导致生产力损失。

通过将丢弃流的总数除以已成功设置的流的总数来计算指标：

-   **丢单失败率**= 总通话中断流计数/总通话设置成功流计数

### <a name="define-your-target-metrics"></a>定义目标指标

本部分将讨论一些核心服务指标，这些指标用于评估服务体验运行状况。 通过不断评估和推动将这些指标保留在其定义的目标之下，你将帮助确保你的用户体验一致、可靠的通话质量。 为此，我们提供了以下目标。

_表 2-核心目标运行状况评估指标_
<table>
<tr>
<th rowspan="2" colspan="2" valign="center">网络类型</th><th rowspan="1">质量目标</th><th colspan="2">可靠性目标</th></tr>
<tr><th>音频较差的流速率</th><th>设置失败率</th><th>丢单故障率</th></tr>
<tr><td rowspan="2"><strong>All</strong></td><td>内部</td><td>2.0%</td><td>0.5%</td><td>2.0%</td></tr>
<tr><td>整体</td><td>3.0%</td><td>1.0%</td><td>3.0%</td></tr>
<tr><td rowspan="5"><strong>会议</strong></td><td>内部</td><td>2.0%</td><td>0.5%</td><td>2.0%</td></tr>
<tr><td>有线内部</td><td>1.0%</td><td>0.5%</td><td>1.0%</td></tr>
<tr><td>Wi-fi 5 GHz 内部</td><td>1.0%</td><td>0.5%</td><td>1.0%</td></tr>
<tr><td>Wi-fi 2.4 GHz 内部</td><td>2.0%</td><td>0.5%</td><td>2.0%</td></tr>
<tr><td>整体</td><td>2.0%</td><td>0.5%</td><td>3.0%</td></tr>
<tr><td rowspan="4"><strong>对等</strong></td><td>内部</td><td>2.0%</td><td>0.5%</td><td>2.0%</td></tr>
<tr><td>有线/Wi-fi 5 GHz 内部</td><td>1.0%</td><td>0.5%</td><td>1.0%</td></tr>
<tr><td>有线/Wi-fi 5 GHz 全部</td><td>2.0%</td><td>1.0%</td><td>1.0%</td></tr>
<tr><td>整体</td><td>2.0%</td><td>1.0%</td><td>3.0%</td></tr>
</table>


讨论和定义组织的目标以满足您的业务目标非常重要。

### <a name="user-experience"></a>用户体验

分析用户体验比科学更是更多的艺术，因为此处收集的指标并不总是意味着网络或服务存在问题，而是指示用户感觉问题。 Microsoft 提供了一种内置的调查机制（称为 "我的呼叫费率" （RMC））来帮助评估整体用户体验。 RMC 将帮助你从用户的视角回答以下问题：

-   我知道如何使用该解决方案？
-   该解决方案是否易于使用和直观，并且它是否支持我的日常通讯需求？
-   该解决方案是否可帮助我完成作业？
-   对解决方案的总体理解有哪些？
-   是否可以在任何时间点使用该解决方案，无论我在哪里？
-   是否可以设置和维护呼叫？

#### <a name="rate-my-call"></a>评价我的呼叫 

费率我的通话费率（RMC）内置于团队和 Skype for business 中，并自动配置为在每10次通话中一次或10% 的参与者显示给参与者。 此简短调查要求用户对呼叫进行评级，并提供有关通话质量可能较差的小环境。 一个或两个等级被视为差，3到4是好的，5为极佳。 尽管它有些滞后指示器，但这是发现服务指标可能遗漏的问题的有用指标。

> [!Note]
> 在用户通过提供较好的反馈 RMC 调查来响应调查时，回复通常会返回 overwhelmingly 负数。 当通话质量较差时，大多数用户仅响应。 因此，即使服务指标良好，你的 RMC 报表也可能会倾斜到差的一边。

你可以使用 CQD 来报告 RMC 用户答复，并且示例报表包含在 CQD 模板中。 但是，本指南中不详细介绍它们。 有关 Skype for Business Online RMC 和指导用户提供有用的 RMC 响应的详细信息，请参阅[此博客文章](https://blogs.technet.microsoft.com/jenstr/2015/05/05/rate-my-call-in-skype-for-business-2015/)。

#### <a name="client-and-device-readiness"></a>客户端和设备准备情况

你需要一个可靠的客户端和设备策略，以帮助确保你的用户具有一致且积极的用户体验。 一些关键原则推动了每个准备策略。

##### <a name="client-readiness"></a>客户端就绪

强大的客户端准备策略可确保用户运行最新版本的客户端，同时享受最佳体验。 Microsoft 定期修补 Skype for Business 客户端;确保你的环境中的最新状态是你的整体成功的关键。 记住修补网络、视频、USB 和音频驱动程序也很重要，因为它们经常被忽视，并且可能会影响用户体验。 考虑将网络、Wlan、视频、USB 和音频驱动程序添加到你的当前修补程序管理过程。

我们建议你不要让你的客户端版本低于6个月。 如果您使用的是 Office 即点即用，则该服务已随时保持最新。 如本指南后面所述，使用随附的[客户端版本](#client-versions)来帮助您完成此过程。 您还可以利用 "我的通话" 示例报告来进一步增强您的客户准备策略。

> [!IMPORTANT]
> 当前，团队客户通过 Azure 内容交付网络自动分发和更新，并将由服务保持最新。 因此，客户准备和调查活动不适用于团队。


##### <a name="device-readiness"></a>设备准备就绪

任何一个策略都不会影响用户体验，而不仅仅是设备准备策略。 大多数组织都很乐意从用户那里删除不必要的设备（例如桌面电话或其他专用音频设备），这通常是切换到团队或 Skype for business 的核心业务理由。 但是，这些相同的组织有时也可以提供替代设备，即使这些设备成本较低。 虽然配备内置麦克风和扬声器的新式笔记本电脑和电脑没有针对企业级语音语音（VoIP）进行优化。 这通常会为所有参与者带来不好的体验，尤其是当扬声器处于噪音环境中时。 Microsoft 的设备认证计划可确保当用户通过使用针对团队或 Skype for business 认证的任何设备参与电话呼叫时，它将产生一个与非认证设备更出色的体验。 

我们始终建议团队和 Skype for business 用户在通过桌面客户端参与语音呼叫时使用已认证的耳机或扬声器。 有关 Microsoft 认证的设备的详细信息，请查看有关[认证计划](/SkypeForBusiness/certification/overview)和查看[合作伙伴解决方案目录](https://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)的这些文章。 使用本指南后面所述的 "[设备" 报告](#devices)，获取有关管理设备的帮助。


### <a name="categories-of-quality"></a>质量类别

Operationalizing 高质量和可靠部署的成功与否取决于你的构建运行严格。 尤其要特别注意下图中所示的三个类别;以下是本指南的重点：

-   **网络：** 音频质量重点针对不良流比率（PSR.EXE）指标、TCP 使用、有线和无线子网以及标识 HTTP 代理和 VPN 的使用。

-   **终结点：** 音频设备和客户端版本（仅 Skype for business）。

-   **服务管理：** 此类别包含两个部分：

    -   首先，Microsoft 有责任管理和维护团队和 Skype for business Online 服务。

    -   第二是组织必须管理的任务以确保能够可靠地访问该服务，例如，在将基础结构添加到服务中时，更新构建信息和维护新 Office 365 IP 地址的防火墙。

![组织中质量类别的图形](media/qerguide-image-categories.png "组织中的质量类别：服务管理、终结点和网络。")

_图 3-团队和 Skype for business Online 部署的关键类别_

下图介绍了每个类别必须执行的任务。 我们建议您至少每周运行一次这些任务。

第一次执行这些任务比后续迭代需要更多的工作，因为其中许多类别都要求您验证部署配置。 通过满足你定义的目标实现所需的状态后，执行这些任务将帮助你维护该状态。

<!--  This is a net new graphic, never was included in the online article. OOPS! -->
![每个质量类别的每周任务列表](media/qerguide-image-tasks.png "每个质量类别的每周任务列表")

#### <a name="service-management-tasks"></a>服务管理任务

在 cloud-first world 中，你必须执行某些服务管理任务来保持高质量的用户体验。 这些任务范围包括：确保有足够的带宽来联系服务，但没有饱和 internet 链接，验证所有托管网络区域的服务质量（QoS）是否存在，并在防火墙上的[Office 365 IP 范围](https://aka.ms/o365ips)内保持最高。

#### <a name="network-tasks"></a>网络任务

网络任务有两种类别：可靠性和质量。 可靠性侧重于衡量用户成功进行呼叫并保持连接的能力。 质量重点介绍在呼叫期间和结束后，用户客户端发送给团队和 Skype for business Online 的聚合遥测。 

由于可靠性对用户体验有重大影响，因此在深入了解质量之前开始评估和调查这些指标非常重要。 

#### <a name="endpoints-tasks"></a>终结点任务

此类别中的主要任务是验证哪些客户端版本在过去六个月内运行桌面版本的 Skype for Business，以确保用户获得对 Skype for business 桌面客户端的连续优化的好处。 此外，这简化了整体客户端管理任务，并提供了一致的用户体验。

另一个重要领域是监视哪些设备在你的部署中很流行，并推动使用已认证的设备来提供最佳用户体验。


> [!IMPORTANT]
> 当前，团队客户通过 Azure 内容交付网络自动分发和更新，并将由服务保持最新。 客户端准备情况和调查活动不适用于团队。

## <a name="cqd-basics"></a>CQD 基础知识

本部分介绍使用 CQD 的基础知识。 指南适用于以下主题：

-   什么是 CQD？
-   使用 CQD 的期望值
-   查找你的租户 ID
-   有关 Microsoft 团队和 Skype for Business 的报告
-   第一和第二分类
-   维度、度量值和筛选器
-   流与通话
-   良好、差和未分类的通话
-   常见子网

有关更深入的培训和资源，请参阅[附录](#other-resources)。

### <a name="what-is-cqd"></a>什么是 CQD？

使用呼叫质量仪表板（CQD）可深入了解使用团队和 Skype for business 服务进行的通话的质量。 CQD 旨在帮助 Skype for business 和团队管理员和网络工程师优化网络，保持密切关注的质量、可靠性和用户体验。 CQD 查看整个组织的聚合遥测，其中整体模式可能会变得显而易见，使员工能够做出明智的评估和计划补救活动以最大限度地提高影响。 CQD 提供了有助于深入了解整体质量、可靠性和用户体验的指标的报告。

本指南将帮助您了解 CQD 的核心概念，以帮助最大程度地提高用户利用团队或 Skype for business 在线体验的影响。 在[附录](#other-resources)中可以找到其他 CQD 资源。

### <a name="expectations-using-cqd"></a>使用 CQD 的期望值

CQD 虽然对分析趋势和子网很有用，但并不总是为给定方案提供特定原因。 在使用 CQD 时，了解这一点并设置正确的期望值非常重要。

-   CQD 不会为每个方案提供根本原因。
-   CQD 不能包含电话系统或音频会议流。
-   CQD 将根据趋势分析要进一步调查的区域。

### <a name="report-editions"></a>报表版本

CQD Online 中有两个报表版本： "摘要" 和 "详细信息"。 使用位于屏幕顶部的栏中的下拉菜单打开报告版本。 所选报告版本的名称将显示在屏幕顶部。

-   摘要报表是静态报表，不能对其进行编辑、下载或导出。 
-   详细报告可以完全自定义，并且可以下载到 CSV 文件、导出或克隆。

有关这两个版本之间区别的完整说明，请参阅[本文](turning-on-and-using-call-quality-dashboard.md)。

2020年1月[的新增功能：下载 CQD 的 POWER BI 查询模板](https://github.com/MicrosoftDocs/OfficeDocs-SkypeForBusiness/blob/live/Teams/downloads/CQD-Power-BI-query-templates.zip?raw=true)。 可用于分析和报告 CQD 数据的自定义 Power BI 模板。

_图 4-CQD 报表类别_

汇总报表分为四个类别：

-   **摘要报告**重点介绍通过每天、每月和表报表分析质量趋势来帮助识别质量较差的子网。 这是首次登录 CQD Online 时的默认登陆页面。
-   **位置增强的报表**重点基于位置信息分析质量趋势。 若要使用这些报表，您必须已上载了一个生成文件。
-   **可靠性报告**侧重于分析音频、视频、视频屏幕共享（VBSS）和应用共享的可靠性趋势。
-   **经验报告**是 "slimmed" 版本的详细 QER 模板，重点介绍了分析音频质量和可靠性的关键领域。

### <a name="report-types"></a>报表类型

你可以从 CQD 中的两种类型的报表中进行选择，具体取决于你希望查看数据的方式。 虽然本指南不介绍创建一种类型的报表的具体情况，但 QER CQD 模板提供了可自定义的图表和表报表的混合，供你使用：

-   图表报表创建以可视格式表示数据的图形条形图。 图表报表最适合用于在给定时间段内实现数据的可视化。
-   当您将报表导出到 CSV 文件以便在 Microsoft Excel 中进行操作时，表格报表对于查看单个度量和维度非常有用。

### <a name="tenant-id"></a>租户 ID

某些 CQD 报表要求你包含租户 ID 的筛选器。 由于 CQD 聚合数据的方式，因此包含了联合参与者遥测。 尽管在分析趋势时这一点非常有用，但客户端和设备报表要求你将数据筛选到特定租户，以排除联合参与者遥测。 如果不知道租户 ID，可以使用以下方法之一来查找它。

> [!Note]
> 这些方法需要以下权限：<ul><li>全局管理员角色</li><li>Skype for Business 管理员角色</li></ul>

#### <a name="azure-portal"></a>Azure 门户

1.  登录到 Microsoft Azure 门户：<https://portal.azure.com>

2.  选择 " **Azure Active Directory**"。

3.  在 "**管理**" 下，选择 "**属性**"。 租户 ID 显示在 "**目录 id** " 框中。

#### <a name="azure-powershell"></a>Azure PowerShell

1. [安装 Microsoft Azure PowerShell 服务管理模块](https://docs.microsoft.com/powershell/azure/servicemanagement/install-azure-ps?view=azuresmps-4.0.0)。

2. 出现提示时，打开 Azure PowerShell 命令窗口并运行以下脚本，输入 Office 365 凭据： 

   ```PowerShell
   Login-AzureRmAccount
   ```

3. 租户 ID 在输出中列出。

#### <a name="skype-for-business-online-admin-center"></a>Skype for Business Online 管理中心

1.  转到 <https://portal.office.com>。

2.  通过租户管理员组织帐户登录。

3.  选择 "**管理中心**" 下**的 "Skype for** business"。

4.  租户 ID 作为 "欢迎" 页面上的 "**组织 id** " 列出。

#### <a name="skype-for-business-online-using-powershell"></a>使用 PowerShell 的 Skype for Business Online

1. [设置适用于 Windows PowerShell 的计算机](/SkypeForBusiness/set-up-your-computer-for-windows-powershell/set-up-your-computer-for-windows-powershell)。

2. 运行以下命令：

   ```PowerShell
   (Get-cstenant).tenantid
   ```

3. 租户 ID 显示为 GUID。

### <a name="teams-vs-skype-for-business"></a>团队与 Skype for business

CQD 可以报告团队和 Skype for business 遥测。 但是，有时你可能希望开发报表以查看与 Skype for Business 分开的团队遥测。

#### <a name="summary-reports"></a>摘要报告

若要修改 "摘要报告" 页面以仅查看团队或 Skype for business，请从屏幕顶部选择 "**产品过滤器**" 下拉菜单，然后选择所需的产品。

![显示筛选选项的下拉菜单的屏幕截图](media/qerguide-image-productfilter.png)

_图 5-选择产品筛选器_

#### <a name="detailed-reports"></a>详细报告

若要筛选所有详细报表，请在浏览器栏中将以下内容追加到 URL 的末尾：

```PowerShell
/filter/[AllStreams].[Is Teams]|[FALSE]
```

**上例**

```https://cqd.lync.com/cqd/#/1234567/2018-5/filter/[AllStreams].[Is Teams]|[FALSE]```

有关 URL 筛选器的详细信息，请参阅本部分后面的[筛选报告](#filtering-reports)。

若要筛选单个详细报表，请将筛选``Is Teams``器添加到报表，并将其设置为 True 或 False。 有关详细信息，请参阅本部分后面的[编辑报告](#editing-reports)。

!["添加筛选器" 页面的屏幕截图](media/qerguide-image-addteamsfilter.png)

_图 6-向报表添加 Microsoft 团队筛选器_


### <a name="managed-vs-unmanaged-networks"></a>托管网络与非托管网络

默认情况下，CQD 中的所有终结点归为外部。 一旦引入了生成文件，我们就可以开始查看托管终结点数据。 正如前面所述，CQD 中的网络定义为：

-   _托管网络_（通常称为内部或内部）可能受组织影响和控制。 这包括内部 LAN、远程 WAN 和 VPN。
-   _非托管网络_（通常称为外部网络或外部网络）不受组织影响或控制。 非托管网络的一个示例是旅馆或机场网络。

### <a name="dimensions-measures-and-filters"></a>维度、度量值和筛选器

标准格式的 CQD 查询包含以下所有三个参数：

-   **维度：** 我希望如何对数据进行透视。

-   **度量：** 我想要报告哪些内容。

-   **筛选器：** 我希望如何减少查询返回的数据集。

另一种查看方式是，_维度_是分组函数，_度量值_是我感兴趣的数据，_筛选器_是我希望将结果缩小到与 "我的查询" 相关的结果的方式。

格式正确的查询示例**向我展示了 "子网 [维度] 的不良流 [Measure]"，用于构建 6 [Filter]**。 有关详细信息，请参阅[CQD 中可用的维度和度量](https://aka.ms/cqd-dm)。

### <a name="first-vs-second"></a>第一和第二 

CQD 中的许多维度和度量值都属于第一或第二。 CQD 不使用 "调用方/被调用方" 字段-这些字段已被重命名 _，因为调用__方和被_调用方之间有介入的步骤。 以下逻辑确定所涉及的终结点标记为 "第一个"：

-   如果在流或呼叫中涉及服务器，则**首先**将始终是服务器终结点（会议服务器、中介服务器等）。

-   **第二个**将始终是客户端终结点，除非该流位于两个服务器终结点之间。

-   如果两个终结点的类型相同，则首先选择哪一个是基于用户代理类别的内部排序。 这样可以确保排序的一致性。

有关在两个终结点相同时确定第一个或第二个终结点的详细信息，请参阅[CQD 中可用的维度和度量值](https://aka.ms/cqd-dm)。

### <a name="stream-vs-call"></a>流与调用

您需要了解通话和流之间的区别，以便正确选择要在 CQD 中查看的维度或度量值。 尽管 CQD 的主要焦点位于流上，但也可以使用基于呼叫的度量。

-   **流：**_流_存在于两个终结点之间。 每个方向只有一个流，并且需要两个流才能进行通信。 流对于调查建筑物、网络或子网很有用。 在某些情况下，将在度量的名称中使用 call 和 stream （例如，呼叫设置流或呼叫中断流）。 这些仍属于流。

-   **通话：**_通话_是来自所有参与者的所有流的分组。 通话至少包含两个流。 单个调用将至少具有两个终结点，每个终结点至少有一个流。

有关维度或度量值是指调用还是流的其他指导，请参阅[CQD 中可用的维度和度量值](https://aka.ms/cqd-dm)

### <a name="good-poor-and-unclassified-calls"></a>良好、差和未分类的通话

通话被分类为 "良好"、"差" 或 "未分类"。 让我们花一些时间来详细讨论每一种信息。

-   **好或差：** 一个很好或很差的通话包括一个调用，其中包含一组完整的服务指标，由服务生成并接收完整的 QoE 报告。 [在本指南前面部分中](#poor-stream-rate)，确定流是否正常或较差。

-   未**分类：** 未分类流不包含完整的一组服务指标。 这些调用可以是短时间，通常不会小于60秒-无法计算平均值，也不会生成 QoE 报告。 不受分类通话的最常见原因是几乎没有数据包利用率。 例如，参与者在静音中加入会议，而从不讲话。 参与者正在接收，但无法传输媒体。 如果没有传输媒体，则没有任何指标可供 CQD 用于分类终结点的出站媒体流。

有关流分类过程的详细信息，请参阅[本文](stream-classification-in-call-quality-dashboard.md)。

### <a name="common-subnets"></a>常见子网

公用子网是由旅馆、家庭网络、热点和类似区域使用的专用子网。 由于这些子网的广泛使用，因此很难进行会审。 如果你的组织使用其中一个通用子网，我们建议你将该网络移动到另一个子网。 这将使 CQD 中的报告更轻松。 记下时，"所有网络" 模板中的报表已配置为排除这些子网，以将它们排除为质量较差的源。 常用子网定义如下。其影响将因组织而异。

-   10.0.0.0/24
-   192.168.0.0/24
-   192.168.1.0/24
-   192.168.2.0/24
-   172.20.10.0/24
-   192.168.43.0/24

在调查使用公共子网的托管网络时，需要使用第二个反身本地 IP 维度来对子网进行分组。 此维度包含终结点的公共 IP 地址。

## <a name="cqd-online"></a>CQD Online

本部分介绍了访问 CQD 的基础知识。 指南适用于以下主题：

-   联机访问 CQD
-   CQD 入门
-   在 CQD 中编辑报表
-   在 CQD 中筛选报表
-   在 CQD 中导入报表

有关更深入的培训和资源，请参阅[附录](#other-resources)。

### <a name="access-cqd-online"></a>联机访问 CQD

您可以通过以下三种方式之一访问 CQD：

-   转到 <https://cqd.lync.com>。

-   转到 " **Microsoft 团队管理中心**" 并选择指向 CQD 的链接，如下图所示。

![选中的通话质量仪表板的屏幕截图。](media/qerguide-image-mopo.png "在左侧导航窗格中，选择 "链接到呼叫质量" 仪表板。")

_图 7-通过 Microsoft 团队管理中心访问 CQD_

-   转到旧版**Skype for business 管理中心** > **工具**，然后选择指向 CQD 的链接，如下图所示。

![主窗格中选定的 CQD 的屏幕截图。](media/qerguide-image-legacyui.png "将在左侧导航窗格中选择 "工具"，然后在主窗格中选择 "指向 CQD 的链接"。")

_图 8-通过 Skype for Business 管理中心访问 CQD_


### <a name="getting-started"></a>入门

第一次浏览到 CQD 时，你将看到 "摘要报告" 页面。 本指南中介绍的大部分报告都是自定义详细报告。 若要开始使用详细报表，请选择页面顶部的 "**摘要报表**"，然后选择 "**详细报表**"。

![显示 CQD 中可用的报表类型的屏幕截图](media/qerguide-image-choosereports.png)

_图 9-导航到详细报告_

CQD 中的 "详细报告" 页面类似于下图。

![演示构成详细报表的元素的屏幕截图](media/qerguide-image-detailedreportspage.png)

|             |           |
| ------------|-----------|
| ![数字1的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout1.png "下列") | "摘要" 窗格显示右侧显示的报告集的上下文。 |
| ![数字2的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout2.png "双") | 可以在摘要窗格中选择 "**编辑**" 以设置报表级别的属性（包括 y 轴高度）和导入新模板。 |
| ![数字3的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout3.png "三个") | 痕迹导航可帮助用户识别其当前在报表集层次结构中的位置。 |
| ![数字4的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout4.png "共有") | 具有子报表的报表显示为蓝色链接。 通过选择链接，您可以向下钻取到子报表。 |

_图 10-"详细报告" 页面_

指向报表中的 "条形图" 和 "趋势线" 以显示详细值。 具有焦点的报表将显示 "操作" 菜单： "**编辑**"、"**复制**"、"**删除**"、"**下载**" 和 "**导出" 报表树**。

### <a name="editing-reports"></a>编辑报表

当您在报表的 "操作" 菜单上选择 "**编辑**" 时，将打开 "查询编辑器"。 每个报表都由 CQD 的查询支持。 报告是其查询返回的数据的可视化形式。 查询编辑器是除了报表的显示选项之外，还可用于编辑这些查询的 UI，如下图所示。

![显示组成正在编辑的报表的元素的屏幕截图。](media/qerguide-image-queryeditor.png)

|             |           |
| ------------|-----------|
| ![数字1的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout1.png "下列") | 从左窗格中选择维度、度量值和筛选器。 指向现有值将显示 "关闭" 按钮（**X**），您可以选择删除该值。<ul><li>通过选择维度或度量值，可以通过编辑 "**标题**" 字段来更改标题。 您也可以通过选择顶部窗格中的蓝色向上或向下箭头来更改顺序。</li><li>选择标题**+** 旁边的 "（"）将打开用于添加新维度、度量值或筛选器的对话框。</li><li>在 "**查找**字段" 中输入维度、度量值或筛选器的前几个字母以筛选列表，以便更轻松地进行搜索。</li></ul> |
| ![数字2的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout2.png "双") | 顶部窗格显示图表自定义的选项。 |
| ![数字3的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout3.png "三个") | 查询编辑器显示报表的预览。 |
| ![数字4的图标，引用上一个屏幕截图中的标注](media/qerguide-image-callout4.png "共有") | 使用屏幕底部的**编辑**框创建或编辑报表的详细说明。 |

_图 11-查询编辑器_

### <a name="filtering-reports"></a>筛选报表

所提供的模板包括几个内置查询和报表筛选器。 以下部分介绍了在整个模板中使用的最常见的筛选器。

#### <a name="url-filter"></a>URL 筛选器

可以使用 URL 筛选器筛选特定维度的每个报表。 最常见的 URL 筛选器用于筛选报表以排除联合参与者遥测，或专注于团队或 Skype for business Online。 我们建议在使用筛选器时，为其添加书签以方便参考。 

当修正托管建筑物或网络（其中联合终结点可能会影响你的报表）时，从 CQD 报告中排除联合数据将非常有用。

若要实现 URL 筛选器，请在浏览器地址栏中将以下内容追加到 URL 的末尾：

```PowerShell
/filter/[AllStreams].[Second Tenant Id]\|[YOUR TENANT ID HERE]
```

上例  

```https://cqd.lync.com/cqd/#/1234567/2018-08/filter/[AllStreams].[Second Tenant Id]|[TENANTID]```

若要筛选团队或 Skype for business 的报表，请将以下内容附加到 URL 的末尾：

```PowerShell
/filter/[AllStreams].[Is Teams]|[TRUE | FALSE]
```

上例

```https://cqd.lync.com/cqd/#/1234567/2018-08/filter/[AllStreams].[Is Teams]|[TRUE]```


> [!NOTE]
> 上面的 URL 示例仅适用于视觉表示形式。 请使用的默认 CQD 链接<https://cqd.lync.com>。


#### <a name="query-filters"></a>查询筛选器

查询筛选器通过在 CQD 中使用查询编辑器实现。 这些筛选器用于减少 CQD 返回的记录数，从而最大程度减少报表的总体大小和查询时间。 这对于筛选出非托管网络尤其有用。 下表中列出的筛选器使用正则表达式（RegEx）。

_表 3-查询筛选器_

| 筛选器         | 说明          | CQD 查询筛选器示例      |
|----------------|----------------------|-------------------------------|
| 无空值   | 某些筛选器没有用于筛选空值的选项。 若要手动筛选空值，请使用空白表达式，并将筛选器设置为等于或不等于，具体取决于你的需求。      | 第二建筑物\< \> \^ \\名称 s\*\$                       |
| 排除公共子网 | 如果没有有效的生成文件以从非托管网络单独托管，则报告中将包含家庭网络。 这些主子网位于其控制范围之外，可以从报表中快速排除。 本指南中定义的常用子网是10.0.0.0、192.168.1.0 和192.168.0.0。 | 第二\< \>子\|网\| 10.0.0.0 192.168.0.0 192.168.1。0 |
| 仅限内部查看  | 用于筛选托管（内部）或非托管（外部）的报表。 托管 CQD 模板已预配置了这些筛选器。       | 第二内部公司内部公司 = 内部        |

#### <a name="report-filters"></a>报表筛选器

报表筛选器通过在 "查询编辑器" 或直接添加到报表中向呈现的报表添加筛选器来实现。 在整个模板中使用以下报表筛选器。

_表 4-报表筛选器_

| 筛选器     | 说明                            | CQD 报表筛选器示例         |
|------------|----------------------------------------|-----------------------------------|
| Month      | 首先从年开始，然后是 "月"。 | 2017-10                           |
| 字母 | 筛选任何字母字符。 | [a-z]                             |
| 整数    | 筛选任何数字字符。    | [0-9]                             |
| 百分比 | 按百分比筛选。              | （[3-9]\\。）\|（[3-9]）\|（[1-9] [0-9]） |

## <a name="import-the-cqd-templates"></a>导入 CQD 模板

本指南包含[两个特选 CQD 模板](https://aka.ms/qertemplates)。 这些模板提高了 CQD 的使用，并为您提供了快速利用 CQD 功能来对用户的团队或 Skype for business 体验产生影响的机会。 "所有网络" 模板（虽然已优化为使用生成数据文件）可用于在 CQD 中收集和上载构建信息，如下一节中所述。

**若要导入模板（。CQDX）进入 CQD Online**

1. 转到 <https://cqd.lync.com>。

2. 使用 Office 365 管理凭据进行身份验证。

   > [!NOTE]
   > 您必须拥有 Office 365 全局管理员、Skype for business 管理员或报表读者角色才能访问 CQD。 

3. 选择页面顶部的 "**摘要报告**" 菜单，然后选择 "**详细报告**"。

4. 在 "摘要" 窗格中，选择 "**导入**"。 转到 CQDX 保存的位置，选择 CQDX 模板，然后选择 "**打开**"。

5. 上载模板后，将显示一个弹出窗口，显示 "报表导入成功" 消息。 选择 **"确定"。**

   ![成功导入通知的屏幕截图](media/qerguide-image-importmessage.png "已成功导入模板的通知")

6. 对第二个 CQD 模板重复步骤4和步骤5。

> [!NOTE]
> CQD 模板按用户导入。 如果其他用户需要使用该报表，他们必须登录并将模板导入其 CQD 实例。 


## <a name="building-mapping"></a>构建映射

在团队或 Skype for business Online 部署中，所有客户端都是外部客户端。 也就是说，默认情况下，所有客户端都在 CQD Online 中报告为外部，无论客户端是否连接到内部公司网络。

在使用 CQD 时，你需要知道终结点的位置以及它是否已连接到你可以管理的网络或无法管理的网络（假定你只能改进可管理的网络）。 通过将子网和生成信息上载到 CQD Online，你可以启用 CQD 以确定终结点是否已连接到内部公司/托管网络或外部/非托管网络。

### <a name="building-data-file-structure"></a>构建数据文件结构

你上载的数据文件的格式必须满足以下要求才能在上载之前通过验证检查。

-   文件必须是 TSV 文件，这意味着对于每一行，每一列都由制表符分隔，或 CSV 文件，其中每列由逗号分隔。

-   文件不能大于 50 MB。

-   数据文件的内容*不能包含表格标题*。 换句话说，数据文件的第一行必须是实际数据，而不是列标题（如 "Network"）。

-   对于每个列，数据类型只能是 String、Number 或 Bool。 如果数据类型为 "数字"，则值必须为数值;如果是 Bool，则该值必须是0或1。

-   对于每一列，如果数据类型为 String，则数据可以为空（但必须用适当的分隔符（即制表符或逗号）分隔。 这只是将该字段分配为空字符串值。

-   每一行必须有14列。 每列必须具有下表中所述的数据类型，并且列必须按照表中列出的顺序排列。

_表 5-构建文件结构_

| 列名称        | 数据类型 | 示例                   | 指引    |
|--------------------|-----------|---------------------------|-------------|
| 网络            | String    | 192.168.1.0               | 必需    |
| NetworkName        | String    | 美国/西雅图/西雅图-海-1 | 必需\*  |
| NetworkRange       | 数字    | 个                        | 必需    |
| BuildingName       | String    | 西雅图-海-1             | 必需\*  |
| OwnershipType      | String    | 制定                   | 可选    |
| BuildingType       | String    | 终止            | 可选    |
| BuildingOfficeType | String    | 技术               | 可选    |
| 城市               | String    | 西雅图                   | 推荐 |
| ZipCode            | String    | 98001                     | 推荐 |
| 该国            | String    | 我们                        | 推荐 |
| 省/市/自治区              | String    | WA                        | 推荐 |
| 区域             | String    | MSUS                      | 推荐 |
| InsideCorp         | Bool      | 1                         | 必需    |
| ExpressRoute       | Bool      | 0                         | 必需    |

\*虽然 CQD 不是必需的，但模板配置为显示建筑物和网络名称。

#### <a name="supernetting"></a>Supernetting

你可以使用 supernetting （通常称为无类别的域间路由（CIDR））来代替定义每个子网。 *Supernet*是共享单个路由前缀的若干子网的组合。 你可以使用 supernetted 地址，而不是为每个子网添加条目。 支持 Supernetting，但我们不建议使用它。

例如，Contoso 的市场营销大楼由以下子网组成：

-   10.1.0.0/24-第一层
-   10.1.1.0/24-第二层
-   10.1.2.0/24-第三个楼层
-   10.1.3.0/24-第四个楼层

你可以使用 supernetted 地址（在本例中为 10.1.0.0/22），而不是为每个子网添加条目。

-   Network = 10.1.0。0
-   网络范围 = 22

在实现 supernetting 之前，需要考虑以下几点：

-   Supernetting 只能在具有8位到28位掩码的子网映射中使用。

-   Supernetting 花费的时间更少，但它以减少数据丰富的成本为代价。 假设存在涉及子网200.1.2.0 的质量问题。 如果你已实现 supernetting，你将不知道子网所在的位置或网络的类型（例如，实验）。 如果您已为建筑物和上传的地板位置信息定义了所有子网，您将能够看到这种区别。

-   请务必确保 supernetted 地址正确，并且不会捕获不需要的子网。

-   在数据中查找192.168.0.0 非常常见。 对于许多组织，这表示用户在家中。 对于其他人，这是卫星办公室的 IP 地址方案。 如果你的组织具有使用此配置的办事处，则不要将其包含在你的构建文件中，因为很难通过使用公共子网来区分家庭网络和内部网络。 请参阅本指南前面部分的有关[公用子网](#common-subnets)的部分。

> [!IMPORTANT]
> 网络范围可用于表示 supernet。 将检查所有新生成数据文件上是否有任何重叠区域。 如果你以前上载了一个生成文件，你应该下载当前文件并再次上载它以识别任何重叠并解决问题。 以前上载的文件中的任何重叠都可能会导致向报表中的建筑物进行错误的子网映射。

#### <a name="vpn"></a>VPN

客户端发送到 Office 365 的体验质量（QoE）数据（CQD 数据来源的位置）包括 VPN 标志。 CQD 将看到这是第一个 VPN 和第二个 VPN 维度。 但是，此标志依赖于 VPN 供应商向 Windows 报告，VPN 网络适配器已注册为远程访问适配器。 并非所有 VPN 供应商都正确注册远程访问适配器。 因此，你可能无法使用内置的 VPN 查询筛选器。 可通过两种方法在构建信息文件中容纳 VPN 子网：

- 使用 VPN 子网的此字段中的文本 "VPN" 定义**网络名称**。

  ![显示使用网络名称的 VPN 的 QCD 报告屏幕截图](media/qerguide-image-vpnnetworkname.png)

  _图 12-使用网络名称的 VPN_

- 使用 VPN 子网的此字段中的文本 "VPN" 定义**建筑物名称**。

  ![显示使用建筑物名称的 VPN 的 QCD 报告屏幕截图](media/qerguide-image-vpnbuildingname.png)

  _图 13-使用建筑物名称的 VPN_

> [!IMPORTANT]
> 某些 VPN 实现不会准确报告子网信息。 如果你的报告中出现这种情况，我们建议在将 vpn 子网添加到构建文件时，将 VPN 子网中每个地址的单独条目添加为单独的32位网络，而不是子网的一个条目。 每一行可以有相同的建筑物元数据。 例如，对于 172.16.18.0/24，而不是一行，您有253行，每个地址对应于从 172.16.18.1/32 到 172.16.18.254/32 的每个地址，包括一行。


> [!NOTE]
> 当基础互联网连接为无线时，misidentify 将网络连接称为有线的 VPN 连接。 在通过 VPN 连接查看高质量时，无法假定已准确识别连接类型。

### <a name="uploading-building-information"></a>上载建筑物信息

CQD 摘要报告仪表板包括**租户数据上载**页面，该页面通过选择右上角中的**租户数据上载**链接标记进行访问（查找齿轮图标）。 此页面用于管理员上载其自己的信息，例如 IP 地址和地理信息的映射、映射每个无线访问点及其 MAC 地址等。

1. 通过浏览转到 CQD Online <https://cqd.lync.com>。

2. 选择右上角的齿轮图标，然后从 "**摘要报告**" 页面中选择 "**租户数据上载**"。

   ![在上载数据时出现的对话框的屏幕截图](media/qerguide-image-tenantdataupload.png)

   _图 14-租户数据上载菜单_

3. 或者，如果你首次访问 CQD，系统将要求你上载数据。 你可以选择 "**立即上载**" 以快速导航到**租户数据上载**页面。

   ![通知用户上载生成数据的横幅的屏幕截图](media/qerguide-image-buildingdatauploadbanner.png)

   _图 15-构建数据上载横幅_

4. 在 "**租户数据上载**" 页面上，选择 "**浏览**" 以选择数据文件。

5. 选择数据文件后，指定 "**开始日期**"，（可选）指定结束日期。

6. 选择 "**开始日期**" 后，选择 "**上传**" 将文件上传到 CQD。 <br><br>在上载文件之前，它将经过验证。 如果验证失败，则会显示一条错误消息，要求你更正该文件。 下图显示了当数据文件中的列数不正确时出现的错误。

   ![显示生成数据上载错误的对话框示例](media/qerguide-image-buildingdatauploaderror.png)
 
   _图 16-生成数据上载错误_

7. 如果验证期间没有出现错误，文件上载将成功。 然后，你可以在 "我的上**传**" 表中看到上载的数据文件，其中显示了当前租户在该页面底部的所有上载文件的完整列表。

> [!NOTE]
> 最多可能需要四个小时才能完成处理生成文件。 <br><br> 如果你已经上载了一个生成文件，但需要添加可能已错过或排除的子网，请通过添加新的子网、删除当前文件并重新上载新编辑的文件来修改原始文件。 CQD 中只能有一个活动的构建数据文件。 


### <a name="updating-a-building-file"></a>更新生成文件

在收集生成和子网信息时，管理员通常会在一段时间内将生成文件上载到多个迭代中，并在新子网可用时添加新的子网和生成信息。 出现这种情况时，你需要重新上载你的构建文件。 此过程类似于上一节中所述的初始上载，还有一些例外，如下部分所述。

> [!Important]
> 一次只能有一个生成文件处于活动状态。 多个生成文件不具有累积性。

#### <a name="adding-net-new-subnets"></a>添加全新的子网

有时，你需要将新的子网添加到 CQD 中的子网，而不是你的网络拓扑的一部分。 若要添加全新的子网，请在 CQD 租户数据上载门户中执行以下操作：

1.  编辑原始构建文件，并提供在获取网络新子网之前至少一天出现的结束日期。
2.  如果尚未有最新的副本，请下载原始文件。
3.  将新的全新子网附加到原始生成文件。
4.  按照上述相同过程上载新修改的生成文件，并将开始日期设置为上一个生成文件结束后的一天。

#### <a name="updating-the-current-building-file"></a>更新当前构建文件

如果生成文件已上载，但需要添加缺少的子网，请在 CQD 租户数据上载门户中执行以下操作：

1.  如果尚未有最新的副本，请下载原始文件。
2.  删除 CQD 中的当前文件。
3.  将新子网追加到原始文件。
4.  上载构建文件。 请务必先将开始日期设置为至少八个月，这样 CQD 将处理历史记录数据。

### <a name="missing-subnets"></a>缺少子网

在上载托管网络的生成信息后，每个托管网络都应具有一个建筑物关联。 但是，这并不总是这样。通常，缺少几个子网。 本部分介绍如何验证缺少的网络。

浏览到 CQD Online 中的**详细报告**页面，并导航到 CQD 模板中包含的**缺失子网报告**。 这将显示包含10个或更多音频流的所有子网，这些流在建筑物数据文件中未定义且标记为外部。 确保此列表中没有托管网络。 如果缺少子网，请更新原始生成数据文件，然后将其重新上载到 CQD。

> [!IMPORTANT]
> 你需要将租户 ID 作为**第二租户 id**的查询筛选器添加到此报表，以筛选报表以仅查看你的组织的租户数据。 否则，报表将显示联合子网。

> [!NOTE] 
> 请确保将 "月" 报表筛选器调整为当前月份。 选择 "**编辑**"，然后调整 "**月**" 报表筛选器以保存新的默认月份。

![显示缺少子网报表的屏幕截图](media/qerguide-image-missingbuildingreport.png)

_图 17-缺少生成报告_

### <a name="building-mapping-tools"></a>构建地图工具

让我们面对 it，可能很难在你的组织中映射子网。 较大的全局网络非常复杂，有不同的团队管理各自的区域，并且网络拓扑可能没有单一来源。 有两个工具可用于帮助开始建筑物映射练习，如以下部分所述。

#### <a name="cqd-tools"></a>CQD 工具

这些工具基于 PowerShell，并且可以利用 Active Directory （AD）站点和服务以及 Microsoft DHCP 服务来帮助预填充你的构建文件。  这些工具将帮助你执行以下任务：

1.  查询广告网站和服务，并基于其中包含的信息创建构建文件。
2.  查询 Microsoft DHCP 服务器或服务器以提取子网信息并自动创建构建文件。
3.  验证现有生成文件、检查重复项和重叠。
4.  在 CQD 中查找未映射的子网。

有关此工具的详细信息，请参阅[此博客文章](https://aka.ms/cqdtools)。

#### <a name="network-planner"></a>Network Planner

网络规划器只需几个简单的步骤即可确定和组织你的云语音部署的网络要求。 通过提供你的组织的网络详细信息和云语音使用，你可以大致计算云语音部署的网络要求、管理和导出这些详细信息以进行报告，以及查看要进一步调查的区域和后续步骤。

虽然网络规划器不会完全自动自动生成映射过程，但在将网络信息输入网络 Planner 后，可以将其导出到准备上载的构建文件。

## <a name="reliability-investigations"></a>可靠性调查

提高质量的第一步是评估整个组织的可靠性状态。 由于可靠性对于积极的用户体验至关重要，因此我们从衡量可靠性的两个组件开始：

1.  **设置失败：** 无法建立通话。

2.  **删除失败：** 通话已建立且意外终止。

在本部分中，我们将介绍用于调查两个区域的方法。

> [!NOTE]
> 本指南不介绍这些模板中包含的所有报表。  但是，下面介绍的调查方法仍适用。 有关详细信息，请参阅各个报告说明。


### <a name="setup-failures"></a>设置失败

首先优先考虑此区域中的修正设置失败，因为这些失败会对用户体验产生严重的负面影响。

通过评估组织的整体设置故障百分比来开始调查，然后根据构建或网络的最高百分比确定调查范围。 

#### <a name="setup-failure-trend-analysis"></a>设置故障趋势分析

此报告显示流、流设置失败和流设置失败率的总数量。 指向任意一个列以显示其单个值，如下图所示。 

![显示流设置失败百分比的图表](media/qerguide-image-streamsetupfailures.png)

_图 19-音频可靠性流设置失败_

##### <a name="analysis"></a>定量分析

通过使用此报表，你可以回答以下问题并确定下一个操作过程：

-   当前月份的通话设置总失败百分比是多少？

-   是否已定义的目标度量值低于或高于其总呼叫设置失败百分比？

-   故障趋势是否比上个月更糟或更好？

-   故障趋势是增长、稳定还是降低？

无论以前的答案如何，都可以通过使用辅助子报表查找可能需要修正的任何单个建筑物或子网来进一步调查。 尽管整体失败率可能低于目标度量值，但一个或多个建筑物或网络的故障率可能高于目标指标，需要调查。

#### <a name="setup-failure-investigations"></a>设置失败调查 

此摘要报告用于发现和隔离任何可能需要补救的建筑物或网络。

> [!NOTE]
> 请确保将 "月" 报表筛选器调整为当前月份。 选择 "**编辑**"，然后调整 "**月**" 报表筛选器以保存新的默认月份。


![显示设置失败的屏幕截图](media/qerguide-image-setupfailuresbysubnet.png)

_图 20-子网的音频设置故障_

##### <a name="remediation"></a>修正 

专注于具有最大故障量的建筑物或子网上的第一项补救措施。 这将最大程度地提高用户体验的影响，并有助于快速降低组织呼叫设置失败的速率。 下表列出了由 CQD 报告的安装失败的两个原因。

_表 7-呼叫设置失败的原因_

| 呼叫设置失败原因       | 典型原因                    |
|----------------------------------|----------------------------------|
| 缺少固件深层数据包检查例外规则 | 指示由于深入的数据包检查规则，沿路径的网络设备阻止媒体路径被建立。 这可能是因为没有正确配置防火墙规则。 在此方案中，TCP 握手成功，但 SSL 握手未成功。      |
| 缺少 FW IP 阻止例外规则      | 指示路径上的网络设备阻止将媒体路径建立到 Office 365 网络。 这可能是因为未正确配置代理或防火墙规则，以便允许访问用于团队和 Skype for business 流量的 IP 地址和端口。 |

开始补救后，您可以将精力集中在特定建筑物或子网上。 如上表所示，这些问题是由于防火墙或代理配置导致的。 查看下表中的选项以获取更正操作。

_表 8-通话设置失败修正的后续步骤_


|      修正      |                                                                                                                                                                                                                                                                                                                                                                   指引                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 配置防火墙 | 与您的网络团队协作，并针对[Office 365 IP 地址列表](https://aka.ms/o365ips)验证您的防火墙配置。<br><br>验证防火墙规则中是否包含[媒体子网](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2#bkmk_teams)和端口。 <br><br>验证是否在防火墙中打开了必要的端口（如下所示）。 UDP 应具有优先权，因为 TCP 被视为音频、视频和基于视频的屏幕共享的故障回复协议，其使用将影响呼叫的质量。 旧版 RDP 应用程序共享仅使用 TCP。<br><ul><li>**TCP：** 端口443</li><li>**UDP：** 端口 3478-3481</li><ul> |
|        验证         |                                                                                                                                                                                                                                                                 使用 " [Microsoft 网络评估" 工具](https://www.microsoft.com/download/details.aspx?id=53885)验证受影响的建筑物或子网的连接，方法是使用连接检查功能。                                                                                                                                                                                                                                                                  |

### <a name="drop-failures"></a>删除失败

与设置失败代码不同，CDQ 没有放置故障代码来指示为何出现放置失败，这使隔离特定的根本原因变得困难。 若要更好地会审删除失败，请使用推断方法。 通过修正媒体的任何感兴趣的区域、修补客户端和驱动程序，并推动团队和 Skype for business 的认证设备的使用，您可能需要拒绝丢单。

#### <a name="drop-failure-trend-analysis"></a>丢放故障趋势分析

此报告显示音频流、总丢单故障和下拉失败率的总数量。 指向任意一列以显示其值，如下图所示。 

![显示已丢弃的流的百分比的图表](media/qerguide-image-droppedstreamrate.png)

_图 21-丢弃的流速率_

##### <a name="analysis"></a>定量分析

通过使用此类报表，您可以回答以下问题：

-   目前的击落故障率是多少？
-   丢单故障率是否低于定义的目标度量值？
-   故障趋势是否比上个月更糟或更好？
-   故障趋势是增长、稳定还是降低？

无论上述问题的答案如何，都要花些时间研究一下使用子报表查找任何可能需要补救的建筑物或网络。 尽管整体放置故障率可能低于目标度量值，但一个或多个建筑物或网络的击落失败率可能高于目标指标，需要调查。

#### <a name="drop-failure-investigations"></a>删除失败调查

此处报告的故障表示呼叫被意外丢弃，并产生消极的用户体验。 与趋势报告不同，这些报告提供了对需要进一步调查的特定子网的进一步见解。

> [!NOTE]
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。


![列出放置失败的次数和百分比的报表](media/qerguide-image-dropfailuresbysubnet.png)

_图22–通过子网丢弃故障_

##### <a name="remediation"></a>修正

使用包含的表格报告，可以隔离网络中放置费率超过您定义的目标指标的问题区域。 将您的第一项补救措施集中在具有最高总流计数的建筑物或子网上，以获得最大的影响。

通话删除的常见原因：

-   预配网络或 internet 出口
-   未在受限制的网络上配置 QoS
-   较旧的客户端版本
-   用户行为

发现你的问题区域后，你可以使用[调用分析](https://techcommunity.microsoft.com/t5/Skype-for-Business-Blog/Introducing-Call-Analytics/ba-p/57309)进一步查看该构建中特定问题的用户。 调用分析包含其他 PII 数据，并且对于进一步隔离放置失败的潜在原因非常有用。

无论您的下一步如何，都是将已发现特定建筑物或子网的问题通知帮助台的好做法。 通过这种方式，他们可以快速响应传入的呼叫并更高效地会审用户。 然后，可向工程团队报告已标记的用户，以便进一步调查。

下表列出了管理和修正丢弃故障的一些常用方法。

_表 9-通话丢弃补救措施的后续步骤_

| 修正                              | 指引                      |
|------------------------------------------|-------------------------------|
| **网络/互联网**                         | **拥塞**：与你的网络团队协作以监控特定建筑物/子网的带宽，以确认是否存在使用过度的问题。 如果你确认存在网络拥塞，请考虑增加生成或应用 QoS 的带宽。 使用 "包含[质量较差的流摘要" 报表](#quality-investigations)查看问题子网中是否存在抖动、延迟和数据包丢失问题，因为它们通常位于放置的流之前。<br><br>**QoS**：如果增加的带宽不切实际或成本不受制约，请考虑实施 QoS。 此工具在管理拥塞的流量时非常有效，可确保托管网络上的媒体数据包优先于非媒体流量。 或者，如果没有明确的证据表明带宽是有原因的，请考虑以下解决方案：<ul><li>[Microsoft 团队 QoS 指南](qos-in-teams.md)</li></ul><br>**执行网络准备情况评估**：网络评估提供有关预期带宽使用情况的详细信息，以及如何处理带宽和网络更改，以及团队和 Skype for business 的推荐联网做法。 将上一个表用作源，您有一个建筑物或子网的列表，它非常适合于评估。<ul><li>[Microsoft 团队网络准备情况评估](3-envision-evaluate-my-environment.md#test-the-network)</li></ul><br>**Microsoft 网络评估工具：** 使用此工具可对网络性能进行简单的测试，以确定网络对于团队或 Skype for business Online 呼叫的性能。 该工具可帮助你评估子网的性能，并根据 Microsoft 性能[要求](https://aka.ms/performancerequirements)验证网络的准备情况。<ul><li>[下载网络评估工具](https://www.microsoft.com/download/details.aspx?id=53885)</li></ul> |
| **客户端（仅限 Skype for Business Online）** | 某些较旧的客户端存在媒体可靠性的已知、已记录的问题。 查看来自多个受影响用户的呼叫分析报告，或在 CQD 中创建自定义客户端版本表报表，筛选到具有总呼叫中断故障百分比的特定建筑物或子网。 此信息将帮助你了解该特定建筑物和特定版本的客户端之间的通话中断之间是否存在关系。     |
| **Devices**                                  | 我们建议，任何有呼叫中断的用户（一般情况下，使用集成设备）都应预配[经认证的耳机或免提电话](https://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)，以将其排除在质量和可靠性较差的潜在来源。 |
| **用户行为**                            | 如果你确定不是网络、设备或客户端出现问题，请考虑制定用户采用策略来教育用户如何最大程度地加入和退出会议。 更智能的团队和 Skype for business 用户将为会议中的所有参与者提供更好的用户体验。 将笔记本电脑置于睡眠状态（通过关闭盖子）而不退出会议的用户将被归类为意外的呼叫丢弃。   |

## <a name="quality-investigations"></a>质量调查

在整个组织中评估音频质量状态的下一步是调查不良流速率（PSR.EXE）、TCP 和代理使用情况。 请务必记住，CQD 数据不会为你提供特定的根本原因，而是向你提供可能的问题区域，以便开始与适用于补救活动的相应团队进行协作对话。 

> [!NOTE]
> 本指南不介绍这些模板中包含的所有报表;但是，下面介绍的调查方法仍适用于这些报表。 有关详细信息，请参阅各个报告说明。 

### <a name="quality"></a>画质

PSR.EXE 百分比用于指示组织是否为给定焦点区域的会议定义指标目标。 请务必注意，即使高级别的百分比位于定义的目标中，单个子网或建筑物可能不满足定义的目标，因此需要进一步调查。 例如，如果整个音频 PSR.EXE 百分比是四月的2% （满足示例目标），则单个建筑物和子网可能仍然具有很差的体验，具体取决于该2百分比的整体分布。 

若要评估不良流的百分比，请使用质量报告。 提供了各种质量报告来查看整体、会议、两方、PSTN 呼叫、VPN 和会议室的指标。 提供每月、每周和每日报表以帮助完成此过程。 每周和每日报表仅限于托管网络模板以提高其有效性并减少噪音。 

#### <a name="quality-trend-analysis"></a>质量趋势分析

趋势报表显示一段时间内的质量信息，用于帮助识别和了解每个感兴趣领域的质量趋势。 如上所述，模板中包含用于调查质量的报表树;会议、两方、PSTN 呼叫、VPN 和会议室。 出于分析质量的目的，调查过程是相同的。 但是，我们建议你首先从会议开始，因为对会议质量的任何改进也会对所有其他方面产生积极影响。 

> [!Note]
> 调查两方、PSTN 呼叫和会议室与调查会议类似。 重点是 isloate 的建筑物或子网，其质量最差，并确定质量较差的原因。

> [!Important]
> 基于 VPN 的报表使用第二个 VPN 维度进行筛选。 此维度要求 VPN 网络适配器正确注册为远程访问适配器。 VPN 供应商不可靠地使用此标志，你的里程将根据你的组织中部署的 VPN 供应商而有所不同。 如果需要，请按照[本指南前面](#vpn)概述的指南使用建筑物或网络名称修改 VPN 报告。

![显示质量较差的流的百分比的图表](media/qerguide-image-audioqualityconferencing.png)

_图 23-音频质量-会议_

##### <a name="investigation"></a>调查

通过使用这些报表，您可以回答以下问题：

-   当前月份的总 PSR.EXE 是多少？
-   PSR.EXE 是否低于定义的目标度量？
-   PSR.EXE 比上个月更糟还是更好？
-   PSR.EXE 趋势是增加、稳定还是减少？

无论上述问题的答案如何，都可以通过使用子报表查找任何可能需要调查的建筑物或子网来进行调查。 尽管整体 PSR.EXE 可能位于目标度量的下方，但一个或多个建筑物或网络的 PSR.EXE 通常位于指标中，并且需要补救措施。

#### <a name="quality-investigations"></a>质量调查

质量摘要报告让你更深入地了解将其分类为差的流，并有助于隔离托管网络中的问题区域。

虽然使用的维度可能在报表之间稍有不同，但每个报表将包括用于流总数的度量值、总不良流、PSR.EXE 和因的质量较差。 已为每个感兴趣的领域创建报表：会议、双方、PSTN 呼叫、VPN 和会议室。 托管网络模板包含可利用通过生成文件上载的位置信息的其他报表。

> [!NOTE]
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。

> [!Note]
> 由于公共子网的广泛使用，因此很难进行会审。 显示客户的公共 IP （第二个自身本地 IP）的单独报告已添加到 "所有网络" 模板，以帮助使用常见网络的补救机构。


![显示较差音频流摘要的屏幕截图](media/qerguide-image-poorqualitysummary.png)

_图 24-通过构建和子网会议进行不良音频流摘要_

##### <a name="remediation"></a>修正

将您的补救措施集中在具有最大流量的建筑物或子网上，因为这样可以最大程度地提高影响，并有助于快速改进用户体验。 使用 "抖动"、"数据包丢失" 和 "往返时间（RTT）" 度量来了解对质量不佳的影响（可能存在多个问题）：

-   **抖动**：媒体数据包以不同的速度到达，从而导致扬声器发声机器人。
-   **数据包丢失**：丢弃媒体数据包，这会产生缺少单词或音节的效果。
-   **RTT**：媒体数据包需要很长时间才能访问其目标，从而创建 walkie talkie 效果。

为帮助您调查质量问题，您可以利用[呼叫分析](https://techcommunity.microsoft.com/t5/Skype-for-Business-Blog/Introducing-Call-Analytics/ba-p/57309)。 使用呼叫分析，您可以查看特定的会议或用户的详细呼叫报告。 此报表将包含 PII 数据，在查找失败原因时很有用。 知道哪个生成受到影响后，在该建筑物中跟踪用户应该十分简单。 

不要忘记让帮助台知道这些网络遇到质量问题，因此他们可以快速对传入呼叫进行分类和响应。

_表 10-高 PSR.EXE 的常见参与者_

| 修正                              | 指引                         |
|------------------------------------------|----------------------------------|
| **网络**                                 | **拥塞**：过度使用或未预配的网络可能会导致媒体质量问题。 与网络团队协作，确定从用户到 internet 传出点的网络连接是否有足够的带宽来支持媒体。 <br><br>**执行网络准备情况评估**：网络评估提供有关预期带宽使用情况的详细信息，以及如何处理带宽和网络更改，以及团队和 Skype for business 的推荐联网做法。 将上一个表用作源，您有一个建筑物或子网的列表，它非常适合于评估。<ul><li>[Microsoft 团队网络准备情况评估](3-envision-evaluate-my-environment.md#test-the-network)</li></ul><br>**Microsoft 网络评估工具：** 使用此工具可对网络性能进行简单的测试，以确定网络对于团队或 Skype for business Online 呼叫的性能。 该工具可帮助你评估子网的性能，并根据 Microsoft 性能[要求](https://aka.ms/performancerequirements)验证网络的准备情况。<ul><li>[下载网络评估工具](https://www.microsoft.com/download/details.aspx?id=53885)</li></ul><br> |
| **服务质量 (QoS)**  | QoS 是一种经验证的工具，可帮助在拥挤的网络上优先处理数据包，确保它们的目标时间和时间保持不变。 考虑在整个组织中实施 QoS，最大程度地提高用户在带宽受到限制的体验的质量。 QoS 将帮助解决与数据包丢失较高的问题（通常与较低程度）相关的问题：抖动和往返行程时间。<ul><li>[Microsoft 团队 QoS 指南](qos-in-teams.md)</li></ul> |
| **Wi-Fi**               | Wi-fi 可能会对通话质量产生重大影响。 Wi-fi 部署通常不考虑 VoIP 服务的网络要求，并且通常是质量较差的来源。 有关优化 Wlan 基础结构的详细信息，请参阅[有关 wi-fi 计划的文章](/skypeforbusiness/certification/plan-wifi)。<br><br>**无线驱动程序**：确保无线驱动程序是最新的。 这将有助于减少与过时驱动程序相关的任何不良用户体验。 许多组织不在其修补程序周期内包含无线驱动程序，这些驱动程序可能会在几年后再进行修补。 通过确保无线驱动程序处于最新状态，解决了许多无线问题。<br><br>**WMM**：无线多媒体扩展（WMM）（也称为 wi-fi 多媒体）为无线网络提供基本 QoS 功能。 新式无线网络必须支持许多设备。 这些设备争用带宽，并且可能会导致 VoIP 服务的质量问题，其中的速度和延迟非常重要。 有关详细信息，请咨询您的无线供应商，并考虑在无线网络上实施 WMM，以确定 Skype for business 和团队媒体的优先级。<br><br>**接入点密度**：接入点可能会在理想位置中相隔太远或不在理想位置。 若要最大程度地减少潜在干扰，请在会议室中以及不受墙壁或其他物体阻碍的位置（即 Wi-fi 信号较弱的位置）放置额外的访问点。<br><br>**2.4 ghz 与 5 ghz**： 5 ghz 提供较少的后台干扰和更高的速度，并且应在通过 Wi-fi 部署 VoIP 时进行优先级划分。 但是，5 GHz 不像 2.4 GHz 那样强大，并且不会很轻松地穿透墙壁。 查看建筑物布局以确定你可以为最佳连接所依赖的频率。 |
|**网络设备** | 较大的组织可能会在网络上分布数百个设备。 与您的网络团队协作，确保从用户到 internet 的网络设备保持最新。 |
| **VPN**  | VPN 装置传统上不会用于处理实时媒体工作负荷。 某些 VPN 配置禁止使用 UDP （这是媒体的首选协议），并且仅依赖于 TCP。 请考虑实现 VPN 拆分隧道解决方案，以帮助将 VPN 减少为质量较差的源。 |
| **客户端** <br>（仅限 Skype for Business Online） | 确保定期更新所有客户端。 |
| **Devices** | 使用优化的[设备](https://partnersolutions.skypeforbusiness.com/solutionscatalog)可帮助显著改善用户体验。 随着所有方面的要求，优化的设备旨在最大限度地提高团队和 Skype for business 的用户体验，并产生优质的质量。 |
| **设备** | 修补网络（以太网和 Wi-fi）、音频、视频和 USB 驱动程序应该是整个修补程序管理策略的一部分。 通过更新驱动程序解决了许多质量问题。 |
| **Wi-fi 上的会议室** | 我们强烈建议使用至少 1 Gbps 以太网连接将会议室设备连接到网络。 会议室设备通常包括多个音频和视频流以及会议内容（如屏幕共享），并且比其他团队或 Skype for business 终结点具有更高的网络要求。 根据定义，会议室在安装期间仅提供一个福利的固定设备。<br><br>会议室需要进行额外的关注，以确保使用这些设备的体验达到或超过预期。 会议室的质量问题通常会快速升级，因为它们通常由高级人员使用。<br><br>所有内容相等（除了方便），Wi-fi 性能通常小于有线连接。 随着 "携带您自己的设备" 政策和笔记本电脑的普及，Wi-fi 接入点通常会过度使用。 实时媒体可能不会在 Wi-fi 网络上优先，这可能会导致在高峰使用时间内出现质量问题。 这种繁重的用法可能会与会议中可能有十二个人的会议相符，每个人都有自己的膝上型电脑和智能手机，并且均连接到与会议室设备相同的 Wi-fi 接入点。<br><br>仅在手机安装时，也应将 wi-fi 视为临时解决方案，或者在已正确设置 Wi-fi 以支持企业级的实时媒体时。 |


### <a name="tcp"></a>TCP

TCP 被视为 "回切传输"，而不是你想要用于实时媒体的主传输。 其故障回复传输的原因是 TCP 的状态特点。 例如，如果在潜在的网络上进行呼叫，并且媒体数据包被延迟，而不是在几秒钟前（这些数据包将不再有用），则会对带宽进行竞争以访问接收器，这可能会导致较差的情况。 这将使音频 healer 缝合和拉伸音频，从而产生可听见的项目，通常采用抖动形式。

本部分中的报表不区分良好流和不良流。 鉴于使用 UDP，报表将查找对音频、视频和基于视频的屏幕共享（VBSS）的 TCP 的使用。 提供的流费率较差有助于比较 UDP 质量与 TCP 质量，以便你可以专注于影响最大的工作。 TCP 用法主要由不完整的防火墙规则所导致。 有关团队和 Skype for Business Online 的防火墙规则的详细信息，请参阅[Office 365 url 和 IP 地址范围](https://aka.ms/o365ips)。

> [!Important]
> 强烈建议上载一个[有效的生成文件](#building-mapping)，以便你可以在查看 TCP 使用时快速区分外部流。

> [!Note]
> 音频、视频和 VBSS 所有首选 UDP 作为其主传输。 旧版 RDP 应用程序共享工作负荷仅使用 TCP。

#### <a name="tcp-usage"></a>TCP 使用情况

TCP 报表表示过去七个月内的总 TCP 使用率。 本部分中的所有进一步报表将重点介绍最常使用 TCP 的特定建筑物和子网。 单独的报表可用于会议和两方流。

![图表显示使用 tcp](media/qerguide-image-audiostreamswithtcp.png)
图25的音频流百分比（使用_tcp 使用的音频流）_


##### <a name="investigation"></a>调查

通过使用此报表，你可以回答以下问题：

-   当前月份的 TCP 流总容量是多少？
-   它是否比上个月更糟或更好？
-   TCP 使用趋势是增加、稳定还是减少？
-   TCP PSR.EXE 是否与我的总 PSR.EXE？

如果你注意到，TCP 使用趋势增加或高于正常的每月使用时间，请通过使用子报表来查找可能需要补救的任何建筑物或网络，以进行调查。 理想情况下，你希望在托管网络上尽可能少的基于 TCP 的音频会话。

#### <a name="tcp-vs-udp"></a>TCP 与 UDP

此报表标识基于音频、视频和基于视频的屏幕共享（VBSS）的最新月的 TCP 和 UDP 使用情况报告的数量。 

![显示使用 TCP 和 UDP 的流的数量的报表](media/qerguide-image-tcpvsudp.png)

_图 26-TCP 与 UDP-会议_

##### <a name="analysis"></a>定量分析

尽管你希望 TCP 使用率尽可能低，但你可能会在其他正常的部署中看到一些 TCP 用法。 TCP 本身不会影响较差的调用，因此提供了流速率以帮助确定 TCP 使用是否是影响质量较差的参与者。 

#### <a name="tcp-investigations"></a>TCP 调查

在提供的 CQD 模板中，通过使用 "托管网络" 或 "所有网络" 模板构建和子网报告，导航到 TCP 流。 为了调查 TCP 使用，流程是相同的，因此我们将重点介绍有关会议的讨论。

> [!IMPORTANT]
> 建议上载一个有效的[生成文件](#building-mapping)，以便你可以在查看 TCP 使用时快速从流外部进行区分。 

> [!NOTE]
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。                                  |

![通过构建和子网进行 TCP 使用的屏幕截图](media/qerguide-image-tcpstreams.png)

_图 27-通过构建和子网会议的 TCP 流_

##### <a name="remediation"></a>修正

此报表标识对 TCP 使用量有影响的特定建筑物和子网。 还包含一个其他报告，用于识别在通话中使用的 Microsoft 中继 IP，以帮助隔离缺少的防火墙规则。 将您的补救措施集中在具有最高 TCP 流数量的建筑物上，以最大限度地提高影响。

TCP 使用的最常见原因是防火墙或代理中缺少例外规则。 我们将在下一节中讨论有关代理的信息，以便我们将精力集中在防火墙上。 通过使用提供的建筑物或子网，你可以确定需要更新的防火墙。


_表 11-通过构建和子网进行 TCP 流的补救指南_

| 修正        | 指引     |
|--------------------|--------------------------------------|
| 配置防火墙 | 验证是否已从防火墙中排除[Office 365 IP 端口和地址](https://aka.ms/o365ips)。 对于与媒体相关的 TCP 问题，请重点关注以下各项的初始工作：<ul><li>验证客户端媒体子网 13.107.64.0/18 和 52.112.0.0/14 是否在你的防火墙规则中。</li><li>UDP 端口 3478-3481 是所需的媒体端口，必须打开，否则客户端将故障回复到 TCP 端口443。</li></ul> |
| 验证             | 使用[Microsoft 网络评估工具](https://www.microsoft.com/download/details.aspx?id=53885)检查与受影响的建筑物或子网中的特定 OFFICE 365 IP 地址和端口的连接问题。    |

### <a name="http-proxy"></a>HTTP 代理

出于多种原因，HTTP 代理不是用于建立媒体会话的首选路径。 其中许多包含有助于防止服务连接完成并导致中断的深层数据包检查功能。 此外，几乎所有的代理都强制使用 TCP，而不是允许使用 UDP，这是为了获得最佳音频质量而建议的。

我们始终建议你将客户端配置为直接连接到团队和 Skype for Business 服务。 这对于基于媒体的流量尤其重要。


> [!IMPORTANT]
> 在上载了有效的[生成文件](#building-mapping)后，可以轻松地在分析代理使用情况时将外部音频流与外部音频流区分开来。 


#### <a name="http-proxy-usage"></a>HTTP 代理使用

模板的此部分中的 HTTP 代理流报告非常类似于 TCP 报告。 它不会查看通话是否很差或是否良好，但呼叫是否通过 HTTP 连接。

![使用 HTTP 的音频流的报告的屏幕截图](media/qerguide-image-audiostreamswithhttp.png)

_图 28-具有 HTTP 代理使用的音频流_

##### <a name="analysis"></a>定量分析

你希望查看尽可能少的 HTTP 媒体流。 如果你有流遍历你的代理，请咨询你的网络团队以确保正确的排除，以便客户直接路由到团队或 Skype for business Online 媒体子网。

如果你的组织中只有一个 internet 代理，请验证正确的[Office 365 url 和 IP 地址范围排除](https://aka.ms/o365ips)。 如果您的组织中配置了多个 internet 代理，请使用 HTTP 子报告隔离受影响的建筑物或子网。

对于无法绕过代理的组织，请确保将 Skype for business 客户端配置为在代理之后正确登录，如下所述： [skype For business 应使用代理服务器登录，而不是尝试直接连接](https://support.microsoft.com/help/3207112/skype-for-business-should-use-proxy-server-to-sign-in-instead-of-tryin)。 


#### <a name="http-proxy-investigations"></a>HTTP 代理调查

此报告标识了对 HTTP 使用情况所造成的特定建筑物和子网。

> [!IMPORTANT]
> 在上载了有效的[生成文件](#building-mapping)后，可以轻松地在分析代理使用情况时将外部音频流与外部音频流区分开来。

> [!NOTE]
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。

![通过构建和子网 Sreen 的 HTTP 代理使用情况报告的快照](media/qerguide-image-httpproxyusage.png)

_图29–通过构建和子网进行的 HTTP 代理使用_

##### <a name="remediation"></a>修正

我们[建议](proxy-servers-for-skype-for-business-online.md)您始终绕过 Skype for Business 和团队（尤其是媒体流量）的代理。 代理不会使 Skype for business 更安全，因为其流量已加密。 环境中可能会出现由于延迟和数据包丢失而引起的与性能相关的问题。 此类问题将导致具有音频、视频和屏幕共享的消极体验，其中实时流非常重要。

HTTP 使用的最常见原因是代理中缺少异常规则。 通过使用提供的建筑物或子网，你可以快速确定需要为媒体绕过配置的代理。

验证代理中是否列入白名单中所需的[Office 365 fqdn](https://aka.ms/o365ips) 。

有关将代理用于 Skype for Business Online 和团队的详细信息，请参阅[本文](proxy-servers-for-skype-for-business-online.md)。

## <a name="endpoint-investigations"></a>终结点调查

本部分重点介绍用于报告客户端版本和使用已认证设备的任务。 报告可用于客户端版本、客户端类型、捕获设备和驱动程序（麦克风）、视频捕获设备和 Wlan 供应商和驱动程序版本的大纲使用。

> [!NOTE]
> 本指南不介绍这些模板中包含的所有报表;但是，下面介绍的调查方法仍适用。 有关详细信息，请参阅各个报告说明。

### <a name="client-versions"></a>客户端版本

此空间中的报表重点介绍如何识别正在使用的 Skype for business 客户端版本以及它们在环境中的相对音量。

> [!IMPORTANT]
> 当前，团队客户通过 Azure 内容交付网络自动分发和更新，并将由服务保持最新。 客户端准备情况和调查活动不适用于团队。

> [!Important]
> 除非你排除联盟参与者数据，否则这些报表将包含来自联合终结点的客户端遥测。 若要排除联合终结点，必须为设置为组织的[租户 id](#tenant-id)的第二租户 id 添加[查询筛选器](#query-filters)。 或者，你可以使用[URL 筛选器](#url-filter)来排除联合参与者遥测。

> [!NOTE]
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。

![客户端和设备报表的屏幕截图](media/qerguide-image-clientversionreport.png)

_图 30-客户端版本报告_

#### <a name="remediation"></a>修正

驱动高质量的用户体验的一个重要部分是确保托管客户在运行最新版本的 Skype for business 时，除了确保支持的音频、视频、网络和 USB 驱动程序都是最新版本。 这提供了多项好处，其中包括： 

-   更易于管理几个版本，而不是许多版本。
-   它提供经验的一致性级别。
-   它使解决通话质量和可用性问题变得更容易。
-   Microsoft 不断对整个产品进行总体改进和优化。 确保用户收到这些更新会降低其遇到已解决问题的风险。

将部署限制为不超过六个月的客户端版本将通过减少需要支持的版本的数量来改善整体用户体验并提高可管理性。

如果您仅使用 Office 即点即用，您将在 "六个月" 窗口中自动显示。 无需执行进一步操作。

如果你有混合的即点即用和安装程序包（MSI），则可以使用该报告验证是否定期更新 MSI 客户端。 如果你发现客户端的进度落后，请与负责管理 Office 更新的团队协作，确保他们定期批准和部署客户端修补程序。

还必须考虑并确保网络、视频、USB 和音频驱动程序也能进行修补。 可轻松忽略这些驱动程序，不将它们包含在修补程序管理策略中。

Skype for Business 的版本号可通过以下链接找到：

-   [Office 专业增强版更新的发布信息](https://docs.microsoft.com/officeupdates/release-notes-office365-proplus)
-   [Office 365 的更新历史记录专业增强版](https://docs.microsoft.com/officeupdates/update-history-office365-proplus-by-date)
-   [Skype for Business 下载和更新](/SkypeForBusiness/software-updates)

### <a name="devices"></a>设备

若要使用麦克风设备报表，我们需要了解平均观点（MOS）的概念。 MOS 是用于测量所看到的音频质量的金牌标准测量。 它表示为从0到5的整数分级。

语音质量的所有方法的基础是人员如何感觉语音质量。 因为它受人类认知的影响，因此它本身是主观的主观。 有多种不同的主观测试方法。 大多数语音质量指标基于绝对分类分级（ACR）缩放。

在 ACR 主观测试中，统计数量很多的人按1（坏）到5（很好）的费率对体验质量进行了评级。 分数的平均值为 MOS。 所得到的 MOS 取决于向组公开的体验范围以及要评级的体验类型。

由于对实时通信系统执行语音质量的主观测试是不切实际的，Microsoft 团队和 Skype for business 通过使用高级算法客观预测主观测试的结果来生成 MOS 值。

可用的 MOS 和相关指标集提供了一种视图，可查看由音频设备向用户发送的体验的质量。 

通过向用户提供针对团队和 Skype for business 认证的设备，你可以降低因设备本身而产生负面体验的可能性（例如，内置的便携式扬声器和麦克风更有可能）。 有关详细信息，请参阅[认证计划](/SkypeForBusiness/certification/overview)和[合作伙伴解决方案目录](https://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)中的这些文章。

设备报表用于按音量和 MOS 评分（仅限音频）评估设备使用情况，并且可以在 "客户端 & 设备" 下的随附模板中找到。 

> [!IMPORTANT]
> 除非你排除联盟参与者数据，否则这些报表将包含来自联合终结点的客户端遥测。 若要排除联合终结点，必须为设置为组织的[租户 id](#tenant-id)的**第二租户 id**添加查询筛选器。 或者，你可以使用[URL 筛选器](#url-filter)来排除联合参与者遥测。

> [!NOTE] 
> 请确保将 "月份年份" 筛选器调整为当前月份。 选择 "**编辑**"，然后调整**月份年份**以保存新的默认月份。

> [!Note]
> 您可能注意到查看此报告时，您看到的同一设备报告多次。 这是由于向 CQD 报告设备的报告方式所致。 硬件和操作系统区域设置的差异导致了设备数据的报告方式的差异。

![设备（麦克风）报告的屏幕截图](media/qerguide-image-devicesmicrophone.png)

_图 31-设备（麦克风）报告_

##### <a name="remediation"></a>修正

通常，你需要发现并阶段退出未验证的设备，并将其替换为经过认证的设备。 查看设备报表时的一些注意事项包括：

-   适用于团队和 Skype for business 的设备是否已通过认证？ 
-   你可以通过 "[呼叫分析](https://techcommunity.microsoft.com/t5/Skype-for-Business-Blog/Introducing-Call-Analytics/ba-p/57309)" 标识特定设备的用户。 检查以确保它们具有最新的设备驱动程序，并且其设备未通过 USB 集线器或扩展坞连接。 
-   不同的驱动程序正在使用多少个不同版本？ 他们是否定期进行修补？ 确保定期为音频、视频和 Wlan 驱动程序提供修补程序，有助于消除质量问题，使用户体验更具可预测性和一致性。

##### <a name="audio"></a>音频

下一项任务是确定已[认证的音频设备](https://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)的整体使用。 我们建议在所有音频流的至少80% 使用认证的音频设备。 最佳方法是将麦克风设备报告导出到 Excel 以计算认证或批准的设备的使用情况。 组织通常保留所有已批准的设备的列表，因此对数据进行筛选和排序非常简单。

##### <a name="video"></a>视频

视频驱动程序也很重要，您也可以继续更新。 确保视频卡定期修补有助于排除视频流质量不佳的视频驱动程序。 使用[经过验证的视频设备](https://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)有助于确保更平稳、高质量的用户体验。 支持 H-p 本机编码的视频设备是在视频会议期间减少 CPU 使用率的首选方法。

##### <a name="wi-fi"></a>Wi-Fi

Wi-fi 驱动程序还需要在常规节奏上进行修补，并且应包括在修补程序管理策略中。 可通过维护最新的 Wi-fi 驱动程序来纠正许多质量问题。 有关优化 Wlan 基础结构的详细信息，请参阅[有关 wi-fi 计划的文章](/skypeforbusiness/certification/networking-wifi)。

## <a name="appendix"></a>参见 

### <a name="office-365-network-connectivity-principles"></a>Office 365 网络连接原则

在开始规划 Office 365 网络连接的网络之前，请务必了解安全管理 Office 365 流量和获得最佳性能的连接原则。 以下文章将帮助您了解安全优化 Office 365 网络连接的最新指南：

[Office 365 网络连接原则](https://aka.ms/pnc)

### <a name="planning-for-wi-fi"></a>为 Wlan 进行规划

Microsoft 在无线网络中实现质量和灵活性的方法有三个部分：端到端的计划、部署中的最佳做法以及前瞻性的维护和操作。 此解决方案简述将指导你完成此过程以确保企业级的无线 Skype for business 体验：

[确保企业级的企业版 Skype for Business 体验](https://www.microsoft.com/download/details.aspx?id=47257)

### <a name="lync-networking-guide"></a>Lync 网络指南

有关团队和 Skype for Business 网络概念的更多背景以及对质量重要性背后的基本原理，请继续了解[Lync Server 2013 网络指南](https://blogs.technet.microsoft.com/nexthop/2013/06/03/lync-server-2013-networking-guide-network-planning-monitoring-and-troubleshooting-with-microsoft-lync-server/)。

### <a name="network-performance-requirements"></a>网络性能要求

通过 IP 的实时媒体质量（音频、视频和应用程序共享）很大程度上受到端到端网络连接质量的影响。 为获得最佳团队或 Skype for business 媒体质量，你的网络必须满足以下网络性能指标。

_表 12-网络性能要求_

| 指标                            | 客户端到 Microsoft Edge           | 客户边缘到 Microsoft Edge    |
|-----------------------------------|------------------------------------|------------------------------------|
| 延迟（一种方法）                 | \<50 ms                            | \<30毫秒                            |
| 延迟（RTT 或往返时间） | \<100 ms                           | \<60 ms                            |
| 爆发数据包丢失                 | \<在任何200毫秒的时间间隔内10%   | \<1% 的任何200毫秒的时间间隔    |
| 数据包丢失                       | \<在任何15秒的时间间隔内1%    | \<任何15秒的时间间隔内0.1%  |
| 数据包内部到达抖动       | \<在任何15秒的时间间隔内30毫秒 | \<任何15秒内的15毫秒 |
| 数据包重新排序                    | \<0.05% 的订单外数据包       | \<0.01% 的订单外数据包      |

有关详细信息，请参阅有关团队和 Skype for business Online 的[媒体质量和网络性能的文章](https://aka.ms/performancerequirements)。

### <a name="other-resources"></a>其他资源

#### <a name="building-data-file"></a>生成数据文件

-   [打开和使用 Microsoft 团队和 Skype for business Online 的通话质量仪表板](turning-on-and-using-call-quality-dashboard.md)

#### <a name="cqd-training"></a>CQD 培训

-   <https://aka.ms/sof-cqd>

-   [CQD](https://www.skypeoperationsframework.com/Academy?SOFTrainings=Configuring%20Call%20Quality%20Dashboard%20to%20monitor%20your%20Skype%20for%20Business%20Online%20Environment)指南和研讨会入门

-   [通话质量仪表板中可用的维度和衡量指标](https://aka.ms/cqd-dm)

### <a name="call-analytics-training"></a>通话分析培训

-   [介绍呼叫分析](https://techcommunity.microsoft.com/t5/Skype-for-Business-Blog/Introducing-Call-Analytics/ba-p/57309)

-   [设置通话分析](set-up-call-analytics.md)

-   ["呼叫分析" 和 "呼叫质量" 仪表板之间有何区别？](difference-between-call-analytics-and-call-quality-dashboard.md)

-   [使用通话分析来排查通话质量不良问题](use-call-analytics-to-troubleshoot-poor-call-quality.md)

### <a name="call-analytics-support"></a>呼叫分析支持

-   社区： [Skype for Business 预览版计划](https://techcommunity.microsoft.com/t5/Skype-for-Business-Preview/bd-p/SkypeforBusinessPreviewProgram)

### <a name="devices"></a>设备

-   [Skype for Business 解决方案目录个人外围设备 & Pc](http://partnersolutions.skypeforbusiness.com/solutionscatalog/personal-peripherals-pcs)

### <a name="tenant-reporting"></a>租户报告

-   [Office 365 采纳内容包](https://www.microsoft.com/microsoft-365/blog/2017/05/22/announcing-the-public-preview-of-the-office-365-adoption-content-pack-in-powerbi/)

-   [Microsoft 365 使用情况分析](https://support.office.com/article/Microsoft-365-usage-analytics-77ff780d-ab19-4553-adea-09cb65ad0f1f)

-   [Skype for Business Online 报告](/SkypeForBusiness/skype-for-business-online-reporting/skype-for-business-online-reporting)

-   [Microsoft 团队报告](https://techcommunity.microsoft.com/t5/Microsoft-Teams-Blog/New-usage-reports-for-Microsoft-Teams/ba-p/132614)
